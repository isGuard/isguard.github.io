<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>zea</title>
  
  
  <link href="https://blog.48626.xyz/atom.xml" rel="self"/>
  
  <link href="https://blog.48626.xyz/"/>
  <updated>2024-08-16T03:22:26.000Z</updated>
  <id>https://blog.48626.xyz/</id>
  
  <author>
    <name>初。</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>生成没有前导零的时间格式</title>
    <link href="https://blog.48626.xyz/a50057efe8bd.html"/>
    <id>https://blog.48626.xyz/a50057efe8bd.html</id>
    <published>2024-08-16T03:22:26.000Z</published>
    <updated>2024-08-16T03:22:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>在Java编程中，处理时间格式是一个常见的任务，尤其是在需要特定时间格式输出时。对于一些应用场景，我们可能需要生成没有前导零的时间格式。例如，在一些报告或用户界面中，显示<code>9:5</code>而不是<code>09:05</code>可能看起来更自然或符合特定的设计要求。本文将详细介绍如何在Java中实现这一功能。</p><h4 id="使用SimpleDateFormat类"><a href="#使用SimpleDateFormat类" class="headerlink" title="使用SimpleDateFormat类"></a>使用<code>SimpleDateFormat</code>类</h4><p>在Java中，<code>SimpleDateFormat</code>是处理日期和时间格式的一个非常强大的工具。但是，<code>SimpleDateFormat</code>并没有直接提供去除前导零的选项。不过，我们可以通过一些简单的技巧来实现这一需求。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 标准的时间格式，包含前导零</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;标准时间（有前导零）: &quot;</span> + sdf.format(cal.getTime()));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自定义格式去除前导零</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">customTime</span> <span class="operator">=</span> sdf.format(cal.getTime())</span><br><span class="line">            .replaceFirst(<span class="string">&quot;^0+(?!$)&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            .replaceAll(<span class="string">&quot;:0+&quot;</span>, <span class="string">&quot;:&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义时间（无前导零）: &quot;</span> + customTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上面的代码示例中，我们首先创建了一个<code>SimpleDateFormat</code>对象来生成标准的时间格式。然后，通过正则表达式替换的方式去除了小时和分钟的前导零。这种方法虽然有效，但它依赖于字符串操作，可能不是最优雅的解决方案。</p><h4 id="使用DateTimeFormatter类（Java-8-）"><a href="#使用DateTimeFormatter类（Java-8-）" class="headerlink" title="使用DateTimeFormatter类（Java 8+）"></a>使用<code>DateTimeFormatter</code>类（Java 8+）</h4><p>从Java 8开始，<code>DateTimeFormatter</code>类提供了更强大和灵活的日期时间格式化选项。我们可以使用这个类来直接构建没有前导零的时间格式。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LocalTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalTime.now();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用DateTimeFormatter创建没有前导零的时间格式</span></span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">dtf</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;H:m&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;时间（无前导零）: &quot;</span> + now.format(dtf));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个例子中，<code>H:m</code>模式指定了小时和分钟不带前导零的格式。这种方式不仅简洁，而且是类型安全的，避免了任何可能的类型转换错误。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>在Java中，根据你的Java版本和具体需求，你可以选择<code>SimpleDateFormat</code>或<code>DateTimeFormatter</code>来生成没有前导零的时间格式。对于Java 8及以上版本，推荐使用<code>DateTimeFormatter</code>因为它提供了更好的API支持和性能。通过这些工具，你可以灵活地处理时间格式，满足各种应用场景的需求。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在Java编程中，处理时间格式是一个常见的任务，尤其是在需要特定时间格式输出时。对于一些应用场景，我们可能需要生成没有前导零的时间格式。例如，在一些报告或用户界面中，显示&lt;code&gt;9:5&lt;/code&gt;而不是&lt;code&gt;09:05&lt;/code&gt;可能看起来更自然或符合特定的设计要求。本文将详细介绍如何在Java中实现这一功能。&lt;/p&gt;
&lt;h4 id=&quot;使用SimpleDateFormat类&quot;&gt;&lt;a href=&quot;#使用SimpleDateFormat类&quot; class=&quot;headerlink&quot; title=&quot;使用SimpleDateFormat类&quot;&gt;&lt;/a&gt;使用&lt;code&gt;SimpleDateFormat&lt;/code&gt;类&lt;/h4&gt;&lt;p&gt;在Java中，&lt;code&gt;SimpleDateFormat&lt;/code&gt;是处理日期和时间格式的一个非常强大的工具。但是，&lt;code&gt;SimpleDateFormat&lt;/code&gt;并没有直接提供去除前导零的选项。不过，我们可以通过一些简单的技巧来实现这一需求。&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://blog.48626.xyz/categories/Java/"/>
    
    
    <category term="Java" scheme="https://blog.48626.xyz/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>学生包全能油猴脚本[定位 + 摄像头]</title>
    <link href="https://blog.48626.xyz/2643f6ab131b.html"/>
    <id>https://blog.48626.xyz/2643f6ab131b.html</id>
    <published>2024-08-15T03:59:14.000Z</published>
    <updated>2024-08-15T03:59:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>安装后会在 education[.]github[.]com 页面右上角显示一个按钮，添加图片即可。<br>定位自动从OpenStreetMap获取学校经纬度，无需任何操作，和FakeLocation插件冲突，需提前关闭Fake Location插件</p><p><a href="https://pst.innomi.net/paste/jctrbukenwwdnb2qhevfzxtm/raw">https://pst.innomi.net/paste/jctrbukenwwdnb2qhevfzxtm/raw</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         Enhanced Virtual Camera Hook</span></span><br><span class="line"><span class="comment">// @namespace    updownup</span></span><br><span class="line"><span class="comment">// @version      1.0</span></span><br><span class="line"><span class="comment">// @description  Hook various camera APIs</span></span><br><span class="line"><span class="comment">// @match        *://education.github.com/*</span></span><br><span class="line"><span class="comment">// @match        *://webcamtests.com/*</span></span><br><span class="line"><span class="comment">// @match        *://www.veed.io/*</span></span><br><span class="line"><span class="comment">// @match        *://webcammictest.com/*</span></span><br><span class="line"><span class="comment">// @match        *://www.onlinemictest.com/*</span></span><br><span class="line"><span class="comment">// @grant        unsafeWindow</span></span><br><span class="line"><span class="comment">// @grant        GM_xmlhttpRequest</span></span><br><span class="line"><span class="comment">// @run-at       document-start</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> base64Image;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Utility Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Utils</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="title function_">generateRandomBase64</span>(<span class="params">length</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> characters = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span>;</span><br><span class="line">            <span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">const</span> charactersLength = characters.<span class="property">length</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">                result += characters.<span class="title function_">charAt</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * charactersLength));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">getBase64Image</span>(<span class="params">defaultBase64Image</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> base64Image || defaultBase64Image;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Stealth UI Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">StealthUI</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">defaultBase64Image</span> = <span class="string">&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==&#x27;</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">createUI</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">createUI</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">            container.<span class="property">style</span>.<span class="property">all</span> = <span class="string">&#x27;initial&#x27;</span>;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">appendChild</span>(container);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> shadow = container.<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;closed&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> styles = <span class="string">`</span></span><br><span class="line"><span class="string">            :host &#123; all: initial; &#125;</span></span><br><span class="line"><span class="string">            #stealth-container &#123; position: fixed; top: 0; right: 0; z-index: 2147483647; background-color: rgba(0, 0, 0, 0); padding: 0; border-radius: 7px; transition: opacity 0.3s ease-in-out, background-color 0.3s ease-in-out; font-family: Arial, sans-serif; font-size: 12px; box-sizing: border-box; width: auto; max-width: 200px; opacity: 0.1; &#125;</span></span><br><span class="line"><span class="string">            #stealth-container:hover &#123; background-color: rgba(0, 220, 0, 0.25); opacity: 1; &#125;</span></span><br><span class="line"><span class="string">            #stealth-container.hidden &#123; opacity: 0; pointer-events: none; &#125;</span></span><br><span class="line"><span class="string">            #stealth-fileInput &#123; display: none; &#125;</span></span><br><span class="line"><span class="string">            #stealth-loadButton &#123; background-color: rgba(0, 0, 0, 0); border: none; padding: 5px; border-radius: 8px; cursor: pointer; font-size: inherit; width: 100%; text-align: center; color: black; transition: background-color 0.25s ease-in-out; &#125;</span></span><br><span class="line"><span class="string">            #stealth-loadButton:hover &#123; border-radius: 3px; cursor: pointer; background-color: rgba(25, 25, 25, 0.25); &#125;</span></span><br><span class="line"><span class="string">            #stealth-loadButton.done &#123; animation: spin 2s linear infinite; &#125;</span></span><br><span class="line"><span class="string">            @keyframes spin &#123; 0% &#123; transform: rotate(0deg); &#125; 100% &#123; transform: rotate(360deg); &#125; &#125;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> template = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;template&#x27;</span>);</span><br><span class="line">            template.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;style&gt;<span class="subst">$&#123;styles&#125;</span>&lt;/style&gt;</span></span><br><span class="line"><span class="string">            &lt;div id=&quot;stealth-container&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;file&quot; id=&quot;stealth-fileInput&quot; accept=&quot;image/*&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;button id=&quot;stealth-loadButton&quot;&gt;Load&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line"></span><br><span class="line">            shadow.<span class="title function_">appendChild</span>(template.<span class="property">content</span>.<span class="title function_">cloneNode</span>(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> stealthContainer = shadow.<span class="title function_">getElementById</span>(<span class="string">&#x27;stealth-container&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> fileInput = shadow.<span class="title function_">getElementById</span>(<span class="string">&#x27;stealth-fileInput&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> loadButton = shadow.<span class="title function_">getElementById</span>(<span class="string">&#x27;stealth-loadButton&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            loadButton.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">                fileInput.<span class="title function_">click</span>();</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            fileInput.<span class="property">onchange</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">                <span class="keyword">if</span> (fileInput.<span class="property">files</span> &amp;&amp; fileInput.<span class="property">files</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">                    loadButton.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;done&#x27;</span>);</span><br><span class="line">                    loadButton.<span class="property">textContent</span> = <span class="string">&#x27;...&#x27;</span>;</span><br><span class="line">                    <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">                    reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                        base64Image = e.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">                        loadButton.<span class="property">textContent</span> = <span class="string">&#x27;√&#x27;</span>;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    reader.<span class="title function_">readAsDataURL</span>(fileInput.<span class="property">files</span>[<span class="number">0</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Virtual Stream Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">VirtualStream</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">width = <span class="number">1280</span>, height = <span class="number">720</span>, fps = <span class="number">30</span></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">width</span> = width;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">height</span> = height;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">fps</span> = fps;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">createNoiseLayer</span>(<span class="params">opacity = <span class="number">0.26149721</span></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            canvas.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">            canvas.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> imageData = ctx.<span class="title function_">createImageData</span>(<span class="variable language_">this</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">height</span>);</span><br><span class="line">            <span class="keyword">const</span> data = imageData.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> noise = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>;</span><br><span class="line">                data[i] = data[i + <span class="number">1</span>] = data[i + <span class="number">2</span>] = noise;</span><br><span class="line">                data[i + <span class="number">3</span>] = opacity * <span class="number">255</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ctx.<span class="title function_">putImageData</span>(imageData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> canvas;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">drawImageCovered</span>(<span class="params">ctx, img, x, y, w, h</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> imgRatio = img.<span class="property">width</span> / img.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> canvasRatio = w / h;</span><br><span class="line">            <span class="keyword">let</span> sx, sy, sWidth, sHeight;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (imgRatio &gt; canvasRatio) &#123;</span><br><span class="line">                sHeight = img.<span class="property">height</span>;</span><br><span class="line">                sWidth = sHeight * canvasRatio;</span><br><span class="line">                sx = (img.<span class="property">width</span> - sWidth) / <span class="number">2</span>;</span><br><span class="line">                sy = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sWidth = img.<span class="property">width</span>;</span><br><span class="line">                sHeight = sWidth / canvasRatio;</span><br><span class="line">                sx = <span class="number">0</span>;</span><br><span class="line">                sy = (img.<span class="property">height</span> - sHeight) / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ctx.<span class="title function_">drawImage</span>(img, sx, sy, sWidth, sHeight, x, y, w, h);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">createDynamicFilteredStream</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            canvas.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">            canvas.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">            img.<span class="property">src</span> = <span class="keyword">await</span> <span class="title class_">Utils</span>.<span class="title function_">getBase64Image</span>(<span class="keyword">new</span> <span class="title class_">StealthUI</span>().<span class="property">defaultBase64Image</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> offscreenCanvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            offscreenCanvas.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">            offscreenCanvas.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> offscreenCtx = offscreenCanvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            img.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">drawImageCovered</span>(offscreenCtx, img, <span class="number">0</span>, <span class="number">0</span>, offscreenCanvas.<span class="property">width</span>, offscreenCanvas.<span class="property">height</span>);</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> noiseLayer = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">createNoiseLayer</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> hue = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">let</span> saturate = <span class="number">100</span>;</span><br><span class="line">            <span class="keyword">let</span> brightness = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">generateFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">                hue = (hue + <span class="number">0.1</span>) % <span class="number">2</span>;</span><br><span class="line">                saturate = <span class="number">99</span> + <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) * <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">                brightness = <span class="number">98</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">                ctx.<span class="title function_">drawImage</span>(offscreenCanvas, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                ctx.<span class="property">filter</span> = <span class="string">`hue-rotate(<span class="subst">$&#123;hue&#125;</span>deg) saturate(<span class="subst">$&#123;saturate&#125;</span>%) brightness(<span class="subst">$&#123;brightness&#125;</span>%)`</span>;</span><br><span class="line">                ctx.<span class="title function_">drawImage</span>(canvas, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                ctx.<span class="property">filter</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                ctx.<span class="property">globalCompositeOperation</span> = <span class="string">&#x27;overlay&#x27;</span>;</span><br><span class="line">                ctx.<span class="title function_">drawImage</span>(noiseLayer, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                ctx.<span class="property">globalCompositeOperation</span> = <span class="string">&#x27;source-over&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> stream = canvas.<span class="title function_">captureStream</span>(<span class="variable language_">this</span>.<span class="property">fps</span>);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">setInterval</span>(generateFrame, <span class="number">1000</span> / <span class="variable language_">this</span>.<span class="property">fps</span>);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                noiseLayer = <span class="variable language_">this</span>.<span class="title function_">createNoiseLayer</span>();</span><br><span class="line">            &#125;, <span class="number">100</span> + <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) * <span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> stream;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">createWebGLFilteredStream</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            canvas.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">            canvas.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> gl = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;webgl&#x27;</span>) || canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;experimental-webgl&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!gl) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;WebGL not supported, falling back to 2D canvas&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">createDynamicFilteredStream</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> vertexShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">                attribute vec2 a_position;</span></span><br><span class="line"><span class="string">                attribute vec2 a_texCoord;</span></span><br><span class="line"><span class="string">                varying vec2 v_texCoord;</span></span><br><span class="line"><span class="string">                void main() &#123;</span></span><br><span class="line"><span class="string">                    gl_Position = vec4(a_position, 0, 1);</span></span><br><span class="line"><span class="string">                    v_texCoord = a_texCoord;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> fragmentShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">                precision mediump float;</span></span><br><span class="line"><span class="string">                uniform sampler2D u_image;</span></span><br><span class="line"><span class="string">                uniform sampler2D u_noise;</span></span><br><span class="line"><span class="string">                uniform float u_time;</span></span><br><span class="line"><span class="string">                uniform vec2 u_noiseOffset;</span></span><br><span class="line"><span class="string">                varying vec2 v_texCoord;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                vec3 rgb2hsv(vec3 c) &#123;</span></span><br><span class="line"><span class="string">                    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);</span></span><br><span class="line"><span class="string">                    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));</span></span><br><span class="line"><span class="string">                    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));</span></span><br><span class="line"><span class="string">                    float d = q.x - min(q.w, q.y);</span></span><br><span class="line"><span class="string">                    float e = 1.0e-10;</span></span><br><span class="line"><span class="string">                    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                vec3 hsv2rgb(vec3 c) &#123;</span></span><br><span class="line"><span class="string">                    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);</span></span><br><span class="line"><span class="string">                    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);</span></span><br><span class="line"><span class="string">                    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                void main() &#123;</span></span><br><span class="line"><span class="string">                    vec4 color = texture2D(u_image, vec2(v_texCoord.x, 1.0 - v_texCoord.y));</span></span><br><span class="line"><span class="string">                    vec4 noise = texture2D(u_noise, v_texCoord * 4.0 + u_noiseOffset);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    vec3 hsv = rgb2hsv(color.rgb);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    float saturationAdjust = 0.99 + sin(u_time * 0.002) * 0.01;</span></span><br><span class="line"><span class="string">                    hsv.y *= saturationAdjust;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    float brightnessAdjust = 0.98 + 0.02 * fract(sin(dot(v_texCoord, vec2(12.9898, 78.233))) * 43758.5453);</span></span><br><span class="line"><span class="string">                    hsv.z *= brightnessAdjust;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    vec3 rgb = hsv2rgb(hsv);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    gl_FragColor = vec4(rgb, color.a) + noise * 0.1;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">createShader</span>(<span class="params">gl, type, source</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> shader = gl.<span class="title function_">createShader</span>(type);</span><br><span class="line">                gl.<span class="title function_">shaderSource</span>(shader, source);</span><br><span class="line">                gl.<span class="title function_">compileShader</span>(shader);</span><br><span class="line">                <span class="keyword">if</span> (!gl.<span class="title function_">getShaderParameter</span>(shader, gl.<span class="property">COMPILE_STATUS</span>)) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;An error occurred compiling the shaders: &#x27;</span> + gl.<span class="title function_">getShaderInfoLog</span>(shader));</span><br><span class="line">                    gl.<span class="title function_">deleteShader</span>(shader);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> shader;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> vertexShader = <span class="title function_">createShader</span>(gl, gl.<span class="property">VERTEX_SHADER</span>, vertexShaderSource);</span><br><span class="line">            <span class="keyword">const</span> fragmentShader = <span class="title function_">createShader</span>(gl, gl.<span class="property">FRAGMENT_SHADER</span>, fragmentShaderSource);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> program = gl.<span class="title function_">createProgram</span>();</span><br><span class="line">            gl.<span class="title function_">attachShader</span>(program, vertexShader);</span><br><span class="line">            gl.<span class="title function_">attachShader</span>(program, fragmentShader);</span><br><span class="line">            gl.<span class="title function_">linkProgram</span>(program);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!gl.<span class="title function_">getProgramParameter</span>(program, gl.<span class="property">LINK_STATUS</span>)) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Unable to initialize the shader program: &#x27;</span> + gl.<span class="title function_">getProgramInfoLog</span>(program));</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> positionBuffer = gl.<span class="title function_">createBuffer</span>();</span><br><span class="line">            gl.<span class="title function_">bindBuffer</span>(gl.<span class="property">ARRAY_BUFFER</span>, positionBuffer);</span><br><span class="line">            gl.<span class="title function_">bufferData</span>(gl.<span class="property">ARRAY_BUFFER</span>, <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">                -<span class="number">1</span>, -<span class="number">1</span>,</span><br><span class="line">                <span class="number">1</span>, -<span class="number">1</span>,</span><br><span class="line">                -<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">            ]), gl.<span class="property">STATIC_DRAW</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> texCoordBuffer = gl.<span class="title function_">createBuffer</span>();</span><br><span class="line">            gl.<span class="title function_">bindBuffer</span>(gl.<span class="property">ARRAY_BUFFER</span>, texCoordBuffer);</span><br><span class="line">            gl.<span class="title function_">bufferData</span>(gl.<span class="property">ARRAY_BUFFER</span>, <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">            ]), gl.<span class="property">STATIC_DRAW</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> positionLocation = gl.<span class="title function_">getAttribLocation</span>(program, <span class="string">&#x27;a_position&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> texCoordLocation = gl.<span class="title function_">getAttribLocation</span>(program, <span class="string">&#x27;a_texCoord&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            gl.<span class="title function_">useProgram</span>(program);</span><br><span class="line">            gl.<span class="title function_">enableVertexAttribArray</span>(positionLocation);</span><br><span class="line">            gl.<span class="title function_">enableVertexAttribArray</span>(texCoordLocation);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> imageTexture = gl.<span class="title function_">createTexture</span>();</span><br><span class="line">            gl.<span class="title function_">bindTexture</span>(gl.<span class="property">TEXTURE_2D</span>, imageTexture);</span><br><span class="line">            gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_WRAP_S</span>, gl.<span class="property">CLAMP_TO_EDGE</span>);</span><br><span class="line">            gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_WRAP_T</span>, gl.<span class="property">CLAMP_TO_EDGE</span>);</span><br><span class="line">            gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_MIN_FILTER</span>, gl.<span class="property">LINEAR</span>);</span><br><span class="line">            gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_MAG_FILTER</span>, gl.<span class="property">LINEAR</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">            img.<span class="property">src</span> = <span class="keyword">await</span> <span class="title class_">Utils</span>.<span class="title function_">getBase64Image</span>(<span class="keyword">new</span> <span class="title class_">StealthUI</span>().<span class="property">defaultBase64Image</span>);</span><br><span class="line">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> img.<span class="property">onload</span> = resolve);</span><br><span class="line"></span><br><span class="line">            gl.<span class="title function_">texImage2D</span>(gl.<span class="property">TEXTURE_2D</span>, <span class="number">0</span>, gl.<span class="property">RGBA</span>, gl.<span class="property">RGBA</span>, gl.<span class="property">UNSIGNED_BYTE</span>, img);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">createNoiseTexture</span>(<span class="params">gl, size</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> pixels = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(size * size * <span class="number">4</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pixels.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> noise = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>;</span><br><span class="line">                    pixels[i] = pixels[i + <span class="number">1</span>] = pixels[i + <span class="number">2</span>] = noise;</span><br><span class="line">                    pixels[i + <span class="number">3</span>] = <span class="number">255</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">const</span> texture = gl.<span class="title function_">createTexture</span>();</span><br><span class="line">                gl.<span class="title function_">bindTexture</span>(gl.<span class="property">TEXTURE_2D</span>, texture);</span><br><span class="line">                gl.<span class="title function_">texImage2D</span>(gl.<span class="property">TEXTURE_2D</span>, <span class="number">0</span>, gl.<span class="property">RGBA</span>, size, size, <span class="number">0</span>, gl.<span class="property">RGBA</span>, gl.<span class="property">UNSIGNED_BYTE</span>, pixels);</span><br><span class="line">                gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_MIN_FILTER</span>, gl.<span class="property">LINEAR</span>);</span><br><span class="line">                gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_MAG_FILTER</span>, gl.<span class="property">LINEAR</span>);</span><br><span class="line">                gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_WRAP_S</span>, gl.<span class="property">REPEAT</span>);</span><br><span class="line">                gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_WRAP_T</span>, gl.<span class="property">REPEAT</span>);</span><br><span class="line">                <span class="keyword">return</span> texture;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> noiseTexture = <span class="title function_">createNoiseTexture</span>(gl, <span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> u_image = gl.<span class="title function_">getUniformLocation</span>(program, <span class="string">&#x27;u_image&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> u_noise = gl.<span class="title function_">getUniformLocation</span>(program, <span class="string">&#x27;u_noise&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> u_time = gl.<span class="title function_">getUniformLocation</span>(program, <span class="string">&#x27;u_time&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> u_noiseOffset = gl.<span class="title function_">getUniformLocation</span>(program, <span class="string">&#x27;u_noiseOffset&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            gl.<span class="title function_">uniform1i</span>(u_image, <span class="number">0</span>);</span><br><span class="line">            gl.<span class="title function_">uniform1i</span>(u_noise, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> noiseOffsetX = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">let</span> noiseOffsetY = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">time</span>) &#123;</span><br><span class="line">                gl.<span class="title function_">bindBuffer</span>(gl.<span class="property">ARRAY_BUFFER</span>, positionBuffer);</span><br><span class="line">                gl.<span class="title function_">vertexAttribPointer</span>(positionLocation, <span class="number">2</span>, gl.<span class="property">FLOAT</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">bindBuffer</span>(gl.<span class="property">ARRAY_BUFFER</span>, texCoordBuffer);</span><br><span class="line">                gl.<span class="title function_">vertexAttribPointer</span>(texCoordLocation, <span class="number">2</span>, gl.<span class="property">FLOAT</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">activeTexture</span>(gl.<span class="property">TEXTURE0</span>);</span><br><span class="line">                gl.<span class="title function_">bindTexture</span>(gl.<span class="property">TEXTURE_2D</span>, imageTexture);</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">activeTexture</span>(gl.<span class="property">TEXTURE1</span>);</span><br><span class="line">                gl.<span class="title function_">bindTexture</span>(gl.<span class="property">TEXTURE_2D</span>, noiseTexture);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Update noise offset</span></span><br><span class="line">                noiseOffsetX = (noiseOffsetX + <span class="number">0.001</span>) % <span class="number">1</span>;</span><br><span class="line">                noiseOffsetY = (noiseOffsetY + <span class="number">0.001</span>) % <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">uniform1f</span>(u_time, time);</span><br><span class="line">                gl.<span class="title function_">uniform2f</span>(u_noiseOffset, noiseOffsetX, noiseOffsetY);</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">drawArrays</span>(gl.<span class="property">TRIANGLE_STRIP</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> fps = <span class="variable language_">this</span>.<span class="property">fps</span>;</span><br><span class="line">            <span class="keyword">const</span> stream = canvas.<span class="title function_">captureStream</span>(fps);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> lastTime = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">update</span>(<span class="params">currentTime</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (currentTime - lastTime &gt;= <span class="number">1000</span> / fps) &#123;</span><br><span class="line">                    <span class="title function_">render</span>(currentTime);</span><br><span class="line">                    lastTime = currentTime;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">requestAnimationFrame</span>(update);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="title function_">update</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> stream;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">createVirtualStream</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">createWebGLFilteredStream</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- API Hook Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">APIHook</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span> = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span> = <span class="title class_">Utils</span>.<span class="title function_">generateRandomBase64</span>(<span class="number">43</span>) + <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">virtualGroupId</span> = <span class="title class_">Utils</span>.<span class="title function_">generateRandomBase64</span>(<span class="number">43</span>) + <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookMediaDevices</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookRTCPeerConnection</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookMediaStreamTrack</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookImageCapture</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookGeolocation</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title class_">Quenching</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Quenching</span>() &#123;</span><br><span class="line">            <span class="keyword">const</span> originalToString = <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line">            <span class="keyword">const</span> map = <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>;</span><br><span class="line"></span><br><span class="line">            <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(originalToString, &#123;</span><br><span class="line">                <span class="title function_">apply</span>(<span class="params">target, thisArg, argumentsList</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> thisArg?.<span class="property">call</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">apply</span>(target, thisArg, argumentsList);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (map.<span class="title function_">has</span>(thisArg)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">apply</span>(target, map.<span class="title function_">get</span>(thisArg), argumentsList);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">apply</span>(target, thisArg, argumentsList);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Helper function to replace a method with a hook</span></span><br><span class="line">        <span class="title function_">replaceMethod</span>(<span class="params">obj, methodName, newMethod</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> oldMethod = obj[methodName]</span><br><span class="line">            obj[methodName] = newMethod;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">set</span>(newMethod, oldMethod);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook navigator.mediaDevices methods</span></span><br><span class="line">        <span class="title function_">hookMediaDevices</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">mediaDevices</span>, <span class="string">&#x27;enumerateDevices&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="keyword">const</span> devices = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">get</span>(navigator.<span class="property">mediaDevices</span>.<span class="property">enumerateDevices</span>).<span class="title function_">call</span>(navigator.<span class="property">mediaDevices</span>);</span><br><span class="line">                <span class="keyword">const</span> virtualDevice = <span class="keyword">new</span> <span class="title class_">MediaDeviceInfo</span>(&#123;</span><br><span class="line">                    <span class="attr">deviceId</span>: <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>,</span><br><span class="line">                    <span class="attr">groupId</span>: <span class="variable language_">this</span>.<span class="property">virtualGroupId</span>,</span><br><span class="line">                    <span class="attr">kind</span>: <span class="string">&#x27;videoinput&#x27;</span>,</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;Integrated Webcam&#x27;</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> [virtualDevice, ...devices];</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">mediaDevices</span>, <span class="string">&#x27;getUserMedia&#x27;</span>, <span class="keyword">async</span> (constraints) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (constraints &amp;&amp; constraints.<span class="property">video</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">VirtualStream</span>().<span class="title function_">createVirtualStream</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">get</span>(navigator.<span class="property">mediaDevices</span>.<span class="property">getUserMedia</span>).<span class="title function_">call</span>(navigator.<span class="property">mediaDevices</span>, constraints);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">mediaDevices</span>, <span class="string">&#x27;getDisplayMedia&#x27;</span>, <span class="keyword">async</span> (constraints) =&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">VirtualStream</span>().<span class="title function_">createVirtualStream</span>();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook RTCPeerConnection</span></span><br><span class="line">        <span class="title function_">hookRTCPeerConnection</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(<span class="variable language_">window</span>, <span class="string">&#x27;RTCPeerConnection&#x27;</span>, (<span class="function"><span class="params">originalRTCPeerConnection</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> pc = <span class="keyword">new</span> <span class="title function_">originalRTCPeerConnection</span>(...args);</span><br><span class="line"></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(pc, <span class="string">&#x27;addTrack&#x27;</span>, (<span class="function"><span class="params">originalAddTrack</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (args[<span class="number">0</span>] &amp;&amp; args[<span class="number">0</span>].<span class="property">kind</span> === <span class="string">&#x27;video&#x27;</span> &amp;&amp; args[<span class="number">0</span>].<span class="title function_">getSettings</span>().<span class="property">deviceId</span> === <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>) &#123;</span><br><span class="line">                                <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">VirtualStream</span>().<span class="title function_">createVirtualStream</span>();</span><br><span class="line">                                <span class="keyword">const</span> [videoTrack] = stream.<span class="title function_">getVideoTracks</span>();</span><br><span class="line">                                <span class="keyword">return</span> originalAddTrack.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="keyword">new</span> <span class="title class_">VirtualTrack</span>(videoTrack), ...args.<span class="title function_">slice</span>(<span class="number">1</span>));</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> originalAddTrack.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> pc;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>)(<span class="variable language_">window</span>.<span class="property">RTCPeerConnection</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook MediaStreamTrack</span></span><br><span class="line">        <span class="title function_">hookMediaStreamTrack</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(<span class="variable language_">window</span>, <span class="string">&#x27;MediaStreamTrack&#x27;</span>, (<span class="function"><span class="params">originalMediaStreamTrack</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> track = <span class="keyword">new</span> <span class="title function_">originalMediaStreamTrack</span>(...args);</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(track, <span class="string">&#x27;getSettings&#x27;</span>, (<span class="function"><span class="params">originalGetSettings</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> settings = originalGetSettings.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">                            <span class="keyword">if</span> (settings.<span class="property">deviceId</span> === <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>) &#123;</span><br><span class="line">                                <span class="keyword">return</span> &#123;</span><br><span class="line">                                    ...settings,</span><br><span class="line">                                    <span class="attr">deviceId</span>: <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>,</span><br><span class="line">                                    <span class="attr">groupId</span>: <span class="variable language_">this</span>.<span class="property">virtualGroupId</span>,</span><br><span class="line">                                    <span class="attr">width</span>: <span class="number">1280</span>,</span><br><span class="line">                                    <span class="attr">height</span>: <span class="number">720</span>,</span><br><span class="line">                                    <span class="attr">aspectRatio</span>: <span class="number">16</span> / <span class="number">9</span>,</span><br><span class="line">                                    <span class="attr">frameRate</span>: <span class="number">30</span>,</span><br><span class="line">                                    <span class="attr">facingMode</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">                                    <span class="attr">resizeMode</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">                                &#125;;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> settings;</span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> track;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>)(<span class="variable language_">window</span>.<span class="property">MediaStreamTrack</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook ImageCapture</span></span><br><span class="line">        <span class="title function_">hookImageCapture</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(<span class="variable language_">window</span>, <span class="string">&#x27;ImageCapture&#x27;</span>, (<span class="function"><span class="params">originalImageCapture</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">track</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (track.<span class="property">kind</span> === <span class="string">&#x27;video&#x27;</span> &amp;&amp; track.<span class="title function_">getSettings</span>().<span class="property">deviceId</span> === <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> virtualTrack = <span class="keyword">new</span> <span class="title class_">VirtualTrack</span>(track);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">originalImageCapture</span>(virtualTrack);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">originalImageCapture</span>(track);</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>)(<span class="variable language_">window</span>.<span class="property">ImageCapture</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Geolocation Spoofing</span></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">getCoordinatesFromAddress</span>(<span class="params">address</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">GM_xmlhttpRequest</span>(&#123;</span><br><span class="line">                    <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">`https://nominatim.openstreetmap.org/search?q=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(address)&#125;</span>&amp;format=json`</span>,</span><br><span class="line">                    <span class="attr">onload</span>: <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (response.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(response.<span class="property">responseText</span>);</span><br><span class="line">                            <span class="keyword">if</span> (data.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="title function_">resolve</span>(&#123;</span><br><span class="line">                                    <span class="attr">latitude</span>: <span class="built_in">parseFloat</span>(data[<span class="number">0</span>].<span class="property">lat</span>),</span><br><span class="line">                                    <span class="attr">longitude</span>: <span class="built_in">parseFloat</span>(data[<span class="number">0</span>].<span class="property">lon</span>)</span><br><span class="line">                                &#125;);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No results found&quot;</span>));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status <span class="subst">$&#123;response.status&#125;</span>`</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">onerror</span>: <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">getRandomOffset</span>(<span class="params">maxOffset = <span class="number">0.00005</span></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>) * <span class="number">2</span> * maxOffset;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">updateMockedGeolocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> schoolInput = <span class="variable language_">document</span>.evaluate(<span class="string">&#x27;//*[@id=&quot;school-input&quot;]&#x27;</span>, <span class="variable language_">document</span>, <span class="literal">null</span>, <span class="title class_">XPathResult</span>.<span class="property">FIRST_ORDERED_NODE_TYPE</span>, <span class="literal">null</span>).<span class="property">singleNodeValue</span>;</span><br><span class="line">            <span class="keyword">if</span> (schoolInput &amp;&amp; schoolInput.<span class="property">value</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> coordinates = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getCoordinatesFromAddress</span>(schoolInput.<span class="property">value</span>);</span><br><span class="line">                    <span class="keyword">if</span> (coordinates) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">mockedGeolocation</span> = &#123;</span><br><span class="line">                            <span class="attr">latitude</span>: coordinates.<span class="property">latitude</span> + <span class="variable language_">this</span>.<span class="title function_">getRandomOffset</span>(),</span><br><span class="line">                            <span class="attr">longitude</span>: coordinates.<span class="property">longitude</span> + <span class="variable language_">this</span>.<span class="title function_">getRandomOffset</span>(),</span><br><span class="line">                            <span class="attr">accuracy</span>: <span class="number">30</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">20</span></span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error updating mocked geolocation:&quot;</span>, error);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook Geolocation</span></span><br><span class="line">        <span class="title function_">hookGeolocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">geolocation</span>, <span class="string">&#x27;getCurrentPosition&#x27;</span>, <span class="keyword">async</span> (successCallback, errorCallback, options) =&gt; &#123;</span><br><span class="line">                <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">updateMockedGeolocation</span>();</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>) &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">successCallback</span>(&#123;</span><br><span class="line">                            <span class="attr">coords</span>: &#123;</span><br><span class="line">                                <span class="attr">latitude</span>: <span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>.<span class="property">latitude</span>,</span><br><span class="line">                                <span class="attr">longitude</span>: <span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>.<span class="property">longitude</span>,</span><br><span class="line">                                <span class="attr">accuracy</span>: <span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>.<span class="property">accuracy</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;, <span class="number">2500</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">500</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">get</span>(navigator.<span class="property">geolocation</span>.<span class="property">getCurrentPosition</span>).<span class="title function_">call</span>(navigator.<span class="property">geolocation</span>, successCallback, errorCallback, options);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">geolocation</span>, <span class="string">&#x27;watchPosition&#x27;</span>, <span class="keyword">async</span> (successCallback, errorCallback, options) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> watchId = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        navigator.<span class="property">geolocation</span>.<span class="title function_">getCurrentPosition</span>(successCallback, errorCallback, options);</span><br><span class="line">                    &#125;, <span class="number">5000</span>);</span><br><span class="line">                    <span class="keyword">return</span> watchId;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">get</span>(navigator.<span class="property">geolocation</span>.<span class="property">watchPosition</span>).<span class="title function_">call</span>(navigator.<span class="property">geolocation</span>, successCallback, errorCallback, options);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">geolocation</span>, <span class="string">&#x27;clearWatch&#x27;</span>, <span class="function">(<span class="params">watchId</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(watchId);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Virtual Track Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">VirtualTrack</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">originalTrack</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">originalTrack</span> = originalTrack;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">muted</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">constraints</span> = &#123;&#125;;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">settings</span> = &#123;</span><br><span class="line">                <span class="attr">deviceId</span>: <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>,</span><br><span class="line">                <span class="attr">groupId</span>: <span class="variable language_">this</span>.<span class="property">virtualGroupId</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">1280</span>,</span><br><span class="line">                <span class="attr">height</span>: <span class="number">720</span>,</span><br><span class="line">                <span class="attr">aspectRatio</span>: <span class="number">16</span> / <span class="number">9</span>,</span><br><span class="line">                <span class="attr">frameRate</span>: <span class="number">30</span>,</span><br><span class="line">                <span class="attr">facingMode</span>: <span class="string">&#x27;user&#x27;</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">id</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">kind</span>() &#123; <span class="keyword">return</span> <span class="string">&#x27;video&#x27;</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">label</span>() &#123; <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">enabled</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">enabled</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">muted</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">muted</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">readyState</span>() &#123; <span class="keyword">return</span> <span class="string">&#x27;live&#x27;</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">getConstraints</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> &#123; ...<span class="variable language_">this</span>.<span class="property">constraints</span> &#125;; &#125;</span><br><span class="line">        <span class="title function_">getSettings</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> &#123; ...<span class="variable language_">this</span>.<span class="property">settings</span> &#125;; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">getCapabilities</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">width</span>: &#123; <span class="attr">min</span>: <span class="number">640</span>, <span class="attr">max</span>: <span class="number">1920</span> &#125;,</span><br><span class="line">                <span class="attr">height</span>: &#123; <span class="attr">min</span>: <span class="number">480</span>, <span class="attr">max</span>: <span class="number">1080</span> &#125;,</span><br><span class="line">                <span class="attr">aspectRatio</span>: &#123; <span class="attr">min</span>: <span class="number">1.33</span>, <span class="attr">max</span>: <span class="number">1.78</span> &#125;,</span><br><span class="line">                <span class="attr">frameRate</span>: &#123; <span class="attr">min</span>: <span class="number">15</span>, <span class="attr">max</span>: <span class="number">60</span> &#125;,</span><br><span class="line">                <span class="attr">facingMode</span>: [<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;environment&#x27;</span>],</span><br><span class="line">                <span class="attr">resizeMode</span>: [<span class="string">&#x27;none&#x27;</span>, <span class="string">&#x27;crop-and-scale&#x27;</span>]</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">applyConstraints</span>(<span class="params">newConstraints</span>) &#123;</span><br><span class="line">            <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>.<span class="property">constraints</span>, newConstraints);</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">enabled</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">originalTrack</span>.<span class="title function_">stop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --------  Modify MediaDeviceInfo --------</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">OriginalMediaDeviceInfo</span> = unsafeWindow.<span class="property">MediaDeviceInfo</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">MediaDeviceInfo</span>(<span class="params">&#123; deviceId, groupId, kind, label &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">MediaDeviceInfo</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MediaDeviceInfo</span>(&#123; deviceId, groupId, kind, label &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(<span class="variable language_">this</span>, &#123;</span><br><span class="line">            <span class="attr">deviceId</span>: &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> deviceId; &#125;,</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">groupId</span>: &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> groupId; &#125;,</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">kind</span>: &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> kind; &#125;,</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">label</span>: &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> label; &#125;,</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">MediaDeviceInfo</span>, <span class="string">&#x27;length&#x27;</span>, &#123; <span class="attr">value</span>: <span class="number">0</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">    <span class="title class_">MediaDeviceInfo</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">OriginalMediaDeviceInfo</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    <span class="title class_">MediaDeviceInfo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">MediaDeviceInfo</span>;</span><br><span class="line"></span><br><span class="line">    unsafeWindow.<span class="property">MediaDeviceInfo</span> = <span class="title class_">MediaDeviceInfo</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Initialize --------</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">StealthUI</span>();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">APIHook</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Enhanced Virtual Camera Hook injected&#x27;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;安装后会在 education[.]github[.]com 页面右上角显示一个按钮，添加图片即可。&lt;br&gt;定位自动从OpenStreetMap获取学校经纬度，无需任何操作，和FakeLocation插件冲突，需提前关闭Fake Location插件&lt;/p&gt;

&lt;p&gt;&lt;a </summary>
      
    
    
    
    <category term="gitHub" scheme="https://blog.48626.xyz/categories/gitHub/"/>
    
    
    <category term="gitHub" scheme="https://blog.48626.xyz/tags/gitHub/"/>
    
  </entry>
  
  <entry>
    <title>IntelliJ IDEA Jvm配置</title>
    <link href="https://blog.48626.xyz/0621063cca74.html"/>
    <id>https://blog.48626.xyz/0621063cca74.html</id>
    <published>2024-08-05T06:17:08.000Z</published>
    <updated>2024-08-05T06:17:08.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">## 基础配置</span><br><span class="line"># 服务器模式运行</span><br><span class="line">-server</span><br><span class="line"># 时区编码</span><br><span class="line">-Dfile.encoding=UTF-8</span><br><span class="line">-Duser.timezone=GMT+8</span><br><span class="line"># 设置堆的初始大小和最大大小</span><br><span class="line">-Xms8g</span><br><span class="line">-Xmx32g</span><br><span class="line"># 设置元空间的初始大小和最大大小</span><br><span class="line">-XX:MetaspaceSize=1G</span><br><span class="line">-XX:MaxMetaspaceSize=2G</span><br><span class="line">-XX:MaxDirectMemorySize=2G</span><br><span class="line"></span><br><span class="line">## 垃圾回收 ZGC or ShenandoahGC</span><br><span class="line"># 启用Z Garbage Collector（ZGC）</span><br><span class="line">#-XX:+UseZGC</span><br><span class="line"># ZGC回收间隔</span><br><span class="line">#-XX:ZCollectionInterval=100</span><br><span class="line"># 使用并发标记清除（ConcMarkSweep）垃圾回收器</span><br><span class="line">#-XX:+UseConcMarkSweepGC</span><br><span class="line"># 设置并行垃圾回收线程数</span><br><span class="line">#-XX:ParallelGCThreads=20</span><br><span class="line"># 设置软引用对象在每MB堆内存中存活的最短时间</span><br><span class="line">#-XX:SoftRefLRUPolicyMSPerMB=1000</span><br><span class="line"># 虚拟机在启动时预先分配堆空间</span><br><span class="line">#-XX:+AlwaysPreTouch</span><br><span class="line"></span><br><span class="line"># 启用Shenandoah Garbage Collector（Shenandoah GC）</span><br><span class="line">-XX:+UseShenandoahGC</span><br><span class="line">-XX:+UnlockExperimentalVMOptions</span><br><span class="line"># 设置并行垃圾回收线程数（根据需要调整）</span><br><span class="line">-XX:ParallelGCThreads=20</span><br><span class="line"># 设置软引用对象在每MB堆内存中存活的最短时间</span><br><span class="line">-XX:SoftRefLRUPolicyMSPerMB=1000</span><br><span class="line"># 虚拟机在启动时预先分配堆空间</span><br><span class="line">-XX:+AlwaysPreTouch</span><br><span class="line"># 启用压缩指针（Compressed Oops）</span><br><span class="line">-XX:+UseCompressedOops</span><br><span class="line"># GC触发策略</span><br><span class="line">-XX:ShenandoahHeuristic=passive</span><br><span class="line">## 垃圾回收</span><br><span class="line"></span><br><span class="line">## JIT（即时编译）参数</span><br><span class="line"># 设置编译器线程数</span><br><span class="line">-XX:CICompilerCount=20</span><br><span class="line"># 启用分层编译</span><br><span class="line">-XX:+TieredCompilation</span><br><span class="line"># 设置停止级别，只进行第一级别的编译</span><br><span class="line">-XX:TieredStopAtLevel=1</span><br><span class="line"># 设置最大内联级别</span><br><span class="line">-XX:MaxInlineLevel=9</span><br><span class="line"># 设置第四层（Tier 4）最小调用阈值</span><br><span class="line">-XX:Tier4MinInvocationThreshold=50000</span><br><span class="line"># 设置第四层（Tier 4）调用阈值</span><br><span class="line">-XX:Tier4InvocationThreshold=100000</span><br><span class="line"># 设置第四层（Tier 4）编译阈值</span><br><span class="line"></span><br><span class="line">## 代码设置</span><br><span class="line"># 设置初始代码缓存大小和保留代码缓存大小</span><br><span class="line">-XX:InitialCodeCacheSize=1G</span><br><span class="line">-XX:ReservedCodeCacheSize=2G</span><br><span class="line"></span><br><span class="line">## 错误日志和堆转储设置</span><br><span class="line"># 在发生内存溢出错误时生成堆转储文件</span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError</span><br><span class="line"># 禁用快速抛出异常时的堆栈跟踪省略</span><br><span class="line">-XX:-OmitStackTraceInFastThrow</span><br><span class="line"># 允许自我附加</span><br><span class="line">-Djdk.attach.allowAttachSelf</span><br><span class="line"># 禁用对象晋升时的处理</span><br><span class="line">-XX:-HandlePromotionFailure</span><br><span class="line"></span><br><span class="line">## 其他设置</span><br><span class="line"># JVM激进优化</span><br><span class="line">-XX:+AggressiveOpts</span><br><span class="line"># 高随机数生成器</span><br><span class="line">-Djava.security.egd=file:/dev/./urandom</span><br><span class="line"># 启用字符串去重</span><br><span class="line">-XX:+UseStringDeduplication</span><br><span class="line"># 优化字符串连接</span><br><span class="line">-XX:+OptimizeStringConcat</span><br><span class="line"># 内存分配器</span><br><span class="line">-XX:+UseTLAB</span><br><span class="line"># 使用大页内存</span><br><span class="line">-XX:+UseLargePages</span><br><span class="line"># 文件系统缓存</span><br><span class="line">-Dsun.io.useCanonPrefixCache=false</span><br><span class="line"># 设置首选使用IPv4协议栈</span><br><span class="line">-Djava.net.preferIPv4Stack=true</span><br><span class="line"># 禁用HTTP隧道身份验证</span><br><span class="line">-Djdk.http.auth.tunneling.disabledSchemes=&quot;&quot;</span><br><span class="line"># 解锁JVM中的实验性选项</span><br><span class="line">-XX:+UnlockExperimentalVMOptions</span><br><span class="line"># 忽略不认识的JVM选项</span><br><span class="line">-XX:+IgnoreUnrecognizedVMOptions</span><br><span class="line"># 打开指定包的包访问权限</span><br><span class="line">--add-opens=java.base/jdk.internal.org.objectweb.asm=ALL-UNNAMED</span><br><span class="line">--add-opens=java.base/jdk.internal.org.objectweb.asm.tree=ALL-UNNAMED</span><br><span class="line"># JDK VisualGC 插件</span><br><span class="line">--add-exports=jdk.internal.jvmstat/sun.jvmstat.monitor=ALL-UNNAMED</span><br><span class="line">--add-exports=jdk.internal.jvmstat/sun.jvmstat.monitor.event=ALL-UNNAMED</span><br><span class="line">--add-exports=jdk.internal.jvmstat/sun.jvmstat.perfdata.monitor=ALL-UNNAMED</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span c</summary>
      
    
    
    
    <category term="Intellij" scheme="https://blog.48626.xyz/categories/Intellij/"/>
    
    
    <category term="Java" scheme="https://blog.48626.xyz/tags/Java/"/>
    
    <category term="Intellij" scheme="https://blog.48626.xyz/tags/Intellij/"/>
    
  </entry>
  
  <entry>
    <title>临时禁用 MySQL 数据库的外键约束</title>
    <link href="https://blog.48626.xyz/26bca217efa2.html"/>
    <id>https://blog.48626.xyz/26bca217efa2.html</id>
    <published>2024-07-26T08:38:36.000Z</published>
    <updated>2024-07-26T08:38:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>当你需要删除数据时，可以临时禁用 MySQL 数据库的外键约束。这样，你就可以在删除操作完成后再重新启用外键约束。以下是具体的步骤：</p><p>在进行删除操作前，使用以下语句暂时禁用外键约束：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET FOREIGN_KEY_CHECKS=0;</span><br></pre></td></tr></table></figure><p>然后执行删除操作，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM table1 WHERE <span class="built_in">id</span>=1;</span><br></pre></td></tr></table></figure><p>删除完成后，再启用外键约束：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET FOREIGN_KEY_CHECKS=1;</span><br></pre></td></tr></table></figure><p>需要注意的是，使用这种方法禁用外键约束后，对数据进行的修改操作将不再受到外键约束的限制和检查，因此需要谨慎操作，以免影响数据的完整性和一致性。如果你只是想清空一个受外键约束的表，也可以先删除外键约束后再清空表。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;当你需要删除数据时，可以临时禁用 MySQL 数据库的外键约束。这样，你就可以在删除操作完成后再重新启用外键约束。以下是具体的步骤：&lt;/p&gt;
&lt;p&gt;在进行删除操作前，使用以下语句暂时禁用外键约束：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SET FOREIGN_KEY_CHECKS=0;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="mysql" scheme="https://blog.48626.xyz/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://blog.48626.xyz/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>docker清理没有引用的镜像</title>
    <link href="https://blog.48626.xyz/c77015022e9e.html"/>
    <id>https://blog.48626.xyz/c77015022e9e.html</id>
    <published>2024-07-23T03:25:04.000Z</published>
    <updated>2024-07-23T03:25:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>在 Docker 中清理没有引用的镜像（即无标签或未被任何容器使用的镜像），可以使用以下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune</span><br></pre></td></tr></table></figure><p>这个命令会删除所有没有被任何容器引用的镜像，释放磁盘空间。如果你希望确认删除哪些镜像，可以添加 -a 参数，这样会删除所有没有被使用的镜像，包括有标签但没有容器使用的镜像：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune -a</span><br></pre></td></tr></table></figure><p>如果你只想删除未被使用的镜像，但保留有标签的镜像（可能在将来会用到），可以先列出未被使用的镜像：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image <span class="built_in">ls</span> -q --filter dangling=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>然后根据这个列表手动删除每个镜像：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image <span class="built_in">rm</span> $(docker image <span class="built_in">ls</span> -q --filter dangling=<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><p>这些命令可以帮助你清理掉那些不再使用的 Docker 镜像，释放磁盘空间。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在 Docker 中清理没有引用的镜像（即无标签或未被任何容器使用的镜像），可以使用以下命令：&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker image prune&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;这个命令会删除所有没有被任何容器引用的镜像，释放磁盘空间。如果你希望确认删除哪些镜像，可以添加 -a 参数，这样会删除所有没有被使用的镜像，包括有标签但没有容器使用的镜像：&lt;/p&gt;</summary>
    
    
    
    <category term="docker" scheme="https://blog.48626.xyz/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.48626.xyz/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>达梦数据库备份还原</title>
    <link href="https://blog.48626.xyz/f39d21b18adb.html"/>
    <id>https://blog.48626.xyz/f39d21b18adb.html</id>
    <published>2024-07-09T14:55:26.000Z</published>
    <updated>2024-07-09T14:55:26.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>备份的文件夹：格式大致为<code>/opt/dmdbms/data/DAMENG/bak/DB_DAMENG_FULL_xxxxxxxxxxx</code><br>我当前环境为docker，所以已docker容器演示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入docker容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it dm8 /bin/bash</span><br><span class="line"><span class="comment"># 进入指定目录</span></span><br><span class="line"><span class="built_in">cd</span> /opt/dmdbms/bin</span><br></pre></td></tr></table></figure><h2 id="关闭数据库"><a href="#关闭数据库" class="headerlink" title="关闭数据库"></a>关闭数据库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./disql</span><br><span class="line"><span class="comment"># 账号</span></span><br><span class="line"><span class="comment"># 密码</span></span><br><span class="line">shutdown immediate;</span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h2 id="还原"><a href="#还原" class="headerlink" title="还原"></a>还原</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行还原工具</span></span><br><span class="line">./dmrman</span><br><span class="line"><span class="comment"># 执行还原命令 自行更改还原文件夹的路径和名称</span></span><br><span class="line">restore database <span class="string">&#x27;/opt/dmdbms/data/DAMENG/dm.ini&#x27;</span> from backupset <span class="string">&#x27;/opt/dmdbms/data/DAMENG/bak/DB_DAMENG_FULL_2024_05_30_00_00_00&#x27;</span>;</span><br><span class="line">recover database <span class="string">&#x27;/opt/dmdbms/data/DAMENG/dm.ini&#x27;</span> from backupset <span class="string">&#x27;/opt/dmdbms/data/DAMENG/bak/DB_DAMENG_FULL_2024_05_30_00_00_00&#x27;</span>;</span><br><span class="line">recover database <span class="string">&#x27;/opt/dmdbms/data/DAMENG/dm.ini&#x27;</span> update db_magic;</span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>重启检查还原情况</p><h2 id="可能出现的问题"><a href="#可能出现的问题" class="headerlink" title="可能出现的问题"></a>可能出现的问题</h2><h3 id="文件夹访问权限异常"><a href="#文件夹访问权限异常" class="headerlink" title="文件夹访问权限异常"></a>文件夹访问权限异常</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改文件夹权限</span></span><br><span class="line"><span class="built_in">chown</span> -R dmdba:dinstall DB_DAMENG_FULL_2024_05_30_00_00_00/</span><br><span class="line">su dmdba</span><br><span class="line"><span class="built_in">chown</span> -R root:root DB_DAMENG_FULL_2024_05_30_00_00_00/</span><br></pre></td></tr></table></figure><h2 id="开启归档模式"><a href="#开启归档模式" class="headerlink" title="开启归档模式"></a>开启归档模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE MOUNT;</span><br><span class="line">ALTER DATABASE ADD ARCHIVELOG <span class="string">&#x27;DEST = /home/dmdba/data/DAMENG/arch, TYPE = local, FILE_SIZE = 1024, SPACE_LIMIT = 2048&#x27;</span>;</span><br><span class="line">ALTER DATABASE ARCHIVELOG;</span><br><span class="line">ALTER DATABASE OPEN;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备工作&quot;&gt;&lt;/a&gt;准备工作&lt;/h2&gt;&lt;p&gt;备份的文件夹：格式大致为&lt;code&gt;/opt/dmdbms/data/DAMENG/bak/DB_DAMENG_FULL_xxxxxxxxxxx&lt;/code&gt;&lt;br&gt;我当前环境为docker，所以已docker容器演示&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 进入docker容器&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;docker &lt;span class=&quot;built_in&quot;&gt;exec&lt;/span&gt; -it dm8 /bin/bash&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 进入指定目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; /opt/dmdbms/bin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="达梦" scheme="https://blog.48626.xyz/categories/%E8%BE%BE%E6%A2%A6/"/>
    
    
    <category term="达梦" scheme="https://blog.48626.xyz/tags/%E8%BE%BE%E6%A2%A6/"/>
    
  </entry>
  
  <entry>
    <title>打开双重el-dialog后出现遮罩</title>
    <link href="https://blog.48626.xyz/4b5ecca296b4.html"/>
    <id>https://blog.48626.xyz/4b5ecca296b4.html</id>
    <published>2024-07-08T08:46:03.000Z</published>
    <updated>2024-07-08T08:46:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>环境：vue2，element</p><h2 id="打开双重el-dialog后出现遮罩"><a href="#打开双重el-dialog后出现遮罩" class="headerlink" title="打开双重el-dialog后出现遮罩"></a>打开双重el-dialog后出现遮罩</h2><img src="/4b5ecca296b4/image.png" class="" alt="alt text"><p>点击一下后</p><img src="/4b5ecca296b4/image-1.png" class="" alt="alt text"><p>这能明显的看出差距</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>在第二个dialog添加<code>append-to-body</code></p><img src="/4b5ecca296b4/image-2.png" class="" alt="alt text">]]></content>
    
    
    <summary type="html">&lt;p&gt;环境：vue2，element&lt;/p&gt;
&lt;h2 id=&quot;打开双重el-dialog后出现遮罩&quot;&gt;&lt;a href=&quot;#打开双重el-dialog后出现遮罩&quot; class=&quot;headerlink&quot; title=&quot;打开双重el-dialog后出现遮罩&quot;&gt;&lt;/a&gt;打开双重el-dialog后出现遮罩&lt;/h2&gt;&lt;img src=&quot;/4b5ecca296b4/image.png&quot; class alt=&quot;alt text&quot;&gt;</summary>
    
    
    
    <category term="问题" scheme="https://blog.48626.xyz/categories/%E9%97%AE%E9%A2%98/"/>
    
    <category term="Vue" scheme="https://blog.48626.xyz/categories/%E9%97%AE%E9%A2%98/Vue/"/>
    
    <category term="element" scheme="https://blog.48626.xyz/categories/%E9%97%AE%E9%A2%98/Vue/element/"/>
    
    
    <category term="问题" scheme="https://blog.48626.xyz/tags/%E9%97%AE%E9%A2%98/"/>
    
    <category term="Vue" scheme="https://blog.48626.xyz/tags/Vue/"/>
    
    <category term="element" scheme="https://blog.48626.xyz/tags/element/"/>
    
  </entry>
  
  <entry>
    <title>windows执行多条命令</title>
    <link href="https://blog.48626.xyz/5a83ffea21e3.html"/>
    <id>https://blog.48626.xyz/5a83ffea21e3.html</id>
    <published>2024-07-05T08:32:03.000Z</published>
    <updated>2024-07-05T08:32:03.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>在 Linux 中，<code>&amp;&amp;</code> 被称为逻辑 AND 运算符。它用于将两个命令连接起来，并且只有在前一个命令成功（返回状态码为0）时，才会执行后一个命令。</p><p>例如，下面的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1 &amp;&amp; command2</span><br></pre></td></tr></table></figure><p>表示先执行 <code>command1</code>，如果 <code>command1</code> 成功（返回状态码为0），则执行 <code>command2</code>。如果 <code>command1</code> 失败（返回非0状态码），则 <code>command2</code> 不会执行。</p><p>这是一个典型的用法示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> new_directory &amp;&amp; <span class="built_in">cd</span> new_directory</span><br></pre></td></tr></table></figure><p>在这个例子中，<code>mkdir new_directory</code> 成功后（目录创建成功），才会执行 <code>cd new_directory</code>（进入新创建的目录）。</p><p>这种逻辑 AND 运算符在 Bash 和大多数其他 Linux shell（如 Zsh、Ksh 等）中都可以使用。</p><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>在 Windows 中的命令提示符（Command Prompt）和 PowerShell 中，分号 (<code>;</code>) 也可以用来分隔多个命令，使它们依次执行。与 <code>&amp;&amp;</code> 不同的是，使用分号分隔的命令不会检查前一个命令是否成功。</p><h3 id="在命令提示符中"><a href="#在命令提示符中" class="headerlink" title="在命令提示符中"></a>在命令提示符中</h3><p>在命令提示符中使用分号 (<code>;</code>) 作为命令分隔符不总是直观的做法，因为它可能不会像在 PowerShell 中那样一致地工作。通常建议使用 <code>&amp;</code> 或 <code>&amp;&amp;</code> 代替。</p><h3 id="在-PowerShell-中"><a href="#在-PowerShell-中" class="headerlink" title="在 PowerShell 中"></a>在 PowerShell 中</h3><p>在 PowerShell 中，分号 (<code>;</code>) 可以用于顺序执行多个命令，不管前一个命令是否成功。</p><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1; command2; command3</span><br></pre></td></tr></table></figure><p>这将顺序执行 <code>command1</code>，然后 <code>command2</code>，最后 <code>command3</code>，不论每个命令是否成功。</p><p>以下是具体示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean; hexo s</span><br></pre></td></tr></table></figure><p>这将执行 <code>hexo clean</code> 命令，然后立即执行 <code>hexo s</code> 命令，不考虑 <code>hexo clean</code> 的成功与否。</p><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><ul><li>在命令提示符中，建议使用 <code>&amp;</code> 或 <code>&amp;&amp;</code>。</li><li>在 PowerShell 中，可以使用 <code>;</code> 来顺序执行命令，不管前一个命令是否成功。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Linux&quot;&gt;&lt;a href=&quot;#Linux&quot; class=&quot;headerlink&quot; title=&quot;Linux&quot;&gt;&lt;/a&gt;Linux&lt;/h2&gt;&lt;p&gt;在 Linux 中，&lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt; 被称为逻辑 AND 运算符。它用于将两个命令连接起来，并且只有在前一个命令成功（返回状态码为0）时，才会执行后一个命令。&lt;/p&gt;
&lt;p&gt;例如，下面的命令：&lt;/p&gt;</summary>
    
    
    
    <category term="windows" scheme="https://blog.48626.xyz/categories/windows/"/>
    
    
    <category term="windows" scheme="https://blog.48626.xyz/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>SSH RCE 远程代码执行漏洞 POC</title>
    <link href="https://blog.48626.xyz/0f098a910aa5.html"/>
    <id>https://blog.48626.xyz/0f098a910aa5.html</id>
    <published>2024-07-04T05:04:18.000Z</published>
    <updated>2024-07-04T05:04:18.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>转载于 <a href="https://linux.do/t/topic/124906">https://linux.do/t/topic/124906</a></p></blockquote><p>SSH RCE漏洞，ssh -V检查版本，早于4.4p1 的版本受影响，<br>4.4p1 到 8.5p1（不包含8.5p1）之间的版本不受影响，<br>8.5p1到9.8p1 （不包含9.8p1）之间的版本受影响。</p><p>解决方法:<br>升级ssh版本，编译安装：</p><p>安装编译依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y build-essential zlib1g-dev libssl-dev</span><br></pre></td></tr></table></figure><p>下载指定版本源码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.8p1.tar.gz</span><br></pre></td></tr></table></figure><p>解压并进入目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf openssh-9.8p1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssh-9.8p1</span><br></pre></td></tr></table></figure><p>编译和安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>重启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart ssh</span><br></pre></td></tr></table></figure><p>断开SSH连接重连检查版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -V</span><br></pre></td></tr></table></figure><p>OpenSSH Server远程代码执行漏洞 POC<br>Openssh Server中8.5p1和9.7p1之间的版本中存在一处条件竞争漏洞,如果客户端在120秒内没有进行身份验证（由LoginGraceTime定义的设置）,则sshd的 SIGALRM 处理程序会以一种非异步信号安全的方式异步调用,成功的利用此漏洞可以导致远程攻击者以root的权限执行远程代码</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;转载于 &lt;a href=&quot;https://linux.do/t/topic/124906&quot;&gt;https://linux.do/t/topic/124906&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SSH RCE漏洞，ssh -V检查版本，早于4.4p1 的版本受影响，&lt;br&gt;4.4p1 到 8.5p1（不包含8.5p1）之间的版本不受影响，&lt;br&gt;8.5p1到9.8p1 （不包含9.8p1）之间的版本受影响。&lt;/p&gt;
&lt;p&gt;解决方法:&lt;br&gt;升级ssh版本，编译安装：&lt;/p&gt;</summary>
    
    
    
    <category term="Linux" scheme="https://blog.48626.xyz/categories/Linux/"/>
    
    
    <category term="Linux" scheme="https://blog.48626.xyz/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Bilihepler-personal安装</title>
    <link href="https://blog.48626.xyz/7f8d325aadf0.html"/>
    <id>https://blog.48626.xyz/7f8d325aadf0.html</id>
    <published>2024-07-03T15:34:58.000Z</published>
    <updated>2024-07-03T15:34:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull lkeme/bilihelper-personal:latest</span><br></pre></td></tr></table></figure><h3 id="通过环境变量进行传入"><a href="#通过环境变量进行传入" class="headerlink" title="通过环境变量进行传入"></a>通过环境变量进行传入</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --<span class="built_in">rm</span> -e USER_NAME=你的B站登录账号 -e USER_PASSWORD=你的B站密码 lkeme/bilihelper-personal</span><br></pre></td></tr></table></figure><h3 id="通过配置文件进行传入-能保留登录状态，自定义配置"><a href="#通过配置文件进行传入-能保留登录状态，自定义配置" class="headerlink" title="通过配置文件进行传入(能保留登录状态，自定义配置)"></a>通过配置文件进行传入(能保留登录状态，自定义配置)</h3><p>新建文件 profile&#x2F;user&#x2F;config&#x2F;user.ini</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################</span></span><br><span class="line"><span class="comment">#       程序设置       #</span></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"></span><br><span class="line">[app]</span><br><span class="line">name = BiliHelper-personal</span><br><span class="line"><span class="built_in">env</span> = <span class="built_in">local</span></span><br><span class="line">branch = master</span><br><span class="line">version = 0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"><span class="comment">#       账户设置       #</span></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"></span><br><span class="line">; 帐号/密码</span><br><span class="line">[login_account]</span><br><span class="line">username = <span class="string">&quot;&quot;</span></span><br><span class="line">password = <span class="string">&quot;3oU9UPvzHVkJXacb&quot;</span></span><br><span class="line"></span><br><span class="line">; 登录模式/[1.账密模式 2.短信验证码模式 3.扫码模式]</span><br><span class="line">[login_mode]</span><br><span class="line">mode = 1</span><br><span class="line"></span><br><span class="line">; 国家代码/mode=2触发/例：大陆86 澳大利亚61</span><br><span class="line">[login_country]</span><br><span class="line">code = 86</span><br><span class="line"></span><br><span class="line">; 校验/mode=2触发/校验国内手机号/国外手机号关闭校验</span><br><span class="line">[login_check]</span><br><span class="line">phone = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[login_captcha]</span><br><span class="line">; 验证码手动识别</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">; 验证码手动识别服务地址</span><br><span class="line">url = <span class="string">&quot;http://localhost:50001&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"><span class="comment">#       插件功能设置     #</span></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"></span><br><span class="line">; 检查主程序更新</span><br><span class="line">[check_update]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">; 主站每日任务(每日登录、观看、投币、分享)</span><br><span class="line">[main_site]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line">; 获取AIDS模式/random(随机热门)/fixed(关注列表)</span><br><span class="line">fetch_aids_mode = fixed</span><br><span class="line">; 每日观看</span><br><span class="line">watch = <span class="literal">true</span></span><br><span class="line">; 每日分享</span><br><span class="line">share = <span class="literal">true</span></span><br><span class="line">; 每日视频投币/投币稿件数(每日任务最大5)</span><br><span class="line">add_coin = <span class="literal">true</span></span><br><span class="line">add_coin_num = 5</span><br><span class="line">; 当等级达到6级时停止投币</span><br><span class="line">when_lv6_stop_coin = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">; 漫画助手(每日签到、分享)</span><br><span class="line">[manga]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">; 友爱社签到</span><br><span class="line">[love_club]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">; 直播签到</span><br><span class="line">[live_sign_in]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">; 游戏赛事竞猜预测(破产机)/每日竞猜次数/每次竞猜硬币(1-10)/下注(1.压大,2.压小,3.随机)</span><br><span class="line">[game_forecast]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">max_num = 20</span><br><span class="line">max_coin = 10</span><br><span class="line">bet = 1</span><br><span class="line"></span><br><span class="line">; 银瓜子兑换硬币</span><br><span class="line">[silver2coin]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">; 風機委員/自動連任/需要實名</span><br><span class="line">[judge]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">auto_apply = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">; 大会员权益/年度大会员专享</span><br><span class="line">[vip_privilege]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">; B币券消费/年度大会员专享/每月默认充值数量5B币/消费方式优先级从上到下</span><br><span class="line">[bp_consumption]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line"><span class="comment"># 消费B币充电/充电的目标UID/可充值自己的UID</span></span><br><span class="line">bp2charge = <span class="literal">false</span></span><br><span class="line">bp2charge_uid = 6580464</span><br><span class="line"><span class="comment"># 消费B币充值金瓜子/5000金瓜子</span></span><br><span class="line">bp2gold = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">; 预约直播有奖/UP_UID/逗号分隔</span><br><span class="line">[live_reservation]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line">vmids = 9617619</span><br><span class="line"></span><br><span class="line">; 直播金色宝箱(实物抽奖)</span><br><span class="line">[live_gold_box]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">; 获取记录</span><br><span class="line">[award_records]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">; 大会员积分</span><br><span class="line">[vip_point]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">; 卍预约直播抽奖</span><br><span class="line">[lottery]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">; 每日电池 对应直播间ID和直播间UID</span><br><span class="line">[daily_gold]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">target_up_id = 11153765</span><br><span class="line">target_room_id = 23058</span><br><span class="line"></span><br><span class="line">; 擦亮徽章/ 每日擦亮 默认擦亮变灰徽章</span><br><span class="line">[polish_medal]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">everyday = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">; 批量取消关注/分组名称/默认为all(全部)</span><br><span class="line">[batch_unfollow]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">tag = all</span><br><span class="line"></span><br><span class="line">; 转盘活动</span><br><span class="line">[activity_lottery]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"><span class="comment">#       通知设置       #</span></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"></span><br><span class="line">; 消息推送/消息推送过滤词/逗号分割/优先级从上到下</span><br><span class="line">[notify]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line">filter_words = <span class="built_in">test</span>,测试</span><br><span class="line"></span><br><span class="line">; Dingtalk机器人/token/依赖USE_NOTIFY</span><br><span class="line">[notify_dingtalk]</span><br><span class="line">token =</span><br><span class="line"></span><br><span class="line">; Tele机器人/url(可选)/token/chatid/依赖USE_NOTIFY</span><br><span class="line">[notify_telegram]</span><br><span class="line">url =</span><br><span class="line">bottoken = <span class="string">&quot;&quot;</span></span><br><span class="line">chatid = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">; Pushplus酱/token/依赖USE_NOTIFY</span><br><span class="line">[notify_pushplus]</span><br><span class="line">token =</span><br><span class="line"></span><br><span class="line">; Sever酱(原版)/令牌Key/依赖USE_NOTIFY</span><br><span class="line">[notify_sc]</span><br><span class="line">sckey =</span><br><span class="line"></span><br><span class="line">; Server酱(Turbo版)/令牌Key/依赖USE_NOTIFY</span><br><span class="line">[notify_sct]</span><br><span class="line">sctkey =</span><br><span class="line"></span><br><span class="line">; GoCqhttp/url/token/目标qq/依赖USE_NOTIFY</span><br><span class="line">[notify_gocqhttp]</span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line">token =</span><br><span class="line">target_qq =</span><br><span class="line"></span><br><span class="line">; 飞书机器人/依赖USE_NOTIFY</span><br><span class="line">[notify_feishu]</span><br><span class="line">token =</span><br><span class="line"></span><br><span class="line">; Debug/个人调试推送/url/token</span><br><span class="line">[notify_debug]</span><br><span class="line">url = <span class="string">&quot;&quot;</span></span><br><span class="line">token =</span><br><span class="line"></span><br><span class="line">; 企业微信群机器人/token</span><br><span class="line">[notify_we_com]</span><br><span class="line">token =</span><br><span class="line"></span><br><span class="line">; 企业微信应用消息/corp_id/corp_secret/agent_id/to_user</span><br><span class="line">[notify_we_com_app]</span><br><span class="line">corp_id =</span><br><span class="line">corp_secret =</span><br><span class="line">agent_id =</span><br><span class="line">to_user =</span><br><span class="line"></span><br><span class="line">; Bark/Token</span><br><span class="line">[notify_bark]</span><br><span class="line">token =</span><br><span class="line"></span><br><span class="line">; PushDeer/服务器地址/token</span><br><span class="line">[notify_push_deer]</span><br><span class="line">url =</span><br><span class="line">token =</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"><span class="comment">#       网络设置       #</span></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"></span><br><span class="line">; 验证SSL证书/请求时验证SSL证书行为</span><br><span class="line">[network_ssl]</span><br><span class="line">verify = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">; 是否使用代理/(http\https)</span><br><span class="line">[network_proxy]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">proxy = <span class="string">&quot;http://127.0.0.1:8888&quot;</span></span><br><span class="line"></span><br><span class="line">; 是否使用自定义Github File Mirror/默认使用官方源</span><br><span class="line">[network_github]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">mirror = </span><br><span class="line"></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"><span class="comment">#       程序设置       #</span></span><br><span class="line"><span class="comment">#######################</span></span><br><span class="line"></span><br><span class="line">; 调试模式/采集完整日志</span><br><span class="line">[debug]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">; 记录日志/日志回调地址</span><br><span class="line">[<span class="built_in">log</span>]</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">false</span></span><br><span class="line">callback = <span class="string">&quot;http://www.example.com/api.send?text=&#123;account&#125;[&#123;level&#125;]: &#123;message&#125;&quot;</span></span><br><span class="line"><span class="comment"># 错误回调级别</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   DEBUG   100</span></span><br><span class="line"><span class="comment">#   INFO    200</span></span><br><span class="line"><span class="comment">#   NOTICE  250</span></span><br><span class="line"><span class="comment">#   WARNING 300</span></span><br><span class="line"><span class="comment">#   ERROR   400</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">callback_level = 400</span><br><span class="line"></span><br><span class="line">; app设置</span><br><span class="line">[<span class="built_in">print</span>]</span><br><span class="line">; 用户名，可自定义</span><br><span class="line"><span class="built_in">uname</span> =</span><br><span class="line">; 账号别名，如果为空则默认使用登录账号作为标示</span><br><span class="line">user_identity =</span><br><span class="line">; 多账号区别输出</span><br><span class="line">multiple = <span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>新建文件 profile&#x2F;user&#x2F;device&#x2F;device.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">device_version: 0.0.1</span><br><span class="line"></span><br><span class="line">app:</span><br><span class="line">  bili_a: <span class="comment"># Android</span></span><br><span class="line">    package: <span class="string">&quot;tv.danmaku.bili&quot;</span></span><br><span class="line">    version: <span class="string">&quot;7.58.0&quot;</span></span><br><span class="line">    build: <span class="string">&quot;7580300&quot;</span></span><br><span class="line">    channel: <span class="string">&quot;bili&quot;</span></span><br><span class="line">    device: <span class="string">&quot;phone&quot;</span></span><br><span class="line">    mobi_app: <span class="string">&quot;android&quot;</span></span><br><span class="line">    platform: <span class="string">&quot;android&quot;</span></span><br><span class="line">    s_locale: <span class="string">&quot;zh-Hans_CN&quot;</span></span><br><span class="line">    c_locale: <span class="string">&quot;zh-Hans_CH&quot;</span></span><br><span class="line">    app_key: <span class="string">&quot;MWQ4YjZlN2Q0NTIzMzQzNg==&quot;</span></span><br><span class="line">    secret_key: <span class="string">&quot;NTYwYzUyY2NkMjg4ZmVkMDQ1ODU5ZWQxOGJmZmQ5NzM&quot;</span></span><br><span class="line">    app_key_n: <span class="string">&quot;NzgzYmJiNzI2NDQ1MWQ4Mg==&quot;</span></span><br><span class="line">    secret_key_n: <span class="string">&quot;MjY1MzU4M2M4ODczZGVhMjY4YWI5Mzg2OTE4YjFkNjU=&quot;</span></span><br><span class="line">    statistics: <span class="string">&#x27;&#123;&quot;appId&quot;:1,&quot;platform&quot;:3,&quot;version&quot;:&quot;7.58.0&quot;,&quot;abtest&quot;:&quot;&quot;&#125;&#x27;</span></span><br><span class="line">  bili_i: <span class="comment"># IOS</span></span><br><span class="line">    app_key: <span class="string">&quot;MjdlYjUzZmM5MDU4ZjhjMw==&quot;</span></span><br><span class="line">    secret_key: <span class="string">&quot;YzJlZDUzYTc0ZWVlZmUzY2Y5OWZiZDAxZDhjOWMzNzU=&quot;</span></span><br><span class="line">  bili_t: <span class="comment"># Tv</span></span><br><span class="line">    app_key: <span class="string">&quot;NDQwOWUyY2U4ZmZkMTJiOA==&quot;</span></span><br><span class="line">    secret_key: <span class="string">&quot;NTliNDNlMDRhZDY5NjVmMzQzMTkwNjJiNDc4ZjgzZGQ=&quot;</span></span><br><span class="line"></span><br><span class="line">platform:</span><br><span class="line">  system:</span><br><span class="line">    os: <span class="string">&quot;android&quot;</span></span><br><span class="line">    os_ver: <span class="string">&quot;7.1.2&quot;</span></span><br><span class="line">    model: <span class="string">&quot;MuMu&quot;</span></span><br><span class="line">    network: <span class="string">&quot;2&quot;</span> <span class="comment"># 1 流量 2 WIFI</span></span><br><span class="line">  headers:</span><br><span class="line">    other_ua: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36&quot;</span></span><br><span class="line">    pc_ua: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36 Edg/95.0.1020.53Chrome/95.0.4638.69 Safari/537.36 Edg/95.0.1020.53&quot;</span></span><br><span class="line">    app_ua: <span class="string">&quot;Mozilla/5.0 BiliDroid/<span class="variable">$&#123;app.bili_a.version&#125;</span> (bbcallen@gmail.com) os/<span class="variable">$&#123;platform.system.os&#125;</span> model/<span class="variable">$&#123;device.model&#125;</span> mobi_app/<span class="variable">$&#123;app.bili_a.mobi_app&#125;</span>build/<span class="variable">$&#123;app.bili_a.build&#125;</span> channel/<span class="variable">$&#123;app.bili_a.channel&#125;</span> innerVer/<span class="variable">$&#123;app.bili_a.build&#125;</span>osVer/<span class="variable">$&#123;platform.system.os_ver&#125;</span> network/<span class="variable">$&#123;platform.system.network&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --<span class="built_in">rm</span> -v /path/to/your/confFilePath:/app/profile/user lkeme/bilihelper-personal</span><br></pre></td></tr></table></figure><p>配置文件里设置好，发送完短信 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach 或者docker <span class="built_in">exec</span> 再进去容器里输入</span><br></pre></td></tr></table></figure><h3 id="开启手动验证验证码"><a href="#开启手动验证验证码" class="headerlink" title="开启手动验证验证码"></a>开启手动验证验证码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[login_captcha]</span><br><span class="line">; 验证码手动识别</span><br><span class="line"><span class="built_in">enable</span> = <span class="literal">true</span></span><br><span class="line">; 验证码手动识别服务地址</span><br><span class="line">url = <span class="string">&quot;http://192.168.3.202:50001&quot;</span></span><br></pre></td></tr></table></figure><p>修改部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --<span class="built_in">rm</span> -e CAPTCHA=1 -e CAPTCHA_HOST=localhost -e CAPTCHA_PORT=50002 -p 50002:50002 -v /path/to/your/confFilePath:/app/profile/user lkeme/bilihelper-personal</span><br><span class="line"></span><br><span class="line">-e CAPTCHA=1 <span class="comment"># 开启验证码手动识别服务  默认 0</span></span><br><span class="line">-e CAPTCHA_HOST=0.0.0.0 <span class="comment"># 默认 0.0.0.0</span></span><br><span class="line">-e CAPTCHA_PORT=50002 <span class="comment"># 验证码手动识别服务地址  默认 50001 需要注意端口映射关系</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;命令&quot;&gt;&lt;a href=&quot;#命令&quot; class=&quot;headerlink&quot; title=&quot;命令&quot;&gt;&lt;/a&gt;命令&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker pull lkeme/bilihelper-personal:latest&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;通过环境变量进行传入&quot;&gt;&lt;a href=&quot;#通过环境变量进行传入&quot; class=&quot;headerlink&quot; title=&quot;通过环境变量进行传入&quot;&gt;&lt;/a&gt;通过环境变量进行传入&lt;/h3&gt;</summary>
    
    
    
    <category term="docker" scheme="https://blog.48626.xyz/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.48626.xyz/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>通过fail2ban服务监控frps日志实现禁止非法IP</title>
    <link href="https://blog.48626.xyz/da0034a8ed0b.html"/>
    <id>https://blog.48626.xyz/da0034a8ed0b.html</id>
    <published>2024-07-03T08:40:03.000Z</published>
    <updated>2024-07-03T08:40:03.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="通过fail2ban服务监控frps日志实现禁止非法IP"><a href="#通过fail2ban服务监控frps日志实现禁止非法IP" class="headerlink" title="通过fail2ban服务监控frps日志实现禁止非法IP"></a>通过fail2ban服务监控frps日志实现禁止非法IP</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>服务器使用了frp作为了内网穿透软件，查看frps的日志，发现总有一些国外的ip在扫描这台服务器的端口信息，日志如下图，所以想通过fail2ban服务能够直接禁用这些ip扫描服务器。</p><p>注意一定要挂载日志文件</p><h3 id="1、安装fail2ban服务"><a href="#1、安装fail2ban服务" class="headerlink" title="1、安装fail2ban服务"></a>1、安装fail2ban服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y fail2ban</span><br></pre></td></tr></table></figure><h3 id="2、设置查找frps的规则"><a href="#2、设置查找frps的规则" class="headerlink" title="2、设置查找frps的规则"></a>2、设置查找frps的规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@lianhe ~]<span class="comment"># cat /etc/fail2ban/filter.d/frps.conf</span></span><br><span class="line">[Definition]</span><br><span class="line">failregex = ^.*get a user connection \[&lt;HOST&gt;:[0-9]*\]</span><br><span class="line">            ^.*get a new work connection: \[&lt;HOST&gt;:[0-9]*\]</span><br><span class="line">ignoreregex =</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用gpt4生成的规则</span></span><br><span class="line">[Definition]</span><br><span class="line">failregex = ^.*auth failed.*ip:&lt;HOST&gt;.*$</span><br><span class="line">            ^.*illegal connection.*ip:&lt;HOST&gt;.*$</span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure><h3 id="3、校验规则"><a href="#3、校验规则" class="headerlink" title="3、校验规则"></a>3、校验规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-regex /opt/1panel/apps/frps/frps/log/frps.log /etc/fail2ban/filter.d/frps.conf</span><br></pre></td></tr></table></figure><h3 id="4、设置发现frps的异常ip的操作"><a href="#4、设置发现frps的异常ip的操作" class="headerlink" title="4、设置发现frps的异常ip的操作"></a>4、设置发现frps的异常ip的操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入fail2ban目录，copy一份配置文件</span></span><br><span class="line">[root@lianhe fail2ban]<span class="comment">#  cp jail.conf  jail.local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 jail.local 下添加一下规则</span></span><br><span class="line">[frp]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">findtime = 600</span><br><span class="line">maxretry = 5</span><br><span class="line">bantime = -1</span><br><span class="line">filter = frps</span><br><span class="line">logpath = /opt/1panel/apps/frps/frps/frps.log</span><br><span class="line">protocol = all</span><br><span class="line">chain = all</span><br><span class="line">port = all</span><br><span class="line">action = iptables-allports[name=frp,protocol=tcp]</span><br></pre></td></tr></table></figure><p>配置说明<br>frp：监控目标名称<br>port：封禁全部端口<br>filter：过滤规则，我们使用自定义的frps<br>action：捕捉到恶意IP后执行的操作，本文使用iptables对IP封禁所有端口<br>logpath：需要监控的日志文件<br>bantime：封禁时间，单位为秒<br>findtime：查找时间段，单位为秒<br>maxretry：允许的最大失败次数，这里我们配置10分钟内触发10次规则，那么就封禁掉</p><h3 id="4、永久禁用ip地址"><a href="#4、永久禁用ip地址" class="headerlink" title="4、永久禁用ip地址"></a>4、永久禁用ip地址</h3><h4 id="4-1-编辑文件：-etc-fail2ban-jail-local"><a href="#4-1-编辑文件：-etc-fail2ban-jail-local" class="headerlink" title="4.1 编辑文件：&#x2F;etc&#x2F;fail2ban&#x2F;jail.local"></a>4.1 编辑文件：&#x2F;etc&#x2F;fail2ban&#x2F;jail.local</h4><p>在此件中查找banaction条目。以下屏幕截图显示禁止是iptables-multiport。</p><h4 id="4-2-编辑-banaction文件：-etc-fail2ban-action-d-iptables-multiport-conf"><a href="#4-2-编辑-banaction文件：-etc-fail2ban-action-d-iptables-multiport-conf" class="headerlink" title="4.2 编辑 banaction文件： &#x2F;etc&#x2F;fail2ban&#x2F;action.d&#x2F;iptables-multiport.conf"></a>4.2 编辑 banaction文件： &#x2F;etc&#x2F;fail2ban&#x2F;action.d&#x2F;iptables-multiport.conf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 actionstart 默认条目下，添加以下行：</span></span><br><span class="line"><span class="built_in">cat</span> /etc/fail2ban/ip.banned | <span class="keyword">while</span> <span class="built_in">read</span> IP; <span class="keyword">do</span> iptables -I fail2ban-&lt;name&gt; 1 -s <span class="variable">$IP</span> -j DROP; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 actionban 默认条目下，添加以下行：</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;ip&gt;&#x27;</span> &gt;&gt; /etc/fail2ban/ip.banned</span><br></pre></td></tr></table></figure><h3 id="5、fail2ban服务重新加载"><a href="#5、fail2ban服务重新加载" class="headerlink" title="5、fail2ban服务重新加载"></a>5、fail2ban服务重新加载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-client reload</span><br></pre></td></tr></table></figure><h3 id="6、查看frp服务器禁用那些ip"><a href="#6、查看frp服务器禁用那些ip" class="headerlink" title="6、查看frp服务器禁用那些ip"></a>6、查看frp服务器禁用那些ip</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@lianhe ~]<span class="comment"># fail2ban-client status frp</span></span><br><span class="line">Status <span class="keyword">for</span> the jail: frp</span><br><span class="line">|- Filter</span><br><span class="line">|  |- Currently failed:21</span><br><span class="line">|  |- Total failed:224</span><br><span class="line">|  `- File list:/var/lib/docker/containers/ca21dd5be6d88edad61619d3c14366dda78858ee588c751714a0facc5e2c4985/ca21dd5be6d88edad61619d3c14366dda78858ee588c751714a0facc5e2c4985-json.log</span><br><span class="line">`- Actions</span><br><span class="line">   |- Currently banned:32</span><br><span class="line">   |- Total banned:32</span><br><span class="line">   `- Banned IP list:118.113.244.254 87.120.84.35 172.104.238.212 162.215.216.231 107.173.211.107 61.140.220.92 218.19.45.23 219.152.231.118 168.76.123.59 45.183.247.34 103.164.216.221 162.241.69.208 185.137.122.180 162.62.218.43 124.152.99.57 45.88.90.55 103.154.184.109 87.107.190.12 87.107.190.59 94.156.8.86 119.28.118.4 59.13.123.99 101.126.69.60 124.156.204.21 68.66.251.162 58.210.241.5 103.78.12.14 35.200.157.232 43.153.176.71 91.92.245.192 171.106.204.37 108.179.217.143</span><br></pre></td></tr></table></figure><h3 id="7、通过iptables查看禁用ip"><a href="#7、通过iptables查看禁用ip" class="headerlink" title="7、通过iptables查看禁用ip"></a>7、通过iptables查看禁用ip</h3><h3 id="8、如果有误判的ip地址，解决方法"><a href="#8、如果有误判的ip地址，解决方法" class="headerlink" title="8、如果有误判的ip地址，解决方法"></a>8、如果有误判的ip地址，解决方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-client <span class="built_in">set</span>  frps  unbanip [ip地址]</span><br></pre></td></tr></table></figure><h3 id="9、重装"><a href="#9、重装" class="headerlink" title="9、重装"></a>9、重装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service fail2ban stop</span><br><span class="line"><span class="built_in">rm</span> -r /etc/fail2ban/</span><br><span class="line">apt-get purge fail2ban</span><br><span class="line">apt-get install fail2ban</span><br></pre></td></tr></table></figure><h3 id="10、使用-Fail2ban-client-验证-Fail2ban-状态"><a href="#10、使用-Fail2ban-client-验证-Fail2ban-状态" class="headerlink" title="10、使用 Fail2ban-client 验证 Fail2ban 状态"></a>10、使用 Fail2ban-client 验证 Fail2ban 状态</h3><p>fail2ban 提供了一个命令行 fail2ban-client 用于与 Fail2ban 服务进行交互。这允许您从命令行管理和配置 Fail2ban，还允许您管理 Fail2ban 监狱。</p><p>要验证 fail2ban 安装和配置，请运行以下命令的 <em>fail2ban-client</em>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client ping</span><br></pre></td></tr></table></figure><p>如果您收到诸如“服务器回复：pong”之类的输出消息，这意味着 Fail2ban 正在正常运行。</p><p>接下来，运行下面的 <em>fail2ban-client</em> 命令来检查 sshd jail 的状态。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client status sshd</span><br></pre></td></tr></table></figure><p>下面你可以看到 sshd jail 的详细状态。这包括 SSH 服务的日志文件和 sshd jail 上被禁止的 IP 地址列表。</p><p>现在如果你想获得 sshd 监狱的详细配置，你可以使用 fail2ban-client 命令如下。</p><p>检查 sshd jail 的 bantime 配置。您将在几秒钟内获得 bantime 的输出。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client get sshd bantime</span><br></pre></td></tr></table></figure><p>检查 sshd jail 的 maxrtey 配置。你会看到这里的 maxretry 是 3，因为它被全局配置覆盖了，也就是 maxrety 5 次。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client get sshd maxretry</span><br></pre></td></tr></table></figure><p>对于sshd jail中的banaction，可以使用以下命令。并且您应该将 ufw 的输出作为 sshd jail 的默认禁令。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client get sshd actions</span><br></pre></td></tr></table></figure><p>对于此处的查找时间，您还将看到 sshd 监狱的覆盖值。此处的输出也将采用秒格式。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client get sshd findtime</span><br></pre></td></tr></table></figure><p>最后，您还可以使用以下命令检查 sshd jail 的默认 ignoreip。你会看到 ignoreip 与全局 Fail2ban 配置具有相同的值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client get sshd ignoreip</span><br></pre></td></tr></table></figure><h3 id="11、使用-Fail2ban-client-禁止和取消禁止-IP"><a href="#11、使用-Fail2ban-client-禁止和取消禁止-IP" class="headerlink" title="11、使用 Fail2ban-client 禁止和取消禁止 IP"></a>11、使用 Fail2ban-client 禁止和取消禁止 IP</h3><p>关于 Fail2ban 的另一个重要事项是如何在 Fail2ban 上禁止和取消禁止 IP 地址。为此，您还可以使用 fail2ban-client 命令。</p><p>要在 sshd jail 上手动禁止 IP 地址，您可以使用下面的 fail2ban-client 命令。将 IP 地址更改为您要禁止的 IP 地址。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client set sshd banip IP-ADDRESS</span><br></pre></td></tr></table></figure><p>要从 sshd jail 中解禁 IP 地址，您可以使用下面的 fail2ban-client 命令。请务必将 IP 地址更改为您要取消禁止的 IP 地址。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client set sshd unbanip IP-ADDRESS</span><br></pre></td></tr></table></figure><p>现在，在您手动禁止 IP 地址或取消禁止 IP 地址后，您可以使用下面的 fail2ban-client 命令进行验证。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-client status sshd</span><br></pre></td></tr></table></figure><p>如果您手动禁止某个 IP 地址，请确保该 IP 地址在禁止 IP 地址列表中可用。但是，如果您取消禁止某个 IP 地址，请确保该 IP 地址从禁止 IP 地址列表中消失。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;通过fail2ban服务监控frps日志实现禁止非法IP&quot;&gt;&lt;a href=&quot;#通过fail2ban服务监控frps日志实现禁止非法IP&quot; class=&quot;headerlink&quot; title=&quot;通过fail2ban服务监控frps日志实现禁止非法IP&quot;&gt;&lt;/a&gt;通过fail2ban服务监控frps日志实现禁止非法IP&lt;/h2&gt;&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;服务器使用了frp作为了内网穿透软件，查看frps的日志，发现总有一些国外的ip在扫描这台服务器的端口信息，日志如下图，所以想通过fail2ban服务能够直接禁用这些ip扫描服务器。&lt;/p&gt;</summary>
    
    
    
    <category term="Linux" scheme="https://blog.48626.xyz/categories/Linux/"/>
    
    <category term="fail2ban" scheme="https://blog.48626.xyz/categories/Linux/fail2ban/"/>
    
    
    <category term="Linux" scheme="https://blog.48626.xyz/tags/Linux/"/>
    
    <category term="fail2ban" scheme="https://blog.48626.xyz/tags/fail2ban/"/>
    
  </entry>
  
  <entry>
    <title>Frp穿透及防护</title>
    <link href="https://blog.48626.xyz/f2116e60767b.html"/>
    <id>https://blog.48626.xyz/f2116e60767b.html</id>
    <published>2024-07-03T08:40:03.000Z</published>
    <updated>2024-07-03T08:40:03.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-安装1Panel（非必须只需要软件frps和fail2ban，可以考虑其他安装方式）"><a href="#1-安装1Panel（非必须只需要软件frps和fail2ban，可以考虑其他安装方式）" class="headerlink" title="1. 安装1Panel（非必须只需要软件frps和fail2ban，可以考虑其他安装方式）"></a>1. 安装1Panel（非必须只需要软件frps和fail2ban，可以考虑其他安装方式）</h2><p>官网地址：<a href="https://1panel.cn/docs/installation/online_installation/">https://1panel.cn/docs/installation/online_installation/</a></p><p>根据服务器情况安装</p><p>安装过程略</p><h2 id="2-安装frps"><a href="#2-安装frps" class="headerlink" title="2. 安装frps"></a>2. 安装frps</h2><p>进入1Panel的页面</p><p>选择应用商店搜索frps</p><p>选择安装</p><p>安装后进入安装目录修改配置文件 <code>/opt/1panel/apps/frps/frps/data/frps.toml</code></p><p>根据官网（<a href="https://gofrp.org/zh-cn/docs/reference/server-configures/%EF%BC%89%E7%9A%84%E6%8F%90%E7%A4%BA%E9%85%8D%E7%BD%AE">https://gofrp.org/zh-cn/docs/reference/server-configures/）的提示配置</a></p><p>这是我使用的配置，需要把汉字部分修改为自己需要的设置</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">bindAddr</span> = <span class="string">&quot;服务端监听地址，用于接收 frpc 的连接，默认监听 0.0.0.0。&quot;</span></span><br><span class="line"><span class="attr">bindPort</span> = 服务端监听端口，默认值为 <span class="number">7000</span>。</span><br><span class="line"><span class="attr">enablePrometheus</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[log]</span></span><br><span class="line"><span class="attr">to</span> = <span class="string">&quot;/path/to/frps.log&quot;</span></span><br><span class="line"><span class="attr">level</span> = <span class="string">&quot;info&quot;</span></span><br><span class="line"><span class="attr">maxDays</span> = <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="section">[auth]</span></span><br><span class="line"><span class="attr">method</span> = <span class="string">&quot;token&quot;</span></span><br><span class="line"><span class="attr">token</span> = <span class="string">&quot;在 method 为 token 时生效，客户端需要设置一样的值才能鉴权通过。&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[webServer]</span></span><br><span class="line"><span class="attr">addr</span> = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="attr">port</span> = webServer 监听端口。</span><br><span class="line"><span class="attr">user</span> = <span class="string">&quot;HTTP BasicAuth 用户名。&quot;</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">&quot;HTTP BasicAuth 密码。&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="可能出现的问题"><a href="#可能出现的问题" class="headerlink" title="可能出现的问题"></a>可能出现的问题</h3><h4 id="1-docker的时间和服务器时间不同"><a href="#1-docker的时间和服务器时间不同" class="headerlink" title="1. docker的时间和服务器时间不同"></a>1. docker的时间和服务器时间不同</h4><p>点击容器</p><p>选择frps容器更多，选择编辑</p><p>在挂载中增加时间配置</p><p>在环境变量增加配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET_CONTAINER_TIMEZONE=<span class="literal">true</span></span><br><span class="line">CONTAINER_TIMEZONE=Asia/Shanghai</span><br></pre></td></tr></table></figure><h2 id="3-安装fail2ban"><a href="#3-安装fail2ban" class="headerlink" title="3. 安装fail2ban"></a>3. 安装fail2ban</h2><p>官网提供了安装方式（<a href="https://1panel.cn/docs/user_manual/toolbox/fail2ban/%EF%BC%89">https://1panel.cn/docs/user_manual/toolbox/fail2ban/）</a></p><h3 id="添加frps规则"><a href="#添加frps规则" class="headerlink" title="添加frps规则"></a>添加frps规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/fail2ban/filter.d/frps.conf</span></span><br><span class="line">[Definition]</span><br><span class="line">failregex = ^.*get a user connection \[&lt;HOST&gt;:[0-9]*\]</span><br><span class="line">            ^.*get a new work connection: \[&lt;HOST&gt;:[0-9]*\]</span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure><h3 id="校验规则"><a href="#校验规则" class="headerlink" title="校验规则"></a>校验规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-regex /opt/1panel/apps/frps/frps/log/frps.log /etc/fail2ban/filter.d/frps.conf</span><br></pre></td></tr></table></figure><h3 id="运行规则"><a href="#运行规则" class="headerlink" title="运行规则"></a>运行规则</h3><p>在1Panel面板的工具箱中有Fail2ban的配置，点击全部配置修改，可以根据自由修改配置</p><p>frp：监控目标名称<br>port：封禁全部端口<br>filter：过滤规则，我们使用自定义的frps<br>action：捕捉到恶意IP后执行的操作，本文使用iptables对IP封禁所有端口<br>logpath：需要监控的日志文件<br>bantime：封禁时间，单位为秒<br>findtime：查找时间段，单位为秒<br>maxretry：允许的最大失败次数，这里我们配置10分钟内触发10次规则，那么就封禁掉</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DEFAULT-START</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">ignoreip = 127.0.0.1/8</span><br><span class="line">bantime = 600</span><br><span class="line">findtime = 300</span><br><span class="line">maxretry = 5</span><br><span class="line">banaction = ufw</span><br><span class="line">action = %(action_mwl)s</span><br><span class="line"><span class="comment">#DEFAULT-END</span></span><br><span class="line"></span><br><span class="line">[sshd]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">filter = sshd</span><br><span class="line">port = 22</span><br><span class="line">maxretry = 3</span><br><span class="line">findtime = 300</span><br><span class="line">bantime = 600000</span><br><span class="line">banaction = ufw</span><br><span class="line">action = %(action_mwl)s</span><br><span class="line">logpath = /var/log/auth.log</span><br><span class="line"></span><br><span class="line">[frp]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">findtime = 600</span><br><span class="line">maxretry = 5</span><br><span class="line">bantime = -1</span><br><span class="line">filter = frps</span><br><span class="line">logpath = /opt/1panel/apps/frps/frps/log/frps.log </span><br><span class="line">protocol = all</span><br><span class="line">chain = all</span><br><span class="line">port = all</span><br></pre></td></tr></table></figure><h2 id="4-安装frpc"><a href="#4-安装frpc" class="headerlink" title="4. 安装frpc"></a>4. 安装frpc</h2><p>在本地闲置电脑安装frpc，也用docker的方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --restart always --network host --name frpc -v /data/frpc/frpc.toml:/etc/frp/frpc.toml snowdreamtech/frpc</span><br></pre></td></tr></table></figure><p>根据官网（<a href="https://gofrp.org/zh-cn/docs/reference/client-configures/%EF%BC%89%E7%9A%84%E6%8F%90%E7%A4%BA%E9%85%8D%E7%BD%AE">https://gofrp.org/zh-cn/docs/reference/client-configures/）的提示配置</a></p><p>这是我使用的配置，需要把汉字部分修改为自己需要的设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">user = <span class="string">&quot;LinuxDo&quot;</span></span><br><span class="line">serverAddr = <span class="string">&quot;连接服务端的地址。&quot;</span></span><br><span class="line">serverPort = 连接服务端的端口，默认为 7000。</span><br><span class="line">auth.method = <span class="string">&quot;token&quot;</span></span><br><span class="line">auth.token = <span class="string">&quot;在 method 为 token 时生效，客户端需要设置一样的值才能鉴权通过。&quot;</span></span><br><span class="line">log.to = <span class="string">&quot;console&quot;</span></span><br><span class="line">transport.tcpMux = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[[proxies]]</span><br><span class="line">name = <span class="string">&quot;LinuxDo&quot;</span></span><br><span class="line"><span class="built_in">type</span> = <span class="string">&quot;tcp&quot;</span></span><br><span class="line">localIP = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">localPort = 8080</span><br><span class="line">remotePort = 80</span><br></pre></td></tr></table></figure><p>现在应该就能正常访问本地的服务了</p><h2 id="5-frps添加https（纯IP地址申请TLS证书，避免国内小鸡需要备份的问题）"><a href="#5-frps添加https（纯IP地址申请TLS证书，避免国内小鸡需要备份的问题）" class="headerlink" title="5. frps添加https（纯IP地址申请TLS证书，避免国内小鸡需要备份的问题）"></a>5. frps添加https（纯IP地址申请TLS证书，避免国内小鸡需要备份的问题）</h2><p>可以颁布的证书网站（<a href="https://zerossl.com/?fpr=ourlco%EF%BC%89">https://zerossl.com/?fpr=ourlco）</a></p><p>缺点：只有90天，需要手动创建，手机app使用时需要手动导入证书</p><p>下面只说明获得证书后，把ssl的三个文件放到<code>/data/frpc/data</code>文件夹下</p><p>增加frpc配置文件</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[[proxies]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;LinuxDo&quot;</span></span><br><span class="line"><span class="attr">type</span> = <span class="string">&quot;tcp&quot;</span></span><br><span class="line"><span class="attr">localIP</span> = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line"><span class="attr">localPort</span> = <span class="number">8080</span></span><br><span class="line"><span class="attr">remotePort</span> = <span class="number">81</span></span><br><span class="line"><span class="section">[proxies.plugin]</span></span><br><span class="line"><span class="attr">type</span> = <span class="string">&quot;https2http&quot;</span></span><br><span class="line"><span class="attr">localAddr</span> = <span class="string">&quot;127.0.0.1:8080&quot;</span></span><br><span class="line"><span class="attr">hostHeaderRewrite</span> = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line"><span class="attr">requestHeaders.set.x-from-where</span> = <span class="string">&quot;frp&quot;</span></span><br><span class="line"><span class="attr">crtPath</span> = <span class="string">&quot;/etc/frp/ssl/certificate.crt&quot;</span></span><br><span class="line"><span class="attr">keyPath</span> = <span class="string">&quot;/etc/frp/ssl/private.key&quot;</span></span><br></pre></td></tr></table></figure><p>重新创建frpc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stop frpc &amp;&amp; \</span><br><span class="line">docker <span class="built_in">rm</span> frpc &amp;&amp; \</span><br><span class="line">docker run -d --restart always --network host --name frpc -v /data/frpc/:/etc/frp/ snowdreamtech/frpc</span><br></pre></td></tr></table></figure><p>尝试过直接用cf隧道指向国内小鸡，但是fail2ban拿到的ip是小鸡ip，所以就改用了这种方式</p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="frps安装"><a href="#frps安装" class="headerlink" title="frps安装"></a>frps安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name frps snowdreamtech/frps</span><br><span class="line">docker <span class="built_in">cp</span> frps:/etc/frp /data/frpc/</span><br><span class="line">docker stop frps &amp;&amp; docker <span class="built_in">rm</span> frps</span><br><span class="line">docker run -d --restart always --network host --name frps -v /data/frpc/:/etc/frp/ snowdreamtech/frps</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-安装1Panel（非必须只需要软件frps和fail2ban，可以考虑其他安装方式）&quot;&gt;&lt;a href=&quot;#1-安装1Panel（非必须只需要软件frps和fail2ban，可以考虑其他安装方式）&quot; class=&quot;headerlink&quot; title=&quot;1. 安装1Panel（非必须只需要软件frps和fail2ban，可以考虑其他安装方式）&quot;&gt;&lt;/a&gt;1. 安装1Panel（非必须只需要软件frps和fail2ban，可以考虑其他安装方式）&lt;/h2&gt;&lt;p&gt;官网地址：&lt;a href=&quot;https://1panel.cn/docs/installation/online_installation/&quot;&gt;https://1panel.cn/docs/installation/online_installation/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;根据服务器情况安装&lt;/p&gt;</summary>
    
    
    
    <category term="Linux" scheme="https://blog.48626.xyz/categories/Linux/"/>
    
    <category term="Frp" scheme="https://blog.48626.xyz/categories/Linux/Frp/"/>
    
    
    <category term="Linux" scheme="https://blog.48626.xyz/tags/Linux/"/>
    
    <category term="Frp" scheme="https://blog.48626.xyz/tags/Frp/"/>
    
  </entry>
  
  <entry>
    <title>对Hexo博客静态资源进行压缩</title>
    <link href="https://blog.48626.xyz/be35e2ef1345.html"/>
    <id>https://blog.48626.xyz/be35e2ef1345.html</id>
    <published>2024-07-02T03:02:30.000Z</published>
    <updated>2024-07-02T03:02:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>注意包的版本，这里只展示glup4</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/core@^7.24.7 \</span><br><span class="line">            @babel/preset-env@^7.24.7 \</span><br><span class="line">            gulp-babel@^8.0.0 \</span><br><span class="line">            gulp-cache@^1.1.3 \</span><br><span class="line">            gulp-clean-css@^4.3.0 \</span><br><span class="line">            gulp-htmlclean@^2.7.22 \</span><br><span class="line">            gulp-htmlmin@^5.0.1 \</span><br><span class="line">            gulp-imagemin@^6.2.0 \</span><br><span class="line">            gulp-minify-css@^1.2.4 \</span><br><span class="line">            gulp-uglify@^3.0.2 \</span><br><span class="line">            imagemin-pngquant@^10.0.0 \</span><br><span class="line">            gulp@4.0.2</span><br></pre></td></tr></table></figure><h2 id="创建-gulpfile-js"><a href="#创建-gulpfile-js" class="headerlink" title="创建 gulpfile.js"></a>创建 gulpfile.js</h2><p>在 <code>Hexo</code> 博客的根目录下面，创建一个 <code>gulpfile.js</code> 文件，这个名字不可改，必须是这个名字。<br>在刚创建的文件中写入如下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> minifycss = <span class="built_in">require</span>(<span class="string">&#x27;gulp-minify-css&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> uglify = <span class="built_in">require</span>(<span class="string">&#x27;gulp-uglify&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlmin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlmin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlclean = <span class="built_in">require</span>(<span class="string">&#x27;gulp-htmlclean&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&#x27;gulp-babel&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cache = <span class="built_in">require</span>(<span class="string">&#x27;gulp-cache&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> imagemin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-imagemin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-css&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.css&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">minifycss</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩js文件，支持将ES6代码转换成ES5代码</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-js&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.js&#x27;</span>)</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">babel</span>(&#123;</span><br><span class="line">        <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">      &#125;))</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())</span><br><span class="line">      .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩html文件</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-html&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.html&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">htmlclean</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">      <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyJS</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyCSS</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyURLs</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getPngquant</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;imagemin-pngquant&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">default</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 压缩图片(深度压缩)</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;minify-images&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pngquant = <span class="keyword">await</span> <span class="title function_">getPngquant</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.&#123;png,jpg,gif,ico&#125;&#x27;</span>)</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">cache</span>(<span class="title function_">imagemin</span>(&#123;                   <span class="comment">// 启用缓存，只压缩发生变化的图片</span></span><br><span class="line">        <span class="attr">progressive</span>: <span class="literal">true</span>,                     <span class="comment">// 是否无损压缩 jpg 图片</span></span><br><span class="line">        <span class="attr">interlaced</span>: <span class="literal">false</span>,                     <span class="comment">// 是否隔行扫描 gif 进行渲染</span></span><br><span class="line">        <span class="attr">svgoPlugins</span>: [&#123;<span class="attr">removeViewBox</span>: <span class="literal">false</span>&#125;], <span class="comment">// 是否移除 svg 的 viewbox 属性</span></span><br><span class="line">        <span class="attr">multipass</span>: <span class="literal">false</span>,                      <span class="comment">// 是否多次优化 svg 直到完全优化</span></span><br><span class="line">        <span class="attr">optimizationLevel</span>: <span class="number">5</span>,                  <span class="comment">// 优化等级，取值范围：0-7，默认值：3</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="title function_">pngquant</span>()]                      <span class="comment">// 使用 pngquant 深度压缩 png 图片的 imagemin 插件</span></span><br><span class="line">      &#125;)))</span><br><span class="line">      .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// gulp4的写法</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;default&#x27;</span>,gulp.<span class="title function_">series</span>(gulp.<span class="title function_">parallel</span>(<span class="string">&#x27;minify-css&#x27;</span>, <span class="string">&#x27;minify-js&#x27;</span>,<span class="string">&#x27;minify-html&#x27;</span>, <span class="string">&#x27;minify-images&#x27;</span>,<span class="keyword">function</span>(<span class="params">done</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Gulp is running!&#x27;</span>);</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;)));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意:</p><ul><li>以上代码是运行在 <code>gulp4</code> 环境的，与 <code>gulp3</code> 不通用</li><li>图片压缩速度很慢，若不需要压缩图片，请将第52行的代码中的 <code>&#39;minify-img&#39;</code> 删除，忽略其它文件压缩同理。</li></ul><h2 id="对代码进行压缩"><a href="#对代码进行压缩" class="headerlink" title="对代码进行压缩"></a>对代码进行压缩</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">gulp build</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>先清空文件，生成静态文件，然后使用 <code>gulp</code> 命令对代码进行压缩，最后将其推送到服务器就行了</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;注意包的版本，这里只展示glup4&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install @babel/core@^7.24.7 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            @babel/preset-env@^7.24.7 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp-babel@^8.0.0 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp-cache@^1.1.3 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp-clean-css@^4.3.0 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp-htmlclean@^2.7.22 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp-htmlmin@^5.0.1 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp-imagemin@^6.2.0 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp-minify-css@^1.2.4 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp-uglify@^3.0.2 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            imagemin-pngquant@^10.0.0 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gulp@4.0.2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;创建-gulpfile-js&quot;&gt;&lt;a href=&quot;#创建-gulpfile-js&quot; class=&quot;headerlink&quot; title=&quot;创建 gulpfile.js&quot;&gt;&lt;/a&gt;创建 gulpfile.js&lt;/h2&gt;</summary>
    
    
    
    <category term="Hexo" scheme="https://blog.48626.xyz/categories/Hexo/"/>
    
    
    <category term="Hexo" scheme="https://blog.48626.xyz/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>docker安装mysql</title>
    <link href="https://blog.48626.xyz/2d010ac21d89.html"/>
    <id>https://blog.48626.xyz/2d010ac21d89.html</id>
    <published>2024-07-02T02:58:06.000Z</published>
    <updated>2024-07-02T02:58:06.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysql5"><a href="#mysql5" class="headerlink" title="mysql5"></a>mysql5</h2><h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7.37</span><br></pre></td></tr></table></figure><h3 id="在home目录下创建映射目录"><a href="#在home目录下创建映射目录" class="headerlink" title="在home目录下创建映射目录"></a>在home目录下创建映射目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/mysql5/&#123;conf.d,logs,data&#125;</span><br></pre></td></tr></table></figure><h3 id="创建my-cnf配置文件"><a href="#创建my-cnf配置文件" class="headerlink" title="创建my.cnf配置文件"></a>创建my.cnf配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/mysql5/conf.d/my.cnf</span><br></pre></td></tr></table></figure><h4 id="my-cnf"><a href="#my-cnf" class="headerlink" title="my.cnf"></a>my.cnf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">user=mysql</span><br><span class="line">init_connect=<span class="string">&#x27;SET collation_connection = utf8mb4_unicode_ci&#x27;</span></span><br><span class="line">init_connect=<span class="string">&#x27;SET NAMES utf8mb4&#x27;</span></span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">secure_file_priv=/var/lib/mysql</span><br><span class="line">expire_logs_days=7</span><br><span class="line">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span><br><span class="line">max_connections=1000</span><br><span class="line">default-time_zone=<span class="string">&#x27;+8:00&#x27;</span></span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>MySQL(5.7.19)的默认配置文件是 &#x2F;etc&#x2F;mysql&#x2F;my.cnf 文件。</p><p>如果想要自定义配置，建议向 &#x2F;etc&#x2F;mysql&#x2F;conf.d 目录中创建 .cnf 文件。</p><p>新建的文件可以任意起名，只要保证后缀名是 cnf 即可。</p><p>新建的文件中的配置项可以覆盖 &#x2F;etc&#x2F;mysql&#x2F;my.cnf 中的配置项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql5 -v ~/mysql5/conf:/etc/mysql/conf.d -v ~/mysql5/logs:/logs -v ~/mysql5/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -dit -p 3306:3306 mysql:5.7.37</span><br></pre></td></tr></table></figure><h3 id="远程登录"><a href="#远程登录" class="headerlink" title="远程登录"></a>远程登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入容器5</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql5 /bin/bash</span><br><span class="line"><span class="comment">#登录mysql</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># 查看数据库</span></span><br><span class="line">show databases;</span><br><span class="line"><span class="keyword">select</span> host, user,plugin,authentication_string from mysql.user;</span><br><span class="line"><span class="comment"># 更新 root的 远程登录为所有</span></span><br><span class="line">update mysql.user <span class="built_in">set</span> host=<span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span>; </span><br><span class="line"><span class="keyword">select</span> host, user,plugin,authentication_string from mysql.user;</span><br><span class="line"> <span class="comment"># 给用户授权</span></span><br><span class="line">grant all privileges on *.* to root@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>; </span><br><span class="line"><span class="comment"># 刷新权限</span></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h2 id="mysql8"><a href="#mysql8" class="headerlink" title="mysql8"></a>mysql8</h2><h3 id="下载镜像-1"><a href="#下载镜像-1" class="headerlink" title="下载镜像"></a>下载镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:8</span><br></pre></td></tr></table></figure><h3 id="在home目录下创建映射目录-1"><a href="#在home目录下创建映射目录-1" class="headerlink" title="在home目录下创建映射目录"></a>在home目录下创建映射目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/mysql8/&#123;conf.d,logs,data&#125;</span><br></pre></td></tr></table></figure><h3 id="创建my-cnf配置文件-1"><a href="#创建my-cnf配置文件-1" class="headerlink" title="创建my.cnf配置文件"></a>创建my.cnf配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/mysql8/conf.d/my.cnf</span><br></pre></td></tr></table></figure><h4 id="my-cnf-1"><a href="#my-cnf-1" class="headerlink" title="my.cnf"></a>my.cnf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">user=mysql</span><br><span class="line">init_connect=<span class="string">&#x27;SET collation_connection = utf8mb4_unicode_ci&#x27;</span></span><br><span class="line">init_connect=<span class="string">&#x27;SET NAMES utf8mb4&#x27;</span></span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">secure_file_priv=/var/lib/mysql</span><br><span class="line">expire_logs_days=7</span><br><span class="line">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span><br><span class="line">max_connections=1000</span><br><span class="line">default-time_zone=<span class="string">&#x27;+8:00&#x27;</span></span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8mb4</span><br></pre></td></tr></table></figure><h3 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h3><p>如果想要自定义配置，建议向 &#x2F;etc&#x2F;mysql&#x2F;conf.d 目录中创建 .cnf 文件。</p><p>新建的文件可以任意起名，只要保证后缀名是 cnf 即可。</p><p>新建的文件中的配置项可以覆盖 &#x2F;etc&#x2F;mysql&#x2F;my.cnf 中的配置项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql8 -v ~/mysql8/conf:/etc/mysql/conf.d -v ~/mysql8/logs:/logs -v ~/mysql8/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=Abcd1234! -dit -p 3306:3306 mysql:8</span><br></pre></td></tr></table></figure><h3 id="远程登录-1"><a href="#远程登录-1" class="headerlink" title="远程登录"></a>远程登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入容器8</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql8 /bin/bash</span><br><span class="line"><span class="comment">#登录mysql</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">use mysql;</span><br><span class="line"><span class="keyword">select</span> host,user from user;</span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Abcd1234!&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="comment">#添加远程登录用户</span></span><br><span class="line">CREATE USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;Abcd1234!&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;mysql5&quot;&gt;&lt;a href=&quot;#mysql5&quot; class=&quot;headerlink&quot; title=&quot;mysql5&quot;&gt;&lt;/a&gt;mysql5&lt;/h2&gt;&lt;h3 id=&quot;下载镜像&quot;&gt;&lt;a href=&quot;#下载镜像&quot; class=&quot;headerlink&quot; title=&quot;下载镜像&quot;&gt;&lt;/a&gt;下载镜像&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker pull mysql:5.7.37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="docker" scheme="https://blog.48626.xyz/categories/docker/"/>
    
    <category term="mysql" scheme="https://blog.48626.xyz/categories/docker/mysql/"/>
    
    
    <category term="docker" scheme="https://blog.48626.xyz/tags/docker/"/>
    
    <category term="mysql" scheme="https://blog.48626.xyz/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>mysql主从设置</title>
    <link href="https://blog.48626.xyz/967f626b21b0.html"/>
    <id>https://blog.48626.xyz/967f626b21b0.html</id>
    <published>2024-07-01T02:58:06.000Z</published>
    <updated>2024-07-01T02:58:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>什么是主从，详细百度去吧，我说说我自己的理解</p><ul><li><p>为了灾备</p></li><li><p>均衡负载，提高吞吐量</p></li></ul><h2 id="主备的原理"><a href="#主备的原理" class="headerlink" title="主备的原理"></a>主备的原理</h2><p>主服务器（master） 把数据同步到从服务器（slave）</p><img src="/967f626b21b0/1.jpg" class=""><h2 id="下面就是实现了"><a href="#下面就是实现了" class="headerlink" title="下面就是实现了"></a>下面就是实现了</h2><p>首先需要两个mysql（本地测试推荐：phpstudy里面复制两个mysql）</p><h3 id="修改my-ini"><a href="#修改my-ini" class="headerlink" title="修改my.ini"></a>修改my.ini</h3><p>— 唯一 ,要与备机的不同</p><p><code>server_id = 101</code></p><p>— 开启二进制日志</p><p><code>log-bin= mysql-bin</code></p><h3 id="设置服务"><a href="#设置服务" class="headerlink" title="设置服务"></a>设置服务</h3><p>— 设置服务</p><p><code>.\mysqld.exe install MySQL-3310 –defaults-file=”D:\PhpStudy\MySQL\my.ini”</code></p><p>— 删除服务</p><p><code>.\mysqld.exe remove MySQL-3310</code></p><p>— 开启服务</p><p><code>net start MySQL-3310</code></p><h3 id="远程连接"><a href="#远程连接" class="headerlink" title="远程连接"></a>远程连接</h3><p>— 查询连接账户</p><p><code>SELECT USER,HOST from user;</code></p><p>— 开启远程</p><p><code>grant all privileges on . to ‘root’@’%’ identified by ‘root’ with grant option;</code></p><h3 id="创建连接用户（主机配置）"><a href="#创建连接用户（主机配置）" class="headerlink" title="创建连接用户（主机配置）"></a>创建连接用户（主机配置）</h3><p>— CREATE USER ‘使用名’@’备机IP地址’ IDENTIFIED BY ‘密码’;#创建用户</p><p><code>create user ‘usermysql’@’localhost’ identified by ‘123456’;</code></p><p>— GRANT REPLICATION SLAVE ON . TO ‘使用名’@’备机IP地址’;#分配权限</p><p><code>grant replication slave on . to ‘usermysql’@’localhost’;</code></p><p>— 刷新权限</p><p><code>flush privileges;</code></p><p>— 查看master状态</p><p><code>show master status;</code></p><p>创建连接（从机配置）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER TO </span><br><span class="line">MASTER_HOST=’localhost’, #主机的IP</span><br><span class="line">MASTER_PORT=3306,</span><br><span class="line">MASTER_USER=’usermysql’, #之前创建的那个使用名</span><br><span class="line">MASTER_PASSWORD=’123456′, #密码</span><br><span class="line">MASTER_LOG_FILE=’mysql-bin.000001′, #这是主库中show master status;File下的那个值</span><br><span class="line">MASTER_LOG_POS=446;#这是主库Position下的那个值</span><br><span class="line"></span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes </span><br><span class="line">看到这两个都是Yes就成了</span><br></pre></td></tr></table></figure><p>— 关闭</p><p><code>stop slave;</code></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;什么是主从，详细百度去吧，我说说我自己的理解&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;为了灾备&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;均衡负载，提高吞吐量&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;主备的原理&quot;&gt;&lt;a href=&quot;#主备的原理&quot; class=&quot;headerlink&quot; title=&quot;主备的原理&quot;&gt;&lt;/a&gt;主备的原理&lt;/h2&gt;</summary>
    
    
    
    <category term="mysql" scheme="https://blog.48626.xyz/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://blog.48626.xyz/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Java数组</title>
    <link href="https://blog.48626.xyz/0f32396da29f.html"/>
    <id>https://blog.48626.xyz/0f32396da29f.html</id>
    <published>2024-06-29T17:06:37.000Z</published>
    <updated>2024-06-29T17:06:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="数组拷贝"><a href="#数组拷贝" class="headerlink" title="数组拷贝"></a>数组拷贝</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line"> // 这样拷贝数组没有隔离性</span><br><span class="line"> String[] ss1 = &#123; &quot;1&quot;, &quot;2&quot;, &quot;3&quot; &#125;;</span><br><span class="line"> // 把ss1对数组的引用传递给变量ss2,两个变量指向的是用一个数组</span><br><span class="line"> String[] ss2 = ss1;</span><br><span class="line"> ss2[0] = &quot;4&quot;;</span><br><span class="line"> System.out.println(Arrays.toString(ss1));</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">// 方法1</span><br><span class="line">// 推荐</span><br><span class="line">String[] ss1 = &#123; &quot;1&quot;, &quot;2&quot;, &quot;3&quot; &#125;;</span><br><span class="line">// 通过new关键字再内存中开辟一块空间，ss2指向的是新的数组对象</span><br><span class="line">String[] ss2 = new String[ss1.length];</span><br><span class="line">for (int i = 0; i &lt; ss2.length; i++) &#123;</span><br><span class="line">ss2[i] = ss1[i];</span><br><span class="line">&#125;</span><br><span class="line">ss2[0] = &quot;张三&quot;;</span><br><span class="line">System.out.println(Arrays.toString(ss1));</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">// 方法2</span><br><span class="line">// API提供的方式，底层用C++写的，所以速度很快，比for循环的效率高</span><br><span class="line">String[] ss1 = &#123; &quot;1&quot;, &quot;2&quot;, &quot;3&quot; &#125;;</span><br><span class="line">String[] ss2 = new String[ss1.length];</span><br><span class="line">System.arraycopy(ss1, 0, ss2, 0, ss1.length);</span><br><span class="line">/**</span><br><span class="line"> * (Object src,int srcPos,Object dest,int destPos,int length)</span><br><span class="line"> * src:源数组,srcPos:源数组要复制的起始位置;dest:目的数组;destPos:目的数组放置的起始位置;length:复制的长度</span><br><span class="line"> * 注意：src and dest都必须是同类型或者可以进行转换类型的数组．</span><br><span class="line"> * 有趣的是这个函数可以实现自己到自己复制，比如：</span><br><span class="line"> * int[] fun =&#123;0,1,2,3,4,5,6&#125;; </span><br><span class="line"> * System.arraycopy(fun,0,fun,3,3);</span><br><span class="line"> * 则结果为：&#123;0,1,2,0,1,2,6&#125;;</span><br><span class="line"> */</span><br><span class="line">System.out.println(Arrays.toString(ss2));</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">//方法3</span><br><span class="line">String[] ss1 = &#123; &quot;1&quot;, &quot;2&quot;, &quot;3&quot; &#125;;</span><br><span class="line">String[] ss2 = Arrays.copyOf(ss1, ss1.length);</span><br><span class="line">/**</span><br><span class="line"> *该方法对应不同的数据类型都有各自的重载方法</span><br><span class="line"> *original - 要复制的数组</span><br><span class="line"> *newLength - 要返回的副本的长度</span><br><span class="line"> *newType - 要返回的副本的类型</span><br><span class="line"> *仔细观察发现，copyOf()内部调用了System.arraycopy()方法</span><br><span class="line"> *区别在于：</span><br><span class="line"> *arraycopy()需要目标数组，将原数组拷贝到你自己定义的数组里，而且可以选择拷贝的起点和长度以及放入新数组中的位置</span><br><span class="line"> *copyOf()是系统自动在内部新建一个数组，调用arraycopy()将original内容复制到copy中去，并且长度为newLength。返回copy; 即将原数组拷贝到一个长度为newLength的新数组中，并返回该数组。</span><br><span class="line"> *总结</span><br><span class="line"> *Array.copyOf()可以看作是受限的System.arraycopy()，它主要是用来将原数组全部拷贝到一个新长度的数组，适用于数组扩容。</span><br><span class="line"> */</span><br><span class="line">System.out.println(Arrays.toString(ss2));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="数组扩容"><a href="#数组扩容" class="headerlink" title="数组扩容"></a>数组扩容</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">String[] ss1 = &#123; &quot;1&quot;, &quot;2&quot;, &quot;3&quot; &#125;;</span><br><span class="line">ss1 = Arrays.copyOf(ss1, ss1.length + 2);</span><br><span class="line">System.out.println(ss1.length);</span><br><span class="line">System.out.println(Arrays.toString(ss1));</span><br><span class="line">// 5</span><br><span class="line">// [1, 2, 3, null, null]</span><br><span class="line">&#125;</span><br><span class="line">常见面试题: 统计字符的位置</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">String str = &quot;统计一个字符再字符串中的所有位置&quot;;</span><br><span class="line">int[] arry = countAll(str, &#x27;字&#x27;);</span><br><span class="line">System.out.println(Arrays.toString(arry));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static int[] countAll(String str, char ch) &#123;</span><br><span class="line">int[] array = &#123;&#125;;// 创建一个空数组</span><br><span class="line">for (int i = 0; i &lt; str.length(); i++) &#123;</span><br><span class="line">if (ch == str.charAt(i)) &#123;</span><br><span class="line">// charAt(i)遍历String每个字符</span><br><span class="line">array = Arrays.copyOf(array, array.length + 1);</span><br><span class="line">// 扩容</span><br><span class="line">array[array.length - 1] = i;</span><br><span class="line">// 刚扩容的位置</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="数组排序"><a href="#数组排序" class="headerlink" title="数组排序"></a>数组排序</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">//Java提供排序方法</span><br><span class="line">int[] ss1= &#123;2,3,1&#125;;</span><br><span class="line">Arrays.sort(ss1);</span><br><span class="line">System.out.println(Arrays.toString(ss1));</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">// 方法1</span><br><span class="line">// 冒泡排序，前一个数与后一个数进行比较</span><br><span class="line">int[] ss1 = &#123; 2, 3, 1 &#125;;</span><br><span class="line">int temp = 0;</span><br><span class="line">for (int i = 0; i &lt; ss1.length - 1; i++) &#123;</span><br><span class="line">for (int j = i + 1; j &lt; ss1.length; j++) &#123;</span><br><span class="line">if (ss1[j] &lt; ss1[i]) &#123;</span><br><span class="line">temp = ss1[i];</span><br><span class="line">ss1[i] = ss1[j];</span><br><span class="line">ss1[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(ss1));</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">// 方法2</span><br><span class="line">// 选择排序</span><br><span class="line">int[] ss1 = &#123; 2, 3, 1 &#125;;</span><br><span class="line">int temp = 0;</span><br><span class="line">for (int i = 0; i &lt; ss1.length - 1; i++) &#123;</span><br><span class="line">int min = i;</span><br><span class="line">for (int j = i + 1; j &lt; ss1.length; j++) &#123;</span><br><span class="line">if (ss1[min] &gt; ss1[j]) &#123;</span><br><span class="line">// 找到比选定下标小的数</span><br><span class="line">min = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if (min != i) &#123;</span><br><span class="line">// 交换位置</span><br><span class="line">temp = ss1[i];</span><br><span class="line">ss1[i] = ss1[min];</span><br><span class="line">ss1[min] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(ss1));</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">// 方法3</span><br><span class="line">// 插入排序</span><br><span class="line">int[] ss1 = &#123; 2, 3, 1 &#125;;</span><br><span class="line">int temp = 0;</span><br><span class="line">for (int i = 1; i &lt; ss1.length; i++) &#123;</span><br><span class="line">for (int j = i; j &gt; 0; j--) &#123;</span><br><span class="line">if (ss1[j] &lt; ss1[j - 1]) &#123;</span><br><span class="line">temp = ss1[j];</span><br><span class="line">ss1[j] = ss1[j - 1];</span><br><span class="line">ss1[j - 1] = temp;</span><br><span class="line">&#125; else</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(ss1));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// 有序数组,二分查找</span><br><span class="line">static int bingarySerarch(int[] array, int num) &#123;</span><br><span class="line">int low = 0;</span><br><span class="line">int high = array.length - 1;</span><br><span class="line">while (low &lt;= high) &#123;</span><br><span class="line">int mid = (low + high) / 2;</span><br><span class="line">if (num &gt; array[mid]) &#123;</span><br><span class="line">low = mid + 1;</span><br><span class="line">&#125; else if (num &lt; array[mid]) &#123;</span><br><span class="line">high = mid - 1;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">return mid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return -1;</span><br><span class="line">&#125;</span><br><span class="line">// 无序数组，采用遍历，也可以先排序，后采用二分查找</span><br><span class="line">static int search(int[] array, int num) &#123;</span><br><span class="line">int index = -1;</span><br><span class="line">for (int i = 0; i &lt; array.length; i++) &#123;</span><br><span class="line">if (num == array[i]) &#123;</span><br><span class="line">index = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return index;</span><br><span class="line">&#125;</span><br><span class="line">// Java 提供的查找方式。查看源码，它的本质就是二分查找</span><br><span class="line">static void test(int[] array, int num) &#123;</span><br><span class="line">/**</span><br><span class="line"> * binarySearch(Object[], Object key) a: 要搜索的数组 key：要搜索的值</span><br><span class="line"> * 如果key在数组中，则返回搜索值的索引；否则返回-1或“-”（插入点）。插入点是索引键将要插入数组的那一点，即第一个大于该键的元素的索引。 技巧： [1]</span><br><span class="line"> * 搜索值不是数组元素，且在数组范围内，从1开始计数，得“ - 插入点索引值”； [2] 搜索值是数组元素，从0开始计数，得搜索值的索引值； [3]</span><br><span class="line"> * 搜索值不是数组元素，且大于数组内元素，索引值为 – (length + 1); [4] 搜索值不是数组元素，且小于数组内元素，索引值为 – 1。</span><br><span class="line"> */</span><br><span class="line">int index = Arrays.binarySearch(array, 8);</span><br><span class="line">System.out.println(index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;数组拷贝&quot;&gt;&lt;a href=&quot;#数组拷贝&quot; class=&quot;headerlink&quot; title=&quot;数组拷贝&quot;&gt;&lt;/a&gt;数组拷贝&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public static void main(String[] args) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 // 这样拷贝数组没有隔离性&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 String[] ss1 = &amp;#123; &amp;quot;1&amp;quot;, &amp;quot;2&amp;quot;, &amp;quot;3&amp;quot; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 // 把ss1对数组的引用传递给变量ss2,两个变量指向的是用一个数组&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 String[] ss2 = ss1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 ss2[0] = &amp;quot;4&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 System.out.println(Arrays.toString(ss1));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public static void main(String[] args) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 方法1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 推荐&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		String[] ss1 = &amp;#123; &amp;quot;1&amp;quot;, &amp;quot;2&amp;quot;, &amp;quot;3&amp;quot; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 通过new关键字再内存中开辟一块空间，ss2指向的是新的数组对象&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		String[] ss2 = new String[ss1.length];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		for (int i = 0; i &amp;lt; ss2.length; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			ss2[i] = ss1[i];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		ss2[0] = &amp;quot;张三&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		System.out.println(Arrays.toString(ss1));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public static void main(String[] args) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 方法2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// API提供的方式，底层用C++写的，所以速度很快，比for循环的效率高&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		String[] ss1 = &amp;#123; &amp;quot;1&amp;quot;, &amp;quot;2&amp;quot;, &amp;quot;3&amp;quot; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		String[] ss2 = new String[ss1.length];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		System.arraycopy(ss1, 0, ss2, 0, ss1.length);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 * (Object src,int srcPos,Object dest,int destPos,int length)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 * src:源数组,srcPos:源数组要复制的起始位置;dest:目的数组;destPos:目的数组放置的起始位置;length:复制的长度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 * 注意：src and dest都必须是同类型或者可以进行转换类型的数组．&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 * 有趣的是这个函数可以实现自己到自己复制，比如：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 * int[] fun =&amp;#123;0,1,2,3,4,5,6&amp;#125;; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 * System.arraycopy(fun,0,fun,3,3);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 * 则结果为：&amp;#123;0,1,2,0,1,2,6&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		System.out.println(Arrays.toString(ss2));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public static void main(String[] args) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		//方法3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		String[] ss1 = &amp;#123; &amp;quot;1&amp;quot;, &amp;quot;2&amp;quot;, &amp;quot;3&amp;quot; &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		String[] ss2 = Arrays.copyOf(ss1, ss1.length);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *该方法对应不同的数据类型都有各自的重载方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *original - 要复制的数组&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *newLength - 要返回的副本的长度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *newType - 要返回的副本的类型&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *仔细观察发现，copyOf()内部调用了System.arraycopy()方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *区别在于：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *arraycopy()需要目标数组，将原数组拷贝到你自己定义的数组里，而且可以选择拷贝的起点和长度以及放入新数组中的位置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *copyOf()是系统自动在内部新建一个数组，调用arraycopy()将original内容复制到copy中去，并且长度为newLength。返回copy; 即将原数组拷贝到一个长度为newLength的新数组中，并返回该数组。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *总结&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 *Array.copyOf()可以看作是受限的System.arraycopy()，它主要是用来将原数组全部拷贝到一个新长度的数组，适用于数组扩容。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		 */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		System.out.println(Arrays.toString(ss2));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h1 id=&quot;数组扩容&quot;&gt;&lt;a href=&quot;#数组扩容&quot; class=&quot;headerlink&quot; title=&quot;数组扩容&quot;&gt;&lt;/a&gt;数组扩容&lt;/h1&gt;</summary>
    
    
    
    <category term="Java" scheme="https://blog.48626.xyz/categories/Java/"/>
    
    
    <category term="Java" scheme="https://blog.48626.xyz/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Next 主题在 Hexo 中添加GA4</title>
    <link href="https://blog.48626.xyz/a91cd1e28bb8.html"/>
    <id>https://blog.48626.xyz/a91cd1e28bb8.html</id>
    <published>2024-06-28T17:20:58.000Z</published>
    <updated>2024-06-28T17:20:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>确保您的 Next 主题是7。</p><h2 id="1：修改-config-yml"><a href="#1：修改-config-yml" class="headerlink" title="1：修改_config.yml"></a>1：修改_config.yml</h2><p>打开 <code>&#123;HEXO_ROOT&#125;\themes\next\_config.yml</code> 文件，找到以下代码：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="comment">#head: source/_data/head.swig</span></span><br></pre></td></tr></table></figure><p>删除 “#head: source&#x2F;_data&#x2F;head.swig “行中的 #。</p><h2 id="2：添加head-swig"><a href="#2：添加head-swig" class="headerlink" title="2：添加head.swig"></a>2：添加head.swig</h2><p>创建一个文件 <code>&#123;HEXO_ROOT&#125;\source\_data\head.swig</code> 并将 GA 代码放入该文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Global site tag (gtag.js) - Google Analytics --&gt;</span><br><span class="line">&lt;script async src=&quot;https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  window.dataLayer = window.dataLayer || [];</span><br><span class="line">  function gtag()&#123;dataLayer.push(arguments);&#125;</span><br><span class="line">  gtag(&#x27;js&#x27;, new Date());</span><br><span class="line"></span><br><span class="line">  gtag(&#x27;config&#x27;, &#x27;G-XXXXXXXXXX&#x27;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="3-获取代码"><a href="#3-获取代码" class="headerlink" title="3.获取代码"></a>3.获取代码</h2><ol><li>資料蒐集和修改 -&gt; 資料串流</li><li>點選你的網址</li><li>最下方的 查看代碼操作說明</li><li>選擇右邊的 手動安裝 就可以看到追蹤程式碼了</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;确保您的 Next 主题是7。&lt;/p&gt;
&lt;h2 id=&quot;1：修改-config-yml&quot;&gt;&lt;a href=&quot;#1：修改-config-yml&quot; class=&quot;headerlink&quot; title=&quot;1：修改_config.yml&quot;&gt;&lt;/a&gt;1：修改_config.yml&lt;/h2&gt;&lt;p&gt;打开 &lt;code&gt;&amp;#123;HEXO_ROOT&amp;#125;&#92;themes&#92;next&#92;_config.yml&lt;/code&gt; 文件，找到以下代码：&lt;/p&gt;</summary>
    
    
    
    <category term="Hexo" scheme="https://blog.48626.xyz/categories/Hexo/"/>
    
    
    <category term="Hexo" scheme="https://blog.48626.xyz/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>Docker安装Redis</title>
    <link href="https://blog.48626.xyz/d989f31f055d.html"/>
    <id>https://blog.48626.xyz/d989f31f055d.html</id>
    <published>2024-06-25T08:40:03.000Z</published>
    <updated>2024-06-25T08:40:03.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure><h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/redis/&#123;conf,data&#125;</span><br><span class="line">vim ~/redis/conf/redis.conf</span><br></pre></td></tr></table></figure><p>把下面的代码粘贴到redis.conf中即（该配置已经#daemonize yes，和设置requirepass 123456）</p><h3 id="完整redis-conf"><a href="#完整redis-conf" class="headerlink" title="完整redis.conf"></a>完整redis.conf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Redis configuration file example.</span><br><span class="line">#</span><br><span class="line"># Note that in order to read the configuration file, Redis must be</span><br><span class="line"># started with the file path as first argument:</span><br><span class="line">#</span><br><span class="line"># ./redis-server /path/to/redis.conf</span><br><span class="line"> </span><br><span class="line"># Note on units: when memory size is needed, it is possible to specify</span><br><span class="line"># it in the usual form of 1k 5GB 4M and so forth:</span><br><span class="line">#</span><br><span class="line"># 1k =&gt; 1000 bytes</span><br><span class="line"># 1kb =&gt; 1024 bytes</span><br><span class="line"># 1m =&gt; 1000000 bytes</span><br><span class="line"># 1mb =&gt; 1024*1024 bytes</span><br><span class="line"># 1g =&gt; 1000000000 bytes</span><br><span class="line"># 1gb =&gt; 1024*1024*1024 bytes</span><br><span class="line">#</span><br><span class="line"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span><br><span class="line"> </span><br><span class="line">################################## INCLUDES ###################################</span><br><span class="line"> </span><br><span class="line"># Include one or more other config files here.  This is useful if you</span><br><span class="line"># have a standard template that goes to all Redis servers but also need</span><br><span class="line"># to customize a few per-server settings.  Include files can include</span><br><span class="line"># other files, so use this wisely.</span><br><span class="line">#</span><br><span class="line"># Notice option &quot;include&quot; won&#x27;t be rewritten by command &quot;CONFIG REWRITE&quot;</span><br><span class="line"># from admin or Redis Sentinel. Since Redis always uses the last processed</span><br><span class="line"># line as value of a configuration directive, you&#x27;d better put includes</span><br><span class="line"># at the beginning of this file to avoid overwriting config change at runtime.</span><br><span class="line">#</span><br><span class="line"># If instead you are interested in using includes to override configuration</span><br><span class="line"># options, it is better to use include as the last line.</span><br><span class="line">#</span><br><span class="line"># include /path/to/local.conf</span><br><span class="line"># include /path/to/other.conf</span><br><span class="line"> </span><br><span class="line">################################## MODULES #####################################</span><br><span class="line"> </span><br><span class="line"># Load modules at startup. If the server is not able to load modules</span><br><span class="line"># it will abort. It is possible to use multiple loadmodule directives.</span><br><span class="line">#</span><br><span class="line"># loadmodule /path/to/my_module.so</span><br><span class="line"># loadmodule /path/to/other_module.so</span><br><span class="line"> </span><br><span class="line">################################## NETWORK #####################################</span><br><span class="line"> </span><br><span class="line"># By default, if no &quot;bind&quot; configuration directive is specified, Redis listens</span><br><span class="line"># for connections from all the network interfaces available on the server.</span><br><span class="line"># It is possible to listen to just one or multiple selected interfaces using</span><br><span class="line"># the &quot;bind&quot; configuration directive, followed by one or more IP addresses.</span><br><span class="line">#</span><br><span class="line"># Examples:</span><br><span class="line">#</span><br><span class="line"># bind 192.168.1.100 10.0.0.1</span><br><span class="line"># bind 127.0.0.1 ::1</span><br><span class="line">#</span><br><span class="line"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span><br><span class="line"># internet, binding to all the interfaces is dangerous and will expose the</span><br><span class="line"># instance to everybody on the internet. So by default we uncomment the</span><br><span class="line"># following bind directive, that will force Redis to listen only into</span><br><span class="line"># the IPv4 lookback interface address (this means Redis will be able to</span><br><span class="line"># accept connections only from clients running into the same computer it</span><br><span class="line"># is running).</span><br><span class="line">#</span><br><span class="line"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span><br><span class="line"># JUST COMMENT THE FOLLOWING LINE.</span><br><span class="line"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">bind *</span><br><span class="line"> </span><br><span class="line"># Protected mode is a layer of security protection, in order to avoid that</span><br><span class="line"># Redis instances left open on the internet are accessed and exploited.</span><br><span class="line">#</span><br><span class="line"># When protected mode is on and if:</span><br><span class="line">#</span><br><span class="line"># 1) The server is not binding explicitly to a set of addresses using the</span><br><span class="line">#    &quot;bind&quot; directive.</span><br><span class="line"># 2) No password is configured.</span><br><span class="line">#</span><br><span class="line"># The server only accepts connections from clients connecting from the</span><br><span class="line"># IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span><br><span class="line"># sockets.</span><br><span class="line">#</span><br><span class="line"># By default protected mode is enabled. You should disable it only if</span><br><span class="line"># you are sure you want clients from other hosts to connect to Redis</span><br><span class="line"># even if no authentication is configured, nor a specific set of interfaces</span><br><span class="line"># are explicitly listed using the &quot;bind&quot; directive.</span><br><span class="line">protected-mode yes</span><br><span class="line"> </span><br><span class="line"># Accept connections on the specified port, default is 6379 (IANA #815344).</span><br><span class="line"># If port 0 is specified Redis will not listen on a TCP socket.</span><br><span class="line">port 6379</span><br><span class="line"> </span><br><span class="line"># TCP listen() backlog.</span><br><span class="line">#</span><br><span class="line"># In high requests-per-second environments you need an high backlog in order</span><br><span class="line"># to avoid slow clients connections issues. Note that the Linux kernel</span><br><span class="line"># will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span><br><span class="line"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span><br><span class="line"># in order to get the desired effect.</span><br><span class="line">tcp-backlog 511</span><br><span class="line"> </span><br><span class="line"># Unix socket.</span><br><span class="line">#</span><br><span class="line"># Specify the path for the Unix socket that will be used to listen for</span><br><span class="line"># incoming connections. There is no default, so Redis will not listen</span><br><span class="line"># on a unix socket when not specified.</span><br><span class="line">#</span><br><span class="line"># unixsocket /tmp/redis.sock</span><br><span class="line"># unixsocketperm 700</span><br><span class="line"> </span><br><span class="line"># Close the connection after a client is idle for N seconds (0 to disable)</span><br><span class="line">timeout 0</span><br><span class="line"> </span><br><span class="line"># TCP keepalive.</span><br><span class="line">#</span><br><span class="line"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span><br><span class="line"># of communication. This is useful for two reasons:</span><br><span class="line">#</span><br><span class="line"># 1) Detect dead peers.</span><br><span class="line"># 2) Take the connection alive from the point of view of network</span><br><span class="line">#    equipment in the middle.</span><br><span class="line">#</span><br><span class="line"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span><br><span class="line"># Note that to close the connection the double of the time is needed.</span><br><span class="line"># On other kernels the period depends on the kernel configuration.</span><br><span class="line">#</span><br><span class="line"># A reasonable value for this option is 300 seconds, which is the new</span><br><span class="line"># Redis default starting with Redis 3.2.1.</span><br><span class="line">tcp-keepalive 300</span><br><span class="line"> </span><br><span class="line">################################# GENERAL #####################################</span><br><span class="line"> </span><br><span class="line"># By default Redis does not run as a daemon. Use &#x27;yes&#x27; if you need it.</span><br><span class="line"># Note that Redis will write a pid file in /var/run/redis.pid when daemonized.</span><br><span class="line">#daemonize yes</span><br><span class="line"> </span><br><span class="line"># If you run Redis from upstart or systemd, Redis can interact with your</span><br><span class="line"># supervision tree. Options:</span><br><span class="line">#   supervised no      - no supervision interaction</span><br><span class="line">#   supervised upstart - signal upstart by putting Redis into SIGSTOP mode</span><br><span class="line">#   supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET</span><br><span class="line">#   supervised auto    - detect upstart or systemd method based on</span><br><span class="line">#                        UPSTART_JOB or NOTIFY_SOCKET environment variables</span><br><span class="line"># Note: these supervision methods only signal &quot;process is ready.&quot;</span><br><span class="line">#       They do not enable continuous liveness pings back to your supervisor.</span><br><span class="line">supervised no</span><br><span class="line"> </span><br><span class="line"># If a pid file is specified, Redis writes it where specified at startup</span><br><span class="line"># and removes it at exit.</span><br><span class="line">#</span><br><span class="line"># When the server runs non daemonized, no pid file is created if none is</span><br><span class="line"># specified in the configuration. When the server is daemonized, the pid file</span><br><span class="line"># is used even if not specified, defaulting to &quot;/var/run/redis.pid&quot;.</span><br><span class="line">#</span><br><span class="line"># Creating a pid file is best effort: if Redis is not able to create it</span><br><span class="line"># nothing bad happens, the server will start and run normally.</span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"> </span><br><span class="line"># Specify the server verbosity level.</span><br><span class="line"># This can be one of:</span><br><span class="line"># debug (a lot of information, useful for development/testing)</span><br><span class="line"># verbose (many rarely useful info, but not a mess like the debug level)</span><br><span class="line"># notice (moderately verbose, what you want in production probably)</span><br><span class="line"># warning (only very important / critical messages are logged)</span><br><span class="line">loglevel notice</span><br><span class="line"> </span><br><span class="line"># Specify the log file name. Also the empty string can be used to force</span><br><span class="line"># Redis to log on the standard output. Note that if you use standard</span><br><span class="line"># output for logging but daemonize, logs will be sent to /dev/null</span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"> </span><br><span class="line"># To enable logging to the system logger, just set &#x27;syslog-enabled&#x27; to yes,</span><br><span class="line"># and optionally update the other syslog parameters to suit your needs.</span><br><span class="line"># syslog-enabled no</span><br><span class="line"> </span><br><span class="line"># Specify the syslog identity.</span><br><span class="line"># syslog-ident redis</span><br><span class="line"> </span><br><span class="line"># Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span><br><span class="line"># syslog-facility local0</span><br><span class="line"> </span><br><span class="line"># Set the number of databases. The default database is DB 0, you can select</span><br><span class="line"># a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span><br><span class="line"># dbid is a number between 0 and &#x27;databases&#x27;-1</span><br><span class="line">databases 16</span><br><span class="line"> </span><br><span class="line"># By default Redis shows an ASCII art logo only when started to log to the</span><br><span class="line"># standard output and if the standard output is a TTY. Basically this means</span><br><span class="line"># that normally a logo is displayed only in interactive sessions.</span><br><span class="line">#</span><br><span class="line"># However it is possible to force the pre-4.0 behavior and always show a</span><br><span class="line"># ASCII art logo in startup logs by setting the following option to yes.</span><br><span class="line">always-show-logo yes</span><br><span class="line"> </span><br><span class="line">################################ SNAPSHOTTING  ################################</span><br><span class="line">#</span><br><span class="line"># Save the DB on disk:</span><br><span class="line">#</span><br><span class="line">#   save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">#</span><br><span class="line">#   Will save the DB if both the given number of seconds and the given</span><br><span class="line">#   number of write operations against the DB occurred.</span><br><span class="line">#</span><br><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save &quot;&quot;</span><br><span class="line"> </span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"> </span><br><span class="line"># By default Redis will stop accepting writes if RDB snapshots are enabled</span><br><span class="line"># (at least one save point) and the latest background save failed.</span><br><span class="line"># This will make the user aware (in a hard way) that data is not persisting</span><br><span class="line"># on disk properly, otherwise chances are that no one will notice and some</span><br><span class="line"># disaster will happen.</span><br><span class="line">#</span><br><span class="line"># If the background saving process will start working again Redis will</span><br><span class="line"># automatically allow writes again.</span><br><span class="line">#</span><br><span class="line"># However if you have setup your proper monitoring of the Redis server</span><br><span class="line"># and persistence, you may want to disable this feature so that Redis will</span><br><span class="line"># continue to work as usual even if there are problems with disk,</span><br><span class="line"># permissions, and so forth.</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"> </span><br><span class="line"># Compress string objects using LZF when dump .rdb databases?</span><br><span class="line"># For default that&#x27;s set to &#x27;yes&#x27; as it&#x27;s almost always a win.</span><br><span class="line"># If you want to save some CPU in the saving child set it to &#x27;no&#x27; but</span><br><span class="line"># the dataset will likely be bigger if you have compressible values or keys.</span><br><span class="line">rdbcompression yes</span><br><span class="line"> </span><br><span class="line"># Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span><br><span class="line"># This makes the format more resistant to corruption but there is a performance</span><br><span class="line"># hit to pay (around 10%) when saving and loading RDB files, so you can disable it</span><br><span class="line"># for maximum performances.</span><br><span class="line">#</span><br><span class="line"># RDB files created with checksum disabled have a checksum of zero that will</span><br><span class="line"># tell the loading code to skip the check.</span><br><span class="line">rdbchecksum yes</span><br><span class="line"> </span><br><span class="line"># The filename where to dump the DB</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"> </span><br><span class="line"># The working directory.</span><br><span class="line">#</span><br><span class="line"># The DB will be written inside this directory, with the filename specified</span><br><span class="line"># above using the &#x27;dbfilename&#x27; configuration directive.</span><br><span class="line">#</span><br><span class="line"># The Append Only File will also be created inside this directory.</span><br><span class="line">#</span><br><span class="line"># Note that you must specify a directory here, not a file name.</span><br><span class="line">dir ./</span><br><span class="line"> </span><br><span class="line">################################# REPLICATION #################################</span><br><span class="line"> </span><br><span class="line"># Master-Slave replication. Use slaveof to make a Redis instance a copy of</span><br><span class="line"># another Redis server. A few things to understand ASAP about Redis replication.</span><br><span class="line">#</span><br><span class="line"># 1) Redis replication is asynchronous, but you can configure a master to</span><br><span class="line">#    stop accepting writes if it appears to be not connected with at least</span><br><span class="line">#    a given number of slaves.</span><br><span class="line"># 2) Redis slaves are able to perform a partial resynchronization with the</span><br><span class="line">#    master if the replication link is lost for a relatively small amount of</span><br><span class="line">#    time. You may want to configure the replication backlog size (see the next</span><br><span class="line">#    sections of this file) with a sensible value depending on your needs.</span><br><span class="line"># 3) Replication is automatic and does not need user intervention. After a</span><br><span class="line">#    network partition slaves automatically try to reconnect to masters</span><br><span class="line">#    and resynchronize with them.</span><br><span class="line">#</span><br><span class="line"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"> </span><br><span class="line"># If the master is password protected (using the &quot;requirepass&quot; configuration</span><br><span class="line"># directive below) it is possible to tell the slave to authenticate before</span><br><span class="line"># starting the replication synchronization process, otherwise the master will</span><br><span class="line"># refuse the slave request.</span><br><span class="line">#</span><br><span class="line"># masterauth &lt;master-password&gt;</span><br><span class="line"> </span><br><span class="line"># When a slave loses its connection with the master, or when the replication</span><br><span class="line"># is still in progress, the slave can act in two different ways:</span><br><span class="line">#</span><br><span class="line"># 1) if slave-serve-stale-data is set to &#x27;yes&#x27; (the default) the slave will</span><br><span class="line">#    still reply to client requests, possibly with out of date data, or the</span><br><span class="line">#    data set may just be empty if this is the first synchronization.</span><br><span class="line">#</span><br><span class="line"># 2) if slave-serve-stale-data is set to &#x27;no&#x27; the slave will reply with</span><br><span class="line">#    an error &quot;SYNC with master in progress&quot; to all the kind of commands</span><br><span class="line">#    but to INFO and SLAVEOF.</span><br><span class="line">#</span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line"> </span><br><span class="line"># You can configure a slave instance to accept writes or not. Writing against</span><br><span class="line"># a slave instance may be useful to store some ephemeral data (because data</span><br><span class="line"># written on a slave will be easily deleted after resync with the master) but</span><br><span class="line"># may also cause problems if clients are writing to it because of a</span><br><span class="line"># misconfiguration.</span><br><span class="line">#</span><br><span class="line"># Since Redis 2.6 by default slaves are read-only.</span><br><span class="line">#</span><br><span class="line"># Note: read only slaves are not designed to be exposed to untrusted clients</span><br><span class="line"># on the internet. It&#x27;s just a protection layer against misuse of the instance.</span><br><span class="line"># Still a read only slave exports by default all the administrative commands</span><br><span class="line"># such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span><br><span class="line"># security of read only slaves using &#x27;rename-command&#x27; to shadow all the</span><br><span class="line"># administrative / dangerous commands.</span><br><span class="line">slave-read-only yes</span><br><span class="line"> </span><br><span class="line"># Replication SYNC strategy: disk or socket.</span><br><span class="line">#</span><br><span class="line"># -------------------------------------------------------</span><br><span class="line"># WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY</span><br><span class="line"># -------------------------------------------------------</span><br><span class="line">#</span><br><span class="line"># New slaves and reconnecting slaves that are not able to continue the replication</span><br><span class="line"># process just receiving differences, need to do what is called a &quot;full</span><br><span class="line"># synchronization&quot;. An RDB file is transmitted from the master to the slaves.</span><br><span class="line"># The transmission can happen in two different ways:</span><br><span class="line">#</span><br><span class="line"># 1) Disk-backed: The Redis master creates a new process that writes the RDB</span><br><span class="line">#                 file on disk. Later the file is transferred by the parent</span><br><span class="line">#                 process to the slaves incrementally.</span><br><span class="line"># 2) Diskless: The Redis master creates a new process that directly writes the</span><br><span class="line">#              RDB file to slave sockets, without touching the disk at all.</span><br><span class="line">#</span><br><span class="line"># With disk-backed replication, while the RDB file is generated, more slaves</span><br><span class="line"># can be queued and served with the RDB file as soon as the current child producing</span><br><span class="line"># the RDB file finishes its work. With diskless replication instead once</span><br><span class="line"># the transfer starts, new slaves arriving will be queued and a new transfer</span><br><span class="line"># will start when the current one terminates.</span><br><span class="line">#</span><br><span class="line"># When diskless replication is used, the master waits a configurable amount of</span><br><span class="line"># time (in seconds) before starting the transfer in the hope that multiple slaves</span><br><span class="line"># will arrive and the transfer can be parallelized.</span><br><span class="line">#</span><br><span class="line"># With slow disks and fast (large bandwidth) networks, diskless replication</span><br><span class="line"># works better.</span><br><span class="line">repl-diskless-sync no</span><br><span class="line"> </span><br><span class="line"># When diskless replication is enabled, it is possible to configure the delay</span><br><span class="line"># the server waits in order to spawn the child that transfers the RDB via socket</span><br><span class="line"># to the slaves.</span><br><span class="line">#</span><br><span class="line"># This is important since once the transfer starts, it is not possible to serve</span><br><span class="line"># new slaves arriving, that will be queued for the next RDB transfer, so the server</span><br><span class="line"># waits a delay in order to let more slaves arrive.</span><br><span class="line">#</span><br><span class="line"># The delay is specified in seconds, and by default is 5 seconds. To disable</span><br><span class="line"># it entirely just set it to 0 seconds and the transfer will start ASAP.</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line"> </span><br><span class="line"># Slaves send PINGs to server in a predefined interval. It&#x27;s possible to change</span><br><span class="line"># this interval with the repl_ping_slave_period option. The default value is 10</span><br><span class="line"># seconds.</span><br><span class="line">#</span><br><span class="line"># repl-ping-slave-period 10</span><br><span class="line"> </span><br><span class="line"># The following option sets the replication timeout for:</span><br><span class="line">#</span><br><span class="line"># 1) Bulk transfer I/O during SYNC, from the point of view of slave.</span><br><span class="line"># 2) Master timeout from the point of view of slaves (data, pings).</span><br><span class="line"># 3) Slave timeout from the point of view of masters (REPLCONF ACK pings).</span><br><span class="line">#</span><br><span class="line"># It is important to make sure that this value is greater than the value</span><br><span class="line"># specified for repl-ping-slave-period otherwise a timeout will be detected</span><br><span class="line"># every time there is low traffic between the master and the slave.</span><br><span class="line">#</span><br><span class="line"># repl-timeout 60</span><br><span class="line"> </span><br><span class="line"># Disable TCP_NODELAY on the slave socket after SYNC?</span><br><span class="line">#</span><br><span class="line"># If you select &quot;yes&quot; Redis will use a smaller number of TCP packets and</span><br><span class="line"># less bandwidth to send data to slaves. But this can add a delay for</span><br><span class="line"># the data to appear on the slave side, up to 40 milliseconds with</span><br><span class="line"># Linux kernels using a default configuration.</span><br><span class="line">#</span><br><span class="line"># If you select &quot;no&quot; the delay for data to appear on the slave side will</span><br><span class="line"># be reduced but more bandwidth will be used for replication.</span><br><span class="line">#</span><br><span class="line"># By default we optimize for low latency, but in very high traffic conditions</span><br><span class="line"># or when the master and slaves are many hops away, turning this to &quot;yes&quot; may</span><br><span class="line"># be a good idea.</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"> </span><br><span class="line"># Set the replication backlog size. The backlog is a buffer that accumulates</span><br><span class="line"># slave data when slaves are disconnected for some time, so that when a slave</span><br><span class="line"># wants to reconnect again, often a full resync is not needed, but a partial</span><br><span class="line"># resync is enough, just passing the portion of data the slave missed while</span><br><span class="line"># disconnected.</span><br><span class="line">#</span><br><span class="line"># The bigger the replication backlog, the longer the time the slave can be</span><br><span class="line"># disconnected and later be able to perform a partial resynchronization.</span><br><span class="line">#</span><br><span class="line"># The backlog is only allocated once there is at least a slave connected.</span><br><span class="line">#</span><br><span class="line"># repl-backlog-size 1mb</span><br><span class="line"> </span><br><span class="line"># After a master has no longer connected slaves for some time, the backlog</span><br><span class="line"># will be freed. The following option configures the amount of seconds that</span><br><span class="line"># need to elapse, starting from the time the last slave disconnected, for</span><br><span class="line"># the backlog buffer to be freed.</span><br><span class="line">#</span><br><span class="line"># Note that slaves never free the backlog for timeout, since they may be</span><br><span class="line"># promoted to masters later, and should be able to correctly &quot;partially</span><br><span class="line"># resynchronize&quot; with the slaves: hence they should always accumulate backlog.</span><br><span class="line">#</span><br><span class="line"># A value of 0 means to never release the backlog.</span><br><span class="line">#</span><br><span class="line"># repl-backlog-ttl 3600</span><br><span class="line"> </span><br><span class="line"># The slave priority is an integer number published by Redis in the INFO output.</span><br><span class="line"># It is used by Redis Sentinel in order to select a slave to promote into a</span><br><span class="line"># master if the master is no longer working correctly.</span><br><span class="line">#</span><br><span class="line"># A slave with a low priority number is considered better for promotion, so</span><br><span class="line"># for instance if there are three slaves with priority 10, 100, 25 Sentinel will</span><br><span class="line"># pick the one with priority 10, that is the lowest.</span><br><span class="line">#</span><br><span class="line"># However a special priority of 0 marks the slave as not able to perform the</span><br><span class="line"># role of master, so a slave with priority of 0 will never be selected by</span><br><span class="line"># Redis Sentinel for promotion.</span><br><span class="line">#</span><br><span class="line"># By default the priority is 100.</span><br><span class="line">slave-priority 100</span><br><span class="line"> </span><br><span class="line"># It is possible for a master to stop accepting writes if there are less than</span><br><span class="line"># N slaves connected, having a lag less or equal than M seconds.</span><br><span class="line">#</span><br><span class="line"># The N slaves need to be in &quot;online&quot; state.</span><br><span class="line">#</span><br><span class="line"># The lag in seconds, that must be &lt;= the specified value, is calculated from</span><br><span class="line"># the last ping received from the slave, that is usually sent every second.</span><br><span class="line">#</span><br><span class="line"># This option does not GUARANTEE that N replicas will accept the write, but</span><br><span class="line"># will limit the window of exposure for lost writes in case not enough slaves</span><br><span class="line"># are available, to the specified number of seconds.</span><br><span class="line">#</span><br><span class="line"># For example to require at least 3 slaves with a lag &lt;= 10 seconds use:</span><br><span class="line">#</span><br><span class="line"># min-slaves-to-write 3</span><br><span class="line"># min-slaves-max-lag 10</span><br><span class="line">#</span><br><span class="line"># Setting one or the other to 0 disables the feature.</span><br><span class="line">#</span><br><span class="line"># By default min-slaves-to-write is set to 0 (feature disabled) and</span><br><span class="line"># min-slaves-max-lag is set to 10.</span><br><span class="line"> </span><br><span class="line"># A Redis master is able to list the address and port of the attached</span><br><span class="line"># slaves in different ways. For example the &quot;INFO replication&quot; section</span><br><span class="line"># offers this information, which is used, among other tools, by</span><br><span class="line"># Redis Sentinel in order to discover slave instances.</span><br><span class="line"># Another place where this info is available is in the output of the</span><br><span class="line"># &quot;ROLE&quot; command of a master.</span><br><span class="line">#</span><br><span class="line"># The listed IP and address normally reported by a slave is obtained</span><br><span class="line"># in the following way:</span><br><span class="line">#</span><br><span class="line">#   IP: The address is auto detected by checking the peer address</span><br><span class="line">#   of the socket used by the slave to connect with the master.</span><br><span class="line">#</span><br><span class="line">#   Port: The port is communicated by the slave during the replication</span><br><span class="line">#   handshake, and is normally the port that the slave is using to</span><br><span class="line">#   list for connections.</span><br><span class="line">#</span><br><span class="line"># However when port forwarding or Network Address Translation (NAT) is</span><br><span class="line"># used, the slave may be actually reachable via different IP and port</span><br><span class="line"># pairs. The following two options can be used by a slave in order to</span><br><span class="line"># report to its master a specific set of IP and port, so that both INFO</span><br><span class="line"># and ROLE will report those values.</span><br><span class="line">#</span><br><span class="line"># There is no need to use both the options if you need to override just</span><br><span class="line"># the port or the IP address.</span><br><span class="line">#</span><br><span class="line"># slave-announce-ip 5.5.5.5</span><br><span class="line"># slave-announce-port 1234</span><br><span class="line"> </span><br><span class="line">################################## SECURITY ###################################</span><br><span class="line"> </span><br><span class="line"># Require clients to issue AUTH &lt;PASSWORD&gt; before processing any other</span><br><span class="line"># commands.  This might be useful in environments in which you do not trust</span><br><span class="line"># others with access to the host running redis-server.</span><br><span class="line">#</span><br><span class="line"># This should stay commented out for backward compatibility and because most</span><br><span class="line"># people do not need auth (e.g. they run their own servers).</span><br><span class="line">#</span><br><span class="line"># Warning: since Redis is pretty fast an outside user can try up to</span><br><span class="line"># 150k passwords per second against a good box. This means that you should</span><br><span class="line"># use a very strong password otherwise it will be very easy to break.</span><br><span class="line">#</span><br><span class="line">requirepass 123456</span><br><span class="line"> </span><br><span class="line"># Command renaming.</span><br><span class="line">#</span><br><span class="line"># It is possible to change the name of dangerous commands in a shared</span><br><span class="line"># environment. For instance the CONFIG command may be renamed into something</span><br><span class="line"># hard to guess so that it will still be available for internal-use tools</span><br><span class="line"># but not available for general clients.</span><br><span class="line">#</span><br><span class="line"># Example:</span><br><span class="line">#</span><br><span class="line"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span><br><span class="line">#</span><br><span class="line"># It is also possible to completely kill a command by renaming it into</span><br><span class="line"># an empty string:</span><br><span class="line">#</span><br><span class="line"># rename-command CONFIG &quot;&quot;</span><br><span class="line">#</span><br><span class="line"># Please note that changing the name of commands that are logged into the</span><br><span class="line"># AOF file or transmitted to slaves may cause problems.</span><br><span class="line"> </span><br><span class="line">################################### CLIENTS ####################################</span><br><span class="line"> </span><br><span class="line"># Set the max number of connected clients at the same time. By default</span><br><span class="line"># this limit is set to 10000 clients, however if the Redis server is not</span><br><span class="line"># able to configure the process file limit to allow for the specified limit</span><br><span class="line"># the max number of allowed clients is set to the current file limit</span><br><span class="line"># minus 32 (as Redis reserves a few file descriptors for internal uses).</span><br><span class="line">#</span><br><span class="line"># Once the limit is reached Redis will close all the new connections sending</span><br><span class="line"># an error &#x27;max number of clients reached&#x27;.</span><br><span class="line">#</span><br><span class="line"># maxclients 10000</span><br><span class="line"> </span><br><span class="line">############################## MEMORY MANAGEMENT ################################</span><br><span class="line"> </span><br><span class="line"># Set a memory usage limit to the specified amount of bytes.</span><br><span class="line"># When the memory limit is reached Redis will try to remove keys</span><br><span class="line"># according to the eviction policy selected (see maxmemory-policy).</span><br><span class="line">#</span><br><span class="line"># If Redis can&#x27;t remove keys according to the policy, or if the policy is</span><br><span class="line"># set to &#x27;noeviction&#x27;, Redis will start to reply with errors to commands</span><br><span class="line"># that would use more memory, like SET, LPUSH, and so on, and will continue</span><br><span class="line"># to reply to read-only commands like GET.</span><br><span class="line">#</span><br><span class="line"># This option is usually useful when using Redis as an LRU or LFU cache, or to</span><br><span class="line"># set a hard memory limit for an instance (using the &#x27;noeviction&#x27; policy).</span><br><span class="line">#</span><br><span class="line"># WARNING: If you have slaves attached to an instance with maxmemory on,</span><br><span class="line"># the size of the output buffers needed to feed the slaves are subtracted</span><br><span class="line"># from the used memory count, so that network problems / resyncs will</span><br><span class="line"># not trigger a loop where keys are evicted, and in turn the output</span><br><span class="line"># buffer of slaves is full with DELs of keys evicted triggering the deletion</span><br><span class="line"># of more keys, and so forth until the database is completely emptied.</span><br><span class="line">#</span><br><span class="line"># In short... if you have slaves attached it is suggested that you set a lower</span><br><span class="line"># limit for maxmemory so that there is some free RAM on the system for slave</span><br><span class="line"># output buffers (but this is not needed if the policy is &#x27;noeviction&#x27;).</span><br><span class="line">#</span><br><span class="line"># maxmemory &lt;bytes&gt;</span><br><span class="line"> </span><br><span class="line"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span><br><span class="line"># is reached. You can select among five behaviors:</span><br><span class="line">#</span><br><span class="line"># volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set.</span><br><span class="line"># allkeys-lru -&gt; Evict any key using approximated LRU.</span><br><span class="line"># volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set.</span><br><span class="line"># allkeys-lfu -&gt; Evict any key using approximated LFU.</span><br><span class="line"># volatile-random -&gt; Remove a random key among the ones with an expire set.</span><br><span class="line"># allkeys-random -&gt; Remove a random key, any key.</span><br><span class="line"># volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span><br><span class="line"># noeviction -&gt; Don&#x27;t evict anything, just return an error on write operations.</span><br><span class="line">#</span><br><span class="line"># LRU means Least Recently Used</span><br><span class="line"># LFU means Least Frequently Used</span><br><span class="line">#</span><br><span class="line"># Both LRU, LFU and volatile-ttl are implemented using approximated</span><br><span class="line"># randomized algorithms.</span><br><span class="line">#</span><br><span class="line"># Note: with any of the above policies, Redis will return an error on write</span><br><span class="line">#       operations, when there are no suitable keys for eviction.</span><br><span class="line">#</span><br><span class="line">#       At the date of writing these commands are: set setnx setex append</span><br><span class="line">#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span><br><span class="line">#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span><br><span class="line">#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span><br><span class="line">#       getset mset msetnx exec sort</span><br><span class="line">#</span><br><span class="line"># The default is:</span><br><span class="line">#</span><br><span class="line"># maxmemory-policy noeviction</span><br><span class="line"> </span><br><span class="line"># LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span><br><span class="line"># algorithms (in order to save memory), so you can tune it for speed or</span><br><span class="line"># accuracy. For default Redis will check five keys and pick the one that was</span><br><span class="line"># used less recently, you can change the sample size using the following</span><br><span class="line"># configuration directive.</span><br><span class="line">#</span><br><span class="line"># The default of 5 produces good enough results. 10 Approximates very closely</span><br><span class="line"># true LRU but costs more CPU. 3 is faster but not very accurate.</span><br><span class="line">#</span><br><span class="line"># maxmemory-samples 5</span><br><span class="line"> </span><br><span class="line">############################# LAZY FREEING ####################################</span><br><span class="line"> </span><br><span class="line"># Redis has two primitives to delete keys. One is called DEL and is a blocking</span><br><span class="line"># deletion of the object. It means that the server stops processing new commands</span><br><span class="line"># in order to reclaim all the memory associated with an object in a synchronous</span><br><span class="line"># way. If the key deleted is associated with a small object, the time needed</span><br><span class="line"># in order to execute the DEL command is very small and comparable to most other</span><br><span class="line"># O(1) or O(log_N) commands in Redis. However if the key is associated with an</span><br><span class="line"># aggregated value containing millions of elements, the server can block for</span><br><span class="line"># a long time (even seconds) in order to complete the operation.</span><br><span class="line">#</span><br><span class="line"># For the above reasons Redis also offers non blocking deletion primitives</span><br><span class="line"># such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and</span><br><span class="line"># FLUSHDB commands, in order to reclaim memory in background. Those commands</span><br><span class="line"># are executed in constant time. Another thread will incrementally free the</span><br><span class="line"># object in the background as fast as possible.</span><br><span class="line">#</span><br><span class="line"># DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled.</span><br><span class="line"># It&#x27;s up to the design of the application to understand when it is a good</span><br><span class="line"># idea to use one or the other. However the Redis server sometimes has to</span><br><span class="line"># delete keys or flush the whole database as a side effect of other operations.</span><br><span class="line"># Specifically Redis deletes objects independently of a user call in the</span><br><span class="line"># following scenarios:</span><br><span class="line">#</span><br><span class="line"># 1) On eviction, because of the maxmemory and maxmemory policy configurations,</span><br><span class="line">#    in order to make room for new data, without going over the specified</span><br><span class="line">#    memory limit.</span><br><span class="line"># 2) Because of expire: when a key with an associated time to live (see the</span><br><span class="line">#    EXPIRE command) must be deleted from memory.</span><br><span class="line"># 3) Because of a side effect of a command that stores data on a key that may</span><br><span class="line">#    already exist. For example the RENAME command may delete the old key</span><br><span class="line">#    content when it is replaced with another one. Similarly SUNIONSTORE</span><br><span class="line">#    or SORT with STORE option may delete existing keys. The SET command</span><br><span class="line">#    itself removes any old content of the specified key in order to replace</span><br><span class="line">#    it with the specified string.</span><br><span class="line"># 4) During replication, when a slave performs a full resynchronization with</span><br><span class="line">#    its master, the content of the whole database is removed in order to</span><br><span class="line">#    load the RDB file just transfered.</span><br><span class="line">#</span><br><span class="line"># In all the above cases the default is to delete objects in a blocking way,</span><br><span class="line"># like if DEL was called. However you can configure each case specifically</span><br><span class="line"># in order to instead release memory in a non-blocking way like if UNLINK</span><br><span class="line"># was called, using the following configuration directives:</span><br><span class="line"> </span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">slave-lazy-flush no</span><br><span class="line"> </span><br><span class="line">############################## APPEND ONLY MODE ###############################</span><br><span class="line"> </span><br><span class="line"># By default Redis asynchronously dumps the dataset on disk. This mode is</span><br><span class="line"># good enough in many applications, but an issue with the Redis process or</span><br><span class="line"># a power outage may result into a few minutes of writes lost (depending on</span><br><span class="line"># the configured save points).</span><br><span class="line">#</span><br><span class="line"># The Append Only File is an alternative persistence mode that provides</span><br><span class="line"># much better durability. For instance using the default data fsync policy</span><br><span class="line"># (see later in the config file) Redis can lose just one second of writes in a</span><br><span class="line"># dramatic event like a server power outage, or a single write if something</span><br><span class="line"># wrong with the Redis process itself happens, but the operating system is</span><br><span class="line"># still running correctly.</span><br><span class="line">#</span><br><span class="line"># AOF and RDB persistence can be enabled at the same time without problems.</span><br><span class="line"># If the AOF is enabled on startup Redis will load the AOF, that is the file</span><br><span class="line"># with the better durability guarantees.</span><br><span class="line">#</span><br><span class="line"># Please check http://redis.io/topics/persistence for more information.</span><br><span class="line"> </span><br><span class="line">appendonly no</span><br><span class="line"> </span><br><span class="line"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span><br><span class="line"> </span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"> </span><br><span class="line"># The fsync() call tells the Operating System to actually write data on disk</span><br><span class="line"># instead of waiting for more data in the output buffer. Some OS will really flush</span><br><span class="line"># data on disk, some other OS will just try to do it ASAP.</span><br><span class="line">#</span><br><span class="line"># Redis supports three different modes:</span><br><span class="line">#</span><br><span class="line"># no: don&#x27;t fsync, just let the OS flush the data when it wants. Faster.</span><br><span class="line"># always: fsync after every write to the append only log. Slow, Safest.</span><br><span class="line"># everysec: fsync only one time every second. Compromise.</span><br><span class="line">#</span><br><span class="line"># The default is &quot;everysec&quot;, as that&#x27;s usually the right compromise between</span><br><span class="line"># speed and data safety. It&#x27;s up to you to understand if you can relax this to</span><br><span class="line"># &quot;no&quot; that will let the operating system flush the output buffer when</span><br><span class="line"># it wants, for better performances (but if you can live with the idea of</span><br><span class="line"># some data loss consider the default persistence mode that&#x27;s snapshotting),</span><br><span class="line"># or on the contrary, use &quot;always&quot; that&#x27;s very slow but a bit safer than</span><br><span class="line"># everysec.</span><br><span class="line">#</span><br><span class="line"># More details please check the following article:</span><br><span class="line"># http://antirez.com/post/redis-persistence-demystified.html</span><br><span class="line">#</span><br><span class="line"># If unsure, use &quot;everysec&quot;.</span><br><span class="line"> </span><br><span class="line"># appendfsync always</span><br><span class="line">appendfsync everysec</span><br><span class="line"># appendfsync no</span><br><span class="line"> </span><br><span class="line"># When the AOF fsync policy is set to always or everysec, and a background</span><br><span class="line"># saving process (a background save or AOF log background rewriting) is</span><br><span class="line"># performing a lot of I/O against the disk, in some Linux configurations</span><br><span class="line"># Redis may block too long on the fsync() call. Note that there is no fix for</span><br><span class="line"># this currently, as even performing fsync in a different thread will block</span><br><span class="line"># our synchronous write(2) call.</span><br><span class="line">#</span><br><span class="line"># In order to mitigate this problem it&#x27;s possible to use the following option</span><br><span class="line"># that will prevent fsync() from being called in the main process while a</span><br><span class="line"># BGSAVE or BGREWRITEAOF is in progress.</span><br><span class="line">#</span><br><span class="line"># This means that while another child is saving, the durability of Redis is</span><br><span class="line"># the same as &quot;appendfsync none&quot;. In practical terms, this means that it is</span><br><span class="line"># possible to lose up to 30 seconds of log in the worst scenario (with the</span><br><span class="line"># default Linux settings).</span><br><span class="line">#</span><br><span class="line"># If you have latency problems turn this to &quot;yes&quot;. Otherwise leave it as</span><br><span class="line"># &quot;no&quot; that is the safest pick from the point of view of durability.</span><br><span class="line"> </span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"> </span><br><span class="line"># Automatic rewrite of the append only file.</span><br><span class="line"># Redis is able to automatically rewrite the log file implicitly calling</span><br><span class="line"># BGREWRITEAOF when the AOF log size grows by the specified percentage.</span><br><span class="line">#</span><br><span class="line"># This is how it works: Redis remembers the size of the AOF file after the</span><br><span class="line"># latest rewrite (if no rewrite has happened since the restart, the size of</span><br><span class="line"># the AOF at startup is used).</span><br><span class="line">#</span><br><span class="line"># This base size is compared to the current size. If the current size is</span><br><span class="line"># bigger than the specified percentage, the rewrite is triggered. Also</span><br><span class="line"># you need to specify a minimal size for the AOF file to be rewritten, this</span><br><span class="line"># is useful to avoid rewriting the AOF file even if the percentage increase</span><br><span class="line"># is reached but it is still pretty small.</span><br><span class="line">#</span><br><span class="line"># Specify a percentage of zero in order to disable the automatic AOF</span><br><span class="line"># rewrite feature.</span><br><span class="line"> </span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"> </span><br><span class="line"># An AOF file may be found to be truncated at the end during the Redis</span><br><span class="line"># startup process, when the AOF data gets loaded back into memory.</span><br><span class="line"># This may happen when the system where Redis is running</span><br><span class="line"># crashes, especially when an ext4 filesystem is mounted without the</span><br><span class="line"># data=ordered option (however this can&#x27;t happen when Redis itself</span><br><span class="line"># crashes or aborts but the operating system still works correctly).</span><br><span class="line">#</span><br><span class="line"># Redis can either exit with an error when this happens, or load as much</span><br><span class="line"># data as possible (the default now) and start if the AOF file is found</span><br><span class="line"># to be truncated at the end. The following option controls this behavior.</span><br><span class="line">#</span><br><span class="line"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span><br><span class="line"># the Redis server starts emitting a log to inform the user of the event.</span><br><span class="line"># Otherwise if the option is set to no, the server aborts with an error</span><br><span class="line"># and refuses to start. When the option is set to no, the user requires</span><br><span class="line"># to fix the AOF file using the &quot;redis-check-aof&quot; utility before to restart</span><br><span class="line"># the server.</span><br><span class="line">#</span><br><span class="line"># Note that if the AOF file will be found to be corrupted in the middle</span><br><span class="line"># the server will still exit with an error. This option only applies when</span><br><span class="line"># Redis will try to read more data from the AOF file but not enough bytes</span><br><span class="line"># will be found.</span><br><span class="line">aof-load-truncated yes</span><br><span class="line"> </span><br><span class="line"># When rewriting the AOF file, Redis is able to use an RDB preamble in the</span><br><span class="line"># AOF file for faster rewrites and recoveries. When this option is turned</span><br><span class="line"># on the rewritten AOF file is composed of two different stanzas:</span><br><span class="line">#</span><br><span class="line">#   [RDB file][AOF tail]</span><br><span class="line">#</span><br><span class="line"># When loading Redis recognizes that the AOF file starts with the &quot;REDIS&quot;</span><br><span class="line"># string and loads the prefixed RDB file, and continues loading the AOF</span><br><span class="line"># tail.</span><br><span class="line">#</span><br><span class="line"># This is currently turned off by default in order to avoid the surprise</span><br><span class="line"># of a format change, but will at some point be used as the default.</span><br><span class="line">aof-use-rdb-preamble no</span><br><span class="line"> </span><br><span class="line">################################ LUA SCRIPTING  ###############################</span><br><span class="line"> </span><br><span class="line"># Max execution time of a Lua script in milliseconds.</span><br><span class="line">#</span><br><span class="line"># If the maximum execution time is reached Redis will log that a script is</span><br><span class="line"># still in execution after the maximum allowed time and will start to</span><br><span class="line"># reply to queries with an error.</span><br><span class="line">#</span><br><span class="line"># When a long running script exceeds the maximum execution time only the</span><br><span class="line"># SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</span><br><span class="line"># used to stop a script that did not yet called write commands. The second</span><br><span class="line"># is the only way to shut down the server in the case a write command was</span><br><span class="line"># already issued by the script but the user doesn&#x27;t want to wait for the natural</span><br><span class="line"># termination of the script.</span><br><span class="line">#</span><br><span class="line"># Set it to 0 or a negative value for unlimited execution without warnings.</span><br><span class="line">lua-time-limit 5000</span><br><span class="line"> </span><br><span class="line">################################ REDIS CLUSTER  ###############################</span><br><span class="line">#</span><br><span class="line"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line"># WARNING EXPERIMENTAL: Redis Cluster is considered to be stable code, however</span><br><span class="line"># in order to mark it as &quot;mature&quot; we need to wait for a non trivial percentage</span><br><span class="line"># of users to deploy it in production.</span><br><span class="line"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br><span class="line">#</span><br><span class="line"># Normal Redis instances can&#x27;t be part of a Redis Cluster; only nodes that are</span><br><span class="line"># started as cluster nodes can. In order to start a Redis instance as a</span><br><span class="line"># cluster node enable the cluster support uncommenting the following:</span><br><span class="line">#</span><br><span class="line"># cluster-enabled yes</span><br><span class="line"> </span><br><span class="line"># Every cluster node has a cluster configuration file. This file is not</span><br><span class="line"># intended to be edited by hand. It is created and updated by Redis nodes.</span><br><span class="line"># Every Redis Cluster node requires a different cluster configuration file.</span><br><span class="line"># Make sure that instances running in the same system do not have</span><br><span class="line"># overlapping cluster configuration file names.</span><br><span class="line">#</span><br><span class="line"># cluster-config-file nodes-6379.conf</span><br><span class="line"> </span><br><span class="line"># Cluster node timeout is the amount of milliseconds a node must be unreachable</span><br><span class="line"># for it to be considered in failure state.</span><br><span class="line"># Most other internal time limits are multiple of the node timeout.</span><br><span class="line">#</span><br><span class="line"># cluster-node-timeout 15000</span><br><span class="line"> </span><br><span class="line"># A slave of a failing master will avoid to start a failover if its data</span><br><span class="line"># looks too old.</span><br><span class="line">#</span><br><span class="line"># There is no simple way for a slave to actually have an exact measure of</span><br><span class="line"># its &quot;data age&quot;, so the following two checks are performed:</span><br><span class="line">#</span><br><span class="line"># 1) If there are multiple slaves able to failover, they exchange messages</span><br><span class="line">#    in order to try to give an advantage to the slave with the best</span><br><span class="line">#    replication offset (more data from the master processed).</span><br><span class="line">#    Slaves will try to get their rank by offset, and apply to the start</span><br><span class="line">#    of the failover a delay proportional to their rank.</span><br><span class="line">#</span><br><span class="line"># 2) Every single slave computes the time of the last interaction with</span><br><span class="line">#    its master. This can be the last ping or command received (if the master</span><br><span class="line">#    is still in the &quot;connected&quot; state), or the time that elapsed since the</span><br><span class="line">#    disconnection with the master (if the replication link is currently down).</span><br><span class="line">#    If the last interaction is too old, the slave will not try to failover</span><br><span class="line">#    at all.</span><br><span class="line">#</span><br><span class="line"># The point &quot;2&quot; can be tuned by user. Specifically a slave will not perform</span><br><span class="line"># the failover if, since the last interaction with the master, the time</span><br><span class="line"># elapsed is greater than:</span><br><span class="line">#</span><br><span class="line">#   (node-timeout * slave-validity-factor) + repl-ping-slave-period</span><br><span class="line">#</span><br><span class="line"># So for example if node-timeout is 30 seconds, and the slave-validity-factor</span><br><span class="line"># is 10, and assuming a default repl-ping-slave-period of 10 seconds, the</span><br><span class="line"># slave will not try to failover if it was not able to talk with the master</span><br><span class="line"># for longer than 310 seconds.</span><br><span class="line">#</span><br><span class="line"># A large slave-validity-factor may allow slaves with too old data to failover</span><br><span class="line"># a master, while a too small value may prevent the cluster from being able to</span><br><span class="line"># elect a slave at all.</span><br><span class="line">#</span><br><span class="line"># For maximum availability, it is possible to set the slave-validity-factor</span><br><span class="line"># to a value of 0, which means, that slaves will always try to failover the</span><br><span class="line"># master regardless of the last time they interacted with the master.</span><br><span class="line"># (However they&#x27;ll always try to apply a delay proportional to their</span><br><span class="line"># offset rank).</span><br><span class="line">#</span><br><span class="line"># Zero is the only value able to guarantee that when all the partitions heal</span><br><span class="line"># the cluster will always be able to continue.</span><br><span class="line">#</span><br><span class="line"># cluster-slave-validity-factor 10</span><br><span class="line"> </span><br><span class="line"># Cluster slaves are able to migrate to orphaned masters, that are masters</span><br><span class="line"># that are left without working slaves. This improves the cluster ability</span><br><span class="line"># to resist to failures as otherwise an orphaned master can&#x27;t be failed over</span><br><span class="line"># in case of failure if it has no working slaves.</span><br><span class="line">#</span><br><span class="line"># Slaves migrate to orphaned masters only if there are still at least a</span><br><span class="line"># given number of other working slaves for their old master. This number</span><br><span class="line"># is the &quot;migration barrier&quot;. A migration barrier of 1 means that a slave</span><br><span class="line"># will migrate only if there is at least 1 other working slave for its master</span><br><span class="line"># and so forth. It usually reflects the number of slaves you want for every</span><br><span class="line"># master in your cluster.</span><br><span class="line">#</span><br><span class="line"># Default is 1 (slaves migrate only if their masters remain with at least</span><br><span class="line"># one slave). To disable migration just set it to a very large value.</span><br><span class="line"># A value of 0 can be set but is useful only for debugging and dangerous</span><br><span class="line"># in production.</span><br><span class="line">#</span><br><span class="line"># cluster-migration-barrier 1</span><br><span class="line"> </span><br><span class="line"># By default Redis Cluster nodes stop accepting queries if they detect there</span><br><span class="line"># is at least an hash slot uncovered (no available node is serving it).</span><br><span class="line"># This way if the cluster is partially down (for example a range of hash slots</span><br><span class="line"># are no longer covered) all the cluster becomes, eventually, unavailable.</span><br><span class="line"># It automatically returns available as soon as all the slots are covered again.</span><br><span class="line">#</span><br><span class="line"># However sometimes you want the subset of the cluster which is working,</span><br><span class="line"># to continue to accept queries for the part of the key space that is still</span><br><span class="line"># covered. In order to do so, just set the cluster-require-full-coverage</span><br><span class="line"># option to no.</span><br><span class="line">#</span><br><span class="line"># cluster-require-full-coverage yes</span><br><span class="line"> </span><br><span class="line"># In order to setup your cluster make sure to read the documentation</span><br><span class="line"># available at http://redis.io web site.</span><br><span class="line"> </span><br><span class="line">########################## CLUSTER DOCKER/NAT support  ########################</span><br><span class="line"> </span><br><span class="line"># In certain deployments, Redis Cluster nodes address discovery fails, because</span><br><span class="line"># addresses are NAT-ted or because ports are forwarded (the typical case is</span><br><span class="line"># Docker and other containers).</span><br><span class="line">#</span><br><span class="line"># In order to make Redis Cluster working in such environments, a static</span><br><span class="line"># configuration where each node knows its public address is needed. The</span><br><span class="line"># following two options are used for this scope, and are:</span><br><span class="line">#</span><br><span class="line"># * cluster-announce-ip</span><br><span class="line"># * cluster-announce-port</span><br><span class="line"># * cluster-announce-bus-port</span><br><span class="line">#</span><br><span class="line"># Each instruct the node about its address, client port, and cluster message</span><br><span class="line"># bus port. The information is then published in the header of the bus packets</span><br><span class="line"># so that other nodes will be able to correctly map the address of the node</span><br><span class="line"># publishing the information.</span><br><span class="line">#</span><br><span class="line"># If the above options are not used, the normal Redis Cluster auto-detection</span><br><span class="line"># will be used instead.</span><br><span class="line">#</span><br><span class="line"># Note that when remapped, the bus port may not be at the fixed offset of</span><br><span class="line"># clients port + 10000, so you can specify any port and bus-port depending</span><br><span class="line"># on how they get remapped. If the bus-port is not set, a fixed offset of</span><br><span class="line"># 10000 will be used as usually.</span><br><span class="line">#</span><br><span class="line"># Example:</span><br><span class="line">#</span><br><span class="line"># cluster-announce-ip 10.1.1.5</span><br><span class="line"># cluster-announce-port 6379</span><br><span class="line"># cluster-announce-bus-port 6380</span><br><span class="line"> </span><br><span class="line">################################## SLOW LOG ###################################</span><br><span class="line"> </span><br><span class="line"># The Redis Slow Log is a system to log queries that exceeded a specified</span><br><span class="line"># execution time. The execution time does not include the I/O operations</span><br><span class="line"># like talking with the client, sending the reply and so forth,</span><br><span class="line"># but just the time needed to actually execute the command (this is the only</span><br><span class="line"># stage of command execution where the thread is blocked and can not serve</span><br><span class="line"># other requests in the meantime).</span><br><span class="line">#</span><br><span class="line"># You can configure the slow log with two parameters: one tells Redis</span><br><span class="line"># what is the execution time, in microseconds, to exceed in order for the</span><br><span class="line"># command to get logged, and the other parameter is the length of the</span><br><span class="line"># slow log. When a new command is logged the oldest one is removed from the</span><br><span class="line"># queue of logged commands.</span><br><span class="line"> </span><br><span class="line"># The following time is expressed in microseconds, so 1000000 is equivalent</span><br><span class="line"># to one second. Note that a negative number disables the slow log, while</span><br><span class="line"># a value of zero forces the logging of every command.</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"> </span><br><span class="line"># There is no limit to this length. Just be aware that it will consume memory.</span><br><span class="line"># You can reclaim memory used by the slow log with SLOWLOG RESET.</span><br><span class="line">slowlog-max-len 128</span><br><span class="line"> </span><br><span class="line">################################ LATENCY MONITOR ##############################</span><br><span class="line"> </span><br><span class="line"># The Redis latency monitoring subsystem samples different operations</span><br><span class="line"># at runtime in order to collect data related to possible sources of</span><br><span class="line"># latency of a Redis instance.</span><br><span class="line">#</span><br><span class="line"># Via the LATENCY command this information is available to the user that can</span><br><span class="line"># print graphs and obtain reports.</span><br><span class="line">#</span><br><span class="line"># The system only logs operations that were performed in a time equal or</span><br><span class="line"># greater than the amount of milliseconds specified via the</span><br><span class="line"># latency-monitor-threshold configuration directive. When its value is set</span><br><span class="line"># to zero, the latency monitor is turned off.</span><br><span class="line">#</span><br><span class="line"># By default latency monitoring is disabled since it is mostly not needed</span><br><span class="line"># if you don&#x27;t have latency issues, and collecting data has a performance</span><br><span class="line"># impact, that while very small, can be measured under big load. Latency</span><br><span class="line"># monitoring can easily be enabled at runtime using the command</span><br><span class="line"># &quot;CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;&quot; if needed.</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line"> </span><br><span class="line">############################# EVENT NOTIFICATION ##############################</span><br><span class="line"> </span><br><span class="line"># Redis can notify Pub/Sub clients about events happening in the key space.</span><br><span class="line"># This feature is documented at http://redis.io/topics/notifications</span><br><span class="line">#</span><br><span class="line"># For instance if keyspace events notification is enabled, and a client</span><br><span class="line"># performs a DEL operation on key &quot;foo&quot; stored in the Database 0, two</span><br><span class="line"># messages will be published via Pub/Sub:</span><br><span class="line">#</span><br><span class="line"># PUBLISH __keyspace@0__:foo del</span><br><span class="line"># PUBLISH __keyevent@0__:del foo</span><br><span class="line">#</span><br><span class="line"># It is possible to select the events that Redis will notify among a set</span><br><span class="line"># of classes. Every class is identified by a single character:</span><br><span class="line">#</span><br><span class="line">#  K     Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span><br><span class="line">#  E     Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span><br><span class="line">#  g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span><br><span class="line">#  $     String commands</span><br><span class="line">#  l     List commands</span><br><span class="line">#  s     Set commands</span><br><span class="line">#  h     Hash commands</span><br><span class="line">#  z     Sorted set commands</span><br><span class="line">#  x     Expired events (events generated every time a key expires)</span><br><span class="line">#  e     Evicted events (events generated when a key is evicted for maxmemory)</span><br><span class="line">#  A     Alias for g$lshzxe, so that the &quot;AKE&quot; string means all the events.</span><br><span class="line">#</span><br><span class="line">#  The &quot;notify-keyspace-events&quot; takes as argument a string that is composed</span><br><span class="line">#  of zero or multiple characters. The empty string means that notifications</span><br><span class="line">#  are disabled.</span><br><span class="line">#</span><br><span class="line">#  Example: to enable list and generic events, from the point of view of the</span><br><span class="line">#           event name, use:</span><br><span class="line">#</span><br><span class="line">#  notify-keyspace-events Elg</span><br><span class="line">#</span><br><span class="line">#  Example 2: to get the stream of the expired keys subscribing to channel</span><br><span class="line">#             name __keyevent@0__:expired use:</span><br><span class="line">#</span><br><span class="line">#  notify-keyspace-events Ex</span><br><span class="line">#</span><br><span class="line">#  By default all notifications are disabled because most users don&#x27;t need</span><br><span class="line">#  this feature and the feature has some overhead. Note that if you don&#x27;t</span><br><span class="line">#  specify at least one of K or E, no events will be delivered.</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line"> </span><br><span class="line">############################### ADVANCED CONFIG ###############################</span><br><span class="line"> </span><br><span class="line"># Hashes are encoded using a memory efficient data structure when they have a</span><br><span class="line"># small number of entries, and the biggest entry does not exceed a given</span><br><span class="line"># threshold. These thresholds can be configured using the following directives.</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"> </span><br><span class="line"># Lists are also encoded in a special way to save a lot of space.</span><br><span class="line"># The number of entries allowed per internal list node can be specified</span><br><span class="line"># as a fixed maximum size or a maximum number of elements.</span><br><span class="line"># For a fixed maximum size, use -5 through -1, meaning:</span><br><span class="line"># -5: max size: 64 Kb  &lt;-- not recommended for normal workloads</span><br><span class="line"># -4: max size: 32 Kb  &lt;-- not recommended</span><br><span class="line"># -3: max size: 16 Kb  &lt;-- probably not recommended</span><br><span class="line"># -2: max size: 8 Kb   &lt;-- good</span><br><span class="line"># -1: max size: 4 Kb   &lt;-- good</span><br><span class="line"># Positive numbers mean store up to _exactly_ that number of elements</span><br><span class="line"># per list node.</span><br><span class="line"># The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),</span><br><span class="line"># but if your use case is unique, adjust the settings as necessary.</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line"> </span><br><span class="line"># Lists may also be compressed.</span><br><span class="line"># Compress depth is the number of quicklist ziplist nodes from *each* side of</span><br><span class="line"># the list to *exclude* from compression.  The head and tail of the list</span><br><span class="line"># are always uncompressed for fast push/pop operations.  Settings are:</span><br><span class="line"># 0: disable all list compression</span><br><span class="line"># 1: depth 1 means &quot;don&#x27;t start compressing until after 1 node into the list,</span><br><span class="line">#    going from either the head or tail&quot;</span><br><span class="line">#    So: [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]</span><br><span class="line">#    [head], [tail] will always be uncompressed; inner nodes will compress.</span><br><span class="line"># 2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]</span><br><span class="line">#    2 here means: don&#x27;t compress head or head-&gt;next or tail-&gt;prev or tail,</span><br><span class="line">#    but compress all nodes between them.</span><br><span class="line"># 3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span><br><span class="line"># etc.</span><br><span class="line">list-compress-depth 0</span><br><span class="line"> </span><br><span class="line"># Sets have a special encoding in just one case: when a set is composed</span><br><span class="line"># of just strings that happen to be integers in radix 10 in the range</span><br><span class="line"># of 64 bit signed integers.</span><br><span class="line"># The following configuration setting sets the limit in the size of the</span><br><span class="line"># set in order to use this special memory saving encoding.</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"> </span><br><span class="line"># Similarly to hashes and lists, sorted sets are also specially encoded in</span><br><span class="line"># order to save a lot of space. This encoding is only used when the length and</span><br><span class="line"># elements of a sorted set are below the following limits:</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"> </span><br><span class="line"># HyperLogLog sparse representation bytes limit. The limit includes the</span><br><span class="line"># 16 bytes header. When an HyperLogLog using the sparse representation crosses</span><br><span class="line"># this limit, it is converted into the dense representation.</span><br><span class="line">#</span><br><span class="line"># A value greater than 16000 is totally useless, since at that point the</span><br><span class="line"># dense representation is more memory efficient.</span><br><span class="line">#</span><br><span class="line"># The suggested value is ~ 3000 in order to have the benefits of</span><br><span class="line"># the space efficient encoding without slowing down too much PFADD,</span><br><span class="line"># which is O(N) with the sparse encoding. The value can be raised to</span><br><span class="line"># ~ 10000 when CPU is not a concern, but space is, and the data set is</span><br><span class="line"># composed of many HyperLogLogs with cardinality in the 0 - 15000 range.</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"> </span><br><span class="line"># Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in</span><br><span class="line"># order to help rehashing the main Redis hash table (the one mapping top-level</span><br><span class="line"># keys to values). The hash table implementation Redis uses (see dict.c)</span><br><span class="line"># performs a lazy rehashing: the more operation you run into a hash table</span><br><span class="line"># that is rehashing, the more rehashing &quot;steps&quot; are performed, so if the</span><br><span class="line"># server is idle the rehashing is never complete and some more memory is used</span><br><span class="line"># by the hash table.</span><br><span class="line">#</span><br><span class="line"># The default is to use this millisecond 10 times every second in order to</span><br><span class="line"># actively rehash the main dictionaries, freeing memory when possible.</span><br><span class="line">#</span><br><span class="line"># If unsure:</span><br><span class="line"># use &quot;activerehashing no&quot; if you have hard latency requirements and it is</span><br><span class="line"># not a good thing in your environment that Redis can reply from time to time</span><br><span class="line"># to queries with 2 milliseconds delay.</span><br><span class="line">#</span><br><span class="line"># use &quot;activerehashing yes&quot; if you don&#x27;t have such hard requirements but</span><br><span class="line"># want to free memory asap when possible.</span><br><span class="line">activerehashing yes</span><br><span class="line"> </span><br><span class="line"># The client output buffer limits can be used to force disconnection of clients</span><br><span class="line"># that are not reading data from the server fast enough for some reason (a</span><br><span class="line"># common reason is that a Pub/Sub client can&#x27;t consume messages as fast as the</span><br><span class="line"># publisher can produce them).</span><br><span class="line">#</span><br><span class="line"># The limit can be set differently for the three different classes of clients:</span><br><span class="line">#</span><br><span class="line"># normal -&gt; normal clients including MONITOR clients</span><br><span class="line"># slave  -&gt; slave clients</span><br><span class="line"># pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</span><br><span class="line">#</span><br><span class="line"># The syntax of every client-output-buffer-limit directive is the following:</span><br><span class="line">#</span><br><span class="line"># client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span><br><span class="line">#</span><br><span class="line"># A client is immediately disconnected once the hard limit is reached, or if</span><br><span class="line"># the soft limit is reached and remains reached for the specified number of</span><br><span class="line"># seconds (continuously).</span><br><span class="line"># So for instance if the hard limit is 32 megabytes and the soft limit is</span><br><span class="line"># 16 megabytes / 10 seconds, the client will get disconnected immediately</span><br><span class="line"># if the size of the output buffers reach 32 megabytes, but will also get</span><br><span class="line"># disconnected if the client reaches 16 megabytes and continuously overcomes</span><br><span class="line"># the limit for 10 seconds.</span><br><span class="line">#</span><br><span class="line"># By default normal clients are not limited because they don&#x27;t receive data</span><br><span class="line"># without asking (in a push way), but just after a request, so only</span><br><span class="line"># asynchronous clients may create a scenario where data is requested faster</span><br><span class="line"># than it can read.</span><br><span class="line">#</span><br><span class="line"># Instead there is a default limit for pubsub and slave clients, since</span><br><span class="line"># subscribers and slaves receive data in a push fashion.</span><br><span class="line">#</span><br><span class="line"># Both the hard or the soft limit can be disabled by setting them to zero.</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"> </span><br><span class="line"># Client query buffers accumulate new commands. They are limited to a fixed</span><br><span class="line"># amount by default in order to avoid that a protocol desynchronization (for</span><br><span class="line"># instance due to a bug in the client) will lead to unbound memory usage in</span><br><span class="line"># the query buffer. However you can configure it here if you have very special</span><br><span class="line"># needs, such us huge multi/exec requests or alike.</span><br><span class="line">#</span><br><span class="line"># client-query-buffer-limit 1gb</span><br><span class="line"> </span><br><span class="line"># In the Redis protocol, bulk requests, that are, elements representing single</span><br><span class="line"># strings, are normally limited ot 512 mb. However you can change this limit</span><br><span class="line"># here.</span><br><span class="line">#</span><br><span class="line"># proto-max-bulk-len 512mb</span><br><span class="line"> </span><br><span class="line"># Redis calls an internal function to perform many background tasks, like</span><br><span class="line"># closing connections of clients in timeout, purging expired keys that are</span><br><span class="line"># never requested, and so forth.</span><br><span class="line">#</span><br><span class="line"># Not all tasks are performed with the same frequency, but Redis checks for</span><br><span class="line"># tasks to perform according to the specified &quot;hz&quot; value.</span><br><span class="line">#</span><br><span class="line"># By default &quot;hz&quot; is set to 10. Raising the value will use more CPU when</span><br><span class="line"># Redis is idle, but at the same time will make Redis more responsive when</span><br><span class="line"># there are many keys expiring at the same time, and timeouts may be</span><br><span class="line"># handled with more precision.</span><br><span class="line">#</span><br><span class="line"># The range is between 1 and 500, however a value over 100 is usually not</span><br><span class="line"># a good idea. Most users should use the default of 10 and raise this up to</span><br><span class="line"># 100 only in environments where very low latency is required.</span><br><span class="line">hz 10</span><br><span class="line"> </span><br><span class="line"># When a child rewrites the AOF file, if the following option is enabled</span><br><span class="line"># the file will be fsync-ed every 32 MB of data generated. This is useful</span><br><span class="line"># in order to commit the file to the disk more incrementally and avoid</span><br><span class="line"># big latency spikes.</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"> </span><br><span class="line"># Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good</span><br><span class="line"># idea to start with the default settings and only change them after investigating</span><br><span class="line"># how to improve the performances and how the keys LFU change over time, which</span><br><span class="line"># is possible to inspect via the OBJECT FREQ command.</span><br><span class="line">#</span><br><span class="line"># There are two tunable parameters in the Redis LFU implementation: the</span><br><span class="line"># counter logarithm factor and the counter decay time. It is important to</span><br><span class="line"># understand what the two parameters mean before changing them.</span><br><span class="line">#</span><br><span class="line"># The LFU counter is just 8 bits per key, it&#x27;s maximum value is 255, so Redis</span><br><span class="line"># uses a probabilistic increment with logarithmic behavior. Given the value</span><br><span class="line"># of the old counter, when a key is accessed, the counter is incremented in</span><br><span class="line"># this way:</span><br><span class="line">#</span><br><span class="line"># 1. A random number R between 0 and 1 is extracted.</span><br><span class="line"># 2. A probability P is calculated as 1/(old_value*lfu_log_factor+1).</span><br><span class="line"># 3. The counter is incremented only if R &lt; P.</span><br><span class="line">#</span><br><span class="line"># The default lfu-log-factor is 10. This is a table of how the frequency</span><br><span class="line"># counter changes with a different number of accesses with different</span><br><span class="line"># logarithmic factors:</span><br><span class="line">#</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | 0      | 104        | 255        | 255        | 255        | 255        |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | 1      | 18         | 49         | 255        | 255        | 255        |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | 10     | 10         | 18         | 142        | 255        | 255        |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | 100    | 8          | 11         | 49         | 143        | 255        |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line">#</span><br><span class="line"># NOTE: The above table was obtained by running the following commands:</span><br><span class="line">#</span><br><span class="line">#   redis-benchmark -n 1000000 incr foo</span><br><span class="line">#   redis-cli object freq foo</span><br><span class="line">#</span><br><span class="line"># NOTE 2: The counter initial value is 5 in order to give new objects a chance</span><br><span class="line"># to accumulate hits.</span><br><span class="line">#</span><br><span class="line"># The counter decay time is the time, in minutes, that must elapse in order</span><br><span class="line"># for the key counter to be divided by two (or decremented if it has a value</span><br><span class="line"># less &lt;= 10).</span><br><span class="line">#</span><br><span class="line"># The default value for the lfu-decay-time is 1. A Special value of 0 means to</span><br><span class="line"># decay the counter every time it happens to be scanned.</span><br><span class="line">#</span><br><span class="line"># lfu-log-factor 10</span><br><span class="line"># lfu-decay-time 1</span><br><span class="line"> </span><br><span class="line">########################### ACTIVE DEFRAGMENTATION #######################</span><br><span class="line">#</span><br><span class="line"># WARNING THIS FEATURE IS EXPERIMENTAL. However it was stress tested</span><br><span class="line"># even in production and manually tested by multiple engineers for some</span><br><span class="line"># time.</span><br><span class="line">#</span><br><span class="line"># What is active defragmentation?</span><br><span class="line"># -------------------------------</span><br><span class="line">#</span><br><span class="line"># Active (online) defragmentation allows a Redis server to compact the</span><br><span class="line"># spaces left between small allocations and deallocations of data in memory,</span><br><span class="line"># thus allowing to reclaim back memory.</span><br><span class="line">#</span><br><span class="line"># Fragmentation is a natural process that happens with every allocator (but</span><br><span class="line"># less so with Jemalloc, fortunately) and certain workloads. Normally a server</span><br><span class="line"># restart is needed in order to lower the fragmentation, or at least to flush</span><br><span class="line"># away all the data and create it again. However thanks to this feature</span><br><span class="line"># implemented by Oran Agra for Redis 4.0 this process can happen at runtime</span><br><span class="line"># in an &quot;hot&quot; way, while the server is running.</span><br><span class="line">#</span><br><span class="line"># Basically when the fragmentation is over a certain level (see the</span><br><span class="line"># configuration options below) Redis will start to create new copies of the</span><br><span class="line"># values in contiguous memory regions by exploiting certain specific Jemalloc</span><br><span class="line"># features (in order to understand if an allocation is causing fragmentation</span><br><span class="line"># and to allocate it in a better place), and at the same time, will release the</span><br><span class="line"># old copies of the data. This process, repeated incrementally for all the keys</span><br><span class="line"># will cause the fragmentation to drop back to normal values.</span><br><span class="line">#</span><br><span class="line"># Important things to understand:</span><br><span class="line">#</span><br><span class="line"># 1. This feature is disabled by default, and only works if you compiled Redis</span><br><span class="line">#    to use the copy of Jemalloc we ship with the source code of Redis.</span><br><span class="line">#    This is the default with Linux builds.</span><br><span class="line">#</span><br><span class="line"># 2. You never need to enable this feature if you don&#x27;t have fragmentation</span><br><span class="line">#    issues.</span><br><span class="line">#</span><br><span class="line"># 3. Once you experience fragmentation, you can enable this feature when</span><br><span class="line">#    needed with the command &quot;CONFIG SET activedefrag yes&quot;.</span><br><span class="line">#</span><br><span class="line"># The configuration parameters are able to fine tune the behavior of the</span><br><span class="line"># defragmentation process. If you are not sure about what they mean it is</span><br><span class="line"># a good idea to leave the defaults untouched.</span><br><span class="line"> </span><br><span class="line"># Enabled active defragmentation</span><br><span class="line"># activedefrag yes</span><br><span class="line"> </span><br><span class="line"># Minimum amount of fragmentation waste to start active defrag</span><br><span class="line"># active-defrag-ignore-bytes 100mb</span><br><span class="line"> </span><br><span class="line"># Minimum percentage of fragmentation to start active defrag</span><br><span class="line"># active-defrag-threshold-lower 10</span><br><span class="line"> </span><br><span class="line"># Maximum percentage of fragmentation at which we use maximum effort</span><br><span class="line"># active-defrag-threshold-upper 100</span><br><span class="line"> </span><br><span class="line"># Minimal effort for defrag in CPU percentage</span><br><span class="line"># active-defrag-cycle-min 25</span><br><span class="line"> </span><br><span class="line"># Maximal effort for defrag in CPU percentage</span><br><span class="line"># active-defrag-cycle-max 75</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="精简redis-conf"><a href="#精简redis-conf" class="headerlink" title="精简redis.conf"></a>精简redis.conf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">bind *</span><br><span class="line">protected-mode yes</span><br><span class="line">port 6379</span><br><span class="line">tcp-backlog 511</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 300</span><br><span class="line">supervised no</span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile &quot;/data/redis.log&quot;</span><br><span class="line">databases 16</span><br><span class="line">always-show-logo yes</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir ./</span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line">slave-read-only yes</span><br><span class="line">repl-diskless-sync no</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line">slave-priority 100</span><br><span class="line">requirepass 123456</span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">slave-lazy-flush no</span><br><span class="line">appendonly no</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">aof-load-truncated yes</span><br><span class="line">aof-use-rdb-preamble no</span><br><span class="line">lua-time-limit 5000</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line">slowlog-max-len 128</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line">list-compress-depth 0</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line">activerehashing yes</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line">hz 10</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br></pre></td></tr></table></figure><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name redis --restart=always -p 6379:6379 -v ~/redis/log/redis.log:/data/redis.log -v /etc/localtime:/etc/localtime:ro -v ~/redis/conf/redis.conf:/etc/redis/redis.conf -v ~/redis/data:/data -d redis:latest redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure><h2 id="快速运行"><a href="#快速运行" class="headerlink" title="快速运行"></a>快速运行</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -vp /data/redis/&#123;data,conf,<span class="built_in">log</span>&#125;</span><br><span class="line"><span class="built_in">touch</span> /data/redis/conf/redis.conf</span><br><span class="line"><span class="built_in">touch</span> /data/redis/log/redis.log</span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /data/redis/conf/data.conf</span></span><br><span class="line"><span class="string">bind *</span></span><br><span class="line"><span class="string">protected-mode yes</span></span><br><span class="line"><span class="string">port 6379</span></span><br><span class="line"><span class="string">tcp-backlog 511</span></span><br><span class="line"><span class="string">timeout 0</span></span><br><span class="line"><span class="string">tcp-keepalive 300</span></span><br><span class="line"><span class="string">supervised no</span></span><br><span class="line"><span class="string">pidfile /var/run/redis_6379.pid</span></span><br><span class="line"><span class="string">loglevel notice</span></span><br><span class="line"><span class="string">logfile &quot;/data/redis.log&quot;</span></span><br><span class="line"><span class="string">databases 16</span></span><br><span class="line"><span class="string">always-show-logo yes</span></span><br><span class="line"><span class="string">save 900 1</span></span><br><span class="line"><span class="string">save 300 10</span></span><br><span class="line"><span class="string">save 60 10000</span></span><br><span class="line"><span class="string">stop-writes-on-bgsave-error yes</span></span><br><span class="line"><span class="string">rdbcompression yes</span></span><br><span class="line"><span class="string">rdbchecksum yes</span></span><br><span class="line"><span class="string">dbfilename dump.rdb</span></span><br><span class="line"><span class="string">dir ./</span></span><br><span class="line"><span class="string">slave-serve-stale-data yes</span></span><br><span class="line"><span class="string">slave-read-only yes</span></span><br><span class="line"><span class="string">repl-diskless-sync no</span></span><br><span class="line"><span class="string">repl-diskless-sync-delay 5</span></span><br><span class="line"><span class="string">repl-disable-tcp-nodelay no</span></span><br><span class="line"><span class="string">slave-priority 100</span></span><br><span class="line"><span class="string">requirepass 123456</span></span><br><span class="line"><span class="string">lazyfree-lazy-eviction no</span></span><br><span class="line"><span class="string">lazyfree-lazy-expire no</span></span><br><span class="line"><span class="string">lazyfree-lazy-server-del no</span></span><br><span class="line"><span class="string">slave-lazy-flush no</span></span><br><span class="line"><span class="string">appendonly no</span></span><br><span class="line"><span class="string">appendfilename &quot;appendonly.aof&quot;</span></span><br><span class="line"><span class="string">appendfsync everysec</span></span><br><span class="line"><span class="string">no-appendfsync-on-rewrite no</span></span><br><span class="line"><span class="string">auto-aof-rewrite-percentage 100</span></span><br><span class="line"><span class="string">auto-aof-rewrite-min-size 64mb</span></span><br><span class="line"><span class="string">aof-load-truncated yes</span></span><br><span class="line"><span class="string">aof-use-rdb-preamble no</span></span><br><span class="line"><span class="string">lua-time-limit 5000</span></span><br><span class="line"><span class="string">slowlog-log-slower-than 10000</span></span><br><span class="line"><span class="string">slowlog-max-len 128</span></span><br><span class="line"><span class="string">latency-monitor-threshold 0</span></span><br><span class="line"><span class="string">notify-keyspace-events &quot;&quot;</span></span><br><span class="line"><span class="string">hash-max-ziplist-entries 512</span></span><br><span class="line"><span class="string">hash-max-ziplist-value 64</span></span><br><span class="line"><span class="string">list-max-ziplist-size -2</span></span><br><span class="line"><span class="string">list-compress-depth 0</span></span><br><span class="line"><span class="string">set-max-intset-entries 512</span></span><br><span class="line"><span class="string">zset-max-ziplist-entries 128</span></span><br><span class="line"><span class="string">zset-max-ziplist-value 64</span></span><br><span class="line"><span class="string">hll-sparse-max-bytes 3000</span></span><br><span class="line"><span class="string">activerehashing yes</span></span><br><span class="line"><span class="string">client-output-buffer-limit normal 0 0 0</span></span><br><span class="line"><span class="string">client-output-buffer-limit slave 256mb 64mb 60</span></span><br><span class="line"><span class="string">client-output-buffer-limit pubsub 32mb 8mb 60</span></span><br><span class="line"><span class="string">hz 10</span></span><br><span class="line"><span class="string">aof-rewrite-incremental-fsync yes</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># 运行</span></span><br><span class="line">docker run --name redis --restart=always -p 6379:6379 -v ~/redis/log/redis.log:/data/redis.log -v /etc/localtime:/etc/localtime:ro -v ~/redis/conf/redis.conf:/etc/redis/redis.conf -v ~/redis/data:/data -d redis:latest redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;拉取镜像&quot;&gt;&lt;a href=&quot;#拉取镜像&quot; class=&quot;headerlink&quot; title=&quot;拉取镜像&quot;&gt;&lt;/a&gt;拉取镜像&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker pull redis&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;创建配置文件&quot;&gt;&lt;a href=&quot;#创建配置文件&quot; class=&quot;headerlink&quot; title=&quot;创建配置文件&quot;&gt;&lt;/a&gt;创建配置文件&lt;/h2&gt;</summary>
    
    
    
    <category term="docker" scheme="https://blog.48626.xyz/categories/docker/"/>
    
    <category term="redis" scheme="https://blog.48626.xyz/categories/docker/redis/"/>
    
    
    <category term="docker" scheme="https://blog.48626.xyz/tags/docker/"/>
    
    <category term="redis" scheme="https://blog.48626.xyz/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>WSL安装Docker</title>
    <link href="https://blog.48626.xyz/9f091cd0a120.html"/>
    <id>https://blog.48626.xyz/9f091cd0a120.html</id>
    <published>2024-06-25T03:16:15.000Z</published>
    <updated>2024-06-25T03:16:15.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="配置初始环境"><a href="#配置初始环境" class="headerlink" title="配置初始环境"></a>配置初始环境</h2><p>使用WSL2、Ubuntu20.04.6，其他环境不保证正确</p><p>在用户文件夹下创建<code>.wslconfig</code>输入内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[boot]</span><br><span class="line">systemd=<span class="literal">true</span> <span class="comment"># 启用此设置将在 WSL 实例中启用 systemd 初始化。Systemd 是大多数现代 Linux 发行版的标准 init 系统，允许更好地管理服务和依赖关系。</span></span><br><span class="line"></span><br><span class="line">[experimental]</span><br><span class="line">autoMemoryReclaim=gradual  <span class="comment"># 此选项指定在 WSL 中如何处理内存回收。gradual 表示采用渐进式内存回收，这可能更为保守和平衡。</span></span><br><span class="line">networkingMode=mirrored <span class="comment"># 此设置控制 WSL 中的网络处理方式。mirrored 模式通常会镜像主机操作系统（Windows）的网络配置，使得 WSL 可以共享相同的网络设置。</span></span><br><span class="line">dnsTunneling=<span class="literal">true</span> <span class="comment"># 启用 DNS 隧道功能允许 WSL 使用主机的 DNS 配置，简化 DNS 解析，无需在 WSL 中额外配置。</span></span><br><span class="line">firewall=<span class="literal">true</span> <span class="comment"># 此选项可能启用与 Windows 防火墙的集成，允许 WSL 遵循在主机 Windows 系统上设置的防火墙规则。</span></span><br><span class="line">autoProxy=<span class="literal">true</span> <span class="comment"># 启用 autoProxy 可能允许 WSL 自动使用在 Windows 主机上配置的系统代理设置。</span></span><br></pre></td></tr></table></figure><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><p>因为docker官网提供的脚本在疯狂的安利：Docker Desktop for Windows，所以需要把这段代码给屏蔽掉</p><p>官方脚本：<a href="https://get.docker.com/">https://get.docker.com</a></p><p>需要正常访问并把脚本拷贝一份，然后搜索<code>is_wsl</code>注释掉下面的代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#if is_wsl; then</span></span><br><span class="line"><span class="comment">#echo</span></span><br><span class="line"><span class="comment">#echo &quot;WSL DETECTED: We recommend using Docker Desktop for Windows.&quot;</span></span><br><span class="line"><span class="comment">#echo &quot;Please get Docker Desktop from https://www.docker.com/products/docker-desktop/&quot;</span></span><br><span class="line"><span class="comment">#echo</span></span><br><span class="line"><span class="comment">#cat &gt;&amp;2 &lt;&lt;-&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#You may press Ctrl+C now to abort this script.</span></span><br><span class="line"><span class="comment">#EOF</span></span><br><span class="line"><span class="comment">#( set -x; sleep 20 )</span></span><br><span class="line"><span class="comment">#fi</span></span><br></pre></td></tr></table></figure><p>然后使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim get-docker.sh</span><br><span class="line"><span class="comment"># 粘贴</span></span><br><span class="line"><span class="built_in">chmod</span> +x get-docker.sh</span><br><span class="line">sudo ./get-docker.sh</span><br><span class="line"><span class="comment"># 等待安装，因为国内已经无法下载镜像了，所以需要自己解决代理问题</span></span><br></pre></td></tr></table></figure><h2 id="给普通用户docker权限"><a href="#给普通用户docker权限" class="headerlink" title="给普通用户docker权限"></a>给普通用户docker权限</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个名为 docker 的用户组。</span></span><br><span class="line">sudo groupadd docker</span><br><span class="line"><span class="comment"># 将当前用户（$USER）添加到 docker 用户组中，使得该用户能够运行 Docker 命令而无需使用 sudo。</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"><span class="comment"># 启动一个新的 shell，将其当前用户组切换为 docker，这样该 shell 中的命令执行时将具有 docker 组的权限。 </span></span><br><span class="line">newgrp docker</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;配置初始环境&quot;&gt;&lt;a href=&quot;#配置初始环境&quot; class=&quot;headerlink&quot; title=&quot;配置初始环境&quot;&gt;&lt;/a&gt;配置初始环境&lt;/h2&gt;&lt;p&gt;使用WSL2、Ubuntu20.04.6，其他环境不保证正确&lt;/p&gt;
&lt;p&gt;在用户文件夹下创建&lt;code&gt;.wslconfig&lt;/code&gt;输入内容&lt;/p&gt;</summary>
    
    
    
    <category term="docker" scheme="https://blog.48626.xyz/categories/docker/"/>
    
    <category term="WSL" scheme="https://blog.48626.xyz/categories/docker/WSL/"/>
    
    
    <category term="docker" scheme="https://blog.48626.xyz/tags/docker/"/>
    
    <category term="WSL" scheme="https://blog.48626.xyz/tags/WSL/"/>
    
  </entry>
  
  <entry>
    <title>代理Google站点</title>
    <link href="https://blog.48626.xyz/2267fa75b67a.html"/>
    <id>https://blog.48626.xyz/2267fa75b67a.html</id>
    <published>2024-06-24T14:49:37.000Z</published>
    <updated>2024-06-24T14:49:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="创建-Worker"><a href="#创建-Worker" class="headerlink" title="创建 Worker"></a>创建 Worker</h2><p>首先，登录 Cloudflare，切换至Workers &amp; Pages菜单，点击Create Application按钮：</p><img src="/2267fa75b67a/image.png" class="" alt="alt text"><p>然后，点击Create Worker按钮新建一个 Worker：</p><img src="/2267fa75b67a/image-1.png" class="" alt="alt text"><p>接着，设置一个三级域名 g.harrisonwang.workers.dev，点击Deploy按钮：</p><img src="/2267fa75b67a/image-2.png" class="" alt="alt text"><p>再接着，我们点击Edit code按钮编辑代码：</p><img src="/2267fa75b67a/image-3.png" class="" alt="alt text"><p>最后，粘贴以下代码片段后，点击Save and Deploy完成部署，然后通过域名 g.harrisonwang.workers.dev 访问镜像站：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反代目标网站</span></span><br><span class="line"><span class="keyword">const</span> upstream = <span class="string">&#x27;ipv6.google.com.hk&#x27;</span></span><br><span class="line"><span class="keyword">const</span> upstream_v4 = <span class="string">&#x27;www.google.com.hk&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问区域黑名单（按需设置）.</span></span><br><span class="line"><span class="keyword">const</span> blocked_region = [<span class="string">&#x27;TK&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">//资源重定向</span></span><br><span class="line"><span class="keyword">const</span> replace_dict = &#123;</span><br><span class="line">  <span class="attr">$upstream</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;www.google.com/&#x27;</span>: <span class="string">&#x27;g.wss.so/&#x27;</span>, <span class="comment">//填入你的子域名</span></span><br><span class="line">  <span class="string">&#x27;gstatic.com&#x27;</span>: <span class="string">&#x27;gstatic.cn&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;ajax.googleapis.com&#x27;</span>: <span class="string">&#x27;ajax.lug.ustc.edu.cn&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;fonts.googleapis.com&#x27;</span>: <span class="string">&#x27;fonts.googleapis.cn&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;themes.googleusercontent.com&#x27;</span>: <span class="string">&#x27;google-themes.lug.ustc.edu.cn&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;www.gravatar.com/avatar&#x27;</span>: <span class="string">&#x27;dn-qiniu-avatar.qbox.me/avatar&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;www.google.co.jp&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;www.google.com.sg&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;books.google.com.hk&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;books.google.co.jp&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;books.google.com.sg&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;maps.google.com.hk&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;maps.google.co.jp&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;maps.google.com.sg&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;maps.google.com&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;books.google.com&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">addEventListener</span>(<span class="string">&#x27;fetch&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">respondWith</span>(<span class="title function_">fetchAndApply</span>(event.<span class="property">request</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchAndApply</span>(<span class="params">request</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> region = request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&#x27;cf-ipcountry&#x27;</span>).<span class="title function_">toUpperCase</span>()</span><br><span class="line"><span class="comment">//   const ip_address = request.headers.get(&#x27;cf-connecting-ip&#x27;)</span></span><br><span class="line"><span class="comment">//   const user_agent = request.headers.get(&#x27;user-agent&#x27;)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> response = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">let</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>)</span><br><span class="line">  <span class="keyword">let</span> url_host = url.<span class="property">host</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (url.<span class="property">protocol</span> == <span class="string">&#x27;http:&#x27;</span>) &#123;</span><br><span class="line">    url.<span class="property">protocol</span> = <span class="string">&#x27;https:&#x27;</span></span><br><span class="line">    response = <span class="title class_">Response</span>.<span class="title function_">redirect</span>(url.<span class="property">href</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//检查是否为图片搜索</span></span><br><span class="line">  <span class="keyword">var</span> key = url.<span class="property">href</span></span><br><span class="line">  <span class="keyword">var</span> ikey1 = <span class="string">&#x27;tbm=isch&#x27;</span></span><br><span class="line">  <span class="keyword">var</span> ikey2 = <span class="string">&#x27;/img&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> ((key.<span class="title function_">search</span>(ikey1) == -<span class="number">1</span>) &amp;&amp; (key.<span class="title function_">search</span>(ikey2) == -<span class="number">1</span>)) &#123;</span><br><span class="line">    <span class="keyword">var</span> upstream_domain = upstream</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> upstream_domain = upstream_v4</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  url.<span class="property">host</span> = upstream_domain</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (blocked_region.<span class="title function_">includes</span>(region)) &#123;</span><br><span class="line">    response = <span class="keyword">new</span> <span class="title class_">Response</span>(</span><br><span class="line">      <span class="string">&#x27;Access denied: WorkersProxy is not available in your region yet.&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">status</span>: <span class="number">403</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> method = request.<span class="property">method</span></span><br><span class="line">    <span class="keyword">let</span> request_headers = request.<span class="property">headers</span></span><br><span class="line">    <span class="keyword">let</span> new_request_headers = <span class="keyword">new</span> <span class="title class_">Headers</span>(request_headers)</span><br><span class="line"></span><br><span class="line">    new_request_headers.<span class="title function_">set</span>(<span class="string">&#x27;Host&#x27;</span>, upstream_domain)</span><br><span class="line">    new_request_headers.<span class="title function_">set</span>(<span class="string">&#x27;Referer&#x27;</span>, url.<span class="property">href</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> original_response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url.<span class="property">href</span>, &#123;</span><br><span class="line">      <span class="attr">method</span>: method,</span><br><span class="line">      <span class="attr">headers</span>: new_request_headers,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> original_response_clone = original_response.<span class="title function_">clone</span>()</span><br><span class="line">    <span class="keyword">let</span> original_text = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> response_headers = original_response.<span class="property">headers</span></span><br><span class="line">    <span class="keyword">let</span> new_response_headers = <span class="keyword">new</span> <span class="title class_">Headers</span>(response_headers)</span><br><span class="line">    <span class="keyword">let</span> status = original_response.<span class="property">status</span></span><br><span class="line"></span><br><span class="line">    new_response_headers.<span class="title function_">set</span>(<span class="string">&#x27;cache-control&#x27;</span>, <span class="string">&#x27;public, max-age=14400&#x27;</span>)</span><br><span class="line">    new_response_headers.<span class="title function_">set</span>(<span class="string">&#x27;access-control-allow-origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">    new_response_headers.<span class="title function_">set</span>(<span class="string">&#x27;access-control-allow-credentials&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">    new_response_headers.<span class="title function_">delete</span>(<span class="string">&#x27;content-security-policy&#x27;</span>)</span><br><span class="line">    new_response_headers.<span class="title function_">delete</span>(<span class="string">&#x27;content-security-policy-report-only&#x27;</span>)</span><br><span class="line">    new_response_headers.<span class="title function_">delete</span>(<span class="string">&#x27;clear-site-data&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> content_type = new_response_headers.<span class="title function_">get</span>(<span class="string">&#x27;content-type&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (content_type.<span class="title function_">includes</span>(<span class="string">&#x27;text/html&#x27;</span>) &amp;&amp; content_type.<span class="title function_">includes</span>(<span class="string">&#x27;UTF-8&#x27;</span>)) &#123;</span><br><span class="line">      <span class="comment">// &amp;&amp; content_type.includes(&#x27;UTF-8&#x27;)</span></span><br><span class="line">      original_text = <span class="keyword">await</span> <span class="title function_">replace_response_text</span>(</span><br><span class="line">        original_response_clone,</span><br><span class="line">        upstream_domain,</span><br><span class="line">        url_host</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      original_text = original_response_clone.<span class="property">body</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = <span class="keyword">new</span> <span class="title class_">Response</span>(original_text, &#123;</span><br><span class="line">      status,</span><br><span class="line">      <span class="attr">headers</span>: new_response_headers,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> response</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">replace_response_text</span>(<span class="params">response, upstream_domain, host_name</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> text = <span class="keyword">await</span> response.<span class="title function_">text</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> i, j</span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> replace_dict) &#123;</span><br><span class="line">    j = replace_dict[i]</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="string">&#x27;$upstream&#x27;</span>) &#123;</span><br><span class="line">      i = upstream_domain</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="string">&#x27;$custom_domain&#x27;</span>) &#123;</span><br><span class="line">      i = host_name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (j == <span class="string">&#x27;$upstream&#x27;</span>) &#123;</span><br><span class="line">      j = upstream_domain</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="string">&#x27;$custom_domain&#x27;</span>) &#123;</span><br><span class="line">      j = host_name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> re = <span class="keyword">new</span> <span class="title class_">RegExp</span>(i, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    text = text.<span class="title function_">replace</span>(re, j)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> text</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>记得将 ‘<a href="http://www.google.com/">www.google.com/</a>‘: ‘g.wss.so&#x2F;‘, 此处的 g.wss.so 替换为你的子域名。</p></blockquote><p>至此，代理 Google 站点已完成，我们任意搜索输入一个关键字 strapi，搜索结果如下图图所示。但是由于国内 workers.dev 域名的 DNS 已污染导致无法访问，所以需要绑定一个自定义域名来绕过该问题。</p><img src="/2267fa75b67a/image-4.png" class="" alt="alt text"><h2 id="绑定自定义域名"><a href="#绑定自定义域名" class="headerlink" title="绑定自定义域名"></a>绑定自定义域名</h2><p>首先，点击Add Custom Domain添加一个自定义域名：</p><img src="/2267fa75b67a/image-5.png" class="" alt="alt text"><p>然后，输入要绑定自定义域名如 g.wss.so，点击Add Custom Domain绑定：</p><img src="/2267fa75b67a/image-6.png" class="" alt="alt text"><p>最后，等待 DNS 解析生效，然后使用 g.wss.so 域名访问：</p><img src="/2267fa75b67a/image-7.png" class="" alt="alt text">]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;创建-Worker&quot;&gt;&lt;a href=&quot;#创建-Worker&quot; class=&quot;headerlink&quot; title=&quot;创建 Worker&quot;&gt;&lt;/a&gt;创建 Worker&lt;/h2&gt;&lt;p&gt;首先，登录 Cloudflare，切换至Workers &amp;amp; Pages菜单，点击Create Application按钮：&lt;/p&gt;
&lt;img src=&quot;/2267fa75b67a/image.png&quot; class alt=&quot;alt text&quot;&gt;</summary>
    
    
    
    <category term="cloudflare" scheme="https://blog.48626.xyz/categories/cloudflare/"/>
    
    
    <category term="cloudflare" scheme="https://blog.48626.xyz/tags/cloudflare/"/>
    
  </entry>
  
</feed>
