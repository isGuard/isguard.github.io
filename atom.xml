<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>zea</title>
  
  
  <link href="https://blog.48626.xyz/atom.xml" rel="self"/>
  
  <link href="https://blog.48626.xyz/"/>
  <updated>2024-09-19T07:35:32.565Z</updated>
  <id>https://blog.48626.xyz/</id>
  
  <author>
    <name>初。</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="https://blog.48626.xyz/7424a150c4d5.html"/>
    <id>https://blog.48626.xyz/7424a150c4d5.html</id>
    <published>2024-09-19T07:35:32.565Z</published>
    <updated>2024-09-19T07:35:32.565Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Go学习笔记"><a href="#Go学习笔记" class="headerlink" title="Go学习笔记"></a>Go学习笔记</h1><h2 id="编译go-build"><a href="#编译go-build" class="headerlink" title="编译go build"></a>编译go build</h2><ol><li>编译当前目录</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build 或者 go build .</span><br></pre></td></tr></table></figure><ol start="2"><li>编译指定文件或目录</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译main文件，将会生成可执行文件</span></span><br><span class="line">go build ./mian.go</span><br><span class="line"><span class="comment"># 编译指定文件目录p1（当前文件夹下没有main.go），不会生成编译文件，仅进行编译检查</span></span><br><span class="line">go build ./p1</span><br></pre></td></tr></table></figure><ol start="3"><li>main包有多个文件的情况，指定文件编译main包</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译时必须指定main包的所有文件</span></span><br><span class="line">go build ./main.go ./hello.go</span><br></pre></td></tr></table></figure><ol start="4"><li>编译时指定编译结果输出</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -o ./out/app ./main.go ./hello.go</span><br></pre></td></tr></table></figure><ol start="5"><li>条件编译</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +build linux,386 darwin,!cgo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这段代码只会在Linux 386或不使用cgo的Darwin系统上编译</span></span><br></pre></td></tr></table></figure><p>使用build tags编译：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -tags <span class="string">&quot;linux,386&quot;</span> main.go</span><br></pre></td></tr></table></figure><ol start="6"><li>编译时优化</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁用优化和内联，用于调试</span></span><br><span class="line">go build -gcflags <span class="string">&quot;-N -l&quot;</span> main.go</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译时去掉调试信息，减小二进制文件大小</span></span><br><span class="line">go build -ldflags <span class="string">&quot;-w -s&quot;</span> main.go</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示编译时间</span></span><br><span class="line">go build -x main.go</span><br></pre></td></tr></table></figure><h3 id="运行-go-run"><a href="#运行-go-run" class="headerlink" title="运行 go run"></a>运行 go run</h3><ol><li>直接通过 go run 运行main包，即可运行应用程序</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行应用程序时，指定main包所有文件</span></span><br><span class="line">go run main.go hello.go</span><br><span class="line"><span class="comment"># 运行应用程序时，指定main包所在目录</span></span><br><span class="line">go run .</span><br></pre></td></tr></table></figure><ol start="2"><li>使用go run执行包</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行指定包</span></span><br><span class="line">go run github.com/your-username/your-repo</span><br></pre></td></tr></table></figure><ol start="3"><li>使用go run执行远程代码</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run github.com/user/repo@latest</span><br></pre></td></tr></table></figure><h3 id="交叉编译"><a href="#交叉编译" class="headerlink" title="交叉编译"></a>交叉编译</h3><p>交叉编译需要修改G005、GOARCH、CGO_ENABLED三个环境变量</p><p>GOOS:目标平台的提作系统(darwin、freebsd、linux、windows)</p><p>GOARCH:目标平台的体系架构32位还是64位(386、amd64、arm)</p><p>CGO_ENABLED:是否启用CGO，交叉编译不支持CG0所以要禁用它</p><p>Go支持交叉编译，可以在一个平台上编译其他平台的可执行文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GOOS=linux GOARCH=amd64 go build -o app_linux main.go</span><br><span class="line">GOOS=windows GOARCH=amd64 go build -o app_windows.exe main.go</span><br></pre></td></tr></table></figure><h4 id="win编译liunx-与-mac可执行程序"><a href="#win编译liunx-与-mac可执行程序" class="headerlink" title="win编译liunx 与 mac可执行程序"></a>win编译liunx 与 mac可执行程序</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="variable">$Env</span>:CGO_ENABLED=0;<span class="variable">$Env</span>:GOARCH=<span class="string">&quot;amd64&quot;</span>;<span class="variable">$Env</span>:GOOS=<span class="string">&quot;linux&quot;</span></span><br><span class="line"><span class="comment"># 编译，并输出到app文件</span></span><br><span class="line">go build -o ./out/app .</span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="variable">$Env</span>:CGO_ENABLED=0;<span class="variable">$Env</span>:GOARCH=<span class="string">&quot;amd64&quot;</span>;<span class="variable">$Env</span>:GOOS=<span class="string">&quot;darwin&quot;</span></span><br><span class="line"><span class="comment"># 编译，并输出到app文件</span></span><br><span class="line">go build -o ./out/app .</span><br></pre></td></tr></table></figure><h4 id="Linux编译Windows和macOS可执行程序"><a href="#Linux编译Windows和macOS可执行程序" class="headerlink" title="Linux编译Windows和macOS可执行程序"></a>Linux编译Windows和macOS可执行程序</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译Windows 64位可执行程序</span></span><br><span class="line">GOOS=windows GOARCH=amd64 CGO_ENABLED=0 go build -o app.exe main.go</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译macOS 64位可执行程序</span></span><br><span class="line">GOOS=darwin GOARCH=amd64 CGO_ENABLED=0 go build -o app main.go</span><br></pre></td></tr></table></figure><h4 id="macOS编译Windows和Linux可执行程序"><a href="#macOS编译Windows和Linux可执行程序" class="headerlink" title="macOS编译Windows和Linux可执行程序"></a>macOS编译Windows和Linux可执行程序</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译Windows 64位可执行程序</span></span><br><span class="line">GOOS=windows GOARCH=amd64 CGO_ENABLED=0 go build -o app.exe main.go</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译Linux 64位可执行程序</span></span><br><span class="line">GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o app main.go</span><br></pre></td></tr></table></figure><h3 id="go-mod-依赖管理"><a href="#go-mod-依赖管理" class="headerlink" title="go mod 依赖管理"></a>go mod 依赖管理</h3><ol><li>讲模块下载到本地缓存，需要指定模块路径及版本号</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod download &lt;依赖路径&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>初始化一个新的模块到当前目录</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod init &lt;项目名称&gt;</span><br></pre></td></tr></table></figure><ol start="3"><li>依赖对齐，添加缺少的依赖，删除未使用的依赖</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod tidy</span><br></pre></td></tr></table></figure><ol start="4"><li>通过工具或脚本编辑go.mod</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">go mod edit</span><br><span class="line"><span class="comment"># 添加依赖</span></span><br><span class="line">go mod edit -require=<span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="comment"># 替换路径，old[@version] 替换成 new[@version]</span></span><br><span class="line">go mod edit -replace=<span class="string">&quot;xxx=xxx&quot;</span></span><br><span class="line"><span class="comment"># 排除第三方依赖的某个版本</span></span><br><span class="line">go mod edit -exclude=<span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="comment"># 当前项目作为其他项目的依赖时，添加撤回版本用于排除有问题的版本</span></span><br><span class="line">go mod edit -retract=<span class="string">&quot;v1.0.0&quot;</span></span><br><span class="line"><span class="comment"># 删除撤回版本记录</span></span><br><span class="line">go mod edit -dropretract=<span class="string">&quot;v1.0.0&quot;</span></span><br></pre></td></tr></table></figure><ol start="5"><li>根据go.mod中的依赖项制作vendor副本</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 有了vendor副本，项目将不再依赖本地缓存</span></span><br><span class="line">go mod vendor</span><br><span class="line"><span class="comment"># 验证依赖是否正确</span></span><br><span class="line">go mod verify</span><br></pre></td></tr></table></figure><ol start="6"><li>返回对指定模块的依赖关系最短路径，解释为什么依赖指定包</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod why &lt;依赖路径&gt;</span><br></pre></td></tr></table></figure><ol start="7"><li>打印模块依赖图</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod graph</span><br></pre></td></tr></table></figure><ol start="8"><li>列出当前模块的所有依赖</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go list -m all</span><br></pre></td></tr></table></figure><h3 id="go-mod文件"><a href="#go-mod文件" class="headerlink" title="go.mod文件"></a>go.mod文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块名</span></span><br><span class="line">module gomod</span><br><span class="line"><span class="comment">// go sdk 版本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前module（项目）依赖的包</span></span><br><span class="line">require (</span><br><span class="line"><span class="comment">// dependency latest</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 排除第三方包</span></span><br><span class="line">exclude (</span><br><span class="line"><span class="comment">// dependency latest</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改依赖包的路径或版本</span></span><br><span class="line"><span class="comment">// 依赖包发生迁移</span></span><br><span class="line"><span class="comment">// 原始包无法访问</span></span><br><span class="line"><span class="comment">// 使用本地包替换原始包</span></span><br><span class="line">replace (</span><br><span class="line"><span class="comment">// source latest =&gt; target latest</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 撤回</span></span><br><span class="line"><span class="comment">// 当前项目作为其他项目的依赖，如果某个版本出现了问题则撤回该项目</span></span><br><span class="line">retract (</span><br><span class="line"> v1<span class="number">.0</span><span class="number">.0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="go-install-get-clean"><a href="#go-install-get-clean" class="headerlink" title="go install&#x2F;get&#x2F;clean"></a>go install&#x2F;get&#x2F;clean</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># go install 安装可执行插件</span></span><br><span class="line">go install github.com/google/gops@latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># go get 获取模块信息并更新go.mod文件</span></span><br><span class="line"><span class="comment"># 若本地缓存没有该模块，则下载模块，若有则直接引用</span></span><br><span class="line"><span class="comment"># 获取指定模块及其依赖</span></span><br><span class="line">go get github.com/gin-gonic/gin@v1.9.0</span><br><span class="line"><span class="comment"># 更新指定模块的依赖</span></span><br><span class="line">go get -u github.com/gin-gonic/gin@latest  <span class="comment"># 更新到最新版本</span></span><br><span class="line"><span class="comment"># go get -d: 仅下载依赖，不安装。</span></span><br><span class="line"><span class="comment"># 下载依赖但不安装</span></span><br><span class="line">go get -d github.com/gin-gonic/gin</span><br><span class="line"><span class="comment"># go get -v: 显示详细的下载过程。</span></span><br><span class="line"><span class="comment"># 显示详细的下载过程</span></span><br><span class="line">go get -v github.com/gin-gonic/gin</span><br><span class="line"></span><br><span class="line"><span class="comment"># go clean </span></span><br><span class="line"><span class="comment"># 清理Go的临时文件和缓存。go clean可以帮助您释放磁盘空间，尤其是在进行频繁构建和测试时。</span></span><br><span class="line"><span class="comment"># 清理模块下载的缓存文件</span></span><br><span class="line">go clean -modcache</span><br><span class="line"><span class="comment"># 清理当前模块生成的所有临时文件</span></span><br><span class="line">go clean</span><br><span class="line"><span class="comment"># 清理特定的构建文件</span></span><br><span class="line">go clean -i  <span class="comment"># 清理安装的可执行文件</span></span><br></pre></td></tr></table></figure><h2 id="Go-语言结构与基础语法"><a href="#Go-语言结构与基础语法" class="headerlink" title="Go 语言结构与基础语法"></a>Go 语言结构与基础语法</h2><h3 id="语言结构"><a href="#语言结构" class="headerlink" title="语言结构"></a>语言结构</h3><ol><li><strong>包声明</strong>每个Go源文件必须以<code>package</code>声明开头，表明该文件属于哪个包。</li><li><strong>引入包</strong>使用<code>import</code>关键字引入其他包，可以通过<code>_</code>别名引入包但不调用。</li><li><strong>函数</strong>使用<code>func</code>关键字定义函数，支持多返回值和命名返回参数。</li><li><strong>init函数</strong>每个包可以有一个<code>init</code>函数，程序启动时会自动调用。</li><li><strong>变量</strong>使用<code>var</code>关键字声明变量，支持类型推导和简短声明。</li><li><strong>标识符</strong>标识符是变量、函数、包等的名称，必须以字母或下划线开头，后面可以跟字母、数字或下划线。</li><li><strong>行分隔符</strong>每条语句以分号结束，Go会自动插入分号。</li><li><strong>语句与表达式</strong>语句是执行的指令，表达式是计算得到值的代码。</li><li><strong>注释</strong>单行注释以<code>//</code>开头，多行注释用<code>/* ... */</code>。</li><li><strong>公有成员与私有成员</strong>首字母大写的标识符为公有成员，首字母小写的标识符为私有成员。</li><li><strong>关键字、保留字和预定义标志</strong>Go语言有一系列的关键字和保留字，不能用作标识符。</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明包</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入包</span></span><br><span class="line"><span class="comment">// 引用包时，下划线别名表示只引用不调用</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化函数，golang 每个包的引用会优先调用该函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;init&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数（main函数为整个程序的入口）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 语句或表达式</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">10</span></span><br><span class="line">    fmt.Println(fmt.Sprintf(<span class="string">&quot;打印参数i：%d&quot;</span> , i))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 单行注释</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    多行注释</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 首字符大写为公有成员，小写为私有成员</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 包名与包引用目录可以不一致（包名和文件夹名可以不同）</span></span><br><span class="line">      </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h3><ol><li><strong>切片</strong>动态数组，支持扩展。</li><li><strong>map</strong>键值对集合，支持快速查找。</li><li><strong>channel</strong>用于在goroutine之间传递数据。</li><li><strong>interface</strong>定义方法集，允许不同类型实现相同的接口。</li><li><strong>func</strong>函数类型，可以作为参数或返回值。</li><li><strong>指针类型</strong>存储变量的内存地址，允许直接操作内存。</li></ol><h3 id="关键词和保留词"><a href="#关键词和保留词" class="headerlink" title="关键词和保留词"></a>关键词和保留词</h3><ol><li><strong>break</strong>: 跳出循环或switch语句。</li><li><strong>default</strong>: switch或select的默认选项。</li><li><strong>func</strong>: 定义函数。</li><li><strong>interface</strong>: 声明接口。</li><li><strong>select</strong>: 用于多路选择，监听channel。</li><li><strong>case</strong>: switch或select中的条件。</li><li><strong>defer</strong>: 延迟调用的关键词。</li><li><strong>go</strong>: 启动goroutine的关键词。</li><li><strong>map</strong>: 定义映射类型。</li><li><strong>struct</strong>: 定义结构体类型。</li><li><strong>chan</strong>: 定义通道类型。</li><li><strong>else</strong>: 条件表达式的否则部分。</li><li><strong>goto</strong>: 跳转到标签的位置。</li><li><strong>package</strong>: 声明包名。</li><li><strong>switch</strong>: 流程控制语句。</li><li><strong>const</strong>: 声明常量。</li><li><strong>fallthrough</strong>: 在switch语句中执行下一个case。</li><li><strong>if</strong>: 条件表达式。</li><li><strong>range</strong>: 遍历数组、切片、map等。</li><li><strong>type</strong>: 定义新类型。</li><li><strong>continue</strong>: 跳过当前循环的剩余部分。</li><li><strong>for</strong>: 循环语句。</li><li><strong>import</strong>: 包导入语句。</li><li><strong>return</strong>: 返回语句。</li><li><strong>var</strong>: 变量声明的关键词。</li></ol><h3 id="预定义表示"><a href="#预定义表示" class="headerlink" title="预定义表示"></a>预定义表示</h3><ol><li><strong>append</strong>: 向切片追加元素。</li><li><strong>cap</strong>: 获取数组、切片、通道的容量。</li><li><strong>close</strong>: 关闭通道。</li><li><strong>copy</strong>: 拷贝切片。</li><li><strong>imag</strong>: 返回复数的虚部。</li><li><strong>real</strong>: 返回复数的实部。</li><li><strong>panic</strong>: 抛出异常。</li><li><strong>recover</strong>: 恢复因panic而中断的goroutine。</li><li><strong>iota</strong>: 常量计数器。</li><li><strong>len</strong>: 获取长度。</li><li><strong>make</strong>: 初始化切片、map、channel。</li><li><strong>new</strong>: 创建类型的变量并分配内存。</li><li><strong>nil</strong>: 引用类型的零值。</li><li><strong>false, true</strong>: 布尔类型值。</li><li><strong>print, println</strong>: 打印消息。</li><li>bool,byte, </li><li>complex,complex64,complex128</li><li>float32,float64, </li><li>int,uint,int8,uint8,int16,uint16,int32,uint32,int64,uint64</li><li>string </li><li>uintptr</li></ol><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><ol><li><p><strong>错误处理</strong>: Go使用多返回值的方式处理错误，通常返回一个<code>error</code>类型的值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">result, err := someFunction()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="comment">// 处理错误</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>并发编程</strong>: Go通过goroutines和channels实现并发，goroutines是轻量级线程，channels用于在goroutines之间传递数据。</p></li><li><p><strong>结构体和方法</strong>: 结构体可以定义方法，方法的接收者可以是值类型或指针类型。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Person)</span></span> Greet() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello, my name is&quot;</span>, p.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="数据类型与变量"><a href="#数据类型与变量" class="headerlink" title="数据类型与变量"></a>数据类型与变量</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><ol><li><strong>基本类型</strong><ol><li>布尔类型: <code>bool</code></li><li>整型: <code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code>, <code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code>, <code>int</code>, <code>uint</code>, <code>uintptr</code></li><li>浮点型: <code>float32</code>, <code>float64</code></li><li>复数: <code>complex64</code>, <code>complex128</code></li><li>字符串: <code>string</code></li><li>字符: <code>rune</code> (等价于 <code>int32</code>)</li><li>字节: <code>byte</code> (等价于 <code>uint8</code>)</li></ol></li><li><strong>复合类型</strong><ol><li>数组: <code>[n]T</code></li><li>切片: <code>[]T</code></li><li>字典: <code>map[K]V</code></li><li>结构体: <code>struct</code></li><li>指针: <code>*T</code></li><li>函数: <code>func(T1, T2) (R1, R2)</code></li><li>通道: <code>chan T</code></li><li>接口: <code>interface&#123;&#125;</code></li><li>时间类型</li></ol></li></ol><h3 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h3><ol><li><strong>使用 <code>var</code> 关键字声明变量</strong><ol><li><code>var name type = expression</code></li><li><code>var name1, name2 type = expression1, expression2</code></li><li><code>var name1, name2 = expression1, expression2</code> (类型推断)</li></ol></li><li><strong>使用简短声明 <code>:=</code> 声明变量</strong><ol><li><code>name := expression</code></li><li>只能用于函数内部,不能用于全局变量</li></ol></li><li><strong>零值</strong><ol><li>数值类型: <code>0</code></li><li>布尔类型: <code>false</code></li><li>字符串: <code>&quot;&quot;</code></li><li>指针、通道、函数、接口、切片、字典、通道: <code>nil</code></li></ol></li></ol><h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><ol><li><strong>显式类型转换</strong><ol><li><code>T(expression)</code></li><li>只能在两种类型之间有直接关系时使用</li></ol></li><li><strong>字符串和数值类型转换</strong><ol><li><code>strconv.Itoa(int)</code> </li><li>将整数转换为字符串</li><li><code>strconv.Atoi(string)</code> 将字符串转换为整数</li><li><code>strconv.FormatInt(int64, base)</code> 将整数转换为字符串</li><li><code>strconv.ParseInt(string, base, bitSize)</code> 将字符串转换为整数</li></ol></li><li><strong>字符串和字节&#x2F;rune切片转换</strong><ol><li><code>[]byte(string)</code> 将字符串转换为字节切片</li><li><code>[]rune(string)</code> 将字符串转换为rune切片</li><li><code>string([]byte)</code> 将字节切片转换为字符串</li><li><code>string([]rune)</code> 将rune切片转换为字符串</li></ol></li><li><strong>接口类型转换</strong><ol><li><code>value, ok := interface&#123;&#125;.(T)</code> 类型断言</li><li><code>value := interface&#123;&#125;.(T)</code> 类型断言,如果失败会panic</li></ol></li></ol><h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><ol><li><strong>指针声明</strong><ol><li><code>var p *T</code></li><li><code>p := &amp;v</code> 取变量v的地址</li></ol></li><li><strong>指针运算</strong><ol><li><code>*p</code> 解引用,获取指针指向的值</li><li><code>p++</code> 递增指针,指向下一个元素</li></ol></li><li><strong><code>unsafe.Pointer</code></strong><ol><li>通用指针类型,可以转换为任意指针类型</li><li>不能进行指针运算</li></ol></li><li><strong><code>uintptr</code></strong><ol><li>可以进行指针运算的整数类型</li><li>可以与<code>unsafe.Pointer</code>相互转换</li></ol></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> _case</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量==========================================================</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">VarDeclareCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 通过 var 关键词声明类型</span></span><br><span class="line">    <span class="keyword">var</span> i <span class="type">int</span></span><br><span class="line">    <span class="comment">// 通过var关键词声明变量，并赋值</span></span><br><span class="line">    <span class="keyword">var</span> j <span class="type">int</span> = <span class="number">100</span></span><br><span class="line">    <span class="keyword">var</span> f <span class="type">float32</span> = <span class="number">100.123</span></span><br><span class="line">    <span class="keyword">var</span> x,y,z <span class="type">int</span> = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line">    <span class="comment">// 通过:= 以推断的方式定义变量并赋值，此方式只能用于局部变量的定义</span></span><br><span class="line">    b:= <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 数组</span></span><br><span class="line">    <span class="keyword">var</span> arr = [<span class="number">5</span>]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">    arr1 := [...]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">    <span class="keyword">var</span> arr2 [<span class="number">5</span>]<span class="type">int</span></span><br><span class="line">    arr2[<span class="number">2</span>] = <span class="number">4</span></span><br><span class="line">    arr2[<span class="number">3</span>] = <span class="number">5</span></span><br><span class="line">    <span class="comment">// ...打印，过编</span></span><br><span class="line">    fmt.Println(i,j,f,x,y,z,b,arr,arr1,arr2)</span><br><span class="line">    <span class="comment">//指针类型，用于表示变量地址的类型</span></span><br><span class="line">    <span class="keyword">var</span> intPtr *<span class="type">int</span></span><br><span class="line">    <span class="keyword">var</span> i1 = <span class="number">100</span></span><br><span class="line">    f1(i1)</span><br><span class="line">    <span class="keyword">var</span> i2 = <span class="number">100</span></span><br><span class="line">    f1(&amp;i2)</span><br><span class="line">    fmt.Println(intPtr,i1,i2)</span><br><span class="line">    <span class="keyword">var</span> floatPtr *<span class="type">float64</span></span><br><span class="line">    fmt.Println(floatPtr)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 接口类型</span></span><br><span class="line">    <span class="keyword">var</span> inter <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    fmt.Println(inter)</span><br><span class="line">    inter = i1</span><br><span class="line">    fmt.Println(inter)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(i <span class="type">int</span>)</span></span>&#123;</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">(i *<span class="type">int</span>)</span></span>&#123;</span><br><span class="line">    *i = *i + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量和枚举==========================================================</span></span><br><span class="line"><span class="comment">// 枚举</span></span><br><span class="line"><span class="keyword">type</span> Gender <span class="type">uint</span></span><br><span class="line"></span><br><span class="line">cast (</span><br><span class="line">FEMALE Gender = <span class="literal">iota</span></span><br><span class="line">    MALE</span><br><span class="line">    THIRD</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">cast (</span><br><span class="line">B = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)</span><br><span class="line">    KB</span><br><span class="line">    MB</span><br><span class="line">    GB <span class="comment">// 如果不想引用GB 用 _ 替代，保持顺序</span></span><br><span class="line">    TB</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量和枚举</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConstAndEnumCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">const</span>(</span><br><span class="line">    A = <span class="number">10</span></span><br><span class="line">    B = <span class="number">20</span></span><br><span class="line">    )</span><br><span class="line">    fmt.Println(A,B)</span><br><span class="line">    <span class="keyword">var</span> gander Gender = MALE</span><br><span class="line">    fmt.Println(gander)</span><br><span class="line">    size := MB</span><br><span class="line">    fmt.Println(size)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结构体==========================================================</span></span><br><span class="line"><span class="comment">// 结构体</span></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span>&#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Age <span class="type">uint</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StructCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    u := user&#123;</span><br><span class="line">        Name: <span class="string">&quot;nick&quot;</span>,</span><br><span class="line">        Age: <span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    f3(u)</span><br><span class="line">    fmt.Println(u)</span><br><span class="line">    f4(&amp;u)</span><br><span class="line">    fmt.Println(u)</span><br><span class="line">    <span class="comment">// 指针类型</span></span><br><span class="line">    u1 := &amp;user&#123;</span><br><span class="line">        Name: <span class="string">&quot;nick&quot;</span>,</span><br><span class="line">        Age: <span class="number">18</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 指针类型</span></span><br><span class="line">    u2 := <span class="built_in">new</span>(user)</span><br><span class="line">    u2.Name = <span class="string">&quot;nick&quot;</span></span><br><span class="line">    u2.Age = <span class="number">18</span></span><br><span class="line">    fmt.Println(u2)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 值类型可以不做初始化，指针类型必须要做初始化否则会空指针异常</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f3</span><span class="params">(u user)</span></span>&#123;</span><br><span class="line">    u.Age = <span class="number">28</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f4</span><span class="params">(u *user)</span></span>&#123;</span><br><span class="line">    u.Age = <span class="number">28</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new和make==========================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 通过new函数，可以创建任意类型，并返回指针</span></span><br><span class="line">    mpPtr := <span class="built_in">new</span>(<span class="keyword">map</span>[<span class="type">string</span>]*user)</span><br><span class="line">    <span class="keyword">if</span> *mpPtr == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// (*mpPtr)[&quot;A&quot;] = &amp;user&#123;&#125;</span></span><br><span class="line">    slicePtr := <span class="built_in">new</span>([]user)</span><br><span class="line">    <span class="keyword">if</span> *slicePtr == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    *slicePtr = <span class="built_in">append</span>(*slicePtr,user&#123;Name: <span class="string">&quot;nick&quot;</span>&#125;)</span><br><span class="line">    fmt.Println(mpPtr,slicePtr)</span><br><span class="line">    </span><br><span class="line">    strPtr := <span class="built_in">new</span>(<span class="type">string</span>)</span><br><span class="line">    fmt.Println(strPtr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// make 仅用于 切片、集合、通道的初始化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MakeCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化切片，别设置长度和容量</span></span><br><span class="line">    slice := <span class="built_in">make</span>([]<span class="type">int</span>,<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line">    slice[<span class="number">0</span>] = <span class="number">10</span></span><br><span class="line">    <span class="comment">// 初始化集合，并设置集合的初始大小</span></span><br><span class="line">    mp := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>,<span class="number">10</span>)</span><br><span class="line">    mp[<span class="string">&quot;A&quot;</span>] = <span class="string">&quot;a&quot;</span></span><br><span class="line">    <span class="comment">// 初始化通道，设置通道的读写方向和缓存大小</span></span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">10</span>)</span><br><span class="line">    <span class="comment">// 只写</span></span><br><span class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span>&lt;- <span class="type">int</span>,<span class="number">10</span>)</span><br><span class="line">    <span class="comment">// 只读</span></span><br><span class="line">    ch1 := <span class="built_in">make</span>(&lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    fmt.Println(slice,mp,ch,ch1,ch2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SliceAndMapCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 定义切片</span></span><br><span class="line">    <span class="keyword">var</span> slice []<span class="type">int</span></span><br><span class="line">    slice = []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;</span><br><span class="line">    slice1 := <span class="built_in">make</span>([]<span class="type">int</span>,<span class="number">10</span>)</span><br><span class="line">    slice1[<span class="number">1</span>] = <span class="number">10</span></span><br><span class="line">    fmt.Println(slice,slice1)</span><br><span class="line">    <span class="comment">// 切片的截取</span></span><br><span class="line">    slice2 := <span class="built_in">make</span>([]<span class="type">int</span>,<span class="number">5</span>,<span class="number">10</span>)</span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(slice2),<span class="built_in">cap</span>(slice2))</span><br><span class="line">    slice2[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">    slice2[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    slice2[<span class="number">2</span>] = <span class="number">2</span></span><br><span class="line">    slice2[<span class="number">3</span>] = <span class="number">3</span></span><br><span class="line">    slice2[<span class="number">4</span>] = <span class="number">4</span></span><br><span class="line">    slice3 := slice2[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(slice3),<span class="built_in">cap</span>(slice3),slice3)</span><br><span class="line">    slice4 := slice2[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(slice4),<span class="built_in">cap</span>(slice4),slice4)</span><br><span class="line">    slice5 := slice2[<span class="number">1</span>:<span class="number">8</span>]</span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(slice5),<span class="built_in">cap</span>(slice5),slice5)</span><br><span class="line">    slice6 := slice2[<span class="number">1</span>:<span class="number">10</span>]</span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(slice6),<span class="built_in">cap</span>(slice6),slice6)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 切片的附加</span></span><br><span class="line">    slice6 = <span class="built_in">append</span>(slice3,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">    fmt.Println(<span class="built_in">len</span>(slice6),<span class="built_in">cap</span>(slice6),slice6)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 集合，无序</span></span><br><span class="line">    mp := <span class="built_in">make</span>(mapp[<span class="type">string</span>]<span class="type">string</span>, <span class="number">10</span>)</span><br><span class="line">    mp[<span class="string">&quot;A&quot;</span>] = <span class="string">&quot;a&quot;</span></span><br><span class="line">    mp[<span class="string">&quot;B&quot;</span>] = <span class="string">&quot;b&quot;</span></span><br><span class="line">    mp[<span class="string">&quot;C&quot;</span>] = <span class="string">&quot;c&quot;</span></span><br><span class="line">    mp[<span class="string">&quot;D&quot;</span>] = <span class="string">&quot;d&quot;</span></span><br><span class="line">    fmt.Println(mp)</span><br><span class="line">    <span class="comment">// 无序</span></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> mp&#123;</span><br><span class="line">        fmt.Println(k,v)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除集合元素</span></span><br><span class="line">    <span class="built_in">delete</span>(mp,<span class="string">&quot;B&quot;</span>)</span><br><span class="line">    fmt.Println(mp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换类型与时间类型==========================================================</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConvertCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 同一类数据转换 数字和数字、字符串和字符和字节</span></span><br><span class="line">    <span class="comment">// 不同类型的数据转换</span></span><br><span class="line">    <span class="comment">// 接口类型转其他类型</span></span><br><span class="line">    <span class="comment">// 数字类型的转换</span></span><br><span class="line">    <span class="keyword">var</span> num1 <span class="type">int</span> = <span class="number">100</span></span><br><span class="line">    fmt.Println(<span class="type">int64</span>(num1))</span><br><span class="line">    <span class="keyword">var</span> num2 <span class="type">int64</span> = <span class="number">100</span></span><br><span class="line">    fmt.Println(<span class="type">int</span>(num2))</span><br><span class="line">    <span class="comment">// 字符串与数字类型转换</span></span><br><span class="line">    <span class="keyword">var</span> num3 = <span class="number">100</span></span><br><span class="line">    fmt.Println(strconv.Itoa(num3) + <span class="string">&quot;abc&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> str1 = <span class="string">&quot;100&quot;</span></span><br><span class="line">    fmt.Println(strconv.Atoi(str1))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> num4 <span class="type">int64</span> = <span class="number">1010</span></span><br><span class="line">    fmt.Println(strconv.FormatInt(num4,<span class="number">10</span>))</span><br><span class="line">    fmt.Println(strconv.FormatInt(num4,<span class="number">16</span>))</span><br><span class="line">    <span class="keyword">var</span> str2 = <span class="string">&quot;1010&quot;</span></span><br><span class="line">    fmt.Println(strconv.ParseInt(str2,<span class="number">10</span>,<span class="number">64</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 字符串与[]byte 转换</span></span><br><span class="line">    <span class="keyword">var</span> str3 = <span class="string">&quot;今天天气好&quot;</span></span><br><span class="line">    bytes1 := []<span class="type">byte</span>(str3)</span><br><span class="line">    fmt.Println([]<span class="type">byte</span>(str3))</span><br><span class="line">    fmt.Println(bytes1)</span><br><span class="line">    fmt.<span class="built_in">println</span>(<span class="type">string</span>(bytes1))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 字符串与rune转换</span></span><br><span class="line">    <span class="comment">// rune 为int32类型</span></span><br><span class="line">    <span class="comment">// 将字符串转换为rune切片，实际上rune切片中存储了字符串的Unicode码表</span></span><br><span class="line">    <span class="keyword">var</span> rune1 = []<span class="type">rune</span>(str3)</span><br><span class="line">    fmt.Println(rune1)</span><br><span class="line">    fmt.Println(<span class="type">string</span>(rune1))</span><br><span class="line">    fmt.Println(<span class="type">string</span>(rune1[<span class="number">3</span>]))</span><br><span class="line">    fmt.Println([]<span class="type">int32</span>(str3))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 接口类型转具体类型</span></span><br><span class="line">    <span class="keyword">var</span> inf <span class="keyword">interface</span>&#123;&#125; = <span class="number">100</span></span><br><span class="line">    <span class="keyword">var</span> infStruct interfase&#123;&#125; = user&#123;Name:<span class="string">&quot;nick&quot;</span>&#125;</span><br><span class="line">    <span class="comment">// . 断言</span></span><br><span class="line">    i, ok := inf.(<span class="type">int</span>)</span><br><span class="line">    fmt.Println(i,ok)</span><br><span class="line">    u, ok := infStruct.(user)</span><br><span class="line">    fmt.Println(u,ok)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 时间类型转字符串</span></span><br><span class="line">    <span class="comment">// 2006-01-02 15:04:05Z07:00 固定格式 Z07:00 为时区</span></span><br><span class="line">    <span class="keyword">var</span> t time.Time</span><br><span class="line">    t = time.Now()</span><br><span class="line">    timeStr := t.Format(<span class="string">&quot;2006-01-02 15:04:05Z07:00&quot;</span>);</span><br><span class="line">    fmt.Println(timeStr)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 字符串转时间</span></span><br><span class="line">    t2,_ := time.Parse(<span class="string">&quot;2006-01-02 15:04:05Z07:00&quot;</span>, timeStr)</span><br><span class="line">    fmt.Println(t2)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// uintptr </span></span><br><span class="line">    u1 := user&#123;&#125;</span><br><span class="line">    <span class="comment">// unsafe.Pointer 通用指针类型 不能用于计算</span></span><br><span class="line">    uPtr := unsafe.Pointer(&amp;u1)</span><br><span class="line">    namePtr := unsafe.Pointer(<span class="type">uintptr</span>(uPtr) + unsafe.Offsetof(u1.Name))</span><br><span class="line">    *(*<span class="type">string</span>)(namePtr) = <span class="string">&quot;nick&quot;</span></span><br><span class="line">    fmt.Println(u1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="变量作用域与函数"><a href="#变量作用域与函数" class="headerlink" title="变量作用域与函数"></a>变量作用域与函数</h2><h3 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h3><ol><li><strong>局部变量</strong>在函数内部声明的变量只在该函数内有效。局部变量在函数调用结束后被销毁。</li><li><strong>全局变量</strong>在包级别声明的变量可以在包的任何地方访问。全局变量的命名约定：首字母大写为公有变量，首字母小写为私有变量。</li><li><strong>作用域规则</strong>变量的作用域从声明开始，到其所在代码块结束。如果局部变量与全局变量同名，局部变量会隐藏全局变量。</li></ol><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ol><li><p><strong>函数定义</strong></p><p>使用<code>func</code>关键字定义函数，可以有多个参数和返回值。返回值可以命名，命名返回值在函数体内可以直接赋值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SumCase</span><span class="params">(a, b <span class="type">int</span>)</span></span> (sum <span class="type">int</span>, err <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> a &lt;= <span class="number">0</span> &amp;&amp; b &lt;= <span class="number">0</span> &#123;</span><br><span class="line">        err = errors.New(<span class="string">&quot;两数相加不能同时小于0&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>值传递与引用传递</strong></p><p>Go语言使用值传递，即函数参数的值在调用时被复制。如果需要在函数中修改参数的值，可以传递指针。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReferenceCase</span><span class="params">(a <span class="type">int</span>, b *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    a += <span class="number">1</span>   <span class="comment">// 修改的是局部变量a</span></span><br><span class="line">    *b += <span class="number">1</span>  <span class="comment">// 修改的是b指向的值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>方法</strong></p><p>方法是与类型关联的函数，可以通过接收者来定义。接收者可以是值类型或指针类型。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> GetName() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> u.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> SetAge(age <span class="type">int</span>) &#123;</span><br><span class="line">    u.Age = age</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>返回多个值</strong></p><p>Go语言允许函数返回多个值，常用于返回结果和错误。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SumCase2</span><span class="params">(a, b <span class="type">int</span>)</span></span> (user *User, sum <span class="type">int</span>, err <span class="type">error</span>) &#123;</span><br><span class="line">    user = &amp;User&#123;Name: <span class="string">&quot;nick&quot;</span>, Age: <span class="number">18</span>&#125; <span class="comment">// 需要先初始化user</span></span><br><span class="line">    <span class="keyword">if</span> a &lt;= <span class="number">0</span> &amp;&amp; b &lt;= <span class="number">0</span> &#123;</span><br><span class="line">        err = errors.New(<span class="string">&quot;两数相加不能同时小于0&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>匿名函数</strong></p><p>Go支持匿名函数，可以在定义时立即调用。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gofunc() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure></li><li><p><strong>闭包</strong></p><p>闭包是一个函数值，它引用了其外部作用域中的变量。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">closureExample</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        i++</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>延迟调用</strong></p><p>使用<code>defer</code>关键字可以延迟函数的执行，直到外层函数返回时执行。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DeferExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;Deferred call&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;Normal call&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> _case</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形参</span></span><br><span class="line"><span class="comment">// 局部变量</span></span><br><span class="line"><span class="comment">// 全局变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数可以有多个形参和多个返回值，返回值也可以和形参一样拥有参数名称</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SumCase</span><span class="params">(a,b <span class="type">int</span>)</span></span> (sum <span class="type">int</span>, err <span class="type">error</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> a &lt;= <span class="number">0</span> &amp;&amp; b &lt;= <span class="number">0</span>&#123;</span><br><span class="line">        err = errors.New(<span class="string">&quot;两数相加不能同时小于0&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name String</span><br><span class="line">    Age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SumCase2</span><span class="params">(a, b <span class="type">int</span>)</span></span> (user *User, sum <span class="type">int</span>, err <span class="type">error</span>)&#123;</span><br><span class="line">    <span class="comment">// user 为 nil 会出现异常</span></span><br><span class="line">    user.Name = <span class="string">&quot;nick&quot;</span></span><br><span class="line">    user.Age = <span class="number">18</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> a &lt;= <span class="number">0</span> &amp;&amp; b &lt;= <span class="number">0</span>&#123;</span><br><span class="line">        err = errors.New(<span class="string">&quot;两数相加不能同时小于0&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    sum = a + b</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 值传递与引用传递</span></span><br><span class="line"><span class="comment">// _case.ReferenceCase(a , &amp;b)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReferenceCase</span><span class="params">(a <span class="type">int</span>, b *<span class="type">int</span>)</span></span>&#123;</span><br><span class="line">    a += <span class="number">1</span></span><br><span class="line">    *b += <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局变量 小写为私有全局 大写为公有全局</span></span><br><span class="line"><span class="keyword">var</span> g <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> G <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量作用域</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ScopeCase</span><span class="params">(a, b <span class="type">int</span>)</span></span>&#123;</span><br><span class="line">    c := <span class="number">100</span></span><br><span class="line">    g = a + b + c</span><br><span class="line">    G = g</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建新用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUser</span><span class="params">(name <span class="type">string</span>, age <span class="type">int</span>)</span></span> *User &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;User&#123;Name: name, Age: age&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户的名字</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> GetName() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> u.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户的年龄</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> GetAge() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> u.Age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改用户的年龄</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> SetAge(age <span class="type">int</span>) &#123;</span><br><span class="line">    u.Age = age</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="运算符与优先级"><a href="#运算符与优先级" class="headerlink" title="运算符与优先级"></a>运算符与优先级</h2><h3 id="1-算术运算符"><a href="#1-算术运算符" class="headerlink" title="1. 算术运算符"></a>1. 算术运算符</h3><p>除了您已经列出的基本算术运算符，还有一些需要注意的点：</p><ul><li>整数除法会舍去小数部分</li><li><code>++</code> 和 <code>--</code> 是语句，不是表达式，不能用在赋值语句中</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ArithmeticExtraCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 整数除法</span></span><br><span class="line">    fmt.Println(<span class="number">5</span> / <span class="number">2</span>)  <span class="comment">// 输出: 2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 浮点数除法</span></span><br><span class="line">    fmt.Println(<span class="number">5.0</span> / <span class="number">2.0</span>)  <span class="comment">// 输出: 2.5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ++ 和 -- 的使用</span></span><br><span class="line">    x := <span class="number">5</span></span><br><span class="line">    x++</span><br><span class="line">    fmt.Println(x)  <span class="comment">// 输出: 6</span></span><br><span class="line">    <span class="comment">// 以下代码会编译错误</span></span><br><span class="line">    <span class="comment">// y := x++</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-关系运算符"><a href="#2-关系运算符" class="headerlink" title="2. 关系运算符"></a>2. 关系运算符</h3><p>Go语言中的关系运算符可以用于比较不同类型的值，但必须是可比较的类型。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RelationExtraCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 比较不同类型</span></span><br><span class="line">    <span class="keyword">var</span> a <span class="type">int</span> = <span class="number">5</span></span><br><span class="line">    <span class="keyword">var</span> b <span class="type">int64</span> = <span class="number">5</span></span><br><span class="line">    <span class="comment">// fmt.Println(a == b)  // 编译错误：不同类型不能直接比较</span></span><br><span class="line">    fmt.Println(a == <span class="type">int</span>(b))  <span class="comment">// 正确：先进行类型转换</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 比较浮点数</span></span><br><span class="line">    fmt.Println(<span class="number">0.1</span> + <span class="number">0.2</span> == <span class="number">0.3</span>)  <span class="comment">// 输出: false，因为浮点数精度问题</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-逻辑运算符"><a href="#3-逻辑运算符" class="headerlink" title="3. 逻辑运算符"></a>3. 逻辑运算符</h3><p>Go语言的逻辑运算符支持短路求值。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LogicExtraCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 短路求值</span></span><br><span class="line">    a := <span class="literal">false</span></span><br><span class="line">    b := <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> a &amp;&amp; someFunction() &#123;</span><br><span class="line">        <span class="comment">// someFunction 不会被调用，因为 a 已经是 false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> b || someFunction() &#123;</span><br><span class="line">        <span class="comment">// someFunction 不会被调用，因为 b 已经是 true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">someFunction</span><span class="params">()</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;someFunction called&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-位运算符"><a href="#4-位运算符" class="headerlink" title="4. 位运算符"></a>4. 位运算符</h3><p>Go语言的位运算符中，<code>&amp;^</code> 是按位清零运算符，它的行为有些特殊。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BitExtraCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="number">0</span>b1111</span><br><span class="line">    b := <span class="number">0</span>b1010</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%04b\n&quot;</span>, a &amp;^ b)  <span class="comment">// 输出: 0101</span></span><br><span class="line">    <span class="comment">// a &amp;^ b 等价于 a &amp; (^b)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-赋值运算符"><a href="#5-赋值运算符" class="headerlink" title="5. 赋值运算符"></a>5. 赋值运算符</h3><p>Go语言支持多重赋值，这在交换变量值时特别有用。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AssignmentExtraCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a, b := <span class="number">1</span>, <span class="number">2</span></span><br><span class="line">    fmt.Println(a, b)  <span class="comment">// 输出: 1 2</span></span><br><span class="line">    a, b = b, a</span><br><span class="line">    fmt.Println(a, b)  <span class="comment">// 输出: 2 1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 忽略某些返回值</span></span><br><span class="line">    _, err := someFunction()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// 处理错误</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-运算符优先级"><a href="#6-运算符优先级" class="headerlink" title="6. 运算符优先级"></a>6. 运算符优先级</h3><p>除了您列出的优先级，还有一些需要注意的点：</p><ul><li>括号 <code>()</code> 可以用来改变运算顺序</li><li>函数调用、数组索引、切片操作的优先级高于其他运算符</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PriorityCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="number">1</span> + <span class="number">2</span>*<span class="number">3</span>  <span class="comment">// 7</span></span><br><span class="line">    b := (<span class="number">1</span> + <span class="number">2</span>) * <span class="number">3</span>  <span class="comment">// 9</span></span><br><span class="line">    fmt.Println(a, b)</span><br><span class="line"></span><br><span class="line">    arr := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">    fmt.Println(arr[<span class="number">2</span>+<span class="number">2</span>])  <span class="comment">// 输出: 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-类型断言和类型转换"><a href="#7-类型断言和类型转换" class="headerlink" title="7. 类型断言和类型转换"></a>7. 类型断言和类型转换</h3><p>虽然不是严格意义上的运算符，但类型断言和类型转换在Go中也很重要：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TypeAssertionCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line">    s, ok := i.(<span class="type">string</span>)</span><br><span class="line">    fmt.Println(s, ok)  <span class="comment">// 输出: hello true</span></span><br><span class="line"></span><br><span class="line">    f, ok := i.(<span class="type">float64</span>)</span><br><span class="line">    fmt.Println(f, ok)  <span class="comment">// 输出: 0 false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类型转换</span></span><br><span class="line">    <span class="keyword">var</span> x <span class="type">int</span> = <span class="number">65</span></span><br><span class="line">    <span class="keyword">var</span> y <span class="type">float64</span> = <span class="type">float64</span>(x)</span><br><span class="line">    <span class="keyword">var</span> z <span class="type">string</span> = <span class="type">string</span>(x)</span><br><span class="line">    fmt.Println(y, z)  <span class="comment">// 输出: 65 A</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> _case</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 算数运算符</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ArithmeticCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    a := <span class="number">21</span></span><br><span class="line">    b := <span class="number">10</span></span><br><span class="line">    <span class="keyword">var</span> c <span class="type">int</span></span><br><span class="line">    c = a + b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a + b 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c = a - b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a - b 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c = a * b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a * b 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c = a / b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a / b 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c = a % b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a %% b 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    a++</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a++ 的值为 %d \n&quot;</span>, a)</span><br><span class="line">    a--</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a-- 的值为 %d \n&quot;</span>, a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关系运算</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RelationCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    a := <span class="number">21</span></span><br><span class="line">    b := <span class="number">10</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;a == b&quot;</span>,a == b)</span><br><span class="line">    fmt.Println(<span class="string">&quot;a &gt; b&quot;</span>,a &gt; b)</span><br><span class="line">    fmt.Println(<span class="string">&quot;a &lt; b&quot;</span>,a &lt; b)</span><br><span class="line">    fmt.Println(<span class="string">&quot;a &gt;= b&quot;</span>,a &gt;= b)</span><br><span class="line">    fmt.Println(<span class="string">&quot;a &lt;= b&quot;</span>,a &lt;= b)</span><br><span class="line">    fmt.Println(<span class="string">&quot;a != b&quot;</span>,a != b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逻辑运算</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LogicCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    a := <span class="literal">true</span></span><br><span class="line">    b := <span class="literal">false</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;a &amp;&amp; b&quot;</span>,a &amp;&amp; b)</span><br><span class="line">    fmt.Println(<span class="string">&quot;a || b&quot;</span>,a || b)</span><br><span class="line">    fmt.Println(<span class="string">&quot;!(a &amp;&amp; b)&quot;</span>,!(a &amp;&amp; b))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 位运算</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BitCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a unit8 = <span class="number">60</span></span><br><span class="line">    <span class="keyword">var</span> b unit8 = <span class="number">13</span></span><br><span class="line">    <span class="keyword">var</span> c unit8 = <span class="number">0</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,a)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,b)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">    c = a &amp; b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">    c = a | b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">    c = a ^ b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">    c = a &lt;&lt; <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">    c = a &gt;&gt; <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">    c = ^a</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">    c = a &amp;^ b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">    c = a &amp; ^b</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%08b\n&quot;</span>,c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 赋值运算</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AssignmentCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    a := <span class="number">21</span></span><br><span class="line">    <span class="keyword">var</span> c <span class="type">int</span></span><br><span class="line">    c = a</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c = a 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c += a</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c += a 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c -= a</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c -= a 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c *= a</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c *= a 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c /= a</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c /= a 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    c %= a</span><br><span class="line">    fmt.Printf(<span class="string">&quot;c %= a 的值为 %d \n&quot;</span>, c)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> b <span class="type">uint8</span> = <span class="number">60</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;b 的值为 %d,二进制表示：%08b\n&quot;</span>, b,b)</span><br><span class="line">    b &lt;&lt;= <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;b &lt;&lt;= 2 的值为 %d,二进制表示：%08b\n&quot;</span>, b,b)</span><br><span class="line">    b &gt;&gt;= <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;b &gt;&gt;= 2 的值为 %d,二进制表示：%08b\n&quot;</span>, b,b)</span><br><span class="line">    b &amp;= <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;b &amp;= 2 的值为 %d,二进制表示：%08b\n&quot;</span>, b,b)</span><br><span class="line">    b ^= <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;b ^= 2 的值为 %d,二进制表示：%08b\n&quot;</span>, b,b)</span><br><span class="line">    b |= <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;b |= 2 的值为 %d,二进制表示：%08b\n&quot;</span>, b,b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运算符优先级</span></span><br><span class="line"><span class="comment">// 1. 一元运算符优先级最高，例如：++ -- ! ^</span></span><br><span class="line"><span class="comment">// 2. 二元运算符优先级从高到低</span></span><br><span class="line"><span class="comment">// */%&lt;&lt;&gt;&gt;&amp;&amp;^</span></span><br><span class="line"><span class="comment">// +-|^</span></span><br><span class="line"><span class="comment">// ==!=&lt;&lt;=&gt;&gt;=</span></span><br><span class="line"><span class="comment">// &amp;&amp;</span></span><br><span class="line"><span class="comment">// ||</span></span><br></pre></td></tr></table></figure><h2 id="Golang-流程控制"><a href="#Golang-流程控制" class="headerlink" title="Golang 流程控制"></a>Golang 流程控制</h2><h3 id="1-if-语句的简短语法"><a href="#1-if-语句的简短语法" class="headerlink" title="1. if 语句的简短语法"></a>1. if 语句的简短语法</h3><p>Go允许在if语句中执行一个简单的语句，然后再进行条件判断。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ifShortStatement</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> x := computeValue(); x &gt; <span class="number">10</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;x is greater than 10&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;x is less than or equal to 10&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// x 的作用域仅限于if-else块内</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">computeValue</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-switch-语句的特殊用法"><a href="#2-switch-语句的特殊用法" class="headerlink" title="2. switch 语句的特殊用法"></a>2. switch 语句的特殊用法</h3><p>Go的switch语句比其他语言更灵活。可以使用表达式，也可以省略表达式。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchExtraCase</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 省略表达式的switch，等同于switch true</span></span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> time.Now().Hour() &lt; <span class="number">12</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Good morning!&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> time.Now().Hour() &lt; <span class="number">17</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Good afternoon!&quot;</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Good evening!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多条件case</span></span><br><span class="line">    <span class="keyword">switch</span> num := <span class="number">15</span>; &#123;</span><br><span class="line">    <span class="keyword">case</span> num &lt; <span class="number">50</span> &amp;&amp; num &gt; <span class="number">10</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Number is between 10 and 50&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> num &lt; <span class="number">100</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;Number is less than 100&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-for-循环的变体"><a href="#3-for-循环的变体" class="headerlink" title="3. for 循环的变体"></a>3. for 循环的变体</h3><p>Go只有for循环，但它可以模拟其他语言的while和do-while循环。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forVariants</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 无限循环</span></span><br><span class="line">    count := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Infinite loop&quot;</span>)</span><br><span class="line">        count++</span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 类似while的循环</span></span><br><span class="line">    n := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n &lt; <span class="number">5</span> &#123;</span><br><span class="line">        fmt.Println(n)</span><br><span class="line">        n++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历通道</span></span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line">    ch &lt;- <span class="number">1</span></span><br><span class="line">    ch &lt;- <span class="number">2</span></span><br><span class="line">    ch &lt;- <span class="number">3</span></span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line">    <span class="keyword">for</span> v := <span class="keyword">range</span> ch &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Channel value:&quot;</span>, v)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-defer-语句"><a href="#4-defer-语句" class="headerlink" title="4. defer 语句"></a>4. defer 语句</h3><p>defer语句用于延迟函数的执行，直到周围的函数返回。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;This will be printed last&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;This will be printed first&quot;</span>)</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;This will be printed second to last&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;This will be printed second&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-panic-和-recover"><a href="#5-panic-和-recover" class="headerlink" title="5. panic 和 recover"></a>5. panic 和 recover</h3><p>panic用于抛出运行时错误，recover用于捕获panic。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">panicAndRecover</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;Recovered from panic:&quot;</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;Something went wrong!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-select-语句"><a href="#6-select-语句" class="headerlink" title="6. select 语句"></a>6. select 语句</h3><p>select用于多路复用，主要用于通道操作。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">selectExample</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">        ch1 &lt;- <span class="string">&quot;one&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">        ch2 &lt;- <span class="string">&quot;two&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> msg1 := &lt;-ch1:</span><br><span class="line">            fmt.Println(<span class="string">&quot;Received&quot;</span>, msg1)</span><br><span class="line">        <span class="keyword">case</span> msg2 := &lt;-ch2:</span><br><span class="line">            fmt.Println(<span class="string">&quot;Received&quot;</span>, msg2)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> _case</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FlowControlCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ifElseCase(<span class="number">0</span>)</span><br><span class="line">    ifElseCase(<span class="number">1</span>)</span><br><span class="line">    ifElseCase(<span class="number">2</span>)</span><br><span class="line">    forCase()</span><br><span class="line">    switchCase(<span class="string">&quot;A&quot;</span>,<span class="number">1</span>)</span><br><span class="line">    switchCase(<span class="string">&quot;C&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    gotoCase()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ifElseCase</span><span class="params">(a <span class="type">int</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;if&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> a == <span class="number">1</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;else if&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;else&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">5</span>&#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(<span class="string">&quot;for i&quot;</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> i <span class="type">int</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> b &#123;</span><br><span class="line">         fmt.Println(<span class="string">&quot;for b&quot;</span>, i)</span><br><span class="line">        i++</span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="number">10</span>&#123;</span><br><span class="line">            b = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    list := []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> index,data := <span class="keyword">range</span> list&#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;index,data := range list&quot;</span>, index , data)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mp := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;A&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;C&quot;</span>: <span class="string">&quot;c&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> key,value := <span class="keyword">range</span> mp&#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;key,value := range mp&quot;</span>, key , value)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    str := <span class="string">&quot;hello&quot;</span></span><br><span class="line">    <span class="keyword">for</span> index,char := <span class="keyword">range</span> str&#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;index,char := range str&quot;</span>, index , <span class="type">string</span>(char))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> j <span class="type">int</span></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;for&quot;</span>, j)</span><br><span class="line">        j++</span><br><span class="line">        <span class="keyword">if</span> j &gt;= <span class="number">10</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">lab1:</span><br><span class="line">    <span class="keyword">for</span> i: = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">2</span>; j++&#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;for i for j&quot;</span>, i , j)</span><br><span class="line">            <span class="keyword">break</span> lab1 </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchCase</span><span class="params">(alpha <span class="type">string</span>, in <span class="keyword">interface</span>&#123;&#125;)</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> alpha&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;A&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;B&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;C&quot;</span>)</span><br><span class="line">        <span class="comment">// 只穿透一次</span></span><br><span class="line">        <span class="keyword">fallthrough</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;E&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;E&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;F&quot;</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;F&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> in.(<span class="keyword">type</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;string&quot;</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;int&quot;</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        fmt.Println(<span class="string">&quot;default&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gotoCase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">0</span></span><br><span class="line">lab1:</span><br><span class="line">    fmt.Println(<span class="string">&quot;goto lab1&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="number">1</span> := <span class="number">0</span>; i &lt;<span class="number">10</span>; i++ &#123;</span><br><span class="line">        a += i</span><br><span class="line">        <span class="keyword">if</span> a == <span class="number">0</span> &#123;</span><br><span class="line">            a += <span class="number">1</span></span><br><span class="line">            <span class="keyword">goto</span> lab1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Golang-泛型编程"><a href="#Golang-泛型编程" class="headerlink" title="Golang 泛型编程"></a>Golang 泛型编程</h2>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Go学习笔记&quot;&gt;&lt;a href=&quot;#Go学习笔记&quot; class=&quot;headerlink&quot; title=&quot;Go学习笔记&quot;&gt;&lt;/a&gt;Go学习笔记&lt;/h1&gt;&lt;h2 id=&quot;编译go-build&quot;&gt;&lt;a href=&quot;#编译go-build&quot; class=&quot;headerlink&quot; title=&quot;编译go build&quot;&gt;&lt;/a&gt;编译go build&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;编译当前目录&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>享元模式</title>
    <link href="https://blog.48626.xyz/ebe318129a30.html"/>
    <id>https://blog.48626.xyz/ebe318129a30.html</id>
    <published>2024-09-19T07:33:37.000Z</published>
    <updated>2024-09-19T07:33:37.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>享元模式</strong>是一种结构型设计模式， 它摒弃了在每个对象中保存所有数据的方式， 通过共享多个对象所共有的相同状态， 让你能在有限的内存容量中载入更多对象。</p><img src="/ebe318129a30/image-20240919145558650.png" class="" alt="image-20240919145558650"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假如你希望在长时间工作后放松一下， 所以开发了一款简单的游戏： 玩家们在地图上移动并相互射击。 你决定实现一个真实的粒子系统， 并将其作为游戏的特色。 大量的子弹、 导弹和爆炸弹片会在整个地图上穿行， 为玩家提供紧张刺激的游戏体验。</p><p>开发完成后， 你推送提交了最新版本的程序， 并在编译游戏后将其发送给了一个朋友进行测试。 尽管该游戏在你的电脑上完美运行， 但是你的朋友却无法长时间进行游戏： 游戏总是会在他的电脑上运行几分钟后崩溃。 在研究了几个小时的调试消息记录后， 你发现导致游戏崩溃的原因是内存容量不足。 朋友的设备性能远比不上你的电脑， 因此游戏运行在他的电脑上时很快就会出现问题。</p><p>真正的问题与粒子系统有关。 每个粒子 （一颗子弹、 一枚导弹或一块弹片） 都由包含完整数据的独立对象来表示。 当玩家在游戏中鏖战进入高潮后的某一时刻， 游戏将无法在剩余内存中载入新建粒子， 于是程序就崩溃了。</p><img src="/ebe318129a30/image-20240919150031919.png" class="" alt="image-20240919150031919"><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>仔细观察 <code>粒子</code>Particle类， 你可能会注意到颜色 （color） 和精灵图 （sprite）这两个成员变量所消耗的内存要比其他变量多得多。 更糟糕的是， 对于所有的粒子来说， 这两个成员变量所存储的数据几乎完全一样 （比如所有子弹的颜色和精灵图都一样）。</p><img src="/ebe318129a30/image-20240919150051622.png" class="" alt="image-20240919150051622"><p>每个粒子的另一些状态 （坐标、 移动矢量和速度） 则是不同的。 因为这些成员变量的数值会不断变化。 这些数据代表粒子在存续期间不断变化的情景， 但每个粒子的颜色和精灵图则会保持不变。</p><p>对象的常量数据通常被称为<em>内在状态</em>， 其位于对象中， 其他对象只能读取但不能修改其数值。 而对象的其他状态常常能被其他对象 “从外部” 改变， 因此被称为<em>外在状态</em>。</p><p>享元模式建议不在对象中存储外在状态， 而是将其传递给依赖于它的一个特殊方法。 程序只在对象中保存内在状态， 以方便在不同情景下重用。 这些对象的区别仅在于其内在状态 （与外在状态相比， 内在状态的变体要少很多）， 因此你所需的对象数量会大大削减。</p><img src="/ebe318129a30/image-20240919150109955.png" class="" alt="image-20240919150109955"><p>让我们回到游戏中。 假如能从粒子类中抽出外在状态， 那么我们只需三个不同的对象 （子弹、 导弹和弹片） 就能表示游戏中的所有粒子。 你现在很可能已经猜到了， 我们将这样一个仅存储内在状态的对象称为享元。</p><h3 id="外在状态存储"><a href="#外在状态存储" class="headerlink" title="外在状态存储"></a>外在状态存储</h3><p>那么外在状态会被移动到什么地方呢？ 总得有类来存储它们， 对不对？ 在大部分情况中， 它们会被移动到容器对象中， 也就是我们应用享元模式前的聚合对象中。</p><p>在我们的例子中， 容器对象就是主要的 <code>游戏</code>Game对象， 其会将所有粒子存储在名为 <code>粒子</code>particles的成员变量中。 为了能将外在状态移动到这个类中， 你需要创建多个数组成员变量来存储每个粒子的坐标、 方向矢量和速度。 除此之外， 你还需要另一个数组来存储指向代表粒子的特定享元的引用。 这些数组必须保持同步， 这样你才能够使用同一索引来获取关于某个粒子的所有数据。</p><img src="/ebe318129a30/image-20240919150138887.png" class="" alt="image-20240919150138887"><p>更优雅的解决方案是创建独立的情景类来存储外在状态和对享元对象的引用。 在该方法中， 容器类只需包含一个数组。</p><p>稍等！ 这样的话情景对象数量不是会和不采用该模式时的对象数量一样多吗？ 的确如此， 但这些对象要比之前小很多。 消耗内存最多的成员变量已经被移动到很少的几个享元对象中了。 现在， 一个享元大对象会被上千个情境小对象复用， 因此无需再重复存储数千个大对象的数据。</p><h3 id="享元与不可变性"><a href="#享元与不可变性" class="headerlink" title="享元与不可变性"></a>享元与不可变性</h3><p>由于享元对象可在不同的情景中使用， 你必须确保其状态不能被修改。 享元类的状态只能由构造函数的参数进行一次性初始化， 它不能对其他对象公开其设置器或公有成员变量。</p><h3 id="享元工厂"><a href="#享元工厂" class="headerlink" title="享元工厂"></a>享元工厂</h3><p>为了能更方便地访问各种享元， 你可以创建一个工厂方法来管理已有享元对象的缓存池。 工厂方法从客户端处接收目标享元对象的内在状态作为参数， 如果它能在缓存池中找到所需享元， 则将其返回给客户端； 如果没有找到， 它就会新建一个享元， 并将其添加到缓存池中。</p><p>你可以选择在程序的不同地方放入该函数。 最简单的选择就是将其放置在享元容器中。 除此之外， 你还可以新建一个工厂类， 或者创建一个静态的工厂方法并将其放入实际的享元类中。</p><h2 id="享元模式结构"><a href="#享元模式结构" class="headerlink" title="享元模式结构"></a>享元模式结构</h2><img src="/ebe318129a30/image-20240919150250673.png" class="" alt="image-20240919150250673"><ol><li>享元模式只是一种优化。 在应用该模式之前， 你要确定程序中存在与大量类似对象同时占用内存相关的内存消耗问题， 并且确保该问题无法使用其他更好的方式来解决。</li><li><strong>享元</strong> （Flyweight） 类包含原始对象中部分能在多个对象中共享的状态。 同一享元对象可在许多不同情景中使用。 享元中存储的状态被称为 “内在状态”。 传递给享元方法的状态被称为 “外在状态”。</li><li><strong>情景</strong> （Context） 类包含原始对象中各不相同的外在状态。 情景与享元对象组合在一起就能表示原始对象的全部状态。</li><li>通常情况下， 原始对象的行为会保留在享元类中。 因此调用享元方法必须提供部分外在状态作为参数。 但你也可将行为移动到情景类中， 然后将连入的享元作为单纯的数据对象。</li><li><strong>客户端</strong> （Client） 负责计算或存储享元的外在状态。 在客户端看来， 享元是一种可在运行时进行配置的模板对象， 具体的配置方式为向其方法中传入一些情景数据参数。</li><li><strong>享元工厂</strong> （Flyweight Factory） 会对已有享元的缓存池进行管理。 有了工厂后， 客户端就无需直接创建享元， 它们只需调用工厂并向其传递目标享元的一些内在状态即可。 工厂会根据参数在之前已创建的享元中进行查找， 如果找到满足条件的享元就将其返回； 如果没有找到就根据参数新建享元。</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>在本例中， <strong>享元</strong>模式能有效减少在画布上渲染数百万个树状对象时所需的内存。</p><img src="/ebe318129a30/image-20240919151022603.png" class="" alt="image-20240919151022603"><p>该模式从主要的 <code>树</code>Tree类中抽取内在状态， 并将其移动到享元类 <code>树种类</code>Tree­Type之中。</p><p>最初程序需要在多个对象中存储相同数据， 而现在仅需在几个享元对象中保存数据， 然后在作为情景的 <code>树</code>对象中连入享元即可。 客户端代码使用享元工厂创建树对象并封装搜索指定对象的复杂行为， 并能在需要时复用对象。</p><h3 id="trees"><a href="#trees" class="headerlink" title="trees"></a><strong>trees</strong></h3><h4 id="trees-Tree-java-包含每棵树的独特状态"><a href="#trees-Tree-java-包含每棵树的独特状态" class="headerlink" title="trees&#x2F;Tree.java: 包含每棵树的独特状态"></a><strong>trees&#x2F;Tree.java:</strong> 包含每棵树的独特状态</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.trees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 包含每棵树的独特状态</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 下午3:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tree</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">private</span> TreeType type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Tree</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, TreeType type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">        <span class="built_in">this</span>.y = y;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(Graphics g)</span> &#123;</span><br><span class="line">        type.draw(g, x, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="trees-TreeType-java-包含多棵树共享的状态"><a href="#trees-TreeType-java-包含多棵树共享的状态" class="headerlink" title="trees&#x2F;TreeType.java: 包含多棵树共享的状态"></a><strong>trees&#x2F;TreeType.java:</strong> 包含多棵树共享的状态</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.trees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 包含多棵树共享的状态</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 下午3:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeType</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Color color;</span><br><span class="line">    <span class="keyword">private</span> String otherTreeData;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TreeType</span><span class="params">(String name, Color color, String otherTreeData)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">        <span class="built_in">this</span>.otherTreeData = otherTreeData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(Graphics g, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        g.setColor(Color.BLACK);</span><br><span class="line">        g.fillRect(x - <span class="number">1</span>, y, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">        g.setColor(color);</span><br><span class="line">        g.fillOval(x - <span class="number">5</span>, y - <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="trees-TreeFactory-java-封装创建享元的复杂机制"><a href="#trees-TreeFactory-java-封装创建享元的复杂机制" class="headerlink" title="trees&#x2F;TreeFactory.java: 封装创建享元的复杂机制"></a><strong>trees&#x2F;TreeFactory.java:</strong> 封装创建享元的复杂机制</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.trees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装创建享元的复杂机制</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 下午3:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeFactory</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> Map&lt;String, TreeType&gt; treeTypes = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TreeType <span class="title function_">getTreeType</span><span class="params">(String name, Color color, String otherTreeData)</span> &#123;</span><br><span class="line">        <span class="type">TreeType</span> <span class="variable">result</span> <span class="operator">=</span> treeTypes.get(name);</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">            result = <span class="keyword">new</span> <span class="title class_">TreeType</span>(name, color, otherTreeData);</span><br><span class="line">            treeTypes.put(name, result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="forest"><a href="#forest" class="headerlink" title="forest"></a><strong>forest</strong></h3><h4 id="forest-Forest-java-我们绘制的森林"><a href="#forest-Forest-java-我们绘制的森林" class="headerlink" title="forest&#x2F;Forest.java: 我们绘制的森林"></a><strong>forest&#x2F;Forest.java:</strong> 我们绘制的森林</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.forest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.trees.Tree;</span><br><span class="line"><span class="keyword">import</span> org.example.trees.TreeFactory;</span><br><span class="line"><span class="keyword">import</span> org.example.trees.TreeType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我们绘制的森林</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 下午3:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Forest</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Tree&gt; trees = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">plantTree</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, String name, Color color, String otherTreeData)</span> &#123;</span><br><span class="line">        <span class="type">TreeType</span> <span class="variable">type</span> <span class="operator">=</span> TreeFactory.getTreeType(name, color, otherTreeData);</span><br><span class="line">        <span class="type">Tree</span> <span class="variable">tree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tree</span>(x, y, type);</span><br><span class="line">        trees.add(tree);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Tree tree : trees) &#123;</span><br><span class="line">            tree.draw(graphics);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Main-java-客户端代码"><a href="#Main-java-客户端代码" class="headerlink" title="Main.java: 客户端代码"></a><strong>Main.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.forest.Forest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 下午2:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">CANVAS_SIZE</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">TREES_TO_DRAW</span> <span class="operator">=</span> <span class="number">1000000</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">TREE_TYPES</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="type">Forest</span> <span class="variable">forest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Forest</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Math.floor(TREES_TO_DRAW / TREE_TYPES); i++) &#123;</span><br><span class="line">            forest.plantTree(random(<span class="number">0</span>, CANVAS_SIZE), random(<span class="number">0</span>, CANVAS_SIZE),</span><br><span class="line">                    <span class="string">&quot;Summer Oak&quot;</span>, Color.GREEN, <span class="string">&quot;Oak texture stub&quot;</span>);</span><br><span class="line">            forest.plantTree(random(<span class="number">0</span>, CANVAS_SIZE), random(<span class="number">0</span>, CANVAS_SIZE),</span><br><span class="line">                    <span class="string">&quot;Autumn Oak&quot;</span>, Color.ORANGE, <span class="string">&quot;Autumn Oak texture stub&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        forest.setSize(CANVAS_SIZE, CANVAS_SIZE);</span><br><span class="line">        forest.setVisible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(TREES_TO_DRAW + <span class="string">&quot; trees drawn&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Memory usage:&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Tree size (8 bytes) * &quot;</span> + TREES_TO_DRAW);</span><br><span class="line">        System.out.println(<span class="string">&quot;+ TreeTypes size (~30 bytes) * &quot;</span> + TREE_TYPES + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Total: &quot;</span> + ((TREES_TO_DRAW * <span class="number">8</span> + TREE_TYPES * <span class="number">30</span>) / <span class="number">1024</span> / <span class="number">1024</span>) +</span><br><span class="line">                <span class="string">&quot;MB (instead of &quot;</span> + ((TREES_TO_DRAW * <span class="number">38</span>) / <span class="number">1024</span> / <span class="number">1024</span>) + <span class="string">&quot;MB)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">random</span><span class="params">(<span class="type">int</span> min, <span class="type">int</span> max)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> min + (<span class="type">int</span>) (Math.random() * ((max - min) + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="享元模式适合应用场景"><a href="#享元模式适合应用场景" class="headerlink" title="享元模式适合应用场景"></a>享元模式适合应用场景</h2><p> <strong>仅在程序必须支持大量对象且没有足够的内存容量时使用享元模式。</strong></p><p> 应用该模式所获的收益大小取决于使用它的方式和情景。 它在下列情况中最有效：</p><ul><li>程序需要生成数量巨大的相似对象</li><li>这将耗尽目标设备的所有内存</li><li>对象中包含可抽取且能在多个对象间共享的重复状态。</li></ul><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li>将需要改写为享元的类成员变量拆分为两个部分：<ul><li>内在状态： 包含不变的、 可在许多对象中重复使用的数据的成员变量。</li><li>外在状态： 包含每个对象各自不同的情景数据的成员变量</li></ul></li><li>保留类中表示内在状态的成员变量， 并将其属性设置为不可修改。 这些变量仅可在构造函数中获得初始数值。</li><li>找到所有使用外在状态成员变量的方法， 为在方法中所用的每个成员变量新建一个参数， 并使用该参数代替成员变量。</li><li>你可以有选择地创建工厂类来管理享元缓存池， 它负责在新建享元时检查已有的享元。 如果选择使用工厂， 客户端就只能通过工厂来请求享元， 它们需要将享元的内在状态作为参数传递给工厂。</li><li>客户端必须存储和计算外在状态 （情景） 的数值， 因为只有这样才能调用享元对象的方法。 为了使用方便， 外在状态和引用享元的成员变量可以移动到单独的情景类中。</li></ol><h2 id="享元模式优缺点"><a href="#享元模式优缺点" class="headerlink" title="享元模式优缺点"></a>享元模式优缺点</h2><p>优点：</p><ul><li>如果程序中有很多相似对象， 那么你将可以节省大量内存。</li></ul><p>缺点：</p><ul><li>你可能需要牺牲执行速度来换取内存， 因为他人每次调用享元方法时都需要重新计算部分情景数据。</li><li>代码会变得更加复杂。 团队中的新成员总是会问：  “为什么要像这样拆分一个实体的状态？”。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>你可以使用享元模式实现组合模式树的共享叶节点以节省内存。</li><li>享元展示了如何生成大量的小型对象，外观模式则展示了如何用一个对象来代表整个子系统。</li><li>如果你能将对象的所有共享状态简化为一个享元对象，那么享元就和单例模式类似了。但这两个模式有两个根本性的不同。<ol><li>只会有一个单例实体， 但是<em>享元</em>类可以有多个实体， 各实体的内在状态也可以不同。</li><li><em>单例</em>对象可以是可变的。 享元对象是不可变的。</li></ol></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;享元模式&quot;&gt;&lt;a href=&quot;#享元模式&quot; class=&quot;headerlink&quot; title=&quot;享元模式&quot;&gt;&lt;/a&gt;享元模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;享元模式&lt;/strong&gt;是一种结构型设计模式， 它摒弃了在每个对象中保存所有数据的方式， 通过共享多个对象所共有的相同状态， 让你能在有限的内存容量中载入更多对象。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="享元模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="享元模式" scheme="https://blog.48626.xyz/tags/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>外观模式</title>
    <link href="https://blog.48626.xyz/27c62a80157e.html"/>
    <id>https://blog.48626.xyz/27c62a80157e.html</id>
    <published>2024-09-19T03:59:31.000Z</published>
    <updated>2024-09-19T03:59:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>外观模式</strong>是一种结构型设计模式， 能为程序库、 框架或其他复杂类提供一个简单的接口。</p><img src="/27c62a80157e/image-20240919114501146.png" class="" alt="image-20240919114501146"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假设你必须在代码中使用某个复杂的库或框架中的众多对象。 正常情况下， 你需要负责所有对象的初始化工作、 管理其依赖关系并按正确的顺序执行方法等。</p><p>最终， 程序中类的业务逻辑将与第三方类的实现细节紧密耦合， 使得理解和维护代码的工作很难进行。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>外观类为包含许多活动部件的复杂子系统提供一个简单的接口。 与直接调用子系统相比， 外观提供的功能可能比较有限， 但它却包含了客户端真正关心的功能。</p><p>如果你的程序需要与包含几十种功能的复杂库整合， 但只需使用其中非常少的功能， 那么使用外观模式会非常方便，</p><p>例如， 上传猫咪搞笑短视频到社交媒体网站的应用可能会用到专业的视频转换库， 但它只需使用一个包含 <code>encode­(filename, format)</code>方法 （以文件名与文件格式为参数进行编码的方法） 的类即可。 在创建这个类并将其连接到视频转换库后， 你就拥有了自己的第一个外观。</p><h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><img src="/27c62a80157e/image-20240919114533703.png" class="" alt="电话购物。"><p>当你通过电话给商店下达订单时， 接线员就是该商店的所有服务和部门的外观。 接线员为你提供了一个同购物系统、 支付网关和各种送货服务进行互动的简单语音接口。</p><h2 id="外观模式结构"><a href="#外观模式结构" class="headerlink" title="外观模式结构"></a>外观模式结构</h2><img src="/27c62a80157e/image-20240919114557340.png" class="" alt="image-20240919114557340"><ol><li><p><strong>外观</strong> （Facade） 提供了一种访问特定子系统功能的便捷方式， 其了解如何重定向客户端请求， 知晓如何操作一切活动部件。</p></li><li><p>创建<strong>附加外观</strong> （Additional Facade） 类可以避免多种不相关的功能污染单一外观， 使其变成又一个复杂结构。 客户端和其他外观都可使用附加外观。</p></li><li><p><strong>复杂子系统</strong> （Complex Subsystem） 由数十个不同对象构成。 如果要用这些对象完成有意义的工作， 你必须深入了解子系统的实现细节， 比如按照正确顺序初始化对象和为其提供正确格式的数据。</p><p>子系统类不会意识到外观的存在， 它们在系统内运作并且相互之间可直接进行交互。</p></li><li><p><strong>客户端</strong> （Client） 使用外观代替对子系统对象的直接调用。</p></li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>在本例中， <strong>外观</strong>模式简化了客户端与复杂视频转换框架之间的交互。</p><img src="/27c62a80157e/image-20240919114642525.png" class="" alt="使用单个外观类隔离多重依赖的示例"><p>你可以创建一个封装所需功能并隐藏其他代码的外观类， 从而无需使全部代码直接与数十个框架类进行交互。 该结构还能将未来框架升级或更换所造成的影响最小化， 因为你只需修改程序中外观方法的实现即可。</p><h3 id="some-complex-media-library-复杂视频转换程序库"><a href="#some-complex-media-library-复杂视频转换程序库" class="headerlink" title="some_complex_media_library: 复杂视频转换程序库"></a><strong>some_complex_media_library:</strong> 复杂视频转换程序库</h3><h4 id="some-complex-media-library-VideoFile-java"><a href="#some-complex-media-library-VideoFile-java" class="headerlink" title="some_complex_media_library&#x2F;VideoFile.java"></a><strong>some_complex_media_library&#x2F;VideoFile.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.some_complex_media_library;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoFile</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String codecType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VideoFile</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.codecType = name.substring(name.indexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCodecType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> codecType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="some-complex-media-library-Codec-java"><a href="#some-complex-media-library-Codec-java" class="headerlink" title="some_complex_media_library&#x2F;Codec.java"></a><strong>some_complex_media_library&#x2F;Codec.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.some_complex_media_library;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Codec</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="some-complex-media-library-MPEG4CompressionCodec-java"><a href="#some-complex-media-library-MPEG4CompressionCodec-java" class="headerlink" title="some_complex_media_library&#x2F;MPEG4CompressionCodec.java"></a><strong>some_complex_media_library&#x2F;MPEG4CompressionCodec.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.some_complex_media_library;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MPEG4CompressionCodec</span> <span class="keyword">implements</span> <span class="title class_">Codec</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;mp4&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="some-complex-media-library-OggCompressionCodec-java"><a href="#some-complex-media-library-OggCompressionCodec-java" class="headerlink" title="some_complex_media_library&#x2F;OggCompressionCodec.java"></a><strong>some_complex_media_library&#x2F;OggCompressionCodec.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.some_complex_media_library;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OggCompressionCodec</span> <span class="keyword">implements</span> <span class="title class_">Codec</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;ogg&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="some-complex-media-library-CodecFactory-java"><a href="#some-complex-media-library-CodecFactory-java" class="headerlink" title="some_complex_media_library&#x2F;CodecFactory.java"></a><strong>some_complex_media_library&#x2F;CodecFactory.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.some_complex_media_library;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodecFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Codec <span class="title function_">extract</span><span class="params">(VideoFile file)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> file.getCodecType();</span><br><span class="line">        <span class="keyword">if</span> (type.equals(<span class="string">&quot;mp4&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;CodecFactory: 提取音频...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MPEG4CompressionCodec</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;CodecFactory: 提取ogg音频...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OggCompressionCodec</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="some-complex-media-library-BitrateReader-java"><a href="#some-complex-media-library-BitrateReader-java" class="headerlink" title="some_complex_media_library&#x2F;BitrateReader.java"></a><strong>some_complex_media_library&#x2F;BitrateReader.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.some_complex_media_library;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BitrateReader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> VideoFile <span class="title function_">read</span><span class="params">(VideoFile file, Codec codec)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BitrateReader: 读取文件...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> file;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> VideoFile <span class="title function_">convert</span><span class="params">(VideoFile buffer, Codec codec)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BitrateReader: 写入文件...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> buffer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="some-complex-media-library-AudioMixer-java"><a href="#some-complex-media-library-AudioMixer-java" class="headerlink" title="some_complex_media_library&#x2F;AudioMixer.java"></a><strong>some_complex_media_library&#x2F;AudioMixer.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.some_complex_media_library;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AudioMixer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> File <span class="title function_">fix</span><span class="params">(VideoFile result)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AudioMixer: 修复音频...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;tmp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="facade"><a href="#facade" class="headerlink" title="facade"></a><strong>facade</strong></h3><h4 id="facade-VideoConversionFacade-java-外观提供了进行视频转换的简单接口"><a href="#facade-VideoConversionFacade-java-外观提供了进行视频转换的简单接口" class="headerlink" title="facade&#x2F;VideoConversionFacade.java: 外观提供了进行视频转换的简单接口"></a><strong>facade&#x2F;VideoConversionFacade.java:</strong> 外观提供了进行视频转换的简单接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.facade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.some_complex_media_library.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 外观提供了进行视频转换的简单接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoConversionFacade</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> File <span class="title function_">convertVideo</span><span class="params">(String fileName, String format)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;VideoConversionFacade: 转换已开始。&quot;</span>);</span><br><span class="line">        <span class="type">VideoFile</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoFile</span>(fileName);</span><br><span class="line">        <span class="type">Codec</span> <span class="variable">sourceCodec</span> <span class="operator">=</span> CodecFactory.extract(file);</span><br><span class="line">        Codec destinationCodec;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;mp4&quot;</span>.equals(format)) &#123;</span><br><span class="line">            destinationCodec = <span class="keyword">new</span> <span class="title class_">MPEG4CompressionCodec</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            destinationCodec = <span class="keyword">new</span> <span class="title class_">OggCompressionCodec</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">VideoFile</span> <span class="variable">buffer</span> <span class="operator">=</span> BitrateReader.read(file, sourceCodec);</span><br><span class="line">        <span class="type">VideoFile</span> <span class="variable">intermediateResult</span> <span class="operator">=</span> BitrateReader.convert(buffer, destinationCodec);</span><br><span class="line">        <span class="type">File</span> <span class="variable">result</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">AudioMixer</span>()).fix(intermediateResult);</span><br><span class="line">        System.out.println(<span class="string">&quot;VideoConversionFacade: 转换已完成。&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Main-java-客户端代码"><a href="#Main-java-客户端代码" class="headerlink" title="Main.java: 客户端代码"></a><strong>Main.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.facade.VideoConversionFacade;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/19 上午11:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VideoConversionFacade</span> <span class="variable">converter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VideoConversionFacade</span>();</span><br><span class="line">        <span class="type">File</span> <span class="variable">mp4Video</span> <span class="operator">=</span> converter.convertVideo(<span class="string">&quot;youtubevideo.ogg&quot;</span>, <span class="string">&quot;mp4&quot;</span>);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="外观模式适合应用场景"><a href="#外观模式适合应用场景" class="headerlink" title="外观模式适合应用场景"></a>外观模式适合应用场景</h2><p><strong>如果你需要一个指向复杂子系统的直接接口，且该接口的功能有限，则可以使用外观模式。</strong></p><p>子系统通常会随着时间的推进变得越来越复杂。 即便是应用了设计模式， 通常你也会创建更多的类。 尽管在多种情形中子系统可能是更灵活或易于复用的， 但其所需的配置和样板代码数量将会增长得更快。 为了解决这个问题， 外观将会提供指向子系统中最常用功能的快捷方式， 能够满足客户端的大部分需求。</p><p><strong>如果需要将子系统组织为多层结构，可以使用外观。</strong></p><p>创建外观来定义子系统中各层次的入口。 你可以要求子系统仅使用外观来进行交互， 以减少子系统之间的耦合。</p><p>让我们回到视频转换框架的例子。 该框架可以拆分为两个层次： 音频相关和视频相关。 你可以为每个层次创建一个外观， 然后要求各层的类必须通过这些外观进行交互。 这种方式看上去与中介者模式非常相似。</p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li>考虑能否在现有子系统的基础上提供一个更简单的接口。 如果该接口能让客户端代码独立于众多子系统类， 那么你的方向就是正确的。</li><li>在一个新的外观类中声明并实现该接口。 外观应将客户端代码的调用重定向到子系统中的相应对象处。 如果客户端代码没有对子系统进行初始化， 也没有对其后续生命周期进行管理， 那么外观必须完成此类工作。</li><li>如果要充分发挥这一模式的优势， 你必须确保所有客户端代码仅通过外观来与子系统进行交互。 此后客户端代码将不会受到任何由子系统代码修改而造成的影响， 比如子系统升级后， 你只需修改外观中的代码即可。</li><li>如果外观变得过于臃肿， 你可以考虑将其部分行为抽取为一个新的专用外观类。</li></ol><h2 id="外观模式优缺点"><a href="#外观模式优缺点" class="headerlink" title="外观模式优缺点"></a>外观模式优缺点</h2><p>优点：</p><ul><li>你可以让自己的代码独立于复杂子系统。</li></ul><p>缺点：</p><ul><li>外观可能成为与程序中所有类都耦合的上帝对象。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>外观模式为现有对象定义了一个新接口， 适配器模式则会试图运用已有的接口。 <em>适配器</em>通常只封装一个对象， <em>外观</em>通常会作用于整个对象子系统上。</li><li>当只需对客户端代码隐藏子系统创建对象的方式时， 你可以使用抽象工厂模式来代替外观。</li><li>享元模式展示了如何生成大量的小型对象， 外观则展示了如何用一个对象来代表整个子系统。</li><li>外观和中介者模式的职责类似：它们都尝试在大量紧密耦合的类中组织起合作。<ul><li><em>外观</em>为子系统中的所有对象定义了一个简单接口， 但是它不提供任何新功能。 子系统本身不会意识到外观的存在。 子系统中的对象可以直接进行交流。</li><li><em>中介者</em>将系统中组件的沟通行为中心化。 各组件只知道中介者对象， 无法直接相互交流。</li></ul></li><li>外观类通常可以转换为单例模式类， 因为在大部分情况下一个外观对象就足够了。</li><li>外观与代理模式的相似之处在于它们都缓存了一个复杂实体并自行对其进行初始化。 <em>代理</em>与其服务对象遵循同一接口， 使得自己和服务对象可以互换， 在这一点上它与<em>外观</em>不同。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;外观模式&quot;&gt;&lt;a href=&quot;#外观模式&quot; class=&quot;headerlink&quot; title=&quot;外观模式&quot;&gt;&lt;/a&gt;外观模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;外观模式&lt;/strong&gt;是一种结构型设计模式， 能为程序库、 框架或其他复杂类提供一个简单的接口。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="外观模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="外观模式" scheme="https://blog.48626.xyz/tags/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>装饰模式</title>
    <link href="https://blog.48626.xyz/1e0942ba54aa.html"/>
    <id>https://blog.48626.xyz/1e0942ba54aa.html</id>
    <published>2024-09-19T02:50:21.000Z</published>
    <updated>2024-09-19T02:50:21.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="装饰模式"><a href="#装饰模式" class="headerlink" title="装饰模式"></a>装饰模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>装饰模式</strong>是一种结构型设计模式， 允许你通过将对象放入包含行为的特殊封装对象中来为原对象绑定新的行为。</p><img src="/1e0942ba54aa/image-20240918175329163.png" class="" alt="image-20240918175329163"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假设你正在开发一个提供通知功能的库， 其他程序可使用它向用户发送关于重要事件的通知。</p><p>库的最初版本基于 <code>通知器</code>Notifier类， 其中只有很少的几个成员变量， 一个构造函数和一个 <code>send</code>发送方法。 该方法可以接收来自客户端的消息参数， 并将该消息发送给一系列的邮箱， 邮箱列表则是通过构造函数传递给通知器的。 作为客户端的第三方程序仅会创建和配置通知器对象一次， 然后在有重要事件发生时对其进行调用。</p><img src="/1e0942ba54aa/image-20240918175349098.png" class="" alt="程序可以使用通知器类向预定义的邮箱发送重要事件通知。"><p>此后某个时刻， 你会发现库的用户希望使用除邮件通知之外的功能。 许多用户会希望接收关于紧急事件的手机短信， 还有些用户希望在微信上接收消息， 而公司用户则希望在 QQ 上接收消息。</p><img src="/1e0942ba54aa/image-20240918175415164.png" class="" alt="每种通知类型都将作为通知器的一个子类得以实现。"><p>这有什么难的呢？ 首先扩展 <code>通知器</code>类， 然后在新的子类中加入额外的通知方法。 现在客户端要对所需通知形式的对应类进行初始化， 然后使用该类发送后续所有的通知消息。</p><p>但是很快有人会问：  “为什么不同时使用多种通知形式呢？ 如果房子着火了， 你大概会想在所有渠道中都收到相同的消息吧。”</p><p>你可以尝试创建一个特殊子类来将多种通知方法组合在一起以解决该问题。 但这种方式会使得代码量迅速膨胀， 不仅仅是程序库代码， 客户端代码也会如此。</p><img src="/1e0942ba54aa/image-20240918175436465.png" class="" alt="子类组合数量爆炸。"><p>你必须找到其他方法来规划通知类的结构， 否则它们的数量会在不经意之间打破吉尼斯纪录。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>当你需要更改一个对象的行为时， 第一个跳入脑海的想法就是扩展它所属的类。 但是， 你不能忽视继承可能引发的几个严重问题。</p><ul><li>继承是静态的。 你无法在运行时更改已有对象的行为， 只能使用由不同子类创建的对象来替代当前的整个对象。</li><li>子类只能有一个父类。 大部分编程语言不允许一个类同时继承多个类的行为。</li></ul><p>其中一种方法是用<em>聚合</em>或<em>组合</em> ， 而不是<em>继承</em>。 两者的工作方式几乎一模一样： 一个对象<em>包含</em>指向另一个对象的引用， 并将部分工作委派给引用对象； 继承中的对象则继承了父类的行为， 它们自己<em>能够</em>完成这些工作。</p><p>你可以使用这个新方法来轻松替换各种连接的 “小帮手” 对象， 从而能在运行时改变容器的行为。 一个对象可以使用多个类的行为， 包含多个指向其他对象的引用， 并将各种工作委派给引用对象。 聚合 （或组合） 组合是许多设计模式背后的关键原则 （包括装饰在内）。 记住这一点后， 让我们继续关于模式的讨论。</p><img src="/1e0942ba54aa/image-20240918175503959.png" class="" alt="继承与聚合的对比"><p><em>封装器</em>是装饰模式的别称， 这个称谓明确地表达了该模式的主要思想。  “封装器” 是一个能与其他 “目标” 对象连接的对象。 封装器包含与目标对象相同的一系列方法， 它会将所有接收到的请求委派给目标对象。 但是， 封装器可以在将请求委派给目标前后对其进行处理， 所以可能会改变最终结果。</p><p>那么什么时候一个简单的封装器可以被称为是真正的装饰呢？ 正如之前提到的， 封装器实现了与其封装对象相同的接口。 因此从客户端的角度来看， 这些对象是完全一样的。 封装器中的引用成员变量可以是遵循相同接口的任意对象。 这使得你可以将一个对象放入多个封装器中， 并在对象中添加所有这些封装器的组合行为。</p><p>比如在消息通知示例中， 我们可以将简单邮件通知行为放在基类 <code>通知器</code>中， 但将所有其他通知方法放入装饰中。</p><img src="/1e0942ba54aa/image-20240918175527116.png" class="" alt="将各种通知方法放入装饰。"><p>客户端代码必须将基础通知器放入一系列自己所需的装饰中。 因此最后的对象将形成一个栈结构。</p><img src="/1e0942ba54aa/image-20240918175614220.png" class="" alt="程序可以配置由通知装饰构成的复杂栈。"><p>实际与客户端进行交互的对象将是最后一个进入栈中的装饰对象。 由于所有的装饰都实现了与通知基类相同的接口， 客户端的其他代码并不在意自己到底是与 “纯粹” 的通知器对象， 还是与装饰后的通知器对象进行交互。</p><p>我们可以使用相同方法来完成其他行为 （例如设置消息格式或者创建接收人列表）。 只要所有装饰都遵循相同的接口， 客户端就可以使用任意自定义的装饰来装饰对象。</p><h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><img src="/1e0942ba54aa/image-20240918175652587.png" class="" alt="穿上多件衣服将获得组合性的效果。"><p>穿衣服是使用装饰的一个例子。 觉得冷时， 你可以穿一件毛衣。 如果穿毛衣还觉得冷， 你可以再套上一件夹克。 如果遇到下雨， 你还可以再穿一件雨衣。 所有这些衣物都 “扩展” 了你的基本行为， 但它们并不是你的一部分， 如果你不再需要某件衣物， 可以方便地随时脱掉。</p><h2 id="装饰模式结构"><a href="#装饰模式结构" class="headerlink" title="装饰模式结构"></a>装饰模式结构</h2><img src="/1e0942ba54aa/image-20240918175728317.png" class="" alt="image-20240918175728317"><ol><li><strong>部件</strong> （Component） 声明封装器和被封装对象的公用接口。</li><li><strong>具体部件</strong> （Concrete Component） 类是被封装对象所属的类。 它定义了基础行为， 但装饰类可以改变这些行为。</li><li><strong>基础装饰</strong> （Base Decorator） 类拥有一个指向被封装对象的引用成员变量。 该变量的类型应当被声明为通用部件接口， 这样它就可以引用具体的部件和装饰。 装饰基类会将所有操作委派给被封装的对象。</li><li><strong>具体装饰类</strong> （Concrete Decorators） 定义了可动态添加到部件的额外行为。 具体装饰类会重写装饰基类的方法， 并在调用父类方法之前或之后进行额外的行为。</li><li><strong>客户端</strong> （Client） 可以使用多层装饰来封装部件， 只要它能使用通用接口与所有对象互动即可。</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>在本例中， <strong>装饰</strong>模式能够对敏感数据进行压缩和加密， 从而将数据从使用数据的代码中独立出来。</p><img src="/1e0942ba54aa/image-20240918175829607.png" class="" alt="加密和压缩装饰的示例。"><p>程序使用一对装饰来封装数据源对象。 这两个封装器都改变了从磁盘读写数据的方式：</p><ul><li>当数据即将被<strong>写入磁盘</strong>前， 装饰对数据进行加密和压缩。 在原始类对改变毫无察觉的情况下， 将加密后的受保护数据写入文件。</li><li>当数据刚<strong>从磁盘读出</strong>后， 同样通过装饰对数据进行解压和解密。</li></ul><p>装饰和数据源类实现同一接口， 从而能在客户端代码中相互替换。</p><h3 id="decorators"><a href="#decorators" class="headerlink" title="decorators"></a><strong>decorators</strong></h3><h4 id="decorators-DataSource-java-定义了读取和写入操作的通用数据接口"><a href="#decorators-DataSource-java-定义了读取和写入操作的通用数据接口" class="headerlink" title="decorators&#x2F;DataSource.java: 定义了读取和写入操作的通用数据接口"></a><strong>decorators&#x2F;DataSource.java:</strong> 定义了读取和写入操作的通用数据接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.decorators;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义了读取和写入操作的通用数据接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午5:59</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(String data)</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">readData</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="decorators-FileDataSource-java-简单数据读写器"><a href="#decorators-FileDataSource-java-简单数据读写器" class="headerlink" title="decorators&#x2F;FileDataSource.java: 简单数据读写器"></a><strong>decorators&#x2F;FileDataSource.java:</strong> 简单数据读写器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.decorators;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单数据读写器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午5:59</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDataSource</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FileDataSource</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(name);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file)) &#123;</span><br><span class="line">            fos.write(data.getBytes(), <span class="number">0</span>, data.length());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            System.out.println(ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] buffer = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(name);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(file)) &#123;</span><br><span class="line">            buffer = <span class="keyword">new</span> <span class="title class_">char</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">            reader.read(buffer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            System.out.println(ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="decorators-DataSourceDecorator-java-抽象基础装饰"><a href="#decorators-DataSourceDecorator-java-抽象基础装饰" class="headerlink" title="decorators&#x2F;DataSourceDecorator.java: 抽象基础装饰"></a><strong>decorators&#x2F;DataSourceDecorator.java:</strong> 抽象基础装饰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.decorators;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象基础装饰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午6:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">DataSourceDecorator</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataSource wrappee;</span><br><span class="line"></span><br><span class="line">    DataSourceDecorator(DataSource source) &#123;</span><br><span class="line">        <span class="built_in">this</span>.wrappee = source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        wrappee.writeData(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> wrappee.readData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="decorators-EncryptionDecorator-java-加密装饰"><a href="#decorators-EncryptionDecorator-java-加密装饰" class="headerlink" title="decorators&#x2F;EncryptionDecorator.java: 加密装饰"></a><strong>decorators&#x2F;EncryptionDecorator.java:</strong> 加密装饰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.decorators;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加密装饰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午6:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptionDecorator</span> <span class="keyword">extends</span> <span class="title class_">DataSourceDecorator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EncryptionDecorator</span><span class="params">(DataSource source)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.writeData(encode(data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> decode(<span class="built_in">super</span>.readData());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">encode</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] result = data.getBytes();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">            result[i] += (<span class="type">byte</span>) <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Base64.getEncoder().encodeToString(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">decode</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] result = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">            result[i] -= (<span class="type">byte</span>) <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="decorators-CompressionDecorator-java-压缩装饰"><a href="#decorators-CompressionDecorator-java-压缩装饰" class="headerlink" title="decorators&#x2F;CompressionDecorator.java: 压缩装饰"></a><strong>decorators&#x2F;CompressionDecorator.java:</strong> 压缩装饰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.decorators;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.Deflater;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.DeflaterOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.InflaterInputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 压缩装饰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午6:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompressionDecorator</span> <span class="keyword">extends</span> <span class="title class_">DataSourceDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">compLevel</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CompressionDecorator</span><span class="params">(DataSource source)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCompressionLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compLevel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompressionLevel</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        compLevel = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.writeData(compress(data));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> decompress(<span class="built_in">super</span>.readData());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">compress</span><span class="params">(String stringData)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = stringData.getBytes();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">bout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>(<span class="number">512</span>);</span><br><span class="line">            <span class="type">DeflaterOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeflaterOutputStream</span>(bout, <span class="keyword">new</span> <span class="title class_">Deflater</span>(compLevel));</span><br><span class="line">            dos.write(data);</span><br><span class="line">            dos.close();</span><br><span class="line">            bout.close();</span><br><span class="line">            <span class="keyword">return</span> Base64.getEncoder().encodeToString(bout.toByteArray());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">decompress</span><span class="params">(String stringData)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = Base64.getDecoder().decode(stringData);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data);</span><br><span class="line">            <span class="type">InflaterInputStream</span> <span class="variable">iin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InflaterInputStream</span>(in);</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">bout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>(<span class="number">512</span>);</span><br><span class="line">            <span class="type">int</span> b;</span><br><span class="line">            <span class="keyword">while</span> ((b = iin.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bout.write(b);</span><br><span class="line">            &#125;</span><br><span class="line">            in.close();</span><br><span class="line">            iin.close();</span><br><span class="line">            bout.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(bout.toByteArray());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Main-java-客户端代码"><a href="#Main-java-客户端代码" class="headerlink" title="Main.java: 客户端代码"></a><strong>Main.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.decorators.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午5:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">salaryRecords</span> <span class="operator">=</span> <span class="string">&quot;姓名，薪水 \n 约翰·史密斯，100000\n Steven Jobs，912000&quot;</span>;</span><br><span class="line">        <span class="type">DataSourceDecorator</span> <span class="variable">encoded</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompressionDecorator</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">EncryptionDecorator</span>(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">FileDataSource</span>(<span class="string">&quot;out/OutputDemo.txt&quot;</span>)));</span><br><span class="line">        encoded.writeData(salaryRecords);</span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">plain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileDataSource</span>(<span class="string">&quot;out/OutputDemo.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;- Input ----------------&quot;</span>);</span><br><span class="line">        System.out.println(salaryRecords);</span><br><span class="line">        System.out.println(<span class="string">&quot;- Encoded --------------&quot;</span>);</span><br><span class="line">        System.out.println(plain.readData());</span><br><span class="line">        System.out.println(<span class="string">&quot;- Decoded --------------&quot;</span>);</span><br><span class="line">        System.out.println(encoded.readData());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="装饰模式适合应用场景"><a href="#装饰模式适合应用场景" class="headerlink" title="装饰模式适合应用场景"></a>装饰模式适合应用场景</h2><p><strong>如果你希望在无需修改代码的情况下即可使用对象，且希望在运行时为对象新增额外的行为，可以使用装饰模式。</strong></p><p> 装饰能将业务逻辑组织为层次结构， 你可为各层创建一个装饰， 在运行时将各种不同逻辑组合成对象。 由于这些对象都遵循通用接口， 客户端代码能以相同的方式使用这些对象。</p><p><strong>如果用继承来扩展对象行为的方案难以实现或者根本不可行，你可以使用该模式。</strong></p><p>许多编程语言使用 <code>final</code>最终关键字来限制对某个类的进一步扩展。 复用最终类已有行为的唯一方法是使用装饰模式： 用封装器对其进行封装。</p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li>确保业务逻辑可用一个基本组件及多个额外可选层次表示。</li><li>找出基本组件和可选层次的通用方法。 创建一个组件接口并在其中声明这些方法。</li><li>创建一个具体组件类， 并定义其基础行为。</li><li>创建装饰基类， 使用一个成员变量存储指向被封装对象的引用。 该成员变量必须被声明为组件接口类型， 从而能在运行时连接具体组件和装饰。 装饰基类必须将所有工作委派给被封装的对象。</li><li>确保所有类实现组件接口。</li><li>将装饰基类扩展为具体装饰。 具体装饰必须在调用父类方法 （总是委派给被封装对象） 之前或之后执行自身的行为。</li><li>客户端代码负责创建装饰并将其组合成客户端所需的形式。</li></ol><h2 id="装饰模式优缺点"><a href="#装饰模式优缺点" class="headerlink" title="装饰模式优缺点"></a>装饰模式优缺点</h2><p>优点：</p><ul><li>你无需创建新子类即可扩展对象的行为。</li><li>你可以在运行时添加或删除对象的功能。</li><li>你可以用多个装饰封装对象来组合几种行为。</li><li><em>单一职责原则</em>。 你可以将实现了许多不同行为的一个大类拆分为多个较小的类。</li></ul><p>缺点：</p><ul><li>在封装器栈中删除特定封装器比较困难。</li><li>实现行为不受装饰栈顺序影响的装饰比较困难。</li><li>各层的初始化配置代码看上去可能会很糟糕。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>适配器模式可以对已有对象的接口进行修改，装饰模式则能在不改变对象接口的前提下强化对象功能。 此外， <em>装饰</em>还支持递归组合， <em>适配器</em>则无法实现。</li><li>适配器能为被封装对象提供不同的接口， 代理模式能为对象提供相同的接口， 装饰则能为对象提供加强的接口。</li><li>责任链模式和装饰模式的类结构非常相似。 两者都依赖递归组合将需要执行的操作传递给一系列对象。 但是， 两者有几点重要的不同之处。责任链的管理者可以相互独立地执行一切操作， 还可以随时停止传递请求。 另一方面， 各种<em>装饰</em>可以在遵循基本接口的情况下扩展对象的行为。 此外， 装饰无法中断请求的传递。</li><li>组合模式和装饰的结构图很相似， 因为两者都依赖递归组合来组织无限数量的对象。 <em>装饰</em>类似于<em>组合</em>， 但其只有一个子组件。 此外还有一个明显不同： <em>装饰</em>为被封装对象添加了额外的职责， <em>组合</em>仅对其子节点的结果进行了 “求和”。 但是， 模式也可以相互合作： 你可以使用<em>装饰</em>来扩展<em>组合</em>树中特定对象的行为。</li><li>大量使用组合和装饰的设计通常可从对于原型模式的使用中获益。 你可以通过该模式来复制复杂结构， 而非从零开始重新构造。</li><li>装饰可让你更改对象的外表， 策略模式则让你能够改变其本质。</li><li>装饰和代理有着相似的结构， 但是其意图却非常不同。 这两个模式的构建都基于组合原则， 也就是说一个对象应该将部分工作委派给另一个对象。 两者之间的不同之处在于<em>代理</em>通常自行管理其服务对象的生命周期， 而<em>装饰</em>的生成则总是由客户端进行控制。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;装饰模式&quot;&gt;&lt;a href=&quot;#装饰模式&quot; class=&quot;headerlink&quot; title=&quot;装饰模式&quot;&gt;&lt;/a&gt;装饰模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;装饰模式&lt;/strong&gt;是一种结构型设计模式， 允许你通过将对象放入包含行为的特殊封装对象中来为原对象绑定新的行为。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="装饰模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="装饰模式" scheme="https://blog.48626.xyz/tags/%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>组合模式</title>
    <link href="https://blog.48626.xyz/358c4b6a30e7.html"/>
    <id>https://blog.48626.xyz/358c4b6a30e7.html</id>
    <published>2024-09-18T08:28:47.000Z</published>
    <updated>2024-09-18T08:28:47.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>组合模式</strong>是一种结构型设计模式， 你可以使用它将对象组合成树状结构， 并且能像使用独立对象一样使用它们。</p><img src="/358c4b6a30e7/image-20240918160416633.png" class="" alt="image-20240918160416633"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>如果应用的核心模型能用树状结构表示， 在应用中使用组合模式才有价值。</p><p>例如， 你有两类对象：  <code>产品</code>和 <code>盒子</code> 。 一个盒子中可以包含多个 <code>产品</code>或者几个较小的 <code>盒子</code> 。 这些小 <code>盒子</code>中同样可以包含一些 <code>产品</code>或更小的 <code>盒子</code> ， 以此类推。</p><p>假设你希望在这些类的基础上开发一个定购系统。 订单中可以包含无包装的简单产品， 也可以包含装满产品的盒子…… 以及其他盒子。 此时你会如何计算每张订单的总价格呢？</p><img src="/358c4b6a30e7/image-20240918160458475.png" class="" alt="订单中可能包括各种产品， 这些产品放置在盒子中， 然后又被放入一层又一层更大的盒子中。 整个结构看上去像是一棵倒过来的树。"><p>你可以尝试直接计算： 打开所有盒子， 找到每件产品， 然后计算总价。 这在真实世界中或许可行， 但在程序中， 你并不能简单地使用循环语句来完成该工作。 你必须事先知道所有 <code>产品</code>和 <code>盒子</code>的类别， 所有盒子的嵌套层数以及其他繁杂的细节信息。 因此， 直接计算极不方便， 甚至完全不可行。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>组合模式建议使用一个通用接口来与 <code>产品</code>和 <code>盒子</code>进行交互， 并且在该接口中声明一个计算总价的方法。</p><p>那么方法该如何设计呢？ 对于一个产品， 该方法直接返回其价格； 对于一个盒子， 该方法遍历盒子中的所有项目， 询问每个项目的价格， 然后返回该盒子的总价格。 如果其中某个项目是小一号的盒子， 那么当前盒子也会遍历其中的所有项目， 以此类推， 直到计算出所有内部组成部分的价格。 你甚至可以在盒子的最终价格中增加额外费用， 作为该盒子的包装费用。</p><img src="/358c4b6a30e7/image-20240918160609036.png" class="" alt="组合模式以递归方式处理对象树中的所有项目"><p>该方式的最大优点在于你无需了解构成树状结构的对象的具体类。 你也无需了解对象是简单的产品还是复杂的盒子。 你只需调用通用接口以相同的方式对其进行处理即可。 当你调用该方法后， 对象会将请求沿着树结构传递下去。</p><h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><img src="/358c4b6a30e7/image-20240918160646563.png" class="" alt="部队结构的例子。"><p>大部分国家的军队都采用层次结构管理。 每支部队包括几个师， 师由旅构成， 旅由团构成， 团可以继续划分为排。 最后， 每个排由一小队实实在在的士兵组成。 军事命令由最高层下达， 通过每个层级传递， 直到每位士兵都知道自己应该服从的命令。</p><h2 id="组合模式结构"><a href="#组合模式结构" class="headerlink" title="组合模式结构"></a>组合模式结构</h2><img src="/358c4b6a30e7/image-20240918160748851.png" class="" alt="image-20240918160748851"><ol><li><p><strong>组件</strong> （Component） 接口描述了树中简单项目和复杂项目所共有的操作。</p></li><li><p><strong>叶节点</strong> （Leaf） 是树的基本结构， 它不包含子项目。</p><p>一般情况下， 叶节点最终会完成大部分的实际工作， 因为它们无法将工作指派给其他部分。</p></li><li><p><strong>容器</strong> （Container）——又名 “组合 （Composite）”——是包含叶节点或其他容器等子项目的单位。 容器不知道其子项目所属的具体类， 它只通过通用的组件接口与其子项目交互。</p><p>容器接收到请求后会将工作分配给自己的子项目， 处理中间结果， 然后将最终结果返回给客户端。</p></li><li><p><strong>客户端</strong> （Client） 通过组件接口与所有项目交互。 因此， 客户端能以相同方式与树状结构中的简单或复杂项目交互。</p></li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>在本例中， 我们将借助<strong>组合</strong>模式帮助你在图形编辑器中实现一系列的几何图形。</p><img src="/358c4b6a30e7/image-20240918160843088.png" class="" alt="几何形状编辑器示例。"><p><code>组合图形</code>Compound­Graphic是一个容器， 它可以由多个包括容器在内的子图形构成。 组合图形与简单图形拥有相同的方法。 但是， 组合图形自身并不完成具体工作， 而是将请求递归地传递给自己的子项目， 然后 “汇总” 结果。</p><p>通过所有图形类所共有的接口， 客户端代码可以与所有图形互动。 因此， 客户端不知道与其交互的是简单图形还是组合图形。 客户端可以与非常复杂的对象结构进行交互， 而无需与组成该结构的实体类紧密耦合。</p><h3 id="shapes"><a href="#shapes" class="headerlink" title="shapes"></a><strong>shapes</strong></h3><h4 id="shapes-Shape-java-通用形状接口"><a href="#shapes-Shape-java-通用形状接口" class="headerlink" title="shapes&#x2F;Shape.java: 通用形状接口"></a><strong>shapes&#x2F;Shape.java:</strong> 通用形状接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用形状接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午4:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getX</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getY</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">move</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isInsideBounds</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unSelect</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isSelected</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="shapes-BaseShape-java-提供基本功能的抽象形状"><a href="#shapes-BaseShape-java-提供基本功能的抽象形状" class="headerlink" title="shapes&#x2F;BaseShape.java: 提供基本功能的抽象形状"></a><strong>shapes&#x2F;BaseShape.java:</strong> 提供基本功能的抽象形状</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提供基本功能的抽象形状</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午4:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseShape</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">public</span> Color color;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">selected</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    BaseShape(<span class="type">int</span> x, <span class="type">int</span> y, Color color) &#123;</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">        <span class="built_in">this</span>.y = y;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getX</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getY</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.x += x;</span><br><span class="line">        <span class="built_in">this</span>.y += y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInsideBounds</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &gt; getX() &amp;&amp; x &lt; (getX() + getWidth()) &amp;&amp;</span><br><span class="line">                y &gt; getY() &amp;&amp; y &lt; (getY() + getHeight());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span> &#123;</span><br><span class="line">        selected = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unSelect</span><span class="params">()</span> &#123;</span><br><span class="line">        selected = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSelected</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> selected;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">enableSelectionStyle</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        graphics.setColor(Color.LIGHT_GRAY);</span><br><span class="line"></span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g2</span> <span class="operator">=</span> (Graphics2D) graphics;</span><br><span class="line">        <span class="type">float</span>[] dash1 = &#123;<span class="number">2.0f</span>&#125;;</span><br><span class="line">        g2.setStroke(<span class="keyword">new</span> <span class="title class_">BasicStroke</span>(<span class="number">1.0f</span>,</span><br><span class="line">                BasicStroke.CAP_BUTT,</span><br><span class="line">                BasicStroke.JOIN_MITER,</span><br><span class="line">                <span class="number">2.0f</span>, dash1, <span class="number">0.0f</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">disableSelectionStyle</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        graphics.setColor(color);</span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g2</span> <span class="operator">=</span> (Graphics2D) graphics;</span><br><span class="line">        g2.setStroke(<span class="keyword">new</span> <span class="title class_">BasicStroke</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isSelected()) &#123;</span><br><span class="line">            enableSelectionStyle(graphics);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            disableSelectionStyle(graphics);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="shapes-Dot-java-点"><a href="#shapes-Dot-java-点" class="headerlink" title="shapes&#x2F;Dot.java: 点"></a><strong>shapes&#x2F;Dot.java:</strong> 点</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午4:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dot</span> <span class="keyword">extends</span> <span class="title class_">BaseShape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DOT_SIZE</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dot</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, Color color)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(x, y, color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DOT_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DOT_SIZE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        graphics.fillRect(x - <span class="number">1</span>, y - <span class="number">1</span>, getWidth(), getHeight());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="shapes-Circle-java-圆形"><a href="#shapes-Circle-java-圆形" class="headerlink" title="shapes&#x2F;Circle.java: 圆形"></a><strong>shapes&#x2F;Circle.java:</strong> 圆形</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 圆形</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午4:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">BaseShape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> radius, Color color)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(x, y, color);</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> radius * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> radius * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        graphics.drawOval(x, y, getWidth() - <span class="number">1</span>, getHeight() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="shapes-Rectangle-java-三角形"><a href="#shapes-Rectangle-java-三角形" class="headerlink" title="shapes&#x2F;Rectangle.java: 三角形"></a><strong>shapes&#x2F;Rectangle.java:</strong> 三角形</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 三角形</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午4:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">BaseShape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> height, Color color)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(x, y, color);</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.paint(graphics);</span><br><span class="line">        graphics.drawRect(x, y, getWidth() - <span class="number">1</span>, getHeight() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="shapes-CompoundShape-java-由其他形状对象组成的复合形状"><a href="#shapes-CompoundShape-java-由其他形状对象组成的复合形状" class="headerlink" title="shapes&#x2F;CompoundShape.java: 由其他形状对象组成的复合形状"></a><strong>shapes&#x2F;CompoundShape.java:</strong> 由其他形状对象组成的复合形状</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 由其他形状对象组成的复合形状</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午4:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompoundShape</span> <span class="keyword">extends</span> <span class="title class_">BaseShape</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Shape&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CompoundShape</span><span class="params">(Shape... components)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">0</span>, <span class="number">0</span>, Color.BLACK);</span><br><span class="line">        add(components);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Shape component)</span> &#123;</span><br><span class="line">        children.add(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Shape... components)</span> &#123;</span><br><span class="line">        children.addAll(Arrays.asList(components));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Shape child)</span> &#123;</span><br><span class="line">        children.remove(child);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Shape... components)</span> &#123;</span><br><span class="line">        children.removeAll(Arrays.asList(components));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        children.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getX</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (children.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> children.get(<span class="number">0</span>).getX();</span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            <span class="keyword">if</span> (child.getX() &lt; x) &#123;</span><br><span class="line">                x = child.getX();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getY</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (children.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> children.get(<span class="number">0</span>).getY();</span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            <span class="keyword">if</span> (child.getY() &lt; y) &#123;</span><br><span class="line">                y = child.getY();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxWidth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> getX();</span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">childsRelativeX</span> <span class="operator">=</span> child.getX() - x;</span><br><span class="line">            <span class="type">int</span> <span class="variable">childWidth</span> <span class="operator">=</span> childsRelativeX + child.getWidth();</span><br><span class="line">            <span class="keyword">if</span> (childWidth &gt; maxWidth) &#123;</span><br><span class="line">                maxWidth = childWidth;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxHeight</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> getY();</span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">childsRelativeY</span> <span class="operator">=</span> child.getY() - y;</span><br><span class="line">            <span class="type">int</span> <span class="variable">childHeight</span> <span class="operator">=</span> childsRelativeY + child.getHeight();</span><br><span class="line">            <span class="keyword">if</span> (childHeight &gt; maxHeight) &#123;</span><br><span class="line">                maxHeight = childHeight;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            child.move(x, y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInsideBounds</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            <span class="keyword">if</span> (child.isInsideBounds(x, y)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unSelect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.unSelect();</span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            child.unSelect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">selectChildAt</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            <span class="keyword">if</span> (child.isInsideBounds(x, y)) &#123;</span><br><span class="line">                child.select();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isSelected()) &#123;</span><br><span class="line">            enableSelectionStyle(graphics);</span><br><span class="line">            graphics.drawRect(getX() - <span class="number">1</span>, getY() - <span class="number">1</span>, getWidth() + <span class="number">1</span>, getHeight() + <span class="number">1</span>);</span><br><span class="line">            disableSelectionStyle(graphics);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Shape child : children) &#123;</span><br><span class="line">            child.paint(graphics);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="editor"><a href="#editor" class="headerlink" title="editor"></a><strong>editor</strong></h3><h4 id="editor-ImageEditor-java-形状编辑器"><a href="#editor-ImageEditor-java-形状编辑器" class="headerlink" title="editor&#x2F;ImageEditor.java: 形状编辑器"></a><strong>editor&#x2F;ImageEditor.java:</strong> 形状编辑器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.shapes.CompoundShape;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Shape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.border.Border;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.MouseAdapter;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.MouseEvent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 形状编辑器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午4:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageEditor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> EditorCanvas canvas;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">CompoundShape</span> <span class="variable">allShapes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompoundShape</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ImageEditor</span><span class="params">()</span> &#123;</span><br><span class="line">        canvas = <span class="keyword">new</span> <span class="title class_">EditorCanvas</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadShapes</span><span class="params">(Shape... shapes)</span> &#123;</span><br><span class="line">        allShapes.clear();</span><br><span class="line">        allShapes.add(shapes);</span><br><span class="line">        canvas.refresh();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">EditorCanvas</span> <span class="keyword">extends</span> <span class="title class_">Canvas</span> &#123;</span><br><span class="line">        JFrame frame;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PADDING</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        EditorCanvas() &#123;</span><br><span class="line">            createFrame();</span><br><span class="line">            refresh();</span><br><span class="line">            addMouseListener(<span class="keyword">new</span> <span class="title class_">MouseAdapter</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mousePressed</span><span class="params">(MouseEvent e)</span> &#123;</span><br><span class="line">                    allShapes.unSelect();</span><br><span class="line">                    allShapes.selectChildAt(e.getX(), e.getY());</span><br><span class="line">                    e.getComponent().repaint();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">createFrame</span><span class="params">()</span> &#123;</span><br><span class="line">            frame = <span class="keyword">new</span> <span class="title class_">JFrame</span>();</span><br><span class="line">            frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span><br><span class="line">            frame.setLocationRelativeTo(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">JPanel</span> <span class="variable">contentPanel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">            <span class="type">Border</span> <span class="variable">padding</span> <span class="operator">=</span> BorderFactory.createEmptyBorder(PADDING, PADDING, PADDING, PADDING);</span><br><span class="line">            contentPanel.setBorder(padding);</span><br><span class="line">            frame.setContentPane(contentPanel);</span><br><span class="line"></span><br><span class="line">            frame.add(<span class="built_in">this</span>);</span><br><span class="line">            frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">            frame.getContentPane().setBackground(Color.LIGHT_GRAY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> allShapes.getX() + allShapes.getWidth() + PADDING;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> allShapes.getY() + allShapes.getHeight() + PADDING;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.setSize(getWidth(), getHeight());</span><br><span class="line">            frame.pack();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">(Graphics graphics)</span> &#123;</span><br><span class="line">            allShapes.paint(graphics);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Main-java-客户端代码"><a href="#Main-java-客户端代码" class="headerlink" title="Main.java: 客户端代码"></a><strong>Main.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.editor.ImageEditor;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Circle;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.CompoundShape;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Dot;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Rectangle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午4:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="type">ImageEditor</span> <span class="variable">editor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageEditor</span>();</span><br><span class="line"></span><br><span class="line">        editor.loadShapes(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, Color.BLUE),</span><br><span class="line"></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">CompoundShape</span>(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="number">110</span>, <span class="number">110</span>, <span class="number">50</span>, Color.RED),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Dot</span>(<span class="number">160</span>, <span class="number">160</span>, Color.RED)</span><br><span class="line">                ),</span><br><span class="line"></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">CompoundShape</span>(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="number">250</span>, <span class="number">250</span>, <span class="number">100</span>, <span class="number">100</span>, Color.GREEN),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Dot</span>(<span class="number">240</span>, <span class="number">240</span>, Color.GREEN),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Dot</span>(<span class="number">240</span>, <span class="number">360</span>, Color.GREEN),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Dot</span>(<span class="number">360</span>, <span class="number">360</span>, Color.GREEN),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Dot</span>(<span class="number">360</span>, <span class="number">240</span>, Color.GREEN)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="组合模式适合应用场景"><a href="#组合模式适合应用场景" class="headerlink" title="组合模式适合应用场景"></a>组合模式适合应用场景</h2><p><strong>如果你需要实现树状对象结构，可以使用组合模式。</strong></p><p>组合模式为你提供了两种共享公共接口的基本元素类型： 简单叶节点和复杂容器。 容器中可以包含叶节点和其他容器。 这使得你可以构建树状嵌套递归对象结构。</p><p><strong>如果你希望客户端代码以相同方式处理简单和复杂元素，可以使用该模式。</strong></p><p>组合模式中定义的所有元素共用同一个接口。 在这一接口的帮助下， 客户端不必在意其所使用的对象的具体类。</p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li>确保应用的核心模型能够以树状结构表示。 尝试将其分解为简单元素和容器。 记住， 容器必须能够同时包含简单元素和其他容器。</li><li>声明组件接口及其一系列方法， 这些方法对简单和复杂元素都有意义。</li><li>创建一个叶节点类表示简单元素。 程序中可以有多个不同的叶节点类。</li><li>创建一个容器类表示复杂元素。 在该类中， 创建一个数组成员变量来存储对于其子元素的引用。 该数组必须能够同时保存叶节点和容器， 因此请确保将其声明为组合接口类型。 实现组件接口方法时， 记住容器应该将大部分工作交给其子元素来完成。</li><li>最后， 在容器中定义添加和删除子元素的方法。 记住， 这些操作可在组件接口中声明。 这将会违反<em>接口隔离原则</em>， 因为叶节点类中的这些方法为空。 但是， 这可以让客户端无差别地访问所有元素， 即使是组成树状结构的元素。</li></ol><h2 id="组合模式优缺点"><a href="#组合模式优缺点" class="headerlink" title="组合模式优缺点"></a>组合模式优缺点</h2><p>优点：</p><ul><li>你可以利用多态和递归机制更方便地使用复杂树结构。</li><li><em>开闭原则</em>。 无需更改现有代码， 你就可以在应用中添加新元素， 使其成为对象树的一部分。</li></ul><p>缺点：</p><ul><li>对于功能差异较大的类， 提供公共接口或许会有困难。 在特定情况下， 你需要过度一般化组件接口， 使其变得令人难以理解。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>桥接模式、 状态模式和策略模式（在某种程度上包括适配器模式） 模式的接口非常相似。 实际上， 它们都基于组合模式——即将工作委派给其他对象， 不过也各自解决了不同的问题。 模式并不只是以特定方式组织代码的配方， 你还可以使用它们来和其他开发者讨论模式所解决的问题。</li><li>你可以在创建复杂组合树时使用生成器模式， 因为这可使其构造步骤以递归的方式运行。</li><li>责任链模式通常和组合模式结合使用。 在这种情况下， 叶组件接收到请求后， 可以将请求沿包含全体父组件的链一直传递至对象树的底部。</li><li>你可以使用迭代器模式来遍历组合树。</li><li>你可以使用访问者模式对整个组合树执行操作。</li><li>你可以使用享元模式实现组合树的共享叶节点以节省内存。</li><li>组合和装饰模式的结构图很相似， 因为两者都依赖递归组合来组织无限数量的对象。 <em>装饰</em>类似于<em>组合</em>， 但其只有一个子组件。 此外还有一个明显不同： <em>装饰</em>为被封装对象添加了额外的职责， <em>组合</em>仅对其子节点的结果进行了 “求和”。 但是， 模式也可以相互合作： 你可以使用<em>装饰</em>来扩展<em>组合</em>树中特定对象的行为。</li><li>大量使用组合和装饰的设计通常可从对于原型模式的使用中获益。 你可以通过该模式来复制复杂结构， 而非从零开始重新构造。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;组合模式&quot;&gt;&lt;a href=&quot;#组合模式&quot; class=&quot;headerlink&quot; title=&quot;组合模式&quot;&gt;&lt;/a&gt;组合模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;组合模式&lt;/strong&gt;是一种结构型设计模式， 你可以使用它将对象组合成树状结构， 并且能像使用独立对象一样使用它们。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="组合模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="组合模式" scheme="https://blog.48626.xyz/tags/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>桥接模式</title>
    <link href="https://blog.48626.xyz/ba99b349c7e0.html"/>
    <id>https://blog.48626.xyz/ba99b349c7e0.html</id>
    <published>2024-09-18T07:00:16.000Z</published>
    <updated>2024-09-18T07:00:16.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>桥接模式</strong>是一种结构型设计模式， 可将一个大类或一系列紧密相关的类拆分为抽象和实现两个独立的层次结构， 从而能在开发时分别使用。</p><img src="/ba99b349c7e0/image-20240918143142377.png" class="" alt="image-20240918143142377"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p><em>抽象？ 实现？</em> 听上去挺吓人？ 让我们慢慢来， 先考虑一个简单的例子。</p><p>假如你有一个几何 <code>形状</code>Shape类， 从它能扩展出两个子类：  <code>圆形</code>Circle和 <code>方形</code>Square 。 你希望对这样的类层次结构进行扩展以使其包含颜色， 所以你打算创建名为 <code>红色</code>Red和 <code>蓝色</code>Blue的形状子类。 但是， 由于你已有两个子类， 所以总共需要创建四个类才能覆盖所有组合， 例如 <code>蓝色圆形</code>Blue­Circle和 <code>红色方形</code>Red­Square 。</p><img src="/ba99b349c7e0/image-20240918143207581.png" class="" alt="所有组合类的数量将以几何级数增长。"><p>在层次结构中新增形状和颜色将导致代码复杂程度指数增长。 例如添加三角形状， 你需要新增两个子类， 也就是每种颜色一个； 此后新增一种新颜色需要新增三个子类， 即每种形状一个。 如此以往， 情况会越来越糟糕。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>问题的根本原因是我们试图在两个独立的维度——形状与颜色——上扩展形状类。 这在处理类继承时是很常见的问题。</p><p>桥接模式通过将继承改为组合的方式来解决这个问题。 具体来说， 就是抽取其中一个维度并使之成为独立的类层次， 这样就可以在初始类中引用这个新层次的对象， 从而使得一个类不必拥有所有的状态和行为。</p><img src="/ba99b349c7e0/image-20240918143254734.png" class="" alt="将一个类层次转化为多个相关的类层次， 避免单个类层次的失控。"><p>根据该方法， 我们可以将颜色相关的代码抽取到拥有 <code>红色</code>和 <code>蓝色</code>两个子类的颜色类中， 然后在 <code>形状</code>类中添加一个指向某一颜色对象的引用成员变量。 现在， 形状类可以将所有与颜色相关的工作委派给连入的颜色对象。 这样的引用就成为了 <code>形状</code>和 <code>颜色</code>之间的桥梁。 此后， 新增颜色将不再需要修改形状的类层次， 反之亦然。</p><h3 id="抽象部分和实现部分"><a href="#抽象部分和实现部分" class="headerlink" title="抽象部分和实现部分"></a>抽象部分和实现部分</h3><p>设计模式<em>四人组</em>的著作 在桥接定义中提出了<em>抽象部分</em>和<em>实现部分</em>两个术语。 我觉得这些术语过于学术了， 反而让模式看上去比实际情况更加复杂。 在介绍过形状和颜色的简单例子后， 我们来看看四人组著作中让人望而生畏的词语的含义。</p><p><em>抽象部分</em> （也被称为<em>接口</em>） 是一些实体的高阶控制层。 该层自身不完成任何具体的工作， 它需要将工作委派给<em>实现部分</em>层 （也被称为<em>平台</em>）。</p><p>注意， 这里提到的内容与编程语言中的<em>接口</em>或<em>抽象类</em>无关。 它们并不是一回事。</p><p>在实际的程序中， 抽象部分是图形用户界面 （GUI）， 而实现部分则是底层操作系统代码 （API）， GUI 层调用 API 层来对用户的各种操作做出响应。</p><p>一般来说， 你可以在两个独立方向上扩展这种应用：</p><ul><li>开发多个不同的 GUI （例如面向普通用户和管理员进行分别配置）</li><li>支持多个不同的 API （例如， 能够在 Windows、 Linux 和 macOS 上运行该程序）。</li></ul><p>在最糟糕的情况下， 程序可能会是一团乱麻， 其中包含数百种条件语句， 连接着代码各处不同种类的 GUI 和各种 API。</p><img src="/ba99b349c7e0/image-20240918143442453.png" class="" alt="在庞杂的代码中， 即使是很小的改动都非常难以完成， 因为你必须要在*整体上*对代码有充分的理解。 而在较小且定义明确的模块中， 进行修改则要容易得多。"><p>你可以将特定接口-平台的组合代码抽取到独立的类中， 以在混乱中建立一些秩序。 但是， 你很快会发现这种类的数量<em>很多</em>。 类层次将以指数形式增长， 因为每次添加一个新的 GUI 或支持一种新的 API 都需要创建更多的类。</p><p>让我们试着用桥接模式来解决这个问题。 该模式建议将类拆分为两个类层次结构：</p><ul><li>抽象部分： 程序的 GUI 层。</li><li>实现部分： 操作系统的 API。</li></ul><img src="/ba99b349c7e0/image-20240918143511322.png" class="" alt="创建跨平台应用程序的一种方法"><p>抽象对象控制程序的外观， 并将真实工作委派给连入的实现对象。 不同的实现只要遵循相同的接口就可以互换， 使同一 GUI 可在 Windows 和 Linux 下运行。</p><p>最后的结果是： 你无需改动与 API 相关的类就可以修改 GUI 类。 此外如果想支持一个新的操作系统， 只需在实现部分层次中创建一个子类即可。</p><h2 id="桥接模式结构"><a href="#桥接模式结构" class="headerlink" title="桥接模式结构"></a>桥接模式结构</h2><img src="/ba99b349c7e0/image-20240918143557729.png" class="" alt="image-20240918143557729"><ol><li><p><strong>抽象部分</strong> （Abstraction） 提供高层控制逻辑， 依赖于完成底层实际工作的实现对象。</p></li><li><p><strong>实现部分</strong> （Implementation） 为所有具体实现声明通用接口。 抽象部分仅能通过在这里声明的方法与实现对象交互。</p><p>抽象部分可以列出和实现部分一样的方法， 但是抽象部分通常声明一些复杂行为， 这些行为依赖于多种由实现部分声明的原语操作。</p></li><li><p><strong>具体实现</strong> （Concrete Implementations） 中包括特定于平台的代码。</p></li><li><p><strong>精确抽象</strong> （Refined Abstraction） 提供控制逻辑的变体。 与其父类一样， 它们通过通用实现接口与不同的实现进行交互。</p></li><li><p>通常情况下， <strong>客户端</strong> （Client） 仅关心如何与抽象部分合作。 但是， 客户端需要将抽象对象与一个实现对象连接起来。</p></li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>示例演示了<strong>桥接</strong>模式如何拆分程序中同时管理设备及其遥控器的庞杂代码。  <code>设备</code>Device类作为实现部分， 而 <code>遥控器</code>Remote类则作为抽象部分。</p><img src="/ba99b349c7e0/image-20240918143709620.png" class="" alt="最初类层次结构被拆分为两个部分： 设备和遥控器。"><p>遥控器基类声明了一个指向设备对象的引用成员变量。 所有遥控器通过通用设备接口与设备进行交互， 使得同一个遥控器可以支持不同类型的设备。</p><p>你可以开发独立于设备类的遥控器类， 只需新建一个遥控器子类即可。 例如， 基础遥控器可能只有两个按钮， 但你可在其基础上扩展新功能， 比如额外的一节电池或一块触摸屏。</p><p>客户端代码通过遥控器构造函数将特定种类的遥控器与设备对象连接起来。</p><h3 id="devices"><a href="#devices" class="headerlink" title="devices"></a><strong>devices</strong></h3><h4 id="devices-Device-java-所有设备的通用接口"><a href="#devices-Device-java-所有设备的通用接口" class="headerlink" title="devices&#x2F;Device.java: 所有设备的通用接口"></a><strong>devices&#x2F;Device.java:</strong> 所有设备的通用接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.devices;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有设备的通用接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午2:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">enable</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">disable</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getVolume</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> percent)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getChannel</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setChannel</span><span class="params">(<span class="type">int</span> channel)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">printStatus</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="devices-Radio-java-收音机"><a href="#devices-Radio-java-收音机" class="headerlink" title="devices&#x2F;Radio.java: 收音机"></a><strong>devices&#x2F;Radio.java:</strong> 收音机</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.devices;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 收音机</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午2:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Radio</span> <span class="keyword">implements</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">on</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">volume</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> on;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enable</span><span class="params">()</span> &#123;</span><br><span class="line">        on = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">disable</span><span class="params">()</span> &#123;</span><br><span class="line">        on = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> volume)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (volume &gt; <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.volume = <span class="number">100</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (volume &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.volume = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.volume = volume;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getChannel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> channel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChannel</span><span class="params">(<span class="type">int</span> channel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.channel = channel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;| I&#x27;m radio.&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;| I&#x27;m &quot;</span> + (on ? <span class="string">&quot;enabled&quot;</span> : <span class="string">&quot;disabled&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;| Current volume is &quot;</span> + volume + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;| Current channel is &quot;</span> + channel);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="devices-Tv-java-电视机"><a href="#devices-Tv-java-电视机" class="headerlink" title="devices&#x2F;Tv.java: 电视机"></a><strong>devices&#x2F;Tv.java:</strong> 电视机</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.devices;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 电视机</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午2:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tv</span> <span class="keyword">implements</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">on</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">volume</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> on;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enable</span><span class="params">()</span> &#123;</span><br><span class="line">        on = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">disable</span><span class="params">()</span> &#123;</span><br><span class="line">        on = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> volume)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (volume &gt; <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.volume = <span class="number">100</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (volume &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.volume = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.volume = volume;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getChannel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> channel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setChannel</span><span class="params">(<span class="type">int</span> channel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.channel = channel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;| I&#x27;m TV set.&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;| I&#x27;m &quot;</span> + (on ? <span class="string">&quot;enabled&quot;</span> : <span class="string">&quot;disabled&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;| Current volume is &quot;</span> + volume + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;| Current channel is &quot;</span> + channel);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="remotes"><a href="#remotes" class="headerlink" title="remotes"></a><strong>remotes</strong></h3><h4 id="remotes-Remote-java-所有远程控制器的通用接口"><a href="#remotes-Remote-java-所有远程控制器的通用接口" class="headerlink" title="remotes&#x2F;Remote.java: 所有远程控制器的通用接口"></a><strong>remotes&#x2F;Remote.java:</strong> 所有远程控制器的通用接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.remotes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有远程控制器的通用接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午2:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">power</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">volumeDown</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">volumeUp</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">channelDown</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">channelUp</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="remotes-BasicRemote-java-基础远程控制器"><a href="#remotes-BasicRemote-java-基础远程控制器" class="headerlink" title="remotes&#x2F;BasicRemote.java: 基础远程控制器"></a><strong>remotes&#x2F;BasicRemote.java:</strong> 基础远程控制器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.remotes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.devices.Device;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基础远程控制器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午2:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicRemote</span> <span class="keyword">implements</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Device device;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BasicRemote</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BasicRemote</span><span class="params">(Device device)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.device = device;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">power</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;远程: 电源切换&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (device.isEnabled()) &#123;</span><br><span class="line">            device.disable();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            device.enable();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">volumeDown</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;远程: 降低音量&quot;</span>);</span><br><span class="line">        device.setVolume(device.getVolume() - <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">volumeUp</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;远程: 音量增大&quot;</span>);</span><br><span class="line">        device.setVolume(device.getVolume() + <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelDown</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;远程: 通道关闭&quot;</span>);</span><br><span class="line">        device.setChannel(device.getChannel() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelUp</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;远程: 通道向上&quot;</span>);</span><br><span class="line">        device.setChannel(device.getChannel() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="remotes-AdvancedRemote-java-高级远程控制器"><a href="#remotes-AdvancedRemote-java-高级远程控制器" class="headerlink" title="remotes&#x2F;AdvancedRemote.java: 高级远程控制器"></a><strong>remotes&#x2F;AdvancedRemote.java:</strong> 高级远程控制器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.remotes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.devices.Device;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 高级远程控制器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 下午2:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedRemote</span> <span class="keyword">extends</span> <span class="title class_">BasicRemote</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AdvancedRemote</span><span class="params">(Device device)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.device = device;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mute</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;遥控: 静音&quot;</span>);</span><br><span class="line">        device.setVolume(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Main-java-客户端代码"><a href="#Main-java-客户端代码" class="headerlink" title="Main.java: 客户端代码"></a><strong>Main.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.devices.Device;</span><br><span class="line"><span class="keyword">import</span> org.example.devices.Radio;</span><br><span class="line"><span class="keyword">import</span> org.example.devices.Tv;</span><br><span class="line"><span class="keyword">import</span> org.example.remotes.AdvancedRemote;</span><br><span class="line"><span class="keyword">import</span> org.example.remotes.BasicRemote;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/18 上午11:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        testDevice(<span class="keyword">new</span> <span class="title class_">Tv</span>());</span><br><span class="line">        testDevice(<span class="keyword">new</span> <span class="title class_">Radio</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testDevice</span><span class="params">(Device device)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用基本遥控器进行测试。&quot;</span>);</span><br><span class="line">        <span class="type">BasicRemote</span> <span class="variable">basicRemote</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicRemote</span>(device);</span><br><span class="line">        basicRemote.power();</span><br><span class="line">        device.printStatus();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;使用高级遥控器进行测试。&quot;</span>);</span><br><span class="line">        <span class="type">AdvancedRemote</span> <span class="variable">advancedRemote</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvancedRemote</span>(device);</span><br><span class="line">        advancedRemote.power();</span><br><span class="line">        advancedRemote.mute();</span><br><span class="line">        device.printStatus();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="桥接模式适合应用场景"><a href="#桥接模式适合应用场景" class="headerlink" title="桥接模式适合应用场景"></a>桥接模式适合应用场景</h2><p><strong>如果你想要拆分或重组一个具有多重功能的庞杂类（例如能与多个数据库服务器进行交互的类），可以使用桥接模式。</strong></p><p> 类的代码行数越多， 弄清其运作方式就越困难， 对其进行修改所花费的时间就越长。 一个功能上的变化可能需要在整个类范围内进行修改， 而且常常会产生错误， 甚至还会有一些严重的副作用。</p><p>桥接模式可以将庞杂类拆分为几个类层次结构。 此后， 你可以修改任意一个类层次结构而不会影响到其他类层次结构。 这种方法可以简化代码的维护工作， 并将修改已有代码的风险降到最低。</p><p><strong>如果你希望在几个独立维度上扩展一个类，可使用该模式。</strong></p><p> 桥接建议将每个维度抽取为独立的类层次。 初始类将相关工作委派给属于对应类层次的对象， 无需自己完成所有工作。</p><p><strong>如果你需要在运行时切换不同实现方法，可使用桥接模式。</strong></p><p>当然并不是说一定要实现这一点， 桥接模式可替换抽象部分中的实现对象， 具体操作就和给成员变量赋新值一样简单。</p><p><em>顺便提一句， 最后一点是很多人混淆桥接模式和策略模式的主要原因。 记住， 设计模式并不仅是一种对类进行组织的方式， 它还能用于沟通意图和解决问题。</em></p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li>明确类中独立的维度。 独立的概念可能是： 抽象&#x2F;平台， 域&#x2F;基础设施， 前端&#x2F;后端或接口&#x2F;实现。</li><li>了解客户端的业务需求， 并在抽象基类中定义它们。</li><li>确定在所有平台上都可执行的业务。 并在通用实现接口中声明抽象部分所需的业务。</li><li>为你域内的所有平台创建实现类， 但需确保它们遵循实现部分的接口。</li><li>在抽象类中添加指向实现类型的引用成员变量。 抽象部分会将大部分工作委派给该成员变量所指向的实现对象。</li><li>如果你的高层逻辑有多个变体， 则可通过扩展抽象基类为每个变体创建一个精确抽象。</li><li>客户端代码必须将实现对象传递给抽象部分的构造函数才能使其能够相互关联。 此后， 客户端只需与抽象对象进行交互， 无需和实现对象打交道。</li></ol><h2 id="桥接模式优缺点"><a href="#桥接模式优缺点" class="headerlink" title="桥接模式优缺点"></a>桥接模式优缺点</h2><p>优点：</p><ul><li>你可以创建与平台无关的类和程序。</li><li>客户端代码仅与高层抽象部分进行互动， 不会接触到平台的详细信息。</li><li><em>开闭原则</em>。 你可以新增抽象部分和实现部分， 且它们之间不会相互影响。</li><li><em>单一职责原则</em>。 抽象部分专注于处理高层逻辑， 实现部分处理平台细节。</li></ul><p>缺点：</p><ul><li>对高内聚的类使用该模式可能会让代码更加复杂。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>桥接模式通常会于开发前期进行设计， 使你能够将程序的各个部分独立开来以便开发。 另一方面， 适配器模式通常在已有程序中使用， 让相互不兼容的类能很好地合作。</li><li>桥接、 状态模式和策略模式 （在某种程度上包括适配器） 模式的接口非常相似。 实际上， 它们都基于组合模式——即将工作委派给其他对象， 不过也各自解决了不同的问题。 模式并不只是以特定方式组织代码的配方， 你还可以使用它们来和其他开发者讨论模式所解决的问题。</li><li>你可以将抽象工厂模式和桥接搭配使用。 如果由<em>桥接</em>定义的抽象只能与特定实现合作， 这一模式搭配就非常有用。 在这种情况下， <em>抽象工厂</em>可以对这些关系进行封装， 并且对客户端代码隐藏其复杂性。</li><li>你可以结合使用生成器模式和桥接模式： <em>主管</em>类负责抽象工作， 各种不同的<em>生成器</em>负责<em>实现</em>工作。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;桥接模式&quot;&gt;&lt;a href=&quot;#桥接模式&quot; class=&quot;headerlink&quot; title=&quot;桥接模式&quot;&gt;&lt;/a&gt;桥接模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;桥接模式&lt;/strong&gt;是一种结构型设计模式， 可将一个大类或一系列紧密相关的类拆分为抽象和实现两个独立的层次结构， 从而能在开发时分别使用。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="桥接模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="桥接模式" scheme="https://blog.48626.xyz/tags/%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>适配器模式</title>
    <link href="https://blog.48626.xyz/18238916cc52.html"/>
    <id>https://blog.48626.xyz/18238916cc52.html</id>
    <published>2024-09-14T08:33:00.000Z</published>
    <updated>2024-09-14T08:33:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>适配器模式</strong>是一种结构型设计模式， 它能使接口不兼容的对象能够相互合作。</p><img src="/18238916cc52/image-20240914151124440.png" class="" alt="image-20240914151124440"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假如你正在开发一款股票市场监测程序， 它会从不同来源下载 XML 格式的股票数据， 然后向用户呈现出美观的图表。</p><p>在开发过程中， 你决定在程序中整合一个第三方智能分析函数库。 但是遇到了一个问题， 那就是分析函数库只兼容 JSON 格式的数据。</p><img src="/18238916cc52/image-20240914151204997.png" class="" alt="你无法 “直接” 使用分析函数库， 因为它所需的输入数据格式与你的程序不兼容。"><p>你可以修改程序库来支持 XML。 但是， 这可能需要修改部分依赖该程序库的现有代码。 甚至还有更糟糕的情况， 你可能根本没有程序库的源代码， 从而无法对其进行修改。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>你可以创建一个<em>适配器</em>。 这是一个特殊的对象， 能够转换对象接口， 使其能与其他对象进行交互。</p><p>适配器模式通过封装对象将复杂的转换过程隐藏于幕后。 被封装的对象甚至察觉不到适配器的存在。 例如， 你可以使用一个将所有数据转换为英制单位 （如英尺和英里） 的适配器封装运行于米和千米单位制中的对象。</p><p>适配器不仅可以转换不同格式的数据， 其还有助于采用不同接口的对象之间的合作。 它的运作方式如下：</p><ol><li>适配器实现与其中一个现有对象兼容的接口。</li><li>现有对象可以使用该接口安全地调用适配器方法。</li><li>适配器方法被调用后将以另一个对象兼容的格式和顺序将请求传递给该对象。</li></ol><p>有时你甚至可以创建一个双向适配器来实现双向转换调用。</p><img src="/18238916cc52/image-20240914151301158.png" class="" alt="image-20240914151301158"><p>让我们回到股票市场程序。 为了解决数据格式不兼容的问题， 你可以为分析函数库中的每个类创建将 XML 转换为 JSON 格式的适配器， 然后让客户端仅通过这些适配器来与函数库进行交流。 当某个适配器被调用时， 它会将传入的 XML 数据转换为 JSON 结构， 并将其传递给被封装分析对象的相应方法。</p><h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><img src="/18238916cc52/image-20240914151327849.png" class="" alt="出国旅行前后的旅行箱。"><p>如果你是第一次从美国到欧洲旅行， 那么在给笔记本充电时可能会大吃一惊。 不同国家的电源插头和插座标准不同。 美国插头和德国插座不匹配。 同时提供美国标准插座和欧洲标准插头的电源适配器可以解决你的难题。</p><h2 id="适配器模式结构"><a href="#适配器模式结构" class="headerlink" title="适配器模式结构"></a>适配器模式结构</h2><h3 id="对象适配器"><a href="#对象适配器" class="headerlink" title="对象适配器"></a>对象适配器</h3><p>实现时使用了构成原则： 适配器实现了其中一个对象的接口， 并对另一个对象进行封装。 所有流行的编程语言都可以实现适配器。</p><img src="/18238916cc52/image-20240914151413607-1726298054753-1.png" class="" alt="image-20240914151413607"><ol><li><strong>客户端</strong> （Client） 是包含当前程序业务逻辑的类。</li><li><strong>客户端接口</strong> （Client Interface） 描述了其他类与客户端代码合作时必须遵循的协议。</li><li><strong>服务</strong> （Service） 中有一些功能类 （通常来自第三方或遗留系统）。 客户端与其接口不兼容， 因此无法直接调用其功能。</li><li><strong>适配器</strong> （Adapter） 是一个可以同时与客户端和服务交互的类： 它在实现客户端接口的同时封装了服务对象。 适配器接受客户端通过适配器接口发起的调用， 并将其转换为适用于被封装服务对象的调用。</li><li>客户端代码只需通过接口与适配器交互即可， 无需与具体的适配器类耦合。 因此， 你可以向程序中添加新类型的适配器而无需修改已有代码。 这在服务类的接口被更改或替换时很有用： 你无需修改客户端代码就可以创建新的适配器类。</li></ol><h3 id="类适配器"><a href="#类适配器" class="headerlink" title="类适配器"></a>类适配器</h3><p>这一实现使用了继承机制： 适配器同时继承两个对象的接口。 请注意， 这种方式仅能在支持多重继承的编程语言中实现， 例如 C++。</p><img src="/18238916cc52/image-20240914151700578-1726298221815-3.png" class="" alt="image-20240914151700578"><ol><li><strong>类适配器</strong>不需要封装任何对象， 因为它同时继承了客户端和服务的行为。 适配功能在重写的方法中完成。 最后生成的适配器可替代已有的客户端类进行使用。</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>下列<strong>适配器</strong>模式演示基于经典的 “方钉和圆孔” 问题。</p><img src="/18238916cc52/image-20240914162408832.png" class="" alt="image-20240914162408832"><p>适配器假扮成一个圆钉 （Round­Peg）， 其半径等于方钉 （Square­Peg） 横截面对角线的一半 （即能够容纳方钉的最小外接圆的半径）。</p><h3 id="round"><a href="#round" class="headerlink" title="round"></a><strong>round</strong></h3><h4 id="round-RoundHole-java-圆孔"><a href="#round-RoundHole-java-圆孔" class="headerlink" title="round&#x2F;RoundHole.java: 圆孔"></a><strong>round&#x2F;RoundHole.java:</strong> 圆孔</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.round;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 圆孔</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 下午4:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoundHole</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RoundHole</span><span class="params">(<span class="type">double</span> radius)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getRadius</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">fits</span><span class="params">(RoundPeg peg)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> result;</span><br><span class="line">        result = (<span class="built_in">this</span>.getRadius() &gt;= peg.getRadius());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="round-RoundPeg-java-圆钉"><a href="#round-RoundPeg-java-圆钉" class="headerlink" title="round&#x2F;RoundPeg.java: 圆钉"></a><strong>round&#x2F;RoundPeg.java:</strong> 圆钉</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.round;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 圆钉</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 下午4:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoundPeg</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RoundPeg</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RoundPeg</span><span class="params">(<span class="type">double</span> radius)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getRadius</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="square"><a href="#square" class="headerlink" title="square"></a><strong>square</strong></h3><h4 id="square-SquarePeg-java-方钉"><a href="#square-SquarePeg-java-方钉" class="headerlink" title="square&#x2F;SquarePeg.java: 方钉"></a><strong>square&#x2F;SquarePeg.java:</strong> 方钉</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.square;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方钉</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 下午4:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SquarePeg</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SquarePeg</span><span class="params">(<span class="type">double</span> width)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getSquare</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">double</span> result;</span><br><span class="line">        result = Math.pow(<span class="built_in">this</span>.width, <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="adapters"><a href="#adapters" class="headerlink" title="adapters"></a><strong>adapters</strong></h3><h4 id="adapters-SquarePegAdapter-java-方钉到圆孔的适配器"><a href="#adapters-SquarePegAdapter-java-方钉到圆孔的适配器" class="headerlink" title="adapters&#x2F;SquarePegAdapter.java: 方钉到圆孔的适配器"></a><strong>adapters&#x2F;SquarePegAdapter.java:</strong> 方钉到圆孔的适配器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.adapters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.round.RoundPeg;</span><br><span class="line"><span class="keyword">import</span> org.example.square.SquarePeg;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方钉到圆孔的适配器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 下午4:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SquarePegAdapter</span> <span class="keyword">extends</span> <span class="title class_">RoundPeg</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> SquarePeg peg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SquarePegAdapter</span><span class="params">(SquarePeg peg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.peg = peg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getRadius</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">double</span> result;</span><br><span class="line">        <span class="comment">// 计算一个最小圆半径，它可以适合这个钉子。</span></span><br><span class="line">        result = (Math.sqrt(Math.pow((peg.getWidth() / <span class="number">2</span>), <span class="number">2</span>) * <span class="number">2</span>));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Main-java-客户端代码"><a href="#Main-java-客户端代码" class="headerlink" title="Main.java: 客户端代码"></a><strong>Main.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.adapters.SquarePegAdapter;</span><br><span class="line"><span class="keyword">import</span> org.example.round.RoundHole;</span><br><span class="line"><span class="keyword">import</span> org.example.round.RoundPeg;</span><br><span class="line"><span class="keyword">import</span> org.example.square.SquarePeg;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 下午4:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="comment">// 圆形适合圆形，不足为奇。</span></span><br><span class="line">        <span class="type">RoundHole</span> <span class="variable">hole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoundHole</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="type">RoundPeg</span> <span class="variable">rpeg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoundPeg</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">if</span> (hole.fits(rpeg)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Round peg r5 fits round hole r5.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">SquarePeg</span> <span class="variable">smallSqPeg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SquarePeg</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">SquarePeg</span> <span class="variable">largeSqPeg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SquarePeg</span>(<span class="number">20</span>);</span><br><span class="line">        <span class="comment">// hole.fits(smallSqPeg); // 无法编译。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 适配器解决了这个问题。</span></span><br><span class="line">        <span class="type">SquarePegAdapter</span> <span class="variable">smallSqPegAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SquarePegAdapter</span>(smallSqPeg);</span><br><span class="line">        <span class="type">SquarePegAdapter</span> <span class="variable">largeSqPegAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SquarePegAdapter</span>(largeSqPeg);</span><br><span class="line">        <span class="keyword">if</span> (hole.fits(smallSqPegAdapter)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Square peg w2 fits round hole r5.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!hole.fits(largeSqPegAdapter)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Square peg w20 does not fit into round hole r5.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="适配器模式适合应用场景"><a href="#适配器模式适合应用场景" class="headerlink" title="适配器模式适合应用场景"></a>适配器模式适合应用场景</h2><p> <strong>当你希望使用某个类，但是其接口与其他代码不兼容时，可以使用适配器类。</strong></p><p>适配器模式允许你创建一个中间层类， 其可作为代码与遗留类、 第三方类或提供怪异接口的类之间的转换器。</p><p><strong>如果您需要复用这样一些类，他们处于同一个继承体系，并且他们又有了额外的一些共同的方法，但是这些共同的方法不是所有在这一继承体系中的子类所具有的共性。</strong></p><p>你可以扩展每个子类， 将缺少的功能添加到新的子类中。 但是， 你必须在所有新子类中重复添加这些代码， 这样会使得代码有坏味道。</p><p>将缺失功能添加到一个适配器类中是一种优雅得多的解决方案。 然后你可以将缺少功能的对象封装在适配器中， 从而动态地获取所需功能。 如要这一点正常运作， 目标类必须要有通用接口， 适配器的成员变量应当遵循该通用接口。 这种方式同装饰模式非常相似。</p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li>确保至少有两个类的接口不兼容：<ul><li>一个无法修改 （通常是第三方、 遗留系统或者存在众多已有依赖的类） 的功能性<em>服务</em>类。</li><li>一个或多个将受益于使用服务类的<em>客户端</em>类。</li></ul></li><li>声明客户端接口， 描述客户端如何与服务交互。</li><li>创建遵循客户端接口的适配器类。 所有方法暂时都为空。</li><li>在适配器类中添加一个成员变量用于保存对于服务对象的引用。 通常情况下会通过构造函数对该成员变量进行初始化， 但有时在调用其方法时将该变量传递给适配器会更方便。</li><li>依次实现适配器类客户端接口的所有方法。 适配器会将实际工作委派给服务对象， 自身只负责接口或数据格式的转换。</li><li>客户端必须通过客户端接口使用适配器。 这样一来， 你就可以在不影响客户端代码的情况下修改或扩展适配器。</li></ol><h2 id="适配器模式优缺点"><a href="#适配器模式优缺点" class="headerlink" title="适配器模式优缺点"></a>适配器模式优缺点</h2><p>优点：</p><ul><li><em>单一职责原则</em>你可以将接口或数据转换代码从程序主要业务逻辑中分离。</li><li><em>开闭原则</em>。 只要客户端代码通过客户端接口与适配器进行交互， 你就能在不修改现有客户端代码的情况下在程序中添加新类型的适配器。</li></ul><p>缺点：</p><ul><li>代码整体复杂度增加， 因为你需要新增一系列接口和类。 有时直接更改服务类使其与其他代码兼容会更简单。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>桥接模式通常会于开发前期进行设计， 使你能够将程序的各个部分独立开来以便开发。 另一方面，适配器模式通常在已有程序中使用， 让相互不兼容的类能很好地合作。</li><li>适配器可以对已有对象的接口进行修改，装饰模式则能在不改变对象接口的前提下强化对象功能。 此外， <em>装饰</em>还支持递归组合， <em>适配器</em>则无法实现。</li><li>适配器能为被封装对象提供不同的接口， 代理模式能为对象提供相同的接口， 装饰则能为对象提供加强的接口。</li><li>外观模式为现有对象定义了一个新接口， 适配器则会试图运用已有的接口。 <em>适配器</em>通常只封装一个对象， <em>外观</em>通常会作用于整个对象子系统上。</li><li>桥接、 状态模式和策略模式 （在某种程度上包括适配器） 模式的接口非常相似。 实际上， 它们都基于组合模式——即将工作委派给其他对象， 不过也各自解决了不同的问题。 模式并不只是以特定方式组织代码的配方， 你还可以使用它们来和其他开发者讨论模式所解决的问题。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;适配器模式&quot;&gt;&lt;a href=&quot;#适配器模式&quot; class=&quot;headerlink&quot; title=&quot;适配器模式&quot;&gt;&lt;/a&gt;适配器模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;适配器模式&lt;/strong&gt;是一种结构型设计模式， 它能使接口不兼容的对象能够相互合作。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="适配器模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="适配器模式" scheme="https://blog.48626.xyz/tags/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>单例模式</title>
    <link href="https://blog.48626.xyz/bde6660858d1.html"/>
    <id>https://blog.48626.xyz/bde6660858d1.html</id>
    <published>2024-09-14T03:26:02.000Z</published>
    <updated>2024-09-14T03:26:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>单例模式</strong>是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。</p><img src="/bde6660858d1/image-20240914110319749.png" class="" alt="image-20240914110319749"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>单例模式同时解决了两个问题， 所以违反了<em>单一职责原则</em>：</p><ol><li><p><strong>保证一个类只有一个实例</strong>。 为什么会有人想要控制一个类所拥有的实例数量？ 最常见的原因是控制某些共享资源 （例如数据库或文件） 的访问权限。</p><p>它的运作方式是这样的： 如果你创建了一个对象， 同时过一会儿后你决定再创建一个新对象， 此时你会获得之前已创建的对象， 而不是一个新对象。</p><p>注意， 普通构造函数无法实现上述行为， 因为构造函数的设计决定了它<strong>必须</strong>总是返回一个新对象。</p></li></ol><img src="/bde6660858d1/image-20240914110355127.png" class="" alt="客户端甚至可能没有意识到它们一直都在使用同一个对象。"><ol start="2"><li><p><strong>为该实例提供一个全局访问节点</strong>。 还记得你 （好吧， 其实是我自己） 用过的那些存储重要对象的全局变量吗？ 它们在使用上十分方便， 但同时也非常不安全， 因为任何代码都有可能覆盖掉那些变量的内容， 从而引发程序崩溃。</p><p>和全局变量一样， 单例模式也允许在程序的任何地方访问特定对象。 但是它可以保护该实例不被其他代码覆盖。</p><p>还有一点： 你不会希望解决同一个问题的代码分散在程序各处的。 因此更好的方式是将其放在同一个类中， 特别是当其他代码已经依赖这个类时更应该如此。</p></li></ol><p>如今， 单例模式已经变得非常流行， 以至于人们会将只解决上文描述中任意一个问题的东西称为<em>单例</em>。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>所有单例的实现都包含以下两个相同的步骤：</p><ul><li>将默认构造函数设为私有， 防止其他对象使用单例类的 <code>new</code>运算符。</li><li>新建一个静态构建方法作为构造函数。 该函数会 “偷偷” 调用私有构造函数来创建对象， 并将其保存在一个静态成员变量中。 此后所有对于该函数的调用都将返回这一缓存对象。</li></ul><p>如果你的代码能够访问单例类， 那它就能调用单例类的静态方法。 无论何时调用该方法， 它总是会返回相同的对象。</p><h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><p>政府是单例模式的一个很好的示例。 一个国家只有一个官方政府。 不管组成政府的每个人的身份是什么，  “某政府” 这一称谓总是鉴别那些掌权者的全局访问节点。</p><h2 id="单例模式结构"><a href="#单例模式结构" class="headerlink" title="单例模式结构"></a>单例模式结构</h2><img src="/bde6660858d1/image-20240914110634553.png" class="" alt="image-20240914110634553"><ol><li><p><strong>单例</strong> （Singleton） 类声明了一个名为 <code>get­Instance</code>获取实例的静态方法来返回其所属类的一个相同实例。</p><p>单例的构造函数必须对客户端 （Client） 代码隐藏。 调用 <code>获取实例</code>方法必须是获取单例对象的唯一方式。</p></li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="基础单例（单线程）"><a href="#基础单例（单线程）" class="headerlink" title="基础单例（单线程）"></a>基础单例（单线程）</h3><p>实现一个粗糙的单例非常简单。 你仅需隐藏构造函数并实现一个静态的构建方法即可。</p><h4 id="Singleton-java-单例"><a href="#Singleton-java-单例" class="headerlink" title="Singleton.java: 单例"></a><strong>Singleton.java:</strong> 单例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 上午11:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">public</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">// 下面的代码模拟缓慢的初始化。</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="MainSingleThread-java-客户端代码"><a href="#MainSingleThread-java-客户端代码" class="headerlink" title="MainSingleThread.java: 客户端代码"></a><strong>MainSingleThread.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 上午11:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainSingleThread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;If you see the same value, then singleton was reused (yay!)&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;If you see different values, then 2 singletons were created (booo!!)&quot;</span> + <span class="string">&quot;\n\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;RESULT:&quot;</span> + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">singleton</span> <span class="operator">=</span> Singleton.getInstance(<span class="string">&quot;FOO&quot;</span>);</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">anotherSingleton</span> <span class="operator">=</span> Singleton.getInstance(<span class="string">&quot;BAR&quot;</span>);</span><br><span class="line">        System.out.println(singleton.value);</span><br><span class="line">        System.out.println(anotherSingleton.value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="基础单例（多线程）"><a href="#基础单例（多线程）" class="headerlink" title="基础单例（多线程）"></a>基础单例（多线程）</h3><p>相同的类在多线程环境中会出错。 多线程可能会同时调用构建方法并获取多个单例类的实例。</p><h4 id="MultiSingleton-java-单例"><a href="#MultiSingleton-java-单例" class="headerlink" title="MultiSingleton.java: 单例"></a><strong>MultiSingleton.java:</strong> 单例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 上午11:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MultiSingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MultiSingleton instance;</span><br><span class="line">    <span class="keyword">public</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">MultiSingleton</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">// 下面的代码模拟缓慢的初始化。</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MultiSingleton <span class="title function_">getInstance</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">MultiSingleton</span>(value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="MainMultiThread-java-客户端代码"><a href="#MainMultiThread-java-客户端代码" class="headerlink" title="MainMultiThread.java: 客户端代码"></a><strong>MainMultiThread.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 上午11:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainMultiThread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;If you see the same value, then singleton was reused (yay!)&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;If you see different values, then 2 singletons were created (booo!!)&quot;</span> + <span class="string">&quot;\n\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;RESULT:&quot;</span> + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadFoo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ThreadFoo</span>());</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadBar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ThreadBar</span>());</span><br><span class="line">        threadFoo.start();</span><br><span class="line">        threadBar.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadFoo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">MultiSingleton</span> <span class="variable">singleton</span> <span class="operator">=</span> MultiSingleton.getInstance(<span class="string">&quot;FOO&quot;</span>);</span><br><span class="line">            System.out.println(singleton.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadBar</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">MultiSingleton</span> <span class="variable">singleton</span> <span class="operator">=</span> MultiSingleton.getInstance(<span class="string">&quot;BAR&quot;</span>);</span><br><span class="line">            System.out.println(singleton.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="采用延迟加载的线程安全单例"><a href="#采用延迟加载的线程安全单例" class="headerlink" title="采用延迟加载的线程安全单例"></a>采用延迟加载的线程安全单例</h2><p>为了解决这个问题， 你必须在创建首个单例对象时对线程进行同步。</p><h4 id="MultiSingleton2-java-单例"><a href="#MultiSingleton2-java-单例" class="headerlink" title="MultiSingleton2.java: 单例"></a><strong>MultiSingleton2.java:</strong> 单例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 上午11:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiSingleton2</span> &#123;</span><br><span class="line">    <span class="comment">// 该字段必须声明为volatile，以便双重检查锁定可以工作</span></span><br><span class="line">    <span class="comment">// 正确。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> MultiSingleton2 instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">MultiSingleton2</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MultiSingleton2 <span class="title function_">getInstance</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里采取的方法称为双重检查锁定 (DCL)。它</span></span><br><span class="line">        <span class="comment">// 存在以防止多个线程之间的争用条件</span></span><br><span class="line">        <span class="comment">// 尝试同时获取单例实例，创建单独的</span></span><br><span class="line">        <span class="comment">// 实例作为结果。</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// 似乎这里的 &#x27;result&#x27; 变量完全是</span></span><br><span class="line">        <span class="comment">// 毫无意义。然而，有一个非常重要的警告</span></span><br><span class="line">        <span class="comment">// 在Java中实现双重检查锁定，这由</span></span><br><span class="line">        <span class="comment">// 引入这个局部变量。</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// 您可以在Java中阅读更多信息DCL问题:</span></span><br><span class="line">        <span class="comment">// https://refactoring.guru/java-dcl-issue</span></span><br><span class="line">        <span class="type">MultiSingleton2</span> <span class="variable">result</span> <span class="operator">=</span> instance;</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">synchronized</span> (MultiSingleton2.class) &#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                instance = <span class="keyword">new</span> <span class="title class_">MultiSingleton2</span>(value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="MainMultiThread2-java-客户端代码"><a href="#MainMultiThread2-java-客户端代码" class="headerlink" title="MainMultiThread2.java: 客户端代码"></a><strong>MainMultiThread2.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端代码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/14 上午11:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainMultiThread2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;If you see the same value, then singleton was reused (yay!)&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;If you see different values, then 2 singletons were created (booo!!)&quot;</span> + <span class="string">&quot;\n\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;RESULT:&quot;</span> + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadFoo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ThreadFoo</span>());</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadBar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">ThreadBar</span>());</span><br><span class="line">        threadFoo.start();</span><br><span class="line">        threadBar.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadFoo</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">MultiSingleton2</span> <span class="variable">singleton</span> <span class="operator">=</span> MultiSingleton2.getInstance(<span class="string">&quot;FOO&quot;</span>);</span><br><span class="line">            System.out.println(singleton.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadBar</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">MultiSingleton2</span> <span class="variable">singleton</span> <span class="operator">=</span> MultiSingleton2.getInstance(<span class="string">&quot;BAR&quot;</span>);</span><br><span class="line">            System.out.println(singleton.value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="单例模式适合应用场景"><a href="#单例模式适合应用场景" class="headerlink" title="单例模式适合应用场景"></a>单例模式适合应用场景</h2><p><strong>如果程序中的某个类对于所有客户端只有一个可用的实例，可以使用单例模式。</strong></p><p>单例模式禁止通过除特殊构建方法以外的任何方式来创建自身类的对象。 该方法可以创建一个新对象， 但如果该对象已经被创建， 则返回已有的对象。</p><p><strong>如果你需要更加严格地控制全局变量，可以使用单例模式。</strong></p><p>单例模式与全局变量不同， 它保证类只存在一个实例。 除了单例类自己以外， 无法通过任何方式替换缓存的实例。</p><p>请注意， 你可以随时调整限制并设定生成单例实例的数量， 只需修改 <code>获取实例</code>方法， 即 getInstance 中的代码即可实现。</p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li>在类中添加一个私有静态成员变量用于保存单例实例。</li><li>声明一个公有静态构建方法用于获取单例实例。</li><li>在静态方法中实现”延迟初始化”。 该方法会在首次被调用时创建一个新对象， 并将其存储在静态成员变量中。 此后该方法每次被调用时都返回该实例。</li><li>将类的构造函数设为私有。 类的静态方法仍能调用构造函数， 但是其他对象不能调用。</li><li>检查客户端代码， 将对单例的构造函数的调用替换为对其静态构建方法的调用。</li></ol><h2 id="单例模式优缺点"><a href="#单例模式优缺点" class="headerlink" title="单例模式优缺点"></a>单例模式优缺点</h2><p>优点：</p><ul><li>你可以保证一个类只有一个实例。</li><li>你获得了一个指向该实例的全局访问节点。</li><li>仅在首次请求单例对象时对其进行初始化。</li></ul><p>缺点：</p><ul><li>违反了<em>单一职责原则</em>。 该模式同时解决了两个问题。</li><li>单例模式可能掩盖不良设计， 比如程序各组件之间相互了解过多等。</li><li>该模式在多线程环境下需要进行特殊处理， 避免多个线程多次创建单例对象。</li><li>单例的客户端代码单元测试可能会比较困难， 因为许多测试框架以基于继承的方式创建模拟对象。 由于单例类的构造函数是私有的， 而且绝大部分语言无法重写静态方法， 所以你需要想出仔细考虑模拟单例的方法。 要么干脆不编写测试代码， 或者不使用单例模式。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>外观模式类通常可以转换为单例模式类， 因为在大部分情况下一个外观对象就足够了。</li><li>如果你能将对象的所有共享状态简化为一个享元对象， 那么享元模式就和单例类似了。 但这两个模式有两个根本性的不同。<ol><li>只会有一个单例实体， 但是<em>享元</em>类可以有多个实体， 各实体的内在状态也可以不同。</li><li><em>单例</em>对象可以是可变的。 享元对象是不可变的。</li></ol></li><li>抽象工厂模式、生成器模式和原型模式都可以用单例来实现。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;单例模式&quot;&gt;&lt;a href=&quot;#单例模式&quot; class=&quot;headerlink&quot; title=&quot;单例模式&quot;&gt;&lt;/a&gt;单例模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;单例模式&lt;/strong&gt;是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="单例模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="单例模式" scheme="https://blog.48626.xyz/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>原型模式</title>
    <link href="https://blog.48626.xyz/0ab9b21e79c2.html"/>
    <id>https://blog.48626.xyz/0ab9b21e79c2.html</id>
    <published>2024-09-13T09:48:50.000Z</published>
    <updated>2024-09-13T09:48:50.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>原型模式</strong>是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。</p><img src="/0ab9b21e79c2/image-20240913171342153.png" class="" alt="image-20240913171342153"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>如果你有一个对象， 并希望生成与其完全相同的一个复制品， 你该如何实现呢？ 首先， 你必须新建一个属于相同类的对象。 然后， 你必须遍历原始对象的所有成员变量， 并将成员变量值复制到新对象中。</p><p>不错！ 但有个小问题。 并非所有对象都能通过这种方式进行复制， 因为有些对象可能拥有私有成员变量， 它们在对象本身以外是不可见的。</p><img src="/0ab9b21e79c2/image-20240913171425564.png" class="" alt="从外部” 复制对象并非总是可行。"><p>直接复制还有另外一个问题。 因为你必须知道对象所属的类才能创建复制品， 所以代码必须依赖该类。 即使你可以接受额外的依赖性， 那还有另外一个问题： 有时你只知道对象所实现的接口， 而不知道其所属的具体类， 比如可向方法的某个参数传入实现了某个接口的任何对象。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>原型模式将克隆过程委派给被克隆的实际对象。 模式为所有支持克隆的对象声明了一个通用接口， 该接口让你能够克隆对象， 同时又无需将代码和对象所属类耦合。 通常情况下， 这样的接口中仅包含一个 <code>克隆</code>方法。</p><p>所有的类对 <code>克隆</code>方法的实现都非常相似。 该方法会创建一个当前类的对象， 然后将原始对象所有的成员变量值复制到新建的类中。 你甚至可以复制私有成员变量， 因为绝大部分编程语言都允许对象访问其同类对象的私有成员变量。</p><p>支持克隆的对象即为<em>原型</em>。 当你的对象有几十个成员变量和几百种类型时， 对其进行克隆甚至可以代替子类的构造。</p><img src="/0ab9b21e79c2/image-20240913171643258.png" class="" alt="预生成原型可以代替子类的构造。"><p>其运作方式如下： 创建一系列不同类型的对象并不同的方式对其进行配置。 如果所需对象与预先配置的对象相同， 那么你只需克隆原型即可， 无需新建一个对象。</p><h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><p>现实生活中， 产品在得到大规模生产前会使用原型进行各种测试。 但在这种情况下， 原型只是一种被动的工具， 不参与任何真正的生产活动。</p><img src="/0ab9b21e79c2/image-20240913171716638.png" class="" alt="一个细胞的分裂。"><p>由于工业原型并不是真正意义上的自我复制， 因此细胞有丝分裂 （还记得生物学知识吗？） 或许是更恰当的类比。 有丝分裂会产生一对完全相同的细胞。 原始细胞就是一个原型， 它在复制体的生成过程中起到了推动作用。</p><h2 id="原型模式结构"><a href="#原型模式结构" class="headerlink" title="原型模式结构"></a>原型模式结构</h2><h3 id="基本实现"><a href="#基本实现" class="headerlink" title="基本实现"></a>基本实现</h3><img src="/0ab9b21e79c2/image-20240913171747885.png" class="" alt="image-20240913171747885"><ol><li><strong>原型</strong> （Prototype） 接口将对克隆方法进行声明。 在绝大多数情况下， 其中只会有一个名为 <code>clone</code>克隆的方法。</li><li><strong>具体原型</strong> （Concrete Prototype） 类将实现克隆方法。 除了将原始对象的数据复制到克隆体中之外， 该方法有时还需处理克隆过程中的极端情况， 例如克隆关联对象和梳理递归依赖等等。</li><li><strong>客户端</strong> （Client） 可以复制实现了原型接口的任何对象。</li></ol><h3 id="原型注册表实现"><a href="#原型注册表实现" class="headerlink" title="原型注册表实现"></a>原型注册表实现</h3><img src="/0ab9b21e79c2/image-20240913171845103.png" class="" alt="image-20240913171845103"><ol><li><strong>原型注册表</strong> （Prototype Registry） 提供了一种访问常用原型的简单方法， 其中存储了一系列可供随时复制的预生成对象。 最简单的注册表原型是一个 <code>名称 → 原型</code>的哈希表。 但如果需要使用名称以外的条件进行搜索， 你可以创建更加完善的注册表版本。</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>在本例中， <strong>原型</strong>模式能让你生成完全相同的几何对象副本， 同时无需代码与对象所属类耦合。</p><img src="/0ab9b21e79c2/image-20240913173343513.png" class="" alt="克隆一系列位于同一类层次结构中的对象。"><p>所有形状类都遵循同一个提供克隆方法的接口。 在复制自身成员变量值到结果对象前， 子类可调用其父类的克隆方法。</p><h3 id="shapes-形状列表"><a href="#shapes-形状列表" class="headerlink" title="shapes: 形状列表"></a><strong>shapes:</strong> 形状列表</h3><h4 id="shapes-Shape-java-通用形状接口"><a href="#shapes-Shape-java-通用形状接口" class="headerlink" title="shapes&#x2F;Shape.java: 通用形状接口"></a><strong>shapes&#x2F;Shape.java:</strong> 通用形状接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用形状接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 下午5:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">public</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">(Shape target)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.x = target.x;</span><br><span class="line">            <span class="built_in">this</span>.y = target.y;</span><br><span class="line">            <span class="built_in">this</span>.color = target.color;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Shape <span class="title function_">clone</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(object2 <span class="keyword">instanceof</span> Shape)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape2</span> <span class="operator">=</span> (Shape) object2;</span><br><span class="line">        <span class="keyword">return</span> shape2.x == x &amp;&amp; shape2.y == y &amp;&amp; Objects.equals(shape2.color, color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="shapes-Circle-java-简单形状"><a href="#shapes-Circle-java-简单形状" class="headerlink" title="shapes&#x2F;Circle.java: 简单形状"></a><strong>shapes&#x2F;Circle.java:</strong> 简单形状</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单形状</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 下午5:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(Circle target)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(target);</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.radius = target.radius;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(object2 <span class="keyword">instanceof</span> Circle) || !<span class="built_in">super</span>.equals(object2)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Circle</span> <span class="variable">shape2</span> <span class="operator">=</span> (Circle) object2;</span><br><span class="line">        <span class="keyword">return</span> shape2.radius == radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="shapes-Rectangle-java-另一个形状"><a href="#shapes-Rectangle-java-另一个形状" class="headerlink" title="shapes&#x2F;Rectangle.java: 另一个形状"></a><strong>shapes&#x2F;Rectangle.java:</strong> 另一个形状</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 另一个形状</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 下午5:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(Rectangle target)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(target);</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.width = target.width;</span><br><span class="line">            <span class="built_in">this</span>.height = target.height;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(object2 <span class="keyword">instanceof</span> Rectangle) || !<span class="built_in">super</span>.equals(object2)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">shape2</span> <span class="operator">=</span> (Rectangle) object2;</span><br><span class="line">        <span class="keyword">return</span> shape2.width == width &amp;&amp; shape2.height == height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Main-java-克隆示例"><a href="#Main-java-克隆示例" class="headerlink" title="Main.java: 克隆示例"></a><strong>Main.java:</strong> 克隆示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Circle;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Rectangle;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Shape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 克隆示例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 下午5:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        List&lt;Shape&gt; shapes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Shape&gt; shapesCopy = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">Circle</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">        circle.x = <span class="number">10</span>;</span><br><span class="line">        circle.y = <span class="number">20</span>;</span><br><span class="line">        circle.radius = <span class="number">15</span>;</span><br><span class="line">        circle.color = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">        shapes.add(circle);</span><br><span class="line"></span><br><span class="line">        <span class="type">Circle</span> <span class="variable">anotherCircle</span> <span class="operator">=</span> (Circle) circle.clone();</span><br><span class="line">        shapes.add(anotherCircle);</span><br><span class="line"></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        rectangle.width = <span class="number">10</span>;</span><br><span class="line">        rectangle.height = <span class="number">20</span>;</span><br><span class="line">        rectangle.color = <span class="string">&quot;blue&quot;</span>;</span><br><span class="line">        shapes.add(rectangle);</span><br><span class="line"></span><br><span class="line">        cloneAndCompare(shapes, shapesCopy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">cloneAndCompare</span><span class="params">(List&lt;Shape&gt; shapes, List&lt;Shape&gt; shapesCopy)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Shape shape : shapes) &#123;</span><br><span class="line">            shapesCopy.add(shape.clone());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; shapes.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (shapes.get(i) != shapesCopy.get(i)) &#123;</span><br><span class="line">                System.out.println(i + <span class="string">&quot;: Shapes are different objects (yay!)&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (shapes.get(i).equals(shapesCopy.get(i))) &#123;</span><br><span class="line">                    System.out.println(i + <span class="string">&quot;: And they are identical (yay!)&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(i + <span class="string">&quot;: But they are not identical (booo!)&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(i + <span class="string">&quot;: Shape objects are the same (booo!)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="原型注册站"><a href="#原型注册站" class="headerlink" title="原型注册站"></a>原型注册站</h3><p>你可以实现中心化的原型注册站 （或工厂）， 其中包含一系列预定义的原型对象。 这样一来， 你就可以通过传递对象名称或其他参数的方式从工厂处获得新的对象。 工厂将搜索合适的原型， 然后对其进行克隆复制， 最后将副本返回给你。</p><h3 id="cache"><a href="#cache" class="headerlink" title="cache"></a><strong>cache</strong></h3><h4 id="cache-BundledShapeCache-java-原型工厂"><a href="#cache-BundledShapeCache-java-原型工厂" class="headerlink" title="cache&#x2F;BundledShapeCache.java: 原型工厂"></a><strong>cache&#x2F;BundledShapeCache.java:</strong> 原型工厂</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Circle;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Rectangle;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Shape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原型工厂</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 下午5:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BundledShapeCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Shape&gt; cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BundledShapeCache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Circle</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">        circle.x = <span class="number">5</span>;</span><br><span class="line">        circle.y = <span class="number">7</span>;</span><br><span class="line">        circle.radius = <span class="number">45</span>;</span><br><span class="line">        circle.color = <span class="string">&quot;Green&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        rectangle.x = <span class="number">6</span>;</span><br><span class="line">        rectangle.y = <span class="number">9</span>;</span><br><span class="line">        rectangle.width = <span class="number">8</span>;</span><br><span class="line">        rectangle.height = <span class="number">10</span>;</span><br><span class="line">        rectangle.color = <span class="string">&quot;Blue&quot;</span>;</span><br><span class="line"></span><br><span class="line">        cache.put(<span class="string">&quot;Big green circle&quot;</span>, circle);</span><br><span class="line">        cache.put(<span class="string">&quot;Medium blue rectangle&quot;</span>, rectangle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">put</span><span class="params">(String key, Shape shape)</span> &#123;</span><br><span class="line">        cache.put(key, shape);</span><br><span class="line">        <span class="keyword">return</span> shape;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache.get(key).clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CacheMain-java-克隆示例"><a href="#CacheMain-java-克隆示例" class="headerlink" title="CacheMain.java: 克隆示例"></a><strong>CacheMain.java:</strong> 克隆示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.cache.BundledShapeCache;</span><br><span class="line"><span class="keyword">import</span> org.example.shapes.Shape;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 克隆示例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 下午5:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BundledShapeCache</span> <span class="variable">cache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BundledShapeCache</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape1</span> <span class="operator">=</span> cache.get(<span class="string">&quot;Big green circle&quot;</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape2</span> <span class="operator">=</span> cache.get(<span class="string">&quot;Medium blue rectangle&quot;</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape3</span> <span class="operator">=</span> cache.get(<span class="string">&quot;Medium blue rectangle&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shape1 != shape2 &amp;&amp; !shape1.equals(shape2)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Big green circle != Medium blue rectangle (yay!)&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Big green circle == Medium blue rectangle (booo!)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shape2 != shape3) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Medium blue rectangles are two different objects (yay!)&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (shape2.equals(shape3)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;And they are identical (yay!)&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;But they are not identical (booo!)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Rectangle objects are the same (booo!)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="原型模式适合应用场景"><a href="#原型模式适合应用场景" class="headerlink" title="原型模式适合应用场景"></a>原型模式适合应用场景</h2><p><strong>如果你需要复制一些对象，同时又希望代码独立于这些对象所属的具体类，可以使用原型模式。</strong></p><p>这一点考量通常出现在代码需要处理第三方代码通过接口传递过来的对象时。 即使不考虑代码耦合的情况， 你的代码也不能依赖这些对象所属的具体类， 因为你不知道它们的具体信息。</p><p>原型模式为客户端代码提供一个通用接口， 客户端代码可通过这一接口与所有实现了克隆的对象进行交互， 它也使得客户端代码与其所克隆的对象具体类独立开来。</p><p><strong>如果子类的区别仅在于其对象的初始化方式，那么你可以使用该模式来减少子类的数量。别人创建这些子类的目的可能是为了创建特定类型的对象。</strong></p><p>在原型模式中， 你可以使用一系列预生成的、 各种类型的对象作为原型。</p><p>客户端不必根据需求对子类进行实例化， 只需找到合适的原型并对其进行克隆即可。</p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li><p>创建原型接口， 并在其中声明 <code>克隆</code>方法。 如果你已有类层次结构， 则只需在其所有类中添加该方法即可。</p></li><li><p>原型类必须另行定义一个以该类对象为参数的构造函数。 构造函数必须复制参数对象中的所有成员变量值到新建实体中。 如果你需要修改子类， 则必须调用父类构造函数， 让父类复制其私有成员变量值。</p><p>如果编程语言不支持方法重载， 那么你可能需要定义一个特殊方法来复制对象数据。 在构造函数中进行此类处理比较方便， 因为它在调用 <code>new</code>运算符后会马上返回结果对象。</p></li><li><p>克隆方法通常只有一行代码： 使用 <code>new</code>运算符调用原型版本的构造函数。 注意， 每个类都必须显式重写克隆方法并使用自身类名调用 <code>new</code>运算符。 否则， 克隆方法可能会生成父类的对象。</p></li><li><p>你还可以创建一个中心化原型注册表， 用于存储常用原型。</p><p>你可以新建一个工厂类来实现注册表， 或者在原型基类中添加一个获取原型的静态方法。 该方法必须能够根据客户端代码设定的条件进行搜索。 搜索条件可以是简单的字符串， 或者是一组复杂的搜索参数。 找到合适的原型后， 注册表应对原型进行克隆， 并将复制生成的对象返回给客户端。</p><p>最后还要将对子类构造函数的直接调用替换为对原型注册表工厂方法的调用。</p></li></ol><h2 id="原型模式优缺点"><a href="#原型模式优缺点" class="headerlink" title="原型模式优缺点"></a>原型模式优缺点</h2><p>优点：</p><ul><li>你可以克隆对象， 而无需与它们所属的具体类相耦合。</li><li>你可以克隆预生成原型， 避免反复运行初始化代码。</li><li>你可以更方便地生成复杂对象。</li><li>你可以用继承以外的方式来处理复杂对象的不同配置。</li></ul><p>缺点：</p><ul><li>克隆包含循环引用的复杂对象可能会非常麻烦。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>在许多设计工作的初期都会使用工厂方法模式（较为简单， 而且可以更方便地通过子类进行定制）， 随后演化为使用抽象工厂模式、 原型模式或生成器模式 （更灵活但更加复杂）。</li><li>抽象工厂模式通常基于一组工厂方法， 但你也可以使用原型模式来生成这些类的方法。</li><li>原型可用于保存命令模式的历史记录。</li><li>大量使用组合模式和装饰模式的设计通常可从对于原型的使用中获益。 你可以通过该模式来复制复杂结构， 而非从零开始重新构造。</li><li>原型并不基于继承， 因此没有继承的缺点。 另一方面， <em>原型</em>需要对被复制对象进行复杂的初始化。 工厂方法基于继承， 但是它不需要初始化步骤。</li><li>有时候原型可以作为备忘录模式的一个简化版本， 其条件是你需要在历史记录中存储的对象的状态比较简单， 不需要链接其他外部资源， 或者链接可以方便地重建。</li><li>抽象工厂、 生成器和原型都可以用单例模式来实现。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;原型模式&quot;&gt;&lt;a href=&quot;#原型模式&quot; class=&quot;headerlink&quot; title=&quot;原型模式&quot;&gt;&lt;/a&gt;原型模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;原型模式&lt;/strong&gt;是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="原型模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="原型模式" scheme="https://blog.48626.xyz/tags/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>建造者模式</title>
    <link href="https://blog.48626.xyz/d3df33f31582.html"/>
    <id>https://blog.48626.xyz/d3df33f31582.html</id>
    <published>2024-09-13T07:30:16.000Z</published>
    <updated>2024-09-13T07:30:16.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>生成器模式</strong>是一种创建型设计模式， 使你能够分步骤创建复杂对象。 该模式允许你使用相同的创建代码生成不同类型和形式的对象。</p><img src="/d3df33f31582/image-20240913103719373.png" class="" alt="image-20240913103719373"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假设有这样一个复杂对象， 在对其进行构造时需要对诸多成员变量和嵌套对象进行繁复的初始化工作。 这些初始化代码通常深藏于一个包含众多参数且让人基本看不懂的构造函数中； 甚至还有更糟糕的情况， 那就是这些代码散落在客户端代码的多个位置。</p><img src="/d3df33f31582/image-20240913103807523.png" class="" alt="如果为每种可能的对象都创建一个子类， 这可能会导致程序变得过于复杂。"><p>例如， 我们来思考如何创建一个 <code>房屋</code>House对象。 建造一栋简单的房屋， 首先你需要建造四面墙和地板， 安装房门和一套窗户， 然后再建造一个屋顶。 但是如果你想要一栋更宽敞更明亮的房屋， 还要有院子和其他设施 （例如暖气、 排水和供电设备）， 那又该怎么办呢？</p><p>最简单的方法是扩展 <code>房屋</code>基类， 然后创建一系列涵盖所有参数组合的子类。 但最终你将面对相当数量的子类。 任何新增的参数 （例如门廊类型） 都会让这个层次结构更加复杂。</p><p>另一种方法则无需生成子类。 你可以在 <code>房屋</code>基类中创建一个包括所有可能参数的超级构造函数， 并用它来控制房屋对象。 这种方法确实可以避免生成子类， 但它却会造成另外一个问题。</p><img src="/d3df33f31582/image-20240913105847777.png" class="" alt="拥有大量输入参数的构造函数也有缺陷： 这些参数也不是每次都要全部用上的。"><p>通常情况下， 绝大部分的参数都没有使用， 这使得<strong>对于构造函数的调用十分不简洁</strong>。 例如， 只有很少的房子有游泳池， 因此与游泳池相关的参数十之八九是毫无用处的。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>生成器模式建议将对象构造代码从产品类中抽取出来， 并将其放在一个名为<em>生成器</em>的独立对象中。</p><img src="/d3df33f31582/image-20240913110115764.png" class="" alt="生成器模式让你能够分步骤创建复杂对象。 生成器不允许其他对象访问正在创建中的产品。"><p>该模式会将对象构造过程划分为一组步骤， 比如 <code>build­Walls</code>创建墙壁和 <code>build­Door</code>创建房门创建房门等。 每次创建对象时， 你都需要通过生成器对象执行一系列步骤。 重点在于你无需调用所有步骤， 而只需调用创建特定对象配置所需的那些步骤即可。</p><p>当你需要创建不同形式的产品时， 其中的一些构造步骤可能需要不同的实现。 例如， 木屋的房门可能需要使用木头制造， 而城堡的房门则必须使用石头制造。</p><p>在这种情况下， 你可以创建多个不同的生成器， 用不同方式实现一组相同的创建步骤。 然后你就可以在创建过程中使用这些生成器 （例如按顺序调用多个构造步骤） 来生成不同类型的对象。</p><img src="/d3df33f31582/image-20240913110457750.png" class="" alt="不同生成器以不同方式执行相同的任务。"><p>例如， 假设第一个建造者使用木头和玻璃制造房屋， 第二个建造者使用石头和钢铁， 而第三个建造者使用黄金和钻石。 在调用同一组步骤后， 第一个建造者会给你一栋普通房屋， 第二个会给你一座小城堡， 而第三个则会给你一座宫殿。 但是， 只有在调用构造步骤的客户端代码可以通过通用接口与建造者进行交互时， 这样的调用才能返回需要的房屋。</p><h3 id="主管"><a href="#主管" class="headerlink" title="主管"></a>主管</h3><p>你可以进一步将用于创建产品的一系列生成器步骤调用抽取成为单独的<em>主管</em>类。 主管类可定义创建步骤的执行顺序， 而生成器则提供这些步骤的实现。</p><img src="/d3df33f31582/image-20240913110729981.png" class="" alt="主管知道需要哪些创建步骤才能获得可正常使用的产品。"><p>严格来说， 你的程序中并不一定需要主管类。 客户端代码可直接以特定顺序调用创建步骤。 不过， 主管类中非常适合放入各种例行构造流程， 以便在程序中反复使用。</p><p>此外， 对于客户端代码来说， 主管类完全隐藏了产品构造细节。 客户端只需要将一个生成器与主管类关联， 然后使用主管类来构造产品， 就能从生成器处获得构造结果了。</p><h2 id="生成器模式结构"><a href="#生成器模式结构" class="headerlink" title="生成器模式结构"></a>生成器模式结构</h2><img src="/d3df33f31582/image-20240913110837976.png" class="" alt="image-20240913110837976"><ol><li><strong>生成器</strong> （Builder） 接口声明在所有类型生成器中通用的产品构造步骤。</li><li><strong>具体生成器</strong> （Concrete Builders） 提供构造过程的不同实现。 具体生成器也可以构造不遵循通用接口的产品。</li><li><strong>产品</strong> （Products） 是最终生成的对象。 由不同生成器构造的产品无需属于同一类层次结构或接口。</li><li><strong>主管</strong> （Director） 类定义调用构造步骤的顺序， 这样你就可以创建和复用特定的产品配置。</li><li><strong>客户端</strong> （Client） 必须将某个生成器对象与主管类关联。 一般情况下， 你只需通过主管类构造函数的参数进行一次性关联即可。 此后主管类就能使用生成器对象完成后续所有的构造任务。 但在客户端将生成器对象传递给主管类制造方法时还有另一种方式。 在这种情况下， 你在使用主管类生产产品时每次都可以使用不同的生成器。</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>下面关于<strong>生成器</strong>模式的例子演示了你可以如何复用相同的对象构造代码来生成不同类型的产品——例如汽车 （Car）——及其相应的使用手册 （Manual）。</p><img src="/d3df33f31582/image-20240913112820977.png" class="" alt="分步骤制造汽车并制作对应型号用户使用手册的示例"><p>汽车是一个复杂对象， 有数百种不同的制造方法。 我们没有在 <code>汽车</code>类中塞入一个巨型构造函数， 而是将汽车组装代码抽取到单独的汽车生成器类中。 该类中有一组方法可用来配置汽车的各种部件。</p><p>如果客户端代码需要组装一辆与众不同、 精心调教的汽车， 它可以直接调用生成器。 或者， 客户端可以将组装工作委托给主管类， 因为主管类知道如何使用生成器制造最受欢迎的几种型号汽车。</p><p>你或许会感到吃惊， 但确实每辆汽车都需要一本使用手册 （说真的， 谁会去读它们呢？）。 使用手册会介绍汽车的每一项功能， 因此不同型号的汽车， 其使用手册内容也不一样。 因此， 你可以复用现有流程来制造实际的汽车及其对应的手册。 当然， 编写手册和制造汽车不是一回事， 所以我们需要另外一个生成器对象来专门编写使用手册。 该类与其制造汽车的兄弟类都实现了相同的制造方法， 但是其功能不是制造汽车部件， 而是描述每个部件。 将这些生成器传递给相同的主管对象， 我们就能够生成一辆汽车或是一本使用手册了。</p><p>最后一个部分是获取结果对象。 尽管金属汽车和纸质手册存在关联， 但它们却是完全不同的东西。 我们无法在主管类和具体产品类不发生耦合的情况下， 在主管类中提供获取结果对象的方法。 因此， 我们只能通过负责制造过程的生成器来获取结果对象。</p><h3 id="builders"><a href="#builders" class="headerlink" title="builders"></a><strong>builders</strong></h3><h4 id="builders-Builder-java-通用生成器接口"><a href="#builders-Builder-java-通用生成器接口" class="headerlink" title="builders&#x2F;Builder.java: 通用生成器接口"></a><strong>builders&#x2F;Builder.java:</strong> 通用生成器接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.builders;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.cars.CarType;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Engine;</span><br><span class="line"><span class="keyword">import</span> org.example.components.GPSNavigator;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Transmission;</span><br><span class="line"><span class="keyword">import</span> org.example.components.TripComputer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Builder界面定义了配置产品的所有可能方法。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCarType</span><span class="params">(CarType type)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setSeats</span><span class="params">(<span class="type">int</span> seats)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setEngine</span><span class="params">(Engine engine)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setTransmission</span><span class="params">(Transmission transmission)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setTripComputer</span><span class="params">(TripComputer tripComputer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setGPSNavigator</span><span class="params">(GPSNavigator gpsNavigator)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="builders-CarBuilder-java-汽车生成器"><a href="#builders-CarBuilder-java-汽车生成器" class="headerlink" title="builders&#x2F;CarBuilder.java: 汽车生成器"></a><strong>builders&#x2F;CarBuilder.java:</strong> 汽车生成器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.builders;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.cars.Car;</span><br><span class="line"><span class="keyword">import</span> org.example.cars.CarType;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Engine;</span><br><span class="line"><span class="keyword">import</span> org.example.components.GPSNavigator;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Transmission;</span><br><span class="line"><span class="keyword">import</span> org.example.components.TripComputer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 汽车生成器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarBuilder</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CarType type;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> seats;</span><br><span class="line">    <span class="keyword">private</span> Engine engine;</span><br><span class="line">    <span class="keyword">private</span> Transmission transmission;</span><br><span class="line">    <span class="keyword">private</span> TripComputer tripComputer;</span><br><span class="line">    <span class="keyword">private</span> GPSNavigator gpsNavigator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCarType</span><span class="params">(CarType type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSeats</span><span class="params">(<span class="type">int</span> seats)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.seats = seats;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEngine</span><span class="params">(Engine engine)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTransmission</span><span class="params">(Transmission transmission)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.transmission = transmission;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTripComputer</span><span class="params">(TripComputer tripComputer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tripComputer = tripComputer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGPSNavigator</span><span class="params">(GPSNavigator gpsNavigator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gpsNavigator = gpsNavigator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Car <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Car</span>(type, seats, engine, transmission, tripComputer, gpsNavigator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="builders-CarManualBuilder-java-汽车手册生成器"><a href="#builders-CarManualBuilder-java-汽车手册生成器" class="headerlink" title="builders&#x2F;CarManualBuilder.java: 汽车手册生成器"></a><strong>builders&#x2F;CarManualBuilder.java:</strong> 汽车手册生成器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.builders;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.cars.CarType;</span><br><span class="line"><span class="keyword">import</span> org.example.cars.Manual;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Engine;</span><br><span class="line"><span class="keyword">import</span> org.example.components.GPSNavigator;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Transmission;</span><br><span class="line"><span class="keyword">import</span> org.example.components.TripComputer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 汽车手册生成器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarManualBuilder</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CarType type;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> seats;</span><br><span class="line">    <span class="keyword">private</span> Engine engine;</span><br><span class="line">    <span class="keyword">private</span> Transmission transmission;</span><br><span class="line">    <span class="keyword">private</span> TripComputer tripComputer;</span><br><span class="line">    <span class="keyword">private</span> GPSNavigator gpsNavigator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCarType</span><span class="params">(CarType type)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSeats</span><span class="params">(<span class="type">int</span> seats)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.seats = seats;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEngine</span><span class="params">(Engine engine)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTransmission</span><span class="params">(Transmission transmission)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.transmission = transmission;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTripComputer</span><span class="params">(TripComputer tripComputer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tripComputer = tripComputer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGPSNavigator</span><span class="params">(GPSNavigator gpsNavigator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gpsNavigator = gpsNavigator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Manual <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Manual</span>(type, seats, engine, transmission, tripComputer, gpsNavigator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="cars"><a href="#cars" class="headerlink" title="cars"></a><strong>cars</strong></h3><h4 id="cars-Car-java-汽车产品"><a href="#cars-Car-java-汽车产品" class="headerlink" title="cars&#x2F;Car.java: 汽车产品"></a><strong>cars&#x2F;Car.java:</strong> 汽车产品</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.cars;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.components.Engine;</span><br><span class="line"><span class="keyword">import</span> org.example.components.GPSNavigator;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Transmission;</span><br><span class="line"><span class="keyword">import</span> org.example.components.TripComputer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 汽车产品</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CarType carType;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> seats;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Engine engine;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Transmission transmission;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TripComputer tripComputer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GPSNavigator gpsNavigator;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="variable">fuel</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">(CarType carType, <span class="type">int</span> seats, Engine engine, Transmission transmission,</span></span><br><span class="line"><span class="params">               TripComputer tripComputer, GPSNavigator gpsNavigator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.carType = carType;</span><br><span class="line">        <span class="built_in">this</span>.seats = seats;</span><br><span class="line">        <span class="built_in">this</span>.engine = engine;</span><br><span class="line">        <span class="built_in">this</span>.transmission = transmission;</span><br><span class="line">        <span class="built_in">this</span>.tripComputer = tripComputer;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.tripComputer != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.tripComputer.setCar(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.gpsNavigator = gpsNavigator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CarType <span class="title function_">getCarType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> carType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getFuel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fuel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFuel</span><span class="params">(<span class="type">double</span> fuel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.fuel = fuel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSeats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> seats;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Engine <span class="title function_">getEngine</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> engine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Transmission <span class="title function_">getTransmission</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> transmission;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> TripComputer <span class="title function_">getTripComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tripComputer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GPSNavigator <span class="title function_">getGpsNavigator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gpsNavigator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="cars-Manual-java-手册产品"><a href="#cars-Manual-java-手册产品" class="headerlink" title="cars&#x2F;Manual.java: 手册产品"></a><strong>cars&#x2F;Manual.java:</strong> 手册产品</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.cars;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.components.Engine;</span><br><span class="line"><span class="keyword">import</span> org.example.components.GPSNavigator;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Transmission;</span><br><span class="line"><span class="keyword">import</span> org.example.components.TripComputer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 手册产品</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Manual</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CarType carType;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> seats;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Engine engine;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Transmission transmission;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TripComputer tripComputer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GPSNavigator gpsNavigator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Manual</span><span class="params">(CarType carType, <span class="type">int</span> seats, Engine engine, Transmission transmission,</span></span><br><span class="line"><span class="params">                  TripComputer tripComputer, GPSNavigator gpsNavigator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.carType = carType;</span><br><span class="line">        <span class="built_in">this</span>.seats = seats;</span><br><span class="line">        <span class="built_in">this</span>.engine = engine;</span><br><span class="line">        <span class="built_in">this</span>.transmission = transmission;</span><br><span class="line">        <span class="built_in">this</span>.tripComputer = tripComputer;</span><br><span class="line">        <span class="built_in">this</span>.gpsNavigator = gpsNavigator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        info += <span class="string">&quot;Type of car: &quot;</span> + carType + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        info += <span class="string">&quot;Count of seats: &quot;</span> + seats + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        info += <span class="string">&quot;Engine: volume - &quot;</span> + engine.getVolume() + <span class="string">&quot;; mileage - &quot;</span> + engine.getMileage() + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        info += <span class="string">&quot;Transmission: &quot;</span> + transmission + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.tripComputer != <span class="literal">null</span>) &#123;</span><br><span class="line">            info += <span class="string">&quot;Trip Computer: Functional&quot;</span> + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            info += <span class="string">&quot;Trip Computer: N/A&quot;</span> + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.gpsNavigator != <span class="literal">null</span>) &#123;</span><br><span class="line">            info += <span class="string">&quot;GPS Navigator: Functional&quot;</span> + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            info += <span class="string">&quot;GPS Navigator: N/A&quot;</span> + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="cars-CarType-java"><a href="#cars-CarType-java" class="headerlink" title="cars&#x2F;CarType.java"></a><strong>cars&#x2F;CarType.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.cars;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 汽车类型</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CarType</span> &#123;</span><br><span class="line">    CITY_CAR, SPORTS_CAR, SUV</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="components"><a href="#components" class="headerlink" title="components"></a><strong>components</strong></h3><h4 id="components-Engine-java-产品特征-1"><a href="#components-Engine-java-产品特征-1" class="headerlink" title="components&#x2F;Engine.java: 产品特征 1"></a><strong>components&#x2F;Engine.java:</strong> 产品特征 1</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.components;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 产品特征 1</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Engine</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> volume;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> mileage;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> started;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Engine</span><span class="params">(<span class="type">double</span> volume, <span class="type">double</span> mileage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.volume = volume;</span><br><span class="line">        <span class="built_in">this</span>.mileage = mileage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">on</span><span class="params">()</span> &#123;</span><br><span class="line">        started = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">off</span><span class="params">()</span> &#123;</span><br><span class="line">        started = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isStarted</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> started;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">go</span><span class="params">(<span class="type">double</span> mileage)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (started) &#123;</span><br><span class="line">            <span class="built_in">this</span>.mileage += mileage;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;不能去 ()，你必须先启动引擎!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getVolume</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> volume;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getMileage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mileage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="components-GPSNavigator-java-产品特征-2"><a href="#components-GPSNavigator-java-产品特征-2" class="headerlink" title="components&#x2F;GPSNavigator.java: 产品特征 2"></a><strong>components&#x2F;GPSNavigator.java:</strong> 产品特征 2</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.components;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 产品特征 2</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GPSNavigator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String route;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GPSNavigator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.route = <span class="string">&quot;221b，贝克街，伦敦到苏格兰场，8-10百老汇，伦敦&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GPSNavigator</span><span class="params">(String manualRoute)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.route = manualRoute;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRoute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> route;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="components-Transmission-java-产品特征-3"><a href="#components-Transmission-java-产品特征-3" class="headerlink" title="components&#x2F;Transmission.java: 产品特征 3"></a><strong>components&#x2F;Transmission.java:</strong> 产品特征 3</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.components;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 产品特征 3</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Transmission</span> &#123;</span><br><span class="line">    SINGLE_SPEED, MANUAL, AUTOMATIC, SEMI_AUTOMATIC</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="components-TripComputer-java-产品特征-4"><a href="#components-TripComputer-java-产品特征-4" class="headerlink" title="components&#x2F;TripComputer.java: 产品特征 4"></a><strong>components&#x2F;TripComputer.java:</strong> 产品特征 4</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.cars.Car;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 产品特征 4</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TripComputer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCar</span><span class="params">(Car car)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.car = car;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showFuelLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Fuel level: &quot;</span> + car.getFuel());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.car.getEngine().isStarted()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Car is started&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Car isn&#x27;t started&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="director"><a href="#director" class="headerlink" title="director"></a><strong>director</strong></h3><h4 id="director-Director-java-主管控制生成器"><a href="#director-Director-java-主管控制生成器" class="headerlink" title="director&#x2F;Director.java: 主管控制生成器"></a><strong>director&#x2F;Director.java:</strong> 主管控制生成器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.director;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.builders.Builder;</span><br><span class="line"><span class="keyword">import</span> org.example.cars.CarType;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Engine;</span><br><span class="line"><span class="keyword">import</span> org.example.components.GPSNavigator;</span><br><span class="line"><span class="keyword">import</span> org.example.components.Transmission;</span><br><span class="line"><span class="keyword">import</span> org.example.components.TripComputer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主管控制生成器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/13 上午11:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Director</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">constructSportsCar</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        builder.setCarType(CarType.SPORTS_CAR);</span><br><span class="line">        builder.setSeats(<span class="number">2</span>);</span><br><span class="line">        builder.setEngine(<span class="keyword">new</span> <span class="title class_">Engine</span>(<span class="number">3.0</span>, <span class="number">0</span>));</span><br><span class="line">        builder.setTransmission(Transmission.SEMI_AUTOMATIC);</span><br><span class="line">        builder.setTripComputer(<span class="keyword">new</span> <span class="title class_">TripComputer</span>());</span><br><span class="line">        builder.setGPSNavigator(<span class="keyword">new</span> <span class="title class_">GPSNavigator</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">constructCityCar</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        builder.setCarType(CarType.CITY_CAR);</span><br><span class="line">        builder.setSeats(<span class="number">2</span>);</span><br><span class="line">        builder.setEngine(<span class="keyword">new</span> <span class="title class_">Engine</span>(<span class="number">1.2</span>, <span class="number">0</span>));</span><br><span class="line">        builder.setTransmission(Transmission.AUTOMATIC);</span><br><span class="line">        builder.setTripComputer(<span class="keyword">new</span> <span class="title class_">TripComputer</span>());</span><br><span class="line">        builder.setGPSNavigator(<span class="keyword">new</span> <span class="title class_">GPSNavigator</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">constructSUV</span><span class="params">(Builder builder)</span> &#123;</span><br><span class="line">        builder.setCarType(CarType.SUV);</span><br><span class="line">        builder.setSeats(<span class="number">4</span>);</span><br><span class="line">        builder.setEngine(<span class="keyword">new</span> <span class="title class_">Engine</span>(<span class="number">2.5</span>, <span class="number">0</span>));</span><br><span class="line">        builder.setTransmission(Transmission.MANUAL);</span><br><span class="line">        builder.setGPSNavigator(<span class="keyword">new</span> <span class="title class_">GPSNavigator</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="生成器模式适合应用场景"><a href="#生成器模式适合应用场景" class="headerlink" title="生成器模式适合应用场景"></a>生成器模式适合应用场景</h2><p><strong>使用生成器模式可避免“重叠构造函数（telescoping constructor）”的出现。</strong></p><p>假设你的构造函数中有十个可选参数， 那么调用该函数会非常不方便； 因此， 你需要重载这个构造函数， 新建几个只有较少参数的简化版。 但这些构造函数仍需调用主构造函数， 传递一些默认数值来替代省略掉的参数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pizza</span> &#123;</span><br><span class="line">    Pizza(<span class="type">int</span> size) &#123; …… &#125;</span><br><span class="line">    Pizza(<span class="type">int</span> size, <span class="type">boolean</span> cheese) &#123; …… &#125;</span><br><span class="line">    Pizza(<span class="type">int</span> size, <span class="type">boolean</span> cheese, <span class="type">boolean</span> pepperoni) &#123; …… &#125;</span><br><span class="line">    <span class="comment">// ……</span></span><br></pre></td></tr></table></figure><p>只有在 C# 或 Java 等支持方法重载的编程语言中才能写出如此复杂的构造函数。</p><p>生成器模式让你可以分步骤生成对象， 而且允许你仅使用必须的步骤。 应用该模式后， 你再也不需要将几十个参数塞进构造函数里了。</p><p><strong>当你希望使用代码创建不同形式的产品 （例如石头或木头房屋） 时， 可使用生成器模式。</strong></p><p>如果你需要创建的各种形式的产品， 它们的制造过程相似且仅有细节上的差异， 此时可使用生成器模式。</p><p>基本生成器接口中定义了所有可能的制造步骤， 具体生成器将实现这些步骤来制造特定形式的产品。 同时， 主管类将负责管理制造步骤的顺序。</p><p> <strong>使用生成器构造组合树或其他复杂对象。</strong></p><p>生成器模式让你能分步骤构造产品。 你可以延迟执行某些步骤而不会影响最终产品。 你甚至可以递归调用这些步骤， 这在创建对象树时非常方便。</p><p>生成器在执行制造步骤时， 不能对外发布未完成的产品。 这可以避免客户端代码获取到不完整结果对象的情况。</p><h2 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h2><ol><li><p>清晰地定义通用步骤， 确保它们可以制造所有形式的产品。 否则你将无法进一步实施该模式。</p></li><li><p>在基本生成器接口中声明这些步骤。</p></li><li><p>为每个形式的产品创建具体生成器类， 并实现其构造步骤。</p><p>不要忘记实现获取构造结果对象的方法。 你不能在生成器接口中声明该方法， 因为不同生成器构造的产品可能没有公共接口， 因此你就不知道该方法返回的对象类型。 但是， 如果所有产品都位于单一类层次中， 你就可以安全地在基本接口中添加获取生成对象的方法。</p></li><li><p>考虑创建主管类。 它可以使用同一生成器对象来封装多种构造产品的方式。</p></li><li><p>客户端代码会同时创建生成器和主管对象。 构造开始前， 客户端必须将生成器对象传递给主管对象。 通常情况下， 客户端只需调用主管类构造函数一次即可。 主管类使用生成器对象完成后续所有制造任务。 还有另一种方式， 那就是客户端可以将生成器对象直接传递给主管类的制造方法。</p></li><li><p>只有在所有产品都遵循相同接口的情况下， 构造结果可以直接通过主管类获取。 否则， 客户端应当通过生成器获取构造结果。</p></li></ol><h2 id="生成器模式优缺点"><a href="#生成器模式优缺点" class="headerlink" title="生成器模式优缺点"></a>生成器模式优缺点</h2><p>优点：</p><ul><li>你可以分步创建对象， 暂缓创建步骤或递归运行创建步骤。</li><li>生成不同形式的产品时， 你可以复用相同的制造代码。</li><li><em>单一职责原则</em>。 你可以将复杂构造代码从产品的业务逻辑中分离出来。</li></ul><p>缺点：</p><ul><li>由于该模式需要新增多个类， 因此代码整体复杂程度会有所增加。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>在许多设计工作的初期都会使用工厂方法模式（较为简单， 而且可以更方便地通过子类进行定制）， 随后演化为使用抽象工厂模式、 原型模式或生成器模式（更灵活但更加复杂）。</li><li>生成器重点关注如何分步生成复杂对象。抽象工厂专门用于生产一系列相关对象。 <em>抽象工厂</em>会马上返回产品， <em>生成器</em>则允许你在获取产品前执行一些额外构造步骤。</li><li>你可以在创建复杂组合模式树时使用生成器， 因为这可使其构造步骤以递归的方式运行。</li><li>你可以结合使用生成器和桥接模式： <em>主管</em>类负责抽象工作， 各种不同的<em>生成器</em>负责<em>实现</em>工作。</li><li>抽象工厂、 生成器和原型都可以用单例模式来实现。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;建造者模式&quot;&gt;&lt;a href=&quot;#建造者模式&quot; class=&quot;headerlink&quot; title=&quot;建造者模式&quot;&gt;&lt;/a&gt;建造者模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;生成器模式&lt;/strong&gt;是一种创建型设计模式， 使你能够分步骤创建复杂对象。 该模式允许你使用相同的创建代码生成不同类型和形式的对象。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="建造者模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="建造者模式" scheme="https://blog.48626.xyz/tags/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>抽象工厂模式</title>
    <link href="https://blog.48626.xyz/e385baf06d73.html"/>
    <id>https://blog.48626.xyz/e385baf06d73.html</id>
    <published>2024-09-12T11:28:25.000Z</published>
    <updated>2024-09-12T11:28:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>抽象工厂模式</strong>是一种创建型设计模式， 它能创建一系列相关的对象， 而无需指定其具体类。</p><img src="/e385baf06d73/image-20240912164552024.png" class="" alt="image-20240912164552024"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假设你正在开发一款家具商店模拟器。 你的代码中包括一些类， 用于表示：</p><ol><li>一系列相关产品， 例如 <code>椅子</code>Chair 、  <code>沙发</code>Sofa和 <code>咖啡桌</code>Coffee­Table 。</li><li>系列产品的不同变体。 例如， 你可以使用 <code>现代</code>Modern 、  <code>维多利亚</code>Victorian 、  <code>装饰风艺术</code>Art­Deco等风格生成 <code>椅子</code> 、  <code>沙发</code>和 <code>咖啡桌</code> 。</li></ol><img src="/e385baf06d73/image-20240912165123084.png" class="" alt="系列产品及其不同变体。"><p>你需要设法单独生成每件家具对象， 这样才能确保其风格一致。 如果顾客收到的家具风格不一样， 他们可不会开心。</p><img src="/e385baf06d73/image-20240912165204693.png" class="" alt="现代风格的沙发和维多利亚风格的椅子不搭。"><p>此外， 你也不希望在添加新产品或新风格时修改已有代码。 家具供应商对于产品目录的更新非常频繁， 你不会想在每次更新时都去修改核心代码的。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>首先， 抽象工厂模式建议为系列中的每件产品明确声明接口 （例如椅子、 沙发或咖啡桌）。 然后， 确保所有产品变体都继承这些接口。 例如， 所有风格的椅子都实现 <code>椅子</code>接口； 所有风格的咖啡桌都实现 <code>咖啡桌</code>接口， 以此类推。</p><img src="/e385baf06d73/image-20240912170138049.png" class="" alt="同一对象的所有变体都必须放置在同一个类层次结构之中。"><p>接下来， 我们需要声明<em>抽象工厂</em>——包含系列中所有产品构造方法的接口。 例如 <code>create­Chair</code>创建椅子 、  <code>create­Sofa</code>创建沙发和 <code>create­Coffee­Table</code>创建咖啡桌 。 这些方法必须返回<strong>抽象</strong>产品类型， 即我们之前抽取的那些接口：  <code>椅子</code> ，  <code>沙发</code>和 <code>咖啡桌</code>等等。</p><img src="/e385baf06d73/image-20240912170208152.png" class="" alt="每个具体工厂类都对应一个特定的产品变体。"><p>那么该如何处理产品变体呢？ 对于系列产品的每个变体， 我们都将基于 <code>抽象工厂</code>接口创建不同的工厂类。 每个工厂类都只能返回特定类别的产品， 例如，  <code>现代家具工厂</code>Modern­Furniture­Factory只能创建 <code>现代椅子</code>Modern­Chair 、  <code>现代沙发</code>Modern­Sofa和 <code>现代咖啡桌</code>Modern­Coffee­Table对象。</p><p>客户端代码可以通过相应的抽象接口调用工厂和产品类。 你无需修改实际客户端代码， 就能更改传递给客户端的工厂类， 也能更改客户端代码接收的产品变体。</p><img src="/e385baf06d73/image-20240912173230543.png" class="" alt="客户端无需了解其所调用工厂的具体类信息。"><p>假设客户端想要工厂创建一把椅子。 客户端无需了解工厂类， 也不用管工厂类创建出的椅子类型。 无论是现代风格， 还是维多利亚风格的椅子， 对于客户端来说没有分别， 它只需调用抽象 <code>椅子</code>接口就可以了。 这样一来， 客户端只需知道椅子以某种方式实现了 <code>sit­On</code>坐下方法就足够了。 此外， 无论工厂返回的是何种椅子变体， 它都会和由同一工厂对象创建的沙发或咖啡桌风格一致。</p><p>最后一点说明： 如果客户端仅接触抽象接口， 那么谁来创建实际的工厂对象呢？ 一般情况下， 应用程序会在初始化阶段创建具体工厂对象。 而在此之前， 应用程序必须根据配置文件或环境设定选择工厂类别。</p><h2 id="抽象工厂模式结构"><a href="#抽象工厂模式结构" class="headerlink" title="抽象工厂模式结构"></a>抽象工厂模式结构</h2><img src="/e385baf06d73/image-20240912173436578.png" class="" alt="image-20240912173436578"><ol><li><strong>抽象产品</strong> （Abstract Product） 为构成系列产品的一组不同但相关的产品声明接口。</li><li><strong>具体产品</strong> （Concrete Product） 是抽象产品的多种不同类型实现。 所有变体 （维多利亚&#x2F;现代） 都必须实现相应的抽象产品 （椅子&#x2F;沙发）。</li><li><strong>抽象工厂</strong> （Abstract Factory） 接口声明了一组创建各种抽象产品的方法。</li><li><strong>具体工厂</strong> （Concrete Factory） 实现抽象工厂的构建方法。 每个具体工厂都对应特定产品变体， 且仅创建此种产品变体。</li><li>尽管具体工厂会对具体产品进行初始化， 其构建方法签名必须返回相应的<em>抽象</em>产品。 这样， 使用工厂类的客户端代码就不会与工厂创建的特定产品变体耦合。 <strong>客户端</strong> （Client） 只需通过抽象接口调用工厂和产品对象， 就能与任何具体工厂&#x2F;产品变体交互。</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>下面例子通过应用<strong>抽象工厂</strong>模式， 使得客户端代码无需与具体 UI 类耦合， 就能创建跨平台的 UI 元素， 同时确保所创建的元素与指定的操作系统匹配。</p><img src="/e385baf06d73/image-20240912173914736.png" class="" alt="跨平台 UI 类示例。"><p>跨平台应用中的相同 UI 元素功能类似， 但是在不同操作系统下的外观有一定差异。 此外， 你需要确保 UI 元素与当前操作系统风格一致。 你一定不希望在 Windows 系统下运行的应用程序中显示 macOS 的控件。</p><p>抽象工厂接口声明一系列构建方法， 客户端代码可调用它们生成不同风格的 UI 元素。 每个具体工厂对应特定操作系统， 并负责生成符合该操作系统风格的 UI 元素。</p><p>其运作方式如下： 应用程序启动后检测当前操作系统。 根据该信息， 应用程序通过与该操作系统对应的类创建工厂对象。 其余代码使用该工厂对象创建 UI 元素。 这样可以避免生成错误类型的元素。</p><p>使用这种方法， 客户端代码只需调用抽象接口， 而无需了解具体工厂类和 UI 元素。 此外， 客户端代码还支持未来添加新的工厂或 UI 元素。</p><p>这样一来， 每次在应用程序中添加新的 UI 元素变体时， 你都无需修改客户端代码。 你只需创建一个能够生成这些 UI 元素的工厂类， 然后稍微修改应用程序的初始代码， 使其能够选择合适的工厂类即可。</p><h3 id="buttons-第一个产品层次结构"><a href="#buttons-第一个产品层次结构" class="headerlink" title="buttons: 第一个产品层次结构"></a><strong>buttons:</strong> 第一个产品层次结构</h3><h4 id="buttons-Button-java"><a href="#buttons-Button-java" class="headerlink" title="buttons&#x2F;Button.java"></a><strong>buttons&#x2F;Button.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.buttons;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂假设你有几个系列的产品，</span></span><br><span class="line"><span class="comment"> * 结构成单独的类层次结构 (按钮/复选框)。的所有产品</span></span><br><span class="line"><span class="comment"> * 同一个家庭有共同的接口。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 这是按钮家族的通用接口。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="buttons-MacOSButton-java"><a href="#buttons-MacOSButton-java" class="headerlink" title="buttons&#x2F;MacOSButton.java"></a><strong>buttons&#x2F;MacOSButton.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.buttons;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有产品系列都有相同的品种 (MacOS/Windows)。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 这是一个按钮的MacOS变体。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacOSButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;您已创建MacOSButton.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="buttons-WindowsButton-java"><a href="#buttons-WindowsButton-java" class="headerlink" title="buttons&#x2F;WindowsButton.java"></a><strong>buttons&#x2F;WindowsButton.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.buttons;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有产品系列都有相同的品种 (MacOS/Windows)。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 这是按钮的另一种变体。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;您已创建WindowsButton.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="checkboxes-第二个产品层次结构"><a href="#checkboxes-第二个产品层次结构" class="headerlink" title="checkboxes: 第二个产品层次结构"></a><strong>checkboxes:</strong> 第二个产品层次结构</h3><h4 id="checkboxes-Checkbox-java"><a href="#checkboxes-Checkbox-java" class="headerlink" title="checkboxes&#x2F;Checkbox.java"></a><strong>checkboxes&#x2F;Checkbox.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.checkboxes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Checkboxes是第二个产品系列。它具有与按钮相同的变体。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="checkboxes-MacOSCheckbox-java"><a href="#checkboxes-MacOSCheckbox-java" class="headerlink" title="checkboxes&#x2F;MacOSCheckbox.java"></a><strong>checkboxes&#x2F;MacOSCheckbox.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.checkboxes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有产品系列都有相同的品种 (MacOS/Windows)。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 这是一个复选框的变体。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacOSCheckbox</span> <span class="keyword">implements</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;您已创建MacOSCheckbox.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="checkboxes-WindowsCheckbox-java"><a href="#checkboxes-WindowsCheckbox-java" class="headerlink" title="checkboxes&#x2F;WindowsCheckbox.java"></a><strong>checkboxes&#x2F;WindowsCheckbox.java</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.checkboxes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有产品系列都有相同的品种 (MacOS/Windows)。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 这是复选框的另一种变体。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsCheckbox</span> <span class="keyword">implements</span> <span class="title class_">Checkbox</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;您已创建WindowsCheckbox.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="factories"><a href="#factories" class="headerlink" title="factories"></a><strong>factories</strong></h3><h4 id="factories-GUIFactory-java-抽象工厂"><a href="#factories-GUIFactory-java-抽象工厂" class="headerlink" title="factories&#x2F;GUIFactory.java: 抽象工厂"></a><strong>factories&#x2F;GUIFactory.java:</strong> 抽象工厂</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.factories;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.buttons.Button;</span><br><span class="line"><span class="keyword">import</span> org.example.checkboxes.Checkbox;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂知道所有 (抽象) 产品类型。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line">    Button <span class="title function_">createButton</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="factories-MacOSFactory-java-具体工厂-（-mac­OS）"><a href="#factories-MacOSFactory-java-具体工厂-（-mac­OS）" class="headerlink" title="factories&#x2F;MacOSFactory.java: 具体工厂 （ mac­OS）"></a><strong>factories&#x2F;MacOSFactory.java:</strong> 具体工厂 （ mac­OS）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.factories;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.buttons.Button;</span><br><span class="line"><span class="keyword">import</span> org.example.buttons.MacOSButton;</span><br><span class="line"><span class="keyword">import</span> org.example.checkboxes.Checkbox;</span><br><span class="line"><span class="keyword">import</span> org.example.checkboxes.MacOSCheckbox;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 每个混凝土工厂扩展基本工厂并负责创建</span></span><br><span class="line"><span class="comment"> * 单一品种的产品。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacOSFactory</span> <span class="keyword">implements</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacOSButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacOSCheckbox</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="factories-WindowsFactory-java-具体工厂-（Windows）"><a href="#factories-WindowsFactory-java-具体工厂-（Windows）" class="headerlink" title="factories&#x2F;WindowsFactory.java: 具体工厂 （Windows）"></a><strong>factories&#x2F;WindowsFactory.java:</strong> 具体工厂 （Windows）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.factories;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.buttons.Button;</span><br><span class="line"><span class="keyword">import</span> org.example.buttons.WindowsButton;</span><br><span class="line"><span class="keyword">import</span> org.example.checkboxes.Checkbox;</span><br><span class="line"><span class="keyword">import</span> org.example.checkboxes.WindowsCheckbox;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 每个混凝土工厂扩展基本工厂并负责创建</span></span><br><span class="line"><span class="comment"> * 单一品种的产品。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsFactory</span> <span class="keyword">implements</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Checkbox <span class="title function_">createCheckbox</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsCheckbox</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="app"><a href="#app" class="headerlink" title="app"></a><strong>app</strong></h3><h4 id="app-Application-java-客户端代码"><a href="#app-Application-java-客户端代码" class="headerlink" title="app&#x2F;Application.java: 客户端代码"></a><strong>app&#x2F;Application.java:</strong> 客户端代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.buttons.Button;</span><br><span class="line"><span class="keyword">import</span> org.example.checkboxes.Checkbox;</span><br><span class="line"><span class="keyword">import</span> org.example.factories.GUIFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工厂用户不关心他们使用的混凝土工厂，因为他们的工作</span></span><br><span class="line"><span class="comment"> * 通过抽象接口的工厂和产品。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line">    <span class="keyword">private</span> Checkbox checkbox;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Application</span><span class="params">(GUIFactory factory)</span> &#123;</span><br><span class="line">        button = factory.createButton();</span><br><span class="line">        checkbox = factory.createCheckbox();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paint</span><span class="params">()</span> &#123;</span><br><span class="line">        button.paint();</span><br><span class="line">        checkbox.paint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Main-java-程序配置"><a href="#Main-java-程序配置" class="headerlink" title="Main.java: 程序配置"></a><strong>Main.java:</strong> 程序配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.app.Application;</span><br><span class="line"><span class="keyword">import</span> org.example.factories.GUIFactory;</span><br><span class="line"><span class="keyword">import</span> org.example.factories.MacOSFactory;</span><br><span class="line"><span class="keyword">import</span> org.example.factories.WindowsFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Main类。一切都聚集在这里。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午5:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 应用程序选择工厂类型并在运行时创建它 (通常在</span></span><br><span class="line"><span class="comment">     * 初始化阶段)，具体取决于配置或环境</span></span><br><span class="line"><span class="comment">     * 变量。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Application <span class="title function_">configureApplication</span><span class="params">()</span> &#123;</span><br><span class="line">        Application app;</span><br><span class="line">        GUIFactory factory;</span><br><span class="line">        <span class="type">String</span> <span class="variable">osName</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;os.name&quot;</span>).toLowerCase();</span><br><span class="line">        <span class="keyword">if</span> (osName.contains(<span class="string">&quot;mac&quot;</span>)) &#123;</span><br><span class="line">            factory = <span class="keyword">new</span> <span class="title class_">MacOSFactory</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            factory = <span class="keyword">new</span> <span class="title class_">WindowsFactory</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        app = <span class="keyword">new</span> <span class="title class_">Application</span>(factory);</span><br><span class="line">        <span class="keyword">return</span> app;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        <span class="type">Application</span> <span class="variable">app</span> <span class="operator">=</span> configureApplication();</span><br><span class="line">        app.paint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="抽象工厂模式适合应用场景"><a href="#抽象工厂模式适合应用场景" class="headerlink" title="抽象工厂模式适合应用场景"></a>抽象工厂模式适合应用场景</h2><p> <strong>如果代码需要与多个不同系列的相关产品交互， 但是由于无法提前获取相关信息， 或者出于对未来扩展性的考虑， 你不希望代码基于产品的具体类进行构建， 在这种情况下， 你可以使用抽象工厂。</strong></p><p> 抽象工厂为你提供了一个接口， 可用于创建每个系列产品的对象。 只要代码通过该接口创建对象， 那么你就不会生成与应用程序已生成的产品类型不一致的产品。</p><p><strong>如果你有一个基于一组抽象方法的类， 且其主要功能因此变得不明确， 那么在这种情况下可以考虑使用抽象工厂模式。</strong></p><p> 在设计良好的程序中， <em>每个类仅负责一件事</em>。 如果一个类与多种类型产品交互， 就可以考虑将工厂方法抽取到独立的工厂类或具备完整功能的抽象工厂类中。</p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li>以不同的产品类型与产品变体为维度绘制矩阵。</li><li>为所有产品声明抽象产品接口。 然后让所有具体产品类实现这些接口。</li><li>声明抽象工厂接口， 并且在接口中为所有抽象产品提供一组构建方法。</li><li>为每种产品变体实现一个具体工厂类。</li><li>在应用程序中开发初始化代码。 该代码根据应用程序配置或当前环境， 对特定具体工厂类进行初始化。 然后将该工厂对象传递给所有需要创建产品的类。</li><li>找出代码中所有对产品构造函数的直接调用， 将其替换为对工厂对象中相应构建方法的调用。</li></ol><h2 id="抽象工厂模式优缺点"><a href="#抽象工厂模式优缺点" class="headerlink" title="抽象工厂模式优缺点"></a>抽象工厂模式优缺点</h2><p>优点：</p><ul><li>你可以确保同一工厂生成的产品相互匹配。</li><li>你可以避免客户端和具体产品代码的耦合。</li><li><em>单一职责原则</em>。 你可以将产品生成代码抽取到同一位置， 使得代码易于维护。</li><li><em>开闭原则</em>。 向应用程序中引入新产品变体时， 你无需修改客户端代码。</li></ul><p>缺点：</p><ul><li>由于采用该模式需要向应用中引入众多接口和类， 代码可能会比之前更加复杂。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>在许多设计工作的初期都会使用工厂方法模式（较为简单， 而且可以更方便地通过子类进行定制）， 随后演化为使用抽象工厂模式、原型模式或生成器模式 （更灵活但更加复杂）。</li><li>生成器重点关注如何分步生成复杂对象。 抽象工厂专门用于生产一系列相关对象。 <em>抽象工厂</em>会马上返回产品， <em>生成器</em>则允许你在获取产品前执行一些额外构造步骤。</li><li>抽象工厂模式通常基于一组工厂方法， 但你也可以使用原型模式来生成这些类的方法。</li><li>当只需对客户端代码隐藏子系统创建对象的方式时， 你可以使用抽象工厂来代替外观模式。</li><li>你可以将抽象工厂和桥接模式搭配使用。 如果由<em>桥接</em>定义的抽象只能与特定实现合作， 这一模式搭配就非常有用。 在这种情况下， <em>抽象工厂</em>可以对这些关系进行封装， 并且对客户端代码隐藏其复杂性。</li><li>抽象工厂、生成器和原型都可以用单例模式来实现。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;抽象工厂模式&quot;&gt;&lt;a href=&quot;#抽象工厂模式&quot; class=&quot;headerlink&quot; title=&quot;抽象工厂模式&quot;&gt;&lt;/a&gt;抽象工厂模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;抽象工厂模式&lt;/strong&gt;是一种创建型设计模式， 它能创建一系列相关的对象， 而无需指定其具体类。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="抽象工厂模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="抽象工厂模式" scheme="https://blog.48626.xyz/tags/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>工厂方法模式</title>
    <link href="https://blog.48626.xyz/66f289959be0.html"/>
    <id>https://blog.48626.xyz/66f289959be0.html</id>
    <published>2024-09-12T08:21:37.000Z</published>
    <updated>2024-09-12T08:21:37.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h1><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>工厂方法模式</strong>是一种创建型设计模式， 其在父类中提供一个创建对象的方法， 允许子类决定实例化对象的类型。</p><img src="/66f289959be0/image-20240912152854979.png" class="" alt="image-20240912152854979"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假设你正在开发一款物流管理应用。 最初版本只能处理卡车运输， 因此大部分代码都在位于名为 <code>卡车</code>的类中。</p><p>一段时间后， 这款应用变得极受欢迎。 你每天都能收到十几次来自海运公司的请求， 希望应用能够支持海上物流功能。</p><img src="/66f289959be0/image-20240912152922428.png" class="" alt="在程序中新增一个运输类会遇到问题"><p>这可是个好消息。 但是代码问题该如何处理呢？ 目前， 大部分代码都与 <code>卡车</code>类相关。 在程序中添加 <code>轮船</code>类需要修改全部代码。 更糟糕的是， 如果你以后需要在程序中支持另外一种运输方式， 很可能需要再次对这些代码进行大幅修改。</p><p>最后， 你将不得不编写繁复的代码， 根据不同的运输对象类， 在应用中进行不同的处理。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>工厂方法模式建议使用特殊的<em>工厂</em>方法代替对于对象构造函数的直接调用 （即使用 <code>new</code>运算符）。 不用担心， 对象仍将通过 <code>new</code>运算符创建， 只是该运算符改在工厂方法中调用罢了。 工厂方法返回的对象通常被称作 “产品”。</p><img src="/66f289959be0/image-20240912152957005.png" class="" alt="子类可以修改工厂方法返回的对象类型。"><p>乍看之下， 这种更改可能毫无意义： 我们只是改变了程序中调用构造函数的位置而已。 但是， 仔细想一下， 现在你可以在子类中重写工厂方法， 从而改变其创建产品的类型。</p><p>但有一点需要注意:仅当这些产品具有共同的基类或者接口时， 子类才能返回不同类型的产品， 同时基类中的工厂方法还应将其返回类型声明为这一共有接口。</p><img src="/66f289959be0/image-20240912153018184.png" class="" alt="所有产品都必须使用同一接口。"><p>举例来说，  <code>卡车</code>Truck和 <code>轮船</code>Ship类都必须实现 <code>运输</code>Transport接口， 该接口声明了一个名为 <code>deliver</code>交付的方法。 每个类都将以不同的方式实现该方法： 卡车走陆路交付货物， 轮船走海路交付货物。  <code>陆路运输</code>Road­Logistics类中的工厂方法返回卡车对象， 而 <code>海路运输</code>Sea­Logistics类则返回轮船对象。</p><img src="/66f289959be0/image-20240912153044258.png" class="" alt="只要产品类实现一个共同的接口， 你就可以将其对象传递给客户代码， 而无需提供额外数据。"><p>调用工厂方法的代码 （通常被称为<em>客户端</em>代码） 无需了解不同子类返回实际对象之间的差别。 客户端将所有产品视为抽象的 <code>运输</code> 。 客户端知道所有运输对象都提供 <code>交付</code>方法， 但是并不关心其具体实现方式。</p><h2 id="工厂方法模式结构"><a href="#工厂方法模式结构" class="headerlink" title="工厂方法模式结构"></a>工厂方法模式结构</h2><img src="/66f289959be0/image-20240912153118656.png" class="" alt="image-20240912153118656"><ol><li><p><strong>产品</strong> （Product） 将会对接口进行声明。 对于所有由创建者及其子类构建的对象， 这些接口都是通用的。</p></li><li><p><strong>具体产品</strong> （Concrete Products） 是产品接口的不同实现。</p></li><li><p><strong>创建者</strong> （Creator） 类声明返回产品对象的工厂方法。 该方法的返回对象类型必须与产品接口相匹配。</p><p>你可以将工厂方法声明为抽象方法， 强制要求每个子类以不同方式实现该方法。 或者， 你也可以在基础工厂方法中返回默认产品类型。</p><p>注意， 尽管它的名字是创建者， 但它最主要的职责并<strong>不是</strong>创建产品。 一般来说， 创建者类包含一些与产品相关的核心业务逻辑。 工厂方法将这些逻辑处理从具体产品类中分离出来。 打个比方， 大型软件开发公司拥有程序员培训部门。 但是， 这些公司的主要工作还是编写代码， 而非生产程序员。</p></li><li><p><strong>具体创建者</strong> （Concrete Creators） 将会重写基础工厂方法， 使其返回不同类型的产品。</p><p>注意， 并不一定每次调用工厂方法都会<strong>创建</strong>新的实例。 工厂方法也可以返回缓存、 对象池或其他来源的已有对象。</p></li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>以下示例演示了如何使用<strong>工厂方法</strong>开发跨平台 UI （用户界面） 组件， 并同时避免客户代码与具体 UI 类之间的耦合。</p><img src="/66f289959be0/image-20240912153417032.png" class="" alt="跨平台对话框示例。"><p>基础对话框类使用不同的 UI 组件渲染窗口。 在不同的操作系统下， 这些组件外观或许略有不同， 但其功能保持一致。 Windows 系统中的按钮在 Linux 系统中仍然是按钮。</p><p>如果使用工厂方法， 就不需要为每种操作系统重写对话框逻辑。 如果我们声明了一个在基本对话框类中生成按钮的工厂方法， 那么我们就可以创建一个对话框子类， 并使其通过工厂方法返回 Windows 样式按钮。 子类将继承对话框基础类的大部分代码， 同时在屏幕上根据 Windows 样式渲染按钮。</p><p>如需该模式正常工作， 基础对话框类必须使用抽象按钮 （例如基类或接口）， 以便将其扩展为具体按钮。 这样一来， 无论对话框中使用何种类型的按钮， 其代码都可以正常工作。</p><p>你可以使用此方法开发其他 UI 组件。 不过， 每向对话框中添加一个新的工厂方法， 你就离<a href="https://refactoringguru.cn/design-patterns/abstract-factory">抽象工厂</a>模式更近一步。 我们将在稍后谈到这个模式。</p><h3 id="buttons"><a href="#buttons" class="headerlink" title="buttons"></a><strong>buttons</strong></h3><h4 id="buttons-Button-java-通用产品接口"><a href="#buttons-Button-java-通用产品接口" class="headerlink" title="buttons&#x2F;Button.java: 通用产品接口"></a><strong>buttons&#x2F;Button.java:</strong> 通用产品接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.buttons;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有按钮的通用界面。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="buttons-HtmlButton-java-具体产品"><a href="#buttons-HtmlButton-java-具体产品" class="headerlink" title="buttons&#x2F;HtmlButton.java: 具体产品"></a><strong>buttons&#x2F;HtmlButton.java:</strong> 具体产品</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.buttons;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HTML button实施。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午3:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HtmlButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;&lt;button&gt;HTML Button&lt;/button&gt;&quot;</span>);</span><br><span class="line">        onClick();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;点击!按钮说 - &#x27;HTML Button!&#x27;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="buttons-WindowsButton-java-另一个具体产品"><a href="#buttons-WindowsButton-java-另一个具体产品" class="headerlink" title="buttons&#x2F;WindowsButton.java: 另一个具体产品"></a><strong>buttons&#x2F;WindowsButton.java:</strong> 另一个具体产品</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.buttons;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Windows按钮实现。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午3:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;&lt;button&gt;Windows Button&lt;/button&gt;&quot;</span>);</span><br><span class="line">        onClick();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;点击!按钮说 - &#x27;Windows Button!&#x27;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="factory"><a href="#factory" class="headerlink" title="factory"></a><strong>factory</strong></h3><h4 id="factory-Dialog-java-基础创建者"><a href="#factory-Dialog-java-基础创建者" class="headerlink" title="factory&#x2F;Dialog.java: 基础创建者"></a><strong>factory&#x2F;Dialog.java:</strong> 基础创建者</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.buttons.Button;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基本工厂类。请注意，&quot;工厂 &quot;只是该类的一个角色。</span></span><br><span class="line"><span class="comment"> * 它应该有一些核心业务逻辑，需要创建不同的产品。</span></span><br><span class="line"><span class="comment"> * 创建。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午3:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Dialog</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 子类将重写此方法以创建特定的按钮</span></span><br><span class="line"><span class="comment">     * 对象。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Button <span class="title function_">createButton</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="factory-HtmlDialog-java-具体创建者"><a href="#factory-HtmlDialog-java-具体创建者" class="headerlink" title="factory&#x2F;HtmlDialog.java: 具体创建者"></a><strong>factory&#x2F;HtmlDialog.java:</strong> 具体创建者</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.buttons.Button;</span><br><span class="line"><span class="keyword">import</span> org.example.buttons.HtmlButton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HTML对话框将产生HTML按钮。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午3:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HtmlDialog</span> <span class="keyword">extends</span> <span class="title class_">Dialog</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HtmlButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="factory-WindowsDialog-java-另一个具体创建者"><a href="#factory-WindowsDialog-java-另一个具体创建者" class="headerlink" title="factory&#x2F;WindowsDialog.java: 另一个具体创建者"></a><strong>factory&#x2F;WindowsDialog.java:</strong> 另一个具体创建者</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.buttons.Button;</span><br><span class="line"><span class="keyword">import</span> org.example.buttons.WindowsButton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Windows对话框将生成Windows按钮。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/9/12 下午3:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsDialog</span> <span class="keyword">extends</span> <span class="title class_">Dialog</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Main-java-客户端代码"><a href="#Main-java-客户端代码" class="headerlink" title="Main.java: 客户端代码"></a><strong>Main.java:</strong> 客户端代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.factory.Dialog;</span><br><span class="line"><span class="keyword">import</span> org.example.factory.HtmlDialog;</span><br><span class="line"><span class="keyword">import</span> org.example.factory.WindowsDialog;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Main类。一切都聚集在这里。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Z</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Dialog dialog;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">        configure();</span><br><span class="line">        runBusinessLogic();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 混凝土工厂通常根据配置或</span></span><br><span class="line"><span class="comment">     * 环境选项。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;Windows 10&quot;</span>.equals(System.getProperty(<span class="string">&quot;os.name&quot;</span>))) &#123;</span><br><span class="line">            dialog = <span class="keyword">new</span> <span class="title class_">WindowsDialog</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dialog = <span class="keyword">new</span> <span class="title class_">HtmlDialog</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所有客户端代码都应通过以下方式与工厂和产品一起使用</span></span><br><span class="line"><span class="comment">     * 抽象接口。这种方式，它并不关心它的工作工厂</span></span><br><span class="line"><span class="comment">     * 以及它返回什么样的产品。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">runBusinessLogic</span><span class="params">()</span> &#123;</span><br><span class="line">        dialog.renderWindow();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="工厂方法模式适合应用场景"><a href="#工厂方法模式适合应用场景" class="headerlink" title="工厂方法模式适合应用场景"></a>工厂方法模式适合应用场景</h2><p> <strong>当你在编写代码的过程中， 如果无法预知对象确切类别及其依赖关系时， 可使用工厂方法。</strong></p><p> 工厂方法将创建产品的代码与实际使用产品的代码分离， 从而能在不影响其他代码的情况下扩展产品创建部分代码。</p><p>例如， 如果需要向应用中添加一种新产品， 你只需要开发新的创建者子类， 然后重写其工厂方法即可。</p><p><strong>如果你希望用户能扩展你软件库或框架的内部组件， 可使用工厂方法。</strong></p><p>继承可能是扩展软件库或框架默认行为的最简单方法。 但是当你使用子类替代标准组件时， 框架如何辨识出该子类？</p><p>解决方案是将各框架中构造组件的代码集中到单个工厂方法中， 并在继承该组件之外允许任何人对该方法进行重写。</p><p>让我们看看具体是如何实现的。 假设你使用开源 UI 框架编写自己的应用。 你希望在应用中使用圆形按钮， 但是原框架仅支持矩形按钮。 你可以使用 <code>圆形按钮</code>Round­Button子类来继承标准的 <code>按钮</code>Button类。 但是， 你需要告诉 <code>UI框架</code>UIFramework类使用新的子类按钮代替默认按钮。</p><p>为了实现这个功能， 你可以根据基础框架类开发子类 <code>圆形按钮 UI</code>UIWith­Round­Buttons ， 并且重写其 <code>create­Button</code>创建按钮方法。 基类中的该方法返回 <code>按钮</code>对象， 而你开发的子类返回 <code>圆形按钮</code>对象。 现在， 你就可以使用 <code>圆形按钮 UI</code>类代替 <code>UI框架</code>类。 就是这么简单！</p><p><strong>如果你希望复用现有对象来节省系统资源，而不是每次都重新创建对象，可使用工厂方法。</strong></p><p>在处理大型资源密集型对象 （比如数据库连接、 文件系统和网络资源） 时， 你会经常碰到这种资源需求。</p><p>让我们思考复用现有对象的方法：</p><ol><li>首先， 你需要创建存储空间来存放所有已经创建的对象。</li><li>当他人请求一个对象时， 程序将在对象池中搜索可用对象。</li><li>… 然后将其返回给客户端代码。</li><li>如果没有可用对象， 程序则创建一个新对象 （并将其添加到对象池中）。</li></ol><p>这些代码可不少！ 而且它们必须位于同一处， 这样才能确保重复代码不会污染程序。</p><p>可能最显而易见， 也是最方便的方式， 就是将这些代码放置在我们试图重用的对象类的构造函数中。 但是从定义上来讲， 构造函数始终返回的是<strong>新对象</strong>， 其无法返回现有实例。</p><p>因此， 你需要有一个既能够创建新对象， 又可以重用现有对象的普通方法。 这听上去和工厂方法非常相像。</p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol><li><p>让所有产品都遵循同一接口。 该接口必须声明对所有产品都有意义的方法。</p></li><li><p>在创建类中添加一个空的工厂方法。 该方法的返回类型必须遵循通用的产品接口。</p></li><li><p>在创建者代码中找到对于产品构造函数的所有引用。 将它们依次替换为对于工厂方法的调用， 同时将创建产品的代码移入工厂方法。</p><p>你可能需要在工厂方法中添加临时参数来控制返回的产品类型。</p><p>工厂方法的代码看上去可能非常糟糕。 其中可能会有复杂的 <code>switch</code>分支运算符， 用于选择各种需要实例化的产品类。 但是不要担心， 我们很快就会修复这个问题。</p></li><li><p>现在， 为工厂方法中的每种产品编写一个创建者子类， 然后在子类中重写工厂方法， 并将基本方法中的相关创建代码移动到工厂方法中。</p></li><li><p>如果应用中的产品类型太多， 那么为每个产品创建子类并无太大必要， 这时你也可以在子类中复用基类中的控制参数。</p><p>例如， 设想你有以下一些层次结构的类。 基类 <code>邮件</code>及其子类 <code>航空邮件</code>和 <code>陆路邮件</code> ；  <code>运输</code>及其子类 <code>飞机</code>, <code>卡车</code>和 <code>火车</code> 。  <code>航空邮件</code>仅使用 <code>飞机</code>对象， 而 <code>陆路邮件</code>则会同时使用 <code>卡车</code>和 <code>火车</code>对象。 你可以编写一个新的子类 （例如 <code>火车邮件</code> ） 来处理这两种情况， 但是还有其他可选的方案。 客户端代码可以给 <code>陆路邮件</code>类传递一个参数， 用于控制其希望获得的产品。</p></li><li><p>如果代码经过上述移动后， 基础工厂方法中已经没有任何代码， 你可以将其转变为抽象类。 如果基础工厂方法中还有其他语句， 你可以将其设置为该方法的默认行为。</p></li></ol><h2 id="工厂方法模式优缺点"><a href="#工厂方法模式优缺点" class="headerlink" title="工厂方法模式优缺点"></a>工厂方法模式优缺点</h2><p>优点：</p><ul><li>你可以避免创建者和具体产品之间的紧密耦合。</li><li><em>单一职责原则</em>。 你可以将产品创建代码放在程序的单一位置， 从而使得代码更容易维护。</li><li><em>开闭原则</em>。 无需更改现有客户端代码， 你就可以在程序中引入新的产品类型。</li></ul><p>缺点：</p><ul><li>应用工厂方法模式需要引入许多新的子类， 代码可能会因此变得更复杂。 最好的情况是将该模式引入创建者类的现有层次结构中。</li></ul><h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul><li>在许多设计工作的初期都会使用工厂方法模式（较为简单， 而且可以更方便地通过子类进行定制）， 随后演化为使用抽象工厂模式、 原型模式或生成器模式（更灵活但更加复杂）。</li><li>抽象工厂模式]通常基于一组工厂方法， 但你也可以使用原型模式来生成这些类的方法。</li><li>你可以同时使用工厂方法和迭代器模式来让子类集合返回不同类型的迭代器， 并使得迭代器与集合相匹配。</li><li>原型并不基于继承， 因此没有继承的缺点。 另一方面， <em>原型</em>需要对被复制对象进行复杂的初始化。工厂方法基于继承， 但是它不需要初始化步骤。</li><li>工厂方法是模板方法模式的一种特殊形式。 同时， <em>工厂方法</em>可以作为一个大型<em>模板方法</em>中的一个步骤。</li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;工厂方法模式&quot;&gt;&lt;a href=&quot;#工厂方法模式&quot; class=&quot;headerlink&quot; title=&quot;工厂方法模式&quot;&gt;&lt;/a&gt;工厂方法模式&lt;/h1&gt;&lt;h2 id=&quot;意图&quot;&gt;&lt;a href=&quot;#意图&quot; class=&quot;headerlink&quot; title=&quot;意图&quot;&gt;&lt;/a&gt;意图&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;工厂方法模式&lt;/strong&gt;是一种创建型设计模式， 其在父类中提供一个创建对象的方法， 允许子类决定实例化对象的类型。&lt;/p&gt;</summary>
    
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="工厂方法模式" scheme="https://blog.48626.xyz/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://blog.48626.xyz/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="工厂方法模式" scheme="https://blog.48626.xyz/tags/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Typora启用代理</title>
    <link href="https://blog.48626.xyz/463cd35b6d1e.html"/>
    <id>https://blog.48626.xyz/463cd35b6d1e.html</id>
    <published>2024-09-12T07:23:25.000Z</published>
    <updated>2024-09-12T07:23:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>进入偏好设置, 在通用中下拉找到打开高级设置.<img src="/463cd35b6d1e/image-20240912152435894.png" class="" alt="image-20240912152435894"></p><p>在弹出的文件夹中用编辑器打开conf.user.json文件</p><img src="/463cd35b6d1e/image-20240912152512793.png" class="" alt="image-20240912152512793"><p>修改flags中的内容</p><img src="/463cd35b6d1e/image-20240912152603123.png" class="" alt="image-20240912152603123"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;flags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">[</span><span class="string">&quot;proxy-server&quot;</span><span class="punctuation">,</span> <span class="string">&quot;socks5://127.0.0.1:10808&quot;</span><span class="punctuation">]</span></span><br><span class="line"> <span class="punctuation">]</span> <span class="comment">// default [], append Chrome launch flags, e.g: [[&quot;disable-gpu&quot;], [&quot;host-rules&quot;, &quot;MAP * 127.0.0.1&quot;]]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;进入偏好设置, 在通用中下拉找到打开高级设置.&lt;img src=&quot;/463cd35b6d1e/image-20240912152435894.png&quot; class alt=&quot;image-20240912152435894&quot;&gt;&lt;/p&gt;
&lt;p&gt;在弹出的文件夹中用编辑器打开conf.user.json文件&lt;/p&gt;
&lt;img src=&quot;/463cd35b6d1e/image-20240912152512793.png&quot; class alt=&quot;image-20240912152512793&quot;&gt;</summary>
    
    
    
    <category term="typora" scheme="https://blog.48626.xyz/categories/typora/"/>
    
    
    <category term="typora" scheme="https://blog.48626.xyz/tags/typora/"/>
    
  </entry>
  
  <entry>
    <title>fofa扫clash v2订阅</title>
    <link href="https://blog.48626.xyz/ec3e3ea2c204.html"/>
    <id>https://blog.48626.xyz/ec3e3ea2c204.html</id>
    <published>2024-09-10T08:08:32.000Z</published>
    <updated>2024-09-10T08:08:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>fofa地址：<a href="https://fofa.info/">https://fofa.info/</a></p><p>内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">body=<span class="string">&quot;port: 7890&quot;</span> &amp;&amp; body=<span class="string">&quot;socks-port: 7891&quot;</span> &amp;&amp; body=<span class="string">&quot;allow-lan: true&quot;</span></span><br></pre></td></tr></table></figure><img src="/ec3e3ea2c204/image-20240910161048448-1725955849657-2.png" class="" alt="image-20240910161048448"><p>然后随便打开一个链接，如果是下方类似内容，就导入工具测试</p><img src="/ec3e3ea2c204/image-20240910161150953.png" class="" alt="image-20240910161150953">]]></content>
    
    
    <summary type="html">&lt;p&gt;fofa地址：&lt;a href=&quot;https://fofa.info/&quot;&gt;https://fofa.info/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;内容&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;body=&lt;span class=&quot;string&quot;&gt;&amp;quot;port: 7890&amp;quot;&lt;/span&gt; &amp;amp;&amp;amp; body=&lt;span class=&quot;string&quot;&gt;&amp;quot;socks-port: 7891&amp;quot;&lt;/span&gt; &amp;amp;&amp;amp; body=&lt;span class=&quot;string&quot;&gt;&amp;quot;allow-lan: true&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="fofa" scheme="https://blog.48626.xyz/categories/fofa/"/>
    
    <category term="订阅" scheme="https://blog.48626.xyz/categories/fofa/%E8%AE%A2%E9%98%85/"/>
    
    
    <category term="fofa" scheme="https://blog.48626.xyz/tags/fofa/"/>
    
    <category term="订阅" scheme="https://blog.48626.xyz/tags/%E8%AE%A2%E9%98%85/"/>
    
  </entry>
  
  <entry>
    <title>fofa扫claude</title>
    <link href="https://blog.48626.xyz/5528c0a5beed.html"/>
    <id>https://blog.48626.xyz/5528c0a5beed.html</id>
    <published>2024-09-06T01:34:12.000Z</published>
    <updated>2024-09-06T01:34:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>在fofa搜索<code>&quot;sk-ant-sid01&quot;</code><br>可以搜到标题为 <strong>Claude账号池</strong> 与 <strong>FAE-Claude 登录</strong> 的网站</p><img src="/5528c0a5beed/image-20240906093818847.png" class="" alt="image-20240906093818847"><p>直接打开f12，查找如图中红圈所示的请求，可以发现claude的key明文保存在代码里面</p><img src="/5528c0a5beed/image-20240906093838713.png" class="" alt="image-20240906093838713"><p>运气好可以拿到不少能用的，去fuclaude用就可以了（这个貌似是这个账号池项目，怎么这么草台）</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在fofa搜索&lt;code&gt;&amp;quot;sk-ant-sid01&amp;quot;&lt;/code&gt;&lt;br&gt;可以搜到标题为 &lt;strong&gt;Claude账号池&lt;/strong&gt; 与 &lt;strong&gt;FAE-Claude 登录&lt;/strong&gt; 的网站&lt;/p&gt;
&lt;img src=&quot;/5528c0a5beed/image-20240906093818847.png&quot; class alt=&quot;image-20240906093818847&quot;&gt;



&lt;p&gt;直接打开f12，查找如图中红圈所示的请求，可以发现claude的key明文保存在代码里面&lt;/p&gt;</summary>
    
    
    
    <category term="fofa" scheme="https://blog.48626.xyz/categories/fofa/"/>
    
    <category term="claude" scheme="https://blog.48626.xyz/categories/fofa/claude/"/>
    
    
    <category term="fofa" scheme="https://blog.48626.xyz/tags/fofa/"/>
    
    <category term="claude" scheme="https://blog.48626.xyz/tags/claude/"/>
    
  </entry>
  
  <entry>
    <title>IDEA使用Docker</title>
    <link href="https://blog.48626.xyz/45112dc23ff5.html"/>
    <id>https://blog.48626.xyz/45112dc23ff5.html</id>
    <published>2024-08-25T14:05:37.000Z</published>
    <updated>2024-08-25T14:05:37.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="下载Docker-exe"><a href="#下载Docker-exe" class="headerlink" title="下载Docker.exe"></a>下载Docker.exe</h1><p>下载地址： <a href="https://download.docker.com/win/static/stable/x86_64/">https://download.docker.com/win/static/stable/x86_64/</a></p><p>随便选择一个版本</p><img src="/45112dc23ff5/image-20240825220913418.png" class="" alt="image-20240825220913418"><blockquote><p>解决的问题</p><p>cannot run program docker.exe</p></blockquote><h1 id="下载docker-buildx"><a href="#下载docker-buildx" class="headerlink" title="下载docker-buildx"></a>下载<code>docker-buildx</code></h1><p><a href="https://github.com/docker/buildx/releases/download/v0.13.1/buildx-v0.13.1.windows-amd64.exe">https://github.com/docker/buildx/releases/download/v0.13.1/buildx-v0.13.1.windows-amd64.exe</a></p><p>在你的用户文件夹下（或在文件管理地址栏输入 <code>%USERPROFILE%</code> 回车跳转到用户目录下），新建 .docker 文件夹 （注意有个“.”），下面再新建一个<code>cli-plugins</code>文件夹，将下载的文件放在该文件夹下并重命名刚刚下载的文件为 <code>docker-buildx.exe</code> 。</p><blockquote><p>解决的问题</p><p>ERROR: BuildKit is enabled but the buildx component is missing or broken.       </p><p>Install the buildx component to build images with BuildKit:      </p><p> <a href="https://docs.docker.com/go/buildx/">https://docs.docker.com/go/buildx/</a></p></blockquote><h1 id="修改IDEA设置"><a href="#修改IDEA设置" class="headerlink" title="修改IDEA设置"></a>修改IDEA设置</h1><img src="/45112dc23ff5/image-20240825221058247.png" class="" alt="image-20240825221058247">]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;下载Docker-exe&quot;&gt;&lt;a href=&quot;#下载Docker-exe&quot; class=&quot;headerlink&quot; title=&quot;下载Docker.exe&quot;&gt;&lt;/a&gt;下载Docker.exe&lt;/h1&gt;&lt;p&gt;下载地址： &lt;a href=&quot;https://download.docker.com/win/static/stable/x86_64/&quot;&gt;https://download.docker.com/win/static/stable/x86_64/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;随便选择一个版本&lt;/p&gt;</summary>
    
    
    
    <category term="Intellij" scheme="https://blog.48626.xyz/categories/Intellij/"/>
    
    
    <category term="Intellij" scheme="https://blog.48626.xyz/tags/Intellij/"/>
    
    <category term="Docker" scheme="https://blog.48626.xyz/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Watchtower自动更新Docker容器</title>
    <link href="https://blog.48626.xyz/7e7e26f45b5f.html"/>
    <id>https://blog.48626.xyz/7e7e26f45b5f.html</id>
    <published>2024-08-25T11:24:34.000Z</published>
    <updated>2024-08-25T11:24:34.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>containrrr/watchtower</code> 是一个用于自动更新 Docker 容器的工具。它通过监控运行中的容器，并自动拉取新版本的镜像来更新容器。它是一个非常有用的工具，特别是在你希望保持服务最新且最小化维护工作时。</p><h3 id="安装-Watchtower"><a href="#安装-Watchtower" class="headerlink" title="安装 Watchtower"></a>安装 Watchtower</h3><p>要开始使用 <code>watchtower</code>，首先需要安装并运行它。你可以通过以下命令来运行 <code>watchtower</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name watchtower \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  containrrr/watchtower</span><br></pre></td></tr></table></figure><p>这个命令执行了以下操作：</p><ul><li><code>-d</code>：以分离模式运行 <code>watchtower</code>。</li><li><code>--name watchtower</code>：将容器命名为 <code>watchtower</code>。</li><li><code>-v /var/run/docker.sock:/var/run/docker.sock</code>：将 Docker 的 Unix 套接字文件挂载到容器内，使 <code>watchtower</code> 能够与 Docker 守护进程通信。</li></ul><h3 id="Watchtower-的基本功能"><a href="#Watchtower-的基本功能" class="headerlink" title="Watchtower 的基本功能"></a>Watchtower 的基本功能</h3><p><code>watchtower</code> 会自动检查运行中的 Docker 容器是否有更新的镜像版本。一旦发现新版本的镜像，它会执行以下操作：</p><ol><li>拉取新的镜像版本。</li><li>停止并移除旧的容器。</li><li>使用新的镜像启动容器，保持与原始容器相同的参数（包括端口映射、挂载的卷、环境变量等）。</li></ol><h3 id="Watchtower-的高级配置"><a href="#Watchtower-的高级配置" class="headerlink" title="Watchtower 的高级配置"></a>Watchtower 的高级配置</h3><p><code>watchtower</code> 支持多种配置选项，以适应不同的使用场景。以下是一些常用的选项：</p><h4 id="1-更新间隔-interval"><a href="#1-更新间隔-interval" class="headerlink" title="1. 更新间隔 (--interval)"></a>1. 更新间隔 (<code>--interval</code>)</h4><p>默认情况下，<code>watchtower</code> 每 24 小时检查一次更新。你可以通过 <code>--interval</code> 参数自定义检查间隔时间，单位为秒。例如，每 6 小时检查一次：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name watchtower \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  containrrr/watchtower \</span><br><span class="line">  --interval 21600</span><br></pre></td></tr></table></figure><h4 id="2-清理旧镜像-cleanup"><a href="#2-清理旧镜像-cleanup" class="headerlink" title="2. 清理旧镜像 (--cleanup)"></a>2. 清理旧镜像 (<code>--cleanup</code>)</h4><p>每次更新后，<code>watchtower</code> 默认保留旧的镜像。你可以使用 <code>--cleanup</code> 参数来删除旧的镜像，以节省存储空间：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name watchtower \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  containrrr/watchtower \</span><br><span class="line">  --cleanup</span><br></pre></td></tr></table></figure><h4 id="3-运行一次-run-once"><a href="#3-运行一次-run-once" class="headerlink" title="3. 运行一次 (--run-once)"></a>3. 运行一次 (<code>--run-once</code>)</h4><p>如果你不希望 <code>watchtower</code> 持续运行并监控更新，可以使用 <code>--run-once</code> 参数，让它只检查更新一次并退出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  containrrr/watchtower \</span><br><span class="line">  --run-once</span><br></pre></td></tr></table></figure><h4 id="4-标签过滤-label-enable"><a href="#4-标签过滤-label-enable" class="headerlink" title="4. 标签过滤 (--label-enable)"></a>4. 标签过滤 (<code>--label-enable</code>)</h4><p><code>watchtower</code> 可以配置为只更新带有特定标签的容器。要启用此功能，可以使用 <code>--label-enable</code> 参数，并确保目标容器带有 <code>com.centurylinklabs.watchtower.enable=true</code> 标签。</p><p><strong>为目标容器添加标签：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name my-container \</span><br><span class="line">  --label com.centurylinklabs.watchtower.enable=<span class="literal">true</span> \</span><br><span class="line">  my-image</span><br></pre></td></tr></table></figure><p><strong>运行带有标签过滤的 Watchtower：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name watchtower \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  containrrr/watchtower \</span><br><span class="line">  --label-enable</span><br></pre></td></tr></table></figure><h4 id="5-特定容器更新"><a href="#5-特定容器更新" class="headerlink" title="5. 特定容器更新"></a>5. 特定容器更新</h4><p>你可以指定只更新特定容器，而不是监控所有容器。只需在运行 <code>watchtower</code> 时指定容器的名称或 ID：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name watchtower \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  containrrr/watchtower \</span><br><span class="line">  my-container-1 my-container-2</span><br></pre></td></tr></table></figure><h3 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h3><p><code>watchtower</code> 也可以通过环境变量进行配置，这对于使用 <code>docker-compose</code> 管理多个服务时非常有用。以下是一些常用的环境变量：</p><ul><li><code>WATCHTOWER_CLEANUP=true</code>：启用清理旧镜像。</li><li><code>WATCHTOWER_POLL_INTERVAL=21600</code>：设置更新检查间隔（秒）。</li><li><code>WATCHTOWER_INCLUDE_STOPPED=true</code>：包括停止的容器。</li><li><code>WATCHTOWER_MONITOR_ONLY=true</code>：只监控，不自动更新。</li></ul><h3 id="在-docker-compose-中使用-Watchtower"><a href="#在-docker-compose-中使用-Watchtower" class="headerlink" title="在 docker-compose 中使用 Watchtower"></a>在 <code>docker-compose</code> 中使用 Watchtower</h3><p>你可以在 <code>docker-compose.yml</code> 文件中添加 <code>watchtower</code> 服务，像下面这样：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">watchtower:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">containrrr/watchtower</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WATCHTOWER_CLEANUP=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WATCHTOWER_POLL_INTERVAL=21600</span></span><br></pre></td></tr></table></figure><h3 id="日志与监控"><a href="#日志与监控" class="headerlink" title="日志与监控"></a>日志与监控</h3><p><code>watchtower</code> 会在其日志中记录每次更新的操作，你可以通过查看 <code>watchtower</code> 容器的日志来监控其行为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs watchtower</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><code>watchtower</code> 是一个强大的工具，可以帮助你自动管理 Docker 容器的更新。通过标签、容器名称过滤、清理旧镜像等功能，它提供了很大的灵活性，适合各种场景下的 Docker 容器管理需求。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;containrrr/watchtower&lt;/code&gt; 是一个用于自动更新 Docker 容器的工具。它通过监控运行中的容器，并自动拉取新版本的镜像来更新容器。它是一个非常有用的工具，特别是在你希望保持服务最新且最小化维护工作时。&lt;/p&gt;
&lt;h3 id=&quot;安装-Watchtower&quot;&gt;&lt;a href=&quot;#安装-Watchtower&quot; class=&quot;headerlink&quot; title=&quot;安装 Watchtower&quot;&gt;&lt;/a&gt;安装 Watchtower&lt;/h3&gt;&lt;p&gt;要开始使用 &lt;code&gt;watchtower&lt;/code&gt;，首先需要安装并运行它。你可以通过以下命令来运行 &lt;code&gt;watchtower&lt;/code&gt;：&lt;/p&gt;</summary>
    
    
    
    <category term="docker" scheme="https://blog.48626.xyz/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.48626.xyz/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>进入一个无法启动的Docker容器中故障排查</title>
    <link href="https://blog.48626.xyz/92de010fa9c7.html"/>
    <id>https://blog.48626.xyz/92de010fa9c7.html</id>
    <published>2024-08-19T07:56:42.000Z</published>
    <updated>2024-08-19T07:56:42.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-使用-docker-ps-a-查看容器状态"><a href="#1-使用-docker-ps-a-查看容器状态" class="headerlink" title="1. 使用 docker ps -a 查看容器状态"></a>1. 使用 <code>docker ps -a</code> 查看容器状态</h3><p>首先，确认容器的状态和容器 ID 或名称：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p>找到你想进入的容器，并记下它的容器 ID 或名称。</p><h3 id="2-启动容器并进入"><a href="#2-启动容器并进入" class="headerlink" title="2. 启动容器并进入"></a>2. 启动容器并进入</h3><p>如果容器因为配置文件问题无法启动，你可以使用 <code>docker run</code> 或 <code>docker start</code> 命令启动容器，然后使用 <code>docker exec</code> 命令进入容器中。</p><h4 id="方法一：通过-docker-start-启动并进入容器"><a href="#方法一：通过-docker-start-启动并进入容器" class="headerlink" title="方法一：通过 docker start 启动并进入容器"></a>方法一：通过 <code>docker start</code> 启动并进入容器</h4><ol><li>先启动容器：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start &lt;container_id_or_name&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>然后使用 <code>docker exec</code> 进入容器：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it &lt;container_id_or_name&gt; /bin/bash</span><br></pre></td></tr></table></figure><h4 id="方法二：如果容器启动后立即退出"><a href="#方法二：如果容器启动后立即退出" class="headerlink" title="方法二：如果容器启动后立即退出"></a>方法二：如果容器启动后立即退出</h4><p>在这种情况下，你可以直接使用以下命令启动一个新的临时容器，并挂载原有容器的数据卷进行调试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --<span class="built_in">rm</span> --entrypoint /bin/bash &lt;image_name&gt; -v /path/to/container/config:/path/in/container</span><br></pre></td></tr></table></figure><p>这条命令会启动一个新的容器，进入 <code>bash</code>，并挂载原来容器的配置文件目录。</p><h3 id="3-调整启动命令以进入容器"><a href="#3-调整启动命令以进入容器" class="headerlink" title="3. 调整启动命令以进入容器"></a>3. 调整启动命令以进入容器</h3><p>如果容器是由于配置错误而无法启动的，你可以临时修改容器的启动命令。使用以下命令来启动容器并进入一个交互式 shell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --entrypoint /bin/bash &lt;image_name&gt;</span><br></pre></td></tr></table></figure><p>在进入容器后，你可以查看和修改配置文件。</p><h3 id="4-检查并修改配置文件"><a href="#4-检查并修改配置文件" class="headerlink" title="4. 检查并修改配置文件"></a>4. 检查并修改配置文件</h3><p>进入容器后，使用 <code>cat</code>, <code>vi</code>, <code>nano</code> 等命令查看和编辑配置文件，查找可能导致问题的配置项。</p><h3 id="5-保存修改并重启容器"><a href="#5-保存修改并重启容器" class="headerlink" title="5. 保存修改并重启容器"></a>5. 保存修改并重启容器</h3><p>修改完配置文件后，退出容器并重新启动容器，看问题是否解决。</p><h3 id="6-查看容器日志"><a href="#6-查看容器日志" class="headerlink" title="6. 查看容器日志"></a>6. 查看容器日志</h3><p>如果容器无法启动，你也可以查看容器日志，帮助你诊断问题：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs &lt;container_id_or_name&gt;</span><br></pre></td></tr></table></figure><p>这将显示容器的标准输出和错误信息日志，可能会给你提供有关配置文件问题的线索。</p><p>通过以上步骤，你应该能够进入容器并检查和修改配置文件，找出导致启动失败的问题。如果仍有问题，可以根据日志或错误信息进一步排查。</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;1-使用-docker-ps-a-查看容器状态&quot;&gt;&lt;a href=&quot;#1-使用-docker-ps-a-查看容器状态&quot; class=&quot;headerlink&quot; title=&quot;1. 使用 docker ps -a 查看容器状态&quot;&gt;&lt;/a&gt;1. 使用 &lt;code&gt;docker ps -a&lt;/code&gt; 查看容器状态&lt;/h3&gt;&lt;p&gt;首先，确认容器的状态和容器 ID 或名称：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker ps -a&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="docker" scheme="https://blog.48626.xyz/categories/docker/"/>
    
    
    <category term="docker" scheme="https://blog.48626.xyz/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>生成没有前导零的时间格式</title>
    <link href="https://blog.48626.xyz/a50057efe8bd.html"/>
    <id>https://blog.48626.xyz/a50057efe8bd.html</id>
    <published>2024-08-16T03:22:26.000Z</published>
    <updated>2024-08-16T03:22:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>在Java编程中，处理时间格式是一个常见的任务，尤其是在需要特定时间格式输出时。对于一些应用场景，我们可能需要生成没有前导零的时间格式。例如，在一些报告或用户界面中，显示<code>9:5</code>而不是<code>09:05</code>可能看起来更自然或符合特定的设计要求。本文将详细介绍如何在Java中实现这一功能。</p><h4 id="使用SimpleDateFormat类"><a href="#使用SimpleDateFormat类" class="headerlink" title="使用SimpleDateFormat类"></a>使用<code>SimpleDateFormat</code>类</h4><p>在Java中，<code>SimpleDateFormat</code>是处理日期和时间格式的一个非常强大的工具。但是，<code>SimpleDateFormat</code>并没有直接提供去除前导零的选项。不过，我们可以通过一些简单的技巧来实现这一需求。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">cal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 标准的时间格式，包含前导零</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;标准时间（有前导零）: &quot;</span> + sdf.format(cal.getTime()));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 自定义格式去除前导零</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">customTime</span> <span class="operator">=</span> sdf.format(cal.getTime())</span><br><span class="line">            .replaceFirst(<span class="string">&quot;^0+(?!$)&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            .replaceAll(<span class="string">&quot;:0+&quot;</span>, <span class="string">&quot;:&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义时间（无前导零）: &quot;</span> + customTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上面的代码示例中，我们首先创建了一个<code>SimpleDateFormat</code>对象来生成标准的时间格式。然后，通过正则表达式替换的方式去除了小时和分钟的前导零。这种方法虽然有效，但它依赖于字符串操作，可能不是最优雅的解决方案。</p><h4 id="使用DateTimeFormatter类（Java-8-）"><a href="#使用DateTimeFormatter类（Java-8-）" class="headerlink" title="使用DateTimeFormatter类（Java 8+）"></a>使用<code>DateTimeFormatter</code>类（Java 8+）</h4><p>从Java 8开始，<code>DateTimeFormatter</code>类提供了更强大和灵活的日期时间格式化选项。我们可以使用这个类来直接构建没有前导零的时间格式。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LocalTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalTime.now();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用DateTimeFormatter创建没有前导零的时间格式</span></span><br><span class="line">        <span class="type">DateTimeFormatter</span> <span class="variable">dtf</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;H:m&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;时间（无前导零）: &quot;</span> + now.format(dtf));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个例子中，<code>H:m</code>模式指定了小时和分钟不带前导零的格式。这种方式不仅简洁，而且是类型安全的，避免了任何可能的类型转换错误。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>在Java中，根据你的Java版本和具体需求，你可以选择<code>SimpleDateFormat</code>或<code>DateTimeFormatter</code>来生成没有前导零的时间格式。对于Java 8及以上版本，推荐使用<code>DateTimeFormatter</code>因为它提供了更好的API支持和性能。通过这些工具，你可以灵活地处理时间格式，满足各种应用场景的需求。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在Java编程中，处理时间格式是一个常见的任务，尤其是在需要特定时间格式输出时。对于一些应用场景，我们可能需要生成没有前导零的时间格式。例如，在一些报告或用户界面中，显示&lt;code&gt;9:5&lt;/code&gt;而不是&lt;code&gt;09:05&lt;/code&gt;可能看起来更自然或符合特定的设计要求。本文将详细介绍如何在Java中实现这一功能。&lt;/p&gt;
&lt;h4 id=&quot;使用SimpleDateFormat类&quot;&gt;&lt;a href=&quot;#使用SimpleDateFormat类&quot; class=&quot;headerlink&quot; title=&quot;使用SimpleDateFormat类&quot;&gt;&lt;/a&gt;使用&lt;code&gt;SimpleDateFormat&lt;/code&gt;类&lt;/h4&gt;&lt;p&gt;在Java中，&lt;code&gt;SimpleDateFormat&lt;/code&gt;是处理日期和时间格式的一个非常强大的工具。但是，&lt;code&gt;SimpleDateFormat&lt;/code&gt;并没有直接提供去除前导零的选项。不过，我们可以通过一些简单的技巧来实现这一需求。&lt;/p&gt;</summary>
    
    
    
    <category term="Java" scheme="https://blog.48626.xyz/categories/Java/"/>
    
    
    <category term="Java" scheme="https://blog.48626.xyz/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>学生包全能油猴脚本[定位 + 摄像头]</title>
    <link href="https://blog.48626.xyz/2643f6ab131b.html"/>
    <id>https://blog.48626.xyz/2643f6ab131b.html</id>
    <published>2024-08-15T03:59:14.000Z</published>
    <updated>2024-08-15T03:59:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>安装后会在 education[.]github[.]com 页面右上角显示一个按钮，添加图片即可。<br>定位自动从OpenStreetMap获取学校经纬度，无需任何操作，和FakeLocation插件冲突，需提前关闭Fake Location插件</p><p><a href="https://pst.innomi.net/paste/jctrbukenwwdnb2qhevfzxtm/raw">https://pst.innomi.net/paste/jctrbukenwwdnb2qhevfzxtm/raw</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         Enhanced Virtual Camera Hook</span></span><br><span class="line"><span class="comment">// @namespace    updownup</span></span><br><span class="line"><span class="comment">// @version      1.0</span></span><br><span class="line"><span class="comment">// @description  Hook various camera APIs</span></span><br><span class="line"><span class="comment">// @match        *://education.github.com/*</span></span><br><span class="line"><span class="comment">// @match        *://webcamtests.com/*</span></span><br><span class="line"><span class="comment">// @match        *://www.veed.io/*</span></span><br><span class="line"><span class="comment">// @match        *://webcammictest.com/*</span></span><br><span class="line"><span class="comment">// @match        *://www.onlinemictest.com/*</span></span><br><span class="line"><span class="comment">// @grant        unsafeWindow</span></span><br><span class="line"><span class="comment">// @grant        GM_xmlhttpRequest</span></span><br><span class="line"><span class="comment">// @run-at       document-start</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> base64Image;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Utility Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Utils</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="title function_">generateRandomBase64</span>(<span class="params">length</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> characters = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span>;</span><br><span class="line">            <span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">const</span> charactersLength = characters.<span class="property">length</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">                result += characters.<span class="title function_">charAt</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * charactersLength));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">getBase64Image</span>(<span class="params">defaultBase64Image</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> base64Image || defaultBase64Image;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Stealth UI Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">StealthUI</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">defaultBase64Image</span> = <span class="string">&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==&#x27;</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">createUI</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">createUI</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">            container.<span class="property">style</span>.<span class="property">all</span> = <span class="string">&#x27;initial&#x27;</span>;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">appendChild</span>(container);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> shadow = container.<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;closed&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> styles = <span class="string">`</span></span><br><span class="line"><span class="string">            :host &#123; all: initial; &#125;</span></span><br><span class="line"><span class="string">            #stealth-container &#123; position: fixed; top: 0; right: 0; z-index: 2147483647; background-color: rgba(0, 0, 0, 0); padding: 0; border-radius: 7px; transition: opacity 0.3s ease-in-out, background-color 0.3s ease-in-out; font-family: Arial, sans-serif; font-size: 12px; box-sizing: border-box; width: auto; max-width: 200px; opacity: 0.1; &#125;</span></span><br><span class="line"><span class="string">            #stealth-container:hover &#123; background-color: rgba(0, 220, 0, 0.25); opacity: 1; &#125;</span></span><br><span class="line"><span class="string">            #stealth-container.hidden &#123; opacity: 0; pointer-events: none; &#125;</span></span><br><span class="line"><span class="string">            #stealth-fileInput &#123; display: none; &#125;</span></span><br><span class="line"><span class="string">            #stealth-loadButton &#123; background-color: rgba(0, 0, 0, 0); border: none; padding: 5px; border-radius: 8px; cursor: pointer; font-size: inherit; width: 100%; text-align: center; color: black; transition: background-color 0.25s ease-in-out; &#125;</span></span><br><span class="line"><span class="string">            #stealth-loadButton:hover &#123; border-radius: 3px; cursor: pointer; background-color: rgba(25, 25, 25, 0.25); &#125;</span></span><br><span class="line"><span class="string">            #stealth-loadButton.done &#123; animation: spin 2s linear infinite; &#125;</span></span><br><span class="line"><span class="string">            @keyframes spin &#123; 0% &#123; transform: rotate(0deg); &#125; 100% &#123; transform: rotate(360deg); &#125; &#125;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> template = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;template&#x27;</span>);</span><br><span class="line">            template.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;style&gt;<span class="subst">$&#123;styles&#125;</span>&lt;/style&gt;</span></span><br><span class="line"><span class="string">            &lt;div id=&quot;stealth-container&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;input type=&quot;file&quot; id=&quot;stealth-fileInput&quot; accept=&quot;image/*&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;button id=&quot;stealth-loadButton&quot;&gt;Load&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line"></span><br><span class="line">            shadow.<span class="title function_">appendChild</span>(template.<span class="property">content</span>.<span class="title function_">cloneNode</span>(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> stealthContainer = shadow.<span class="title function_">getElementById</span>(<span class="string">&#x27;stealth-container&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> fileInput = shadow.<span class="title function_">getElementById</span>(<span class="string">&#x27;stealth-fileInput&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> loadButton = shadow.<span class="title function_">getElementById</span>(<span class="string">&#x27;stealth-loadButton&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            loadButton.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">                fileInput.<span class="title function_">click</span>();</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            fileInput.<span class="property">onchange</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">                <span class="keyword">if</span> (fileInput.<span class="property">files</span> &amp;&amp; fileInput.<span class="property">files</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">                    loadButton.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;done&#x27;</span>);</span><br><span class="line">                    loadButton.<span class="property">textContent</span> = <span class="string">&#x27;...&#x27;</span>;</span><br><span class="line">                    <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">                    reader.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                        base64Image = e.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">                        loadButton.<span class="property">textContent</span> = <span class="string">&#x27;√&#x27;</span>;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    reader.<span class="title function_">readAsDataURL</span>(fileInput.<span class="property">files</span>[<span class="number">0</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Virtual Stream Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">VirtualStream</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">width = <span class="number">1280</span>, height = <span class="number">720</span>, fps = <span class="number">30</span></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">width</span> = width;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">height</span> = height;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">fps</span> = fps;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">createNoiseLayer</span>(<span class="params">opacity = <span class="number">0.26149721</span></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            canvas.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">            canvas.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> imageData = ctx.<span class="title function_">createImageData</span>(<span class="variable language_">this</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">height</span>);</span><br><span class="line">            <span class="keyword">const</span> data = imageData.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> noise = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>;</span><br><span class="line">                data[i] = data[i + <span class="number">1</span>] = data[i + <span class="number">2</span>] = noise;</span><br><span class="line">                data[i + <span class="number">3</span>] = opacity * <span class="number">255</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ctx.<span class="title function_">putImageData</span>(imageData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> canvas;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">drawImageCovered</span>(<span class="params">ctx, img, x, y, w, h</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> imgRatio = img.<span class="property">width</span> / img.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> canvasRatio = w / h;</span><br><span class="line">            <span class="keyword">let</span> sx, sy, sWidth, sHeight;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (imgRatio &gt; canvasRatio) &#123;</span><br><span class="line">                sHeight = img.<span class="property">height</span>;</span><br><span class="line">                sWidth = sHeight * canvasRatio;</span><br><span class="line">                sx = (img.<span class="property">width</span> - sWidth) / <span class="number">2</span>;</span><br><span class="line">                sy = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sWidth = img.<span class="property">width</span>;</span><br><span class="line">                sHeight = sWidth / canvasRatio;</span><br><span class="line">                sx = <span class="number">0</span>;</span><br><span class="line">                sy = (img.<span class="property">height</span> - sHeight) / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ctx.<span class="title function_">drawImage</span>(img, sx, sy, sWidth, sHeight, x, y, w, h);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">createDynamicFilteredStream</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            canvas.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">            canvas.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">            img.<span class="property">src</span> = <span class="keyword">await</span> <span class="title class_">Utils</span>.<span class="title function_">getBase64Image</span>(<span class="keyword">new</span> <span class="title class_">StealthUI</span>().<span class="property">defaultBase64Image</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> offscreenCanvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            offscreenCanvas.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">            offscreenCanvas.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> offscreenCtx = offscreenCanvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            img.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">drawImageCovered</span>(offscreenCtx, img, <span class="number">0</span>, <span class="number">0</span>, offscreenCanvas.<span class="property">width</span>, offscreenCanvas.<span class="property">height</span>);</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> noiseLayer = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">createNoiseLayer</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> hue = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">let</span> saturate = <span class="number">100</span>;</span><br><span class="line">            <span class="keyword">let</span> brightness = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">generateFrame</span>(<span class="params"></span>) &#123;</span><br><span class="line">                hue = (hue + <span class="number">0.1</span>) % <span class="number">2</span>;</span><br><span class="line">                saturate = <span class="number">99</span> + <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) * <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">                brightness = <span class="number">98</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">                ctx.<span class="title function_">drawImage</span>(offscreenCanvas, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                ctx.<span class="property">filter</span> = <span class="string">`hue-rotate(<span class="subst">$&#123;hue&#125;</span>deg) saturate(<span class="subst">$&#123;saturate&#125;</span>%) brightness(<span class="subst">$&#123;brightness&#125;</span>%)`</span>;</span><br><span class="line">                ctx.<span class="title function_">drawImage</span>(canvas, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                ctx.<span class="property">filter</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                ctx.<span class="property">globalCompositeOperation</span> = <span class="string">&#x27;overlay&#x27;</span>;</span><br><span class="line">                ctx.<span class="title function_">drawImage</span>(noiseLayer, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                ctx.<span class="property">globalCompositeOperation</span> = <span class="string">&#x27;source-over&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> stream = canvas.<span class="title function_">captureStream</span>(<span class="variable language_">this</span>.<span class="property">fps</span>);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">setInterval</span>(generateFrame, <span class="number">1000</span> / <span class="variable language_">this</span>.<span class="property">fps</span>);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                noiseLayer = <span class="variable language_">this</span>.<span class="title function_">createNoiseLayer</span>();</span><br><span class="line">            &#125;, <span class="number">100</span> + <span class="title class_">Math</span>.<span class="title function_">sin</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>) * <span class="number">150</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> stream;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">createWebGLFilteredStream</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">            canvas.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">width</span>;</span><br><span class="line">            canvas.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">            <span class="keyword">const</span> gl = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;webgl&#x27;</span>) || canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;experimental-webgl&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!gl) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;WebGL not supported, falling back to 2D canvas&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">createDynamicFilteredStream</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> vertexShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">                attribute vec2 a_position;</span></span><br><span class="line"><span class="string">                attribute vec2 a_texCoord;</span></span><br><span class="line"><span class="string">                varying vec2 v_texCoord;</span></span><br><span class="line"><span class="string">                void main() &#123;</span></span><br><span class="line"><span class="string">                    gl_Position = vec4(a_position, 0, 1);</span></span><br><span class="line"><span class="string">                    v_texCoord = a_texCoord;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> fragmentShaderSource = <span class="string">`</span></span><br><span class="line"><span class="string">                precision mediump float;</span></span><br><span class="line"><span class="string">                uniform sampler2D u_image;</span></span><br><span class="line"><span class="string">                uniform sampler2D u_noise;</span></span><br><span class="line"><span class="string">                uniform float u_time;</span></span><br><span class="line"><span class="string">                uniform vec2 u_noiseOffset;</span></span><br><span class="line"><span class="string">                varying vec2 v_texCoord;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                vec3 rgb2hsv(vec3 c) &#123;</span></span><br><span class="line"><span class="string">                    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);</span></span><br><span class="line"><span class="string">                    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));</span></span><br><span class="line"><span class="string">                    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));</span></span><br><span class="line"><span class="string">                    float d = q.x - min(q.w, q.y);</span></span><br><span class="line"><span class="string">                    float e = 1.0e-10;</span></span><br><span class="line"><span class="string">                    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                vec3 hsv2rgb(vec3 c) &#123;</span></span><br><span class="line"><span class="string">                    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);</span></span><br><span class="line"><span class="string">                    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);</span></span><br><span class="line"><span class="string">                    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                void main() &#123;</span></span><br><span class="line"><span class="string">                    vec4 color = texture2D(u_image, vec2(v_texCoord.x, 1.0 - v_texCoord.y));</span></span><br><span class="line"><span class="string">                    vec4 noise = texture2D(u_noise, v_texCoord * 4.0 + u_noiseOffset);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    vec3 hsv = rgb2hsv(color.rgb);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    float saturationAdjust = 0.99 + sin(u_time * 0.002) * 0.01;</span></span><br><span class="line"><span class="string">                    hsv.y *= saturationAdjust;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    float brightnessAdjust = 0.98 + 0.02 * fract(sin(dot(v_texCoord, vec2(12.9898, 78.233))) * 43758.5453);</span></span><br><span class="line"><span class="string">                    hsv.z *= brightnessAdjust;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    vec3 rgb = hsv2rgb(hsv);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    gl_FragColor = vec4(rgb, color.a) + noise * 0.1;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">createShader</span>(<span class="params">gl, type, source</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> shader = gl.<span class="title function_">createShader</span>(type);</span><br><span class="line">                gl.<span class="title function_">shaderSource</span>(shader, source);</span><br><span class="line">                gl.<span class="title function_">compileShader</span>(shader);</span><br><span class="line">                <span class="keyword">if</span> (!gl.<span class="title function_">getShaderParameter</span>(shader, gl.<span class="property">COMPILE_STATUS</span>)) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;An error occurred compiling the shaders: &#x27;</span> + gl.<span class="title function_">getShaderInfoLog</span>(shader));</span><br><span class="line">                    gl.<span class="title function_">deleteShader</span>(shader);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> shader;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> vertexShader = <span class="title function_">createShader</span>(gl, gl.<span class="property">VERTEX_SHADER</span>, vertexShaderSource);</span><br><span class="line">            <span class="keyword">const</span> fragmentShader = <span class="title function_">createShader</span>(gl, gl.<span class="property">FRAGMENT_SHADER</span>, fragmentShaderSource);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> program = gl.<span class="title function_">createProgram</span>();</span><br><span class="line">            gl.<span class="title function_">attachShader</span>(program, vertexShader);</span><br><span class="line">            gl.<span class="title function_">attachShader</span>(program, fragmentShader);</span><br><span class="line">            gl.<span class="title function_">linkProgram</span>(program);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!gl.<span class="title function_">getProgramParameter</span>(program, gl.<span class="property">LINK_STATUS</span>)) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Unable to initialize the shader program: &#x27;</span> + gl.<span class="title function_">getProgramInfoLog</span>(program));</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> positionBuffer = gl.<span class="title function_">createBuffer</span>();</span><br><span class="line">            gl.<span class="title function_">bindBuffer</span>(gl.<span class="property">ARRAY_BUFFER</span>, positionBuffer);</span><br><span class="line">            gl.<span class="title function_">bufferData</span>(gl.<span class="property">ARRAY_BUFFER</span>, <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">                -<span class="number">1</span>, -<span class="number">1</span>,</span><br><span class="line">                <span class="number">1</span>, -<span class="number">1</span>,</span><br><span class="line">                -<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">            ]), gl.<span class="property">STATIC_DRAW</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> texCoordBuffer = gl.<span class="title function_">createBuffer</span>();</span><br><span class="line">            gl.<span class="title function_">bindBuffer</span>(gl.<span class="property">ARRAY_BUFFER</span>, texCoordBuffer);</span><br><span class="line">            gl.<span class="title function_">bufferData</span>(gl.<span class="property">ARRAY_BUFFER</span>, <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">            ]), gl.<span class="property">STATIC_DRAW</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> positionLocation = gl.<span class="title function_">getAttribLocation</span>(program, <span class="string">&#x27;a_position&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> texCoordLocation = gl.<span class="title function_">getAttribLocation</span>(program, <span class="string">&#x27;a_texCoord&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            gl.<span class="title function_">useProgram</span>(program);</span><br><span class="line">            gl.<span class="title function_">enableVertexAttribArray</span>(positionLocation);</span><br><span class="line">            gl.<span class="title function_">enableVertexAttribArray</span>(texCoordLocation);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> imageTexture = gl.<span class="title function_">createTexture</span>();</span><br><span class="line">            gl.<span class="title function_">bindTexture</span>(gl.<span class="property">TEXTURE_2D</span>, imageTexture);</span><br><span class="line">            gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_WRAP_S</span>, gl.<span class="property">CLAMP_TO_EDGE</span>);</span><br><span class="line">            gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_WRAP_T</span>, gl.<span class="property">CLAMP_TO_EDGE</span>);</span><br><span class="line">            gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_MIN_FILTER</span>, gl.<span class="property">LINEAR</span>);</span><br><span class="line">            gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_MAG_FILTER</span>, gl.<span class="property">LINEAR</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">            img.<span class="property">src</span> = <span class="keyword">await</span> <span class="title class_">Utils</span>.<span class="title function_">getBase64Image</span>(<span class="keyword">new</span> <span class="title class_">StealthUI</span>().<span class="property">defaultBase64Image</span>);</span><br><span class="line">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> img.<span class="property">onload</span> = resolve);</span><br><span class="line"></span><br><span class="line">            gl.<span class="title function_">texImage2D</span>(gl.<span class="property">TEXTURE_2D</span>, <span class="number">0</span>, gl.<span class="property">RGBA</span>, gl.<span class="property">RGBA</span>, gl.<span class="property">UNSIGNED_BYTE</span>, img);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">createNoiseTexture</span>(<span class="params">gl, size</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> pixels = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(size * size * <span class="number">4</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pixels.<span class="property">length</span>; i += <span class="number">4</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> noise = <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>;</span><br><span class="line">                    pixels[i] = pixels[i + <span class="number">1</span>] = pixels[i + <span class="number">2</span>] = noise;</span><br><span class="line">                    pixels[i + <span class="number">3</span>] = <span class="number">255</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">const</span> texture = gl.<span class="title function_">createTexture</span>();</span><br><span class="line">                gl.<span class="title function_">bindTexture</span>(gl.<span class="property">TEXTURE_2D</span>, texture);</span><br><span class="line">                gl.<span class="title function_">texImage2D</span>(gl.<span class="property">TEXTURE_2D</span>, <span class="number">0</span>, gl.<span class="property">RGBA</span>, size, size, <span class="number">0</span>, gl.<span class="property">RGBA</span>, gl.<span class="property">UNSIGNED_BYTE</span>, pixels);</span><br><span class="line">                gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_MIN_FILTER</span>, gl.<span class="property">LINEAR</span>);</span><br><span class="line">                gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_MAG_FILTER</span>, gl.<span class="property">LINEAR</span>);</span><br><span class="line">                gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_WRAP_S</span>, gl.<span class="property">REPEAT</span>);</span><br><span class="line">                gl.<span class="title function_">texParameteri</span>(gl.<span class="property">TEXTURE_2D</span>, gl.<span class="property">TEXTURE_WRAP_T</span>, gl.<span class="property">REPEAT</span>);</span><br><span class="line">                <span class="keyword">return</span> texture;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> noiseTexture = <span class="title function_">createNoiseTexture</span>(gl, <span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> u_image = gl.<span class="title function_">getUniformLocation</span>(program, <span class="string">&#x27;u_image&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> u_noise = gl.<span class="title function_">getUniformLocation</span>(program, <span class="string">&#x27;u_noise&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> u_time = gl.<span class="title function_">getUniformLocation</span>(program, <span class="string">&#x27;u_time&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> u_noiseOffset = gl.<span class="title function_">getUniformLocation</span>(program, <span class="string">&#x27;u_noiseOffset&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            gl.<span class="title function_">uniform1i</span>(u_image, <span class="number">0</span>);</span><br><span class="line">            gl.<span class="title function_">uniform1i</span>(u_noise, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> noiseOffsetX = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">let</span> noiseOffsetY = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">time</span>) &#123;</span><br><span class="line">                gl.<span class="title function_">bindBuffer</span>(gl.<span class="property">ARRAY_BUFFER</span>, positionBuffer);</span><br><span class="line">                gl.<span class="title function_">vertexAttribPointer</span>(positionLocation, <span class="number">2</span>, gl.<span class="property">FLOAT</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">bindBuffer</span>(gl.<span class="property">ARRAY_BUFFER</span>, texCoordBuffer);</span><br><span class="line">                gl.<span class="title function_">vertexAttribPointer</span>(texCoordLocation, <span class="number">2</span>, gl.<span class="property">FLOAT</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">activeTexture</span>(gl.<span class="property">TEXTURE0</span>);</span><br><span class="line">                gl.<span class="title function_">bindTexture</span>(gl.<span class="property">TEXTURE_2D</span>, imageTexture);</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">activeTexture</span>(gl.<span class="property">TEXTURE1</span>);</span><br><span class="line">                gl.<span class="title function_">bindTexture</span>(gl.<span class="property">TEXTURE_2D</span>, noiseTexture);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Update noise offset</span></span><br><span class="line">                noiseOffsetX = (noiseOffsetX + <span class="number">0.001</span>) % <span class="number">1</span>;</span><br><span class="line">                noiseOffsetY = (noiseOffsetY + <span class="number">0.001</span>) % <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">uniform1f</span>(u_time, time);</span><br><span class="line">                gl.<span class="title function_">uniform2f</span>(u_noiseOffset, noiseOffsetX, noiseOffsetY);</span><br><span class="line"></span><br><span class="line">                gl.<span class="title function_">drawArrays</span>(gl.<span class="property">TRIANGLE_STRIP</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> fps = <span class="variable language_">this</span>.<span class="property">fps</span>;</span><br><span class="line">            <span class="keyword">const</span> stream = canvas.<span class="title function_">captureStream</span>(fps);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> lastTime = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">update</span>(<span class="params">currentTime</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (currentTime - lastTime &gt;= <span class="number">1000</span> / fps) &#123;</span><br><span class="line">                    <span class="title function_">render</span>(currentTime);</span><br><span class="line">                    lastTime = currentTime;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">requestAnimationFrame</span>(update);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="title function_">update</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> stream;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">createVirtualStream</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">createWebGLFilteredStream</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- API Hook Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">APIHook</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span> = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span> = <span class="title class_">Utils</span>.<span class="title function_">generateRandomBase64</span>(<span class="number">43</span>) + <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">virtualGroupId</span> = <span class="title class_">Utils</span>.<span class="title function_">generateRandomBase64</span>(<span class="number">43</span>) + <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookMediaDevices</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookRTCPeerConnection</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookMediaStreamTrack</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookImageCapture</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">hookGeolocation</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title class_">Quenching</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Quenching</span>() &#123;</span><br><span class="line">            <span class="keyword">const</span> originalToString = <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line">            <span class="keyword">const</span> map = <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>;</span><br><span class="line"></span><br><span class="line">            <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(originalToString, &#123;</span><br><span class="line">                <span class="title function_">apply</span>(<span class="params">target, thisArg, argumentsList</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> thisArg?.<span class="property">call</span> !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">apply</span>(target, thisArg, argumentsList);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (map.<span class="title function_">has</span>(thisArg)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">apply</span>(target, map.<span class="title function_">get</span>(thisArg), argumentsList);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">apply</span>(target, thisArg, argumentsList);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Helper function to replace a method with a hook</span></span><br><span class="line">        <span class="title function_">replaceMethod</span>(<span class="params">obj, methodName, newMethod</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> oldMethod = obj[methodName]</span><br><span class="line">            obj[methodName] = newMethod;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">set</span>(newMethod, oldMethod);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook navigator.mediaDevices methods</span></span><br><span class="line">        <span class="title function_">hookMediaDevices</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">mediaDevices</span>, <span class="string">&#x27;enumerateDevices&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="keyword">const</span> devices = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">get</span>(navigator.<span class="property">mediaDevices</span>.<span class="property">enumerateDevices</span>).<span class="title function_">call</span>(navigator.<span class="property">mediaDevices</span>);</span><br><span class="line">                <span class="keyword">const</span> virtualDevice = <span class="keyword">new</span> <span class="title class_">MediaDeviceInfo</span>(&#123;</span><br><span class="line">                    <span class="attr">deviceId</span>: <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>,</span><br><span class="line">                    <span class="attr">groupId</span>: <span class="variable language_">this</span>.<span class="property">virtualGroupId</span>,</span><br><span class="line">                    <span class="attr">kind</span>: <span class="string">&#x27;videoinput&#x27;</span>,</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;Integrated Webcam&#x27;</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> [virtualDevice, ...devices];</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">mediaDevices</span>, <span class="string">&#x27;getUserMedia&#x27;</span>, <span class="keyword">async</span> (constraints) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (constraints &amp;&amp; constraints.<span class="property">video</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">VirtualStream</span>().<span class="title function_">createVirtualStream</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">get</span>(navigator.<span class="property">mediaDevices</span>.<span class="property">getUserMedia</span>).<span class="title function_">call</span>(navigator.<span class="property">mediaDevices</span>, constraints);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">mediaDevices</span>, <span class="string">&#x27;getDisplayMedia&#x27;</span>, <span class="keyword">async</span> (constraints) =&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">VirtualStream</span>().<span class="title function_">createVirtualStream</span>();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook RTCPeerConnection</span></span><br><span class="line">        <span class="title function_">hookRTCPeerConnection</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(<span class="variable language_">window</span>, <span class="string">&#x27;RTCPeerConnection&#x27;</span>, (<span class="function"><span class="params">originalRTCPeerConnection</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> pc = <span class="keyword">new</span> <span class="title function_">originalRTCPeerConnection</span>(...args);</span><br><span class="line"></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(pc, <span class="string">&#x27;addTrack&#x27;</span>, (<span class="function"><span class="params">originalAddTrack</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (args[<span class="number">0</span>] &amp;&amp; args[<span class="number">0</span>].<span class="property">kind</span> === <span class="string">&#x27;video&#x27;</span> &amp;&amp; args[<span class="number">0</span>].<span class="title function_">getSettings</span>().<span class="property">deviceId</span> === <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>) &#123;</span><br><span class="line">                                <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">VirtualStream</span>().<span class="title function_">createVirtualStream</span>();</span><br><span class="line">                                <span class="keyword">const</span> [videoTrack] = stream.<span class="title function_">getVideoTracks</span>();</span><br><span class="line">                                <span class="keyword">return</span> originalAddTrack.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="keyword">new</span> <span class="title class_">VirtualTrack</span>(videoTrack), ...args.<span class="title function_">slice</span>(<span class="number">1</span>));</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> originalAddTrack.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> pc;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>)(<span class="variable language_">window</span>.<span class="property">RTCPeerConnection</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook MediaStreamTrack</span></span><br><span class="line">        <span class="title function_">hookMediaStreamTrack</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(<span class="variable language_">window</span>, <span class="string">&#x27;MediaStreamTrack&#x27;</span>, (<span class="function"><span class="params">originalMediaStreamTrack</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> track = <span class="keyword">new</span> <span class="title function_">originalMediaStreamTrack</span>(...args);</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(track, <span class="string">&#x27;getSettings&#x27;</span>, (<span class="function"><span class="params">originalGetSettings</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> settings = originalGetSettings.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">                            <span class="keyword">if</span> (settings.<span class="property">deviceId</span> === <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>) &#123;</span><br><span class="line">                                <span class="keyword">return</span> &#123;</span><br><span class="line">                                    ...settings,</span><br><span class="line">                                    <span class="attr">deviceId</span>: <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>,</span><br><span class="line">                                    <span class="attr">groupId</span>: <span class="variable language_">this</span>.<span class="property">virtualGroupId</span>,</span><br><span class="line">                                    <span class="attr">width</span>: <span class="number">1280</span>,</span><br><span class="line">                                    <span class="attr">height</span>: <span class="number">720</span>,</span><br><span class="line">                                    <span class="attr">aspectRatio</span>: <span class="number">16</span> / <span class="number">9</span>,</span><br><span class="line">                                    <span class="attr">frameRate</span>: <span class="number">30</span>,</span><br><span class="line">                                    <span class="attr">facingMode</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">                                    <span class="attr">resizeMode</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">                                &#125;;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">return</span> settings;</span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> track;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>)(<span class="variable language_">window</span>.<span class="property">MediaStreamTrack</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook ImageCapture</span></span><br><span class="line">        <span class="title function_">hookImageCapture</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(<span class="variable language_">window</span>, <span class="string">&#x27;ImageCapture&#x27;</span>, (<span class="function"><span class="params">originalImageCapture</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">track</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (track.<span class="property">kind</span> === <span class="string">&#x27;video&#x27;</span> &amp;&amp; track.<span class="title function_">getSettings</span>().<span class="property">deviceId</span> === <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> virtualTrack = <span class="keyword">new</span> <span class="title class_">VirtualTrack</span>(track);</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">originalImageCapture</span>(virtualTrack);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">originalImageCapture</span>(track);</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>)(<span class="variable language_">window</span>.<span class="property">ImageCapture</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Geolocation Spoofing</span></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">getCoordinatesFromAddress</span>(<span class="params">address</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">GM_xmlhttpRequest</span>(&#123;</span><br><span class="line">                    <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">`https://nominatim.openstreetmap.org/search?q=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(address)&#125;</span>&amp;format=json`</span>,</span><br><span class="line">                    <span class="attr">onload</span>: <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (response.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">                            <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(response.<span class="property">responseText</span>);</span><br><span class="line">                            <span class="keyword">if</span> (data.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="title function_">resolve</span>(&#123;</span><br><span class="line">                                    <span class="attr">latitude</span>: <span class="built_in">parseFloat</span>(data[<span class="number">0</span>].<span class="property">lat</span>),</span><br><span class="line">                                    <span class="attr">longitude</span>: <span class="built_in">parseFloat</span>(data[<span class="number">0</span>].<span class="property">lon</span>)</span><br><span class="line">                                &#125;);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No results found&quot;</span>));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`Request failed with status <span class="subst">$&#123;response.status&#125;</span>`</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">onerror</span>: <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">                        <span class="title function_">reject</span>(error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">getRandomOffset</span>(<span class="params">maxOffset = <span class="number">0.00005</span></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() - <span class="number">0.5</span>) * <span class="number">2</span> * maxOffset;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">updateMockedGeolocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> schoolInput = <span class="variable language_">document</span>.evaluate(<span class="string">&#x27;//*[@id=&quot;school-input&quot;]&#x27;</span>, <span class="variable language_">document</span>, <span class="literal">null</span>, <span class="title class_">XPathResult</span>.<span class="property">FIRST_ORDERED_NODE_TYPE</span>, <span class="literal">null</span>).<span class="property">singleNodeValue</span>;</span><br><span class="line">            <span class="keyword">if</span> (schoolInput &amp;&amp; schoolInput.<span class="property">value</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> coordinates = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">getCoordinatesFromAddress</span>(schoolInput.<span class="property">value</span>);</span><br><span class="line">                    <span class="keyword">if</span> (coordinates) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">mockedGeolocation</span> = &#123;</span><br><span class="line">                            <span class="attr">latitude</span>: coordinates.<span class="property">latitude</span> + <span class="variable language_">this</span>.<span class="title function_">getRandomOffset</span>(),</span><br><span class="line">                            <span class="attr">longitude</span>: coordinates.<span class="property">longitude</span> + <span class="variable language_">this</span>.<span class="title function_">getRandomOffset</span>(),</span><br><span class="line">                            <span class="attr">accuracy</span>: <span class="number">30</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">20</span></span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error updating mocked geolocation:&quot;</span>, error);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook Geolocation</span></span><br><span class="line">        <span class="title function_">hookGeolocation</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">geolocation</span>, <span class="string">&#x27;getCurrentPosition&#x27;</span>, <span class="keyword">async</span> (successCallback, errorCallback, options) =&gt; &#123;</span><br><span class="line">                <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">updateMockedGeolocation</span>();</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>) &#123;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">successCallback</span>(&#123;</span><br><span class="line">                            <span class="attr">coords</span>: &#123;</span><br><span class="line">                                <span class="attr">latitude</span>: <span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>.<span class="property">latitude</span>,</span><br><span class="line">                                <span class="attr">longitude</span>: <span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>.<span class="property">longitude</span>,</span><br><span class="line">                                <span class="attr">accuracy</span>: <span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>.<span class="property">accuracy</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;, <span class="number">2500</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">500</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">get</span>(navigator.<span class="property">geolocation</span>.<span class="property">getCurrentPosition</span>).<span class="title function_">call</span>(navigator.<span class="property">geolocation</span>, successCallback, errorCallback, options);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">geolocation</span>, <span class="string">&#x27;watchPosition&#x27;</span>, <span class="keyword">async</span> (successCallback, errorCallback, options) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">mockedGeolocation</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> watchId = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        navigator.<span class="property">geolocation</span>.<span class="title function_">getCurrentPosition</span>(successCallback, errorCallback, options);</span><br><span class="line">                    &#125;, <span class="number">5000</span>);</span><br><span class="line">                    <span class="keyword">return</span> watchId;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">methodsLookupTable</span>.<span class="title function_">get</span>(navigator.<span class="property">geolocation</span>.<span class="property">watchPosition</span>).<span class="title function_">call</span>(navigator.<span class="property">geolocation</span>, successCallback, errorCallback, options);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">replaceMethod</span>(navigator.<span class="property">geolocation</span>, <span class="string">&#x27;clearWatch&#x27;</span>, <span class="function">(<span class="params">watchId</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(watchId);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Virtual Track Class --------</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">VirtualTrack</span> &#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params">originalTrack</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">originalTrack</span> = originalTrack;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">muted</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">constraints</span> = &#123;&#125;;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">settings</span> = &#123;</span><br><span class="line">                <span class="attr">deviceId</span>: <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>,</span><br><span class="line">                <span class="attr">groupId</span>: <span class="variable language_">this</span>.<span class="property">virtualGroupId</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">1280</span>,</span><br><span class="line">                <span class="attr">height</span>: <span class="number">720</span>,</span><br><span class="line">                <span class="attr">aspectRatio</span>: <span class="number">16</span> / <span class="number">9</span>,</span><br><span class="line">                <span class="attr">frameRate</span>: <span class="number">30</span>,</span><br><span class="line">                <span class="attr">facingMode</span>: <span class="string">&#x27;user&#x27;</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">id</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">virtualDeviceId</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">kind</span>() &#123; <span class="keyword">return</span> <span class="string">&#x27;video&#x27;</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">label</span>() &#123; <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">enabled</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">enabled</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">muted</span>() &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">muted</span>; &#125;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">readyState</span>() &#123; <span class="keyword">return</span> <span class="string">&#x27;live&#x27;</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">getConstraints</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> &#123; ...<span class="variable language_">this</span>.<span class="property">constraints</span> &#125;; &#125;</span><br><span class="line">        <span class="title function_">getSettings</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> &#123; ...<span class="variable language_">this</span>.<span class="property">settings</span> &#125;; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">getCapabilities</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">width</span>: &#123; <span class="attr">min</span>: <span class="number">640</span>, <span class="attr">max</span>: <span class="number">1920</span> &#125;,</span><br><span class="line">                <span class="attr">height</span>: &#123; <span class="attr">min</span>: <span class="number">480</span>, <span class="attr">max</span>: <span class="number">1080</span> &#125;,</span><br><span class="line">                <span class="attr">aspectRatio</span>: &#123; <span class="attr">min</span>: <span class="number">1.33</span>, <span class="attr">max</span>: <span class="number">1.78</span> &#125;,</span><br><span class="line">                <span class="attr">frameRate</span>: &#123; <span class="attr">min</span>: <span class="number">15</span>, <span class="attr">max</span>: <span class="number">60</span> &#125;,</span><br><span class="line">                <span class="attr">facingMode</span>: [<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;environment&#x27;</span>],</span><br><span class="line">                <span class="attr">resizeMode</span>: [<span class="string">&#x27;none&#x27;</span>, <span class="string">&#x27;crop-and-scale&#x27;</span>]</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">applyConstraints</span>(<span class="params">newConstraints</span>) &#123;</span><br><span class="line">            <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>.<span class="property">constraints</span>, newConstraints);</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">enabled</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">originalTrack</span>.<span class="title function_">stop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --------  Modify MediaDeviceInfo --------</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">OriginalMediaDeviceInfo</span> = unsafeWindow.<span class="property">MediaDeviceInfo</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">MediaDeviceInfo</span>(<span class="params">&#123; deviceId, groupId, kind, label &#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">MediaDeviceInfo</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MediaDeviceInfo</span>(&#123; deviceId, groupId, kind, label &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(<span class="variable language_">this</span>, &#123;</span><br><span class="line">            <span class="attr">deviceId</span>: &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> deviceId; &#125;,</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">groupId</span>: &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> groupId; &#125;,</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">kind</span>: &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> kind; &#125;,</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">label</span>: &#123;</span><br><span class="line">                <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> label; &#125;,</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">MediaDeviceInfo</span>, <span class="string">&#x27;length&#x27;</span>, &#123; <span class="attr">value</span>: <span class="number">0</span>, <span class="attr">writable</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">    <span class="title class_">MediaDeviceInfo</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">OriginalMediaDeviceInfo</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    <span class="title class_">MediaDeviceInfo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">MediaDeviceInfo</span>;</span><br><span class="line"></span><br><span class="line">    unsafeWindow.<span class="property">MediaDeviceInfo</span> = <span class="title class_">MediaDeviceInfo</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -------- Initialize --------</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">StealthUI</span>();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">APIHook</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Enhanced Virtual Camera Hook injected&#x27;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;安装后会在 education[.]github[.]com 页面右上角显示一个按钮，添加图片即可。&lt;br&gt;定位自动从OpenStreetMap获取学校经纬度，无需任何操作，和FakeLocation插件冲突，需提前关闭Fake Location插件&lt;/p&gt;

&lt;p&gt;&lt;a </summary>
      
    
    
    
    <category term="gitHub" scheme="https://blog.48626.xyz/categories/gitHub/"/>
    
    
    <category term="gitHub" scheme="https://blog.48626.xyz/tags/gitHub/"/>
    
  </entry>
  
</feed>
